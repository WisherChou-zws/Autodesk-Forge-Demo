{"version":3,"sources":["webpack://Autodesk.Extensions.[name]/webpack/bootstrap","webpack://Autodesk.Extensions.[name]/./node_modules/css-loader/lib/css-base.js","webpack://Autodesk.Extensions.[name]/./node_modules/style-loader/lib/addStyles.js","webpack://Autodesk.Extensions.[name]/./thirdparty/canvg/canvg.js","webpack://Autodesk.Extensions.[name]/./thirdparty/resize-observer-polyfill/ResizeObserver.min.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/Markups.css?c4d8","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/Markups.css","webpack://Autodesk.Extensions.[name]/./extensions/Markup/gui/MarkupsGui.css?dfe1","webpack://Autodesk.Extensions.[name]/./extensions/Markup/gui/MarkupsGui.css","webpack://Autodesk.Extensions.[name]/./node_modules/style-loader/lib/urls.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupTypes.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/EditAction.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/StyleUtils.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupEvents.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/Markup.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetStyle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditMode.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetSize.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditorTextAutosize.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/DomElementStyle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditorTextInput.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupPen.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModePen.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeletePolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetPolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModePolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupPolyLine.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreatePolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeletePolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetPolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModePolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupPolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreatePolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupsCoreUtils.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/EditActionGroup.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/EditActionManager.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CloneMarkup.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-clipboard/Clipboard.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-input/InputHandler.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetPosition.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetRotation.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/EditFrame.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupTool.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/EditModeManager.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/BuiltinEditModes.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupsCore.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/gui/MarkupsGui.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/Markup.js","webpack://Autodesk.Extensions.[name]/./thirdparty/canvg/rgbcolor.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","useSourceMap","list","toString","this","map","item","content","cssMapping","btoa","sourceMapping","sourceMap","unescape","encodeURIComponent","JSON","stringify","toComment","sourceURLs","sources","source","sourceRoot","concat","join","cssWithMappingToString","mediaQuery","alreadyImportedModules","length","id","push","stylesInDom","isOldIE","fn","memo","apply","arguments","memoize","window","document","all","atob","getElement","target","parent","styleTarget","querySelector","HTMLIFrameElement","contentDocument","head","e","singleton","singletonCounter","stylesInsertedAtTop","fixUrls","addStylesToDom","styles","options","domStyle","refs","j","parts","addStyle","listToStyles","newStyles","base","part","css","media","insertStyleElement","style","insertInto","Error","lastStyleElementInsertedAtTop","insertAt","nextSibling","insertBefore","appendChild","firstChild","before","removeStyleElement","parentNode","removeChild","idx","indexOf","splice","createStyleElement","createElement","undefined","attrs","type","nonce","nc","getNonce","addAttrs","el","keys","forEach","setAttribute","obj","update","remove","result","transform","styleIndex","applyToSingletonTag","URL","createObjectURL","revokeObjectURL","Blob","link","rel","createLinkElement","autoFixUrls","convertToAbsoluteUrls","blob","oldSrc","href","styleSheet","cssText","createTextNode","newObj","DEBUG","newList","mayRemove","replaceText","textStore","index","replacement","filter","Boolean","cssNode","childNodes","global","factory","_typeof","require","define","__WEBPACK_AMD_DEFINE_RESULT__","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","rgbcolor","stackblurCanvas","canvas","createCommonjsModule","windowEnv","nodeEnv","DOMParser","doc","defaultClientWidth","defaultClientHeight","createCanvas","width","height","matchesSelector","canvg","opts","svg","console","log","msg","init","ctx","uniqueId","UniqueId","Definitions","Styles","StylesSpecificity","Animations","Images","ViewPort","viewPorts","Clear","SetCurrent","RemoveCurrent","pop","Current","ComputeSize","Math","sqrt","pow","ImagesLoaded","loaded","trim","replace","compressSpaces","ajax","url","AJAX","XMLHttpRequest","ActiveXObject","open","send","responseText","parseXml","xml","Windows","Data","Xml","xmlDoc","Dom","XmlDocument","settings","XmlLoadSettings","prohibitDtd","loadXml","async","loadXML","parser","xmldom","parseFromString","Property","getValue","hasValue","numValue","parseFloat","match","valueOrDefault","def","numValueOrDefault","addOpacity","opacityProp","newValue","color","ok","g","b","getDefinition","isUrlDefinition","getFillStyleDefinition","createGradient","createPattern","getHrefAttribute","pt","attribute","getDPI","getREM","rootEmSize","getEM","emSize","getUnits","isPixels","toPixels","viewPort","processPercent","toMilliseconds","toRadians","PI","textBaselineMapping","baseline","before-edge","text-before-edge","middle","central","after-edge","text-after-edge","ideographic","alphabetic","hanging","mathematical","toTextBaseline","Font","Variants","Weights","CreateFont","fontStyle","fontVariant","fontWeight","fontSize","fontFamily","inherit","f","Parse","font","that","split","set","ff","ToNumberArray","a","Point","x","y","angleTo","atan2","applyTransform","v","xp","yp","CreatePoint","CreatePath","path","BoundingBox","x1","y1","x2","y2","Number","NaN","addPoint","isNaN","addX","addY","addBoundingBox","bb","addQuadraticCurve","p0x","p0y","p1x","p1y","p2x","p2y","cp1x","cp1y","cp2x","cp2y","addBezierCurve","p3x","p3y","p0","p1","p2","p3","b2ac","t1","t2","isPointInBox","Transform","Type","translate","unapply","applyToPoint","rotate","angle","cx","cy","cos","sin","scale","matrix","det","SkewBase","skewX","tan","skewY","transforms","data","transformType","AspectRatio","aspectRatio","desiredWidth","desiredHeight","minX","minY","refX","refY","align","meetOrSlice","scaleX","scaleY","scaleMin","min","scaleMax","max","Element","EmptyProperty","ElementBase","node","attributes","stylesSpecificity","children","createIfNotExists","skipAncestors","ps","render","save","mask","setContext","renderChildren","clearContext","restore","addChild","childNode","child","CreateElement","addStylesFromStyleDefinition","selector","specificity","existingSpecificity","allUppercase","RegExp","normalizeAttributeName","test","toLowerCase","nodeType","nodeName","captureTextNodes","text","textContent","tspan","RenderedElementBase","calculateOpacity","opacity","opacityStyle","fromMeasure","fs","fillStyle","strokeStyle","newLineWidth","lineWidth","lineCap","lineJoin","miterLimit","paintOrder","gaps","setLineDash","webkitLineDash","mozDash","offset","lineDashOffset","webkitLineDashOffset","mozDashOffset","currentFontSize","clip","globalAlpha","PathElementBase","beginPath","Mouse","checkPath","fill","stroke","markers","getMarkers","marker","getBoundingBox","baseClearContext","baseSetContext","getComputedStyle","getPropertyValue","root","moveTo","lineTo","closePath","viewBox","rect","rx","ry","KAPPA","bezierCurveTo","circle","arc","ellipse","line","getPoints","points","polyline","polygon","basePath","PathParser","tokens","reset","command","previousCommand","start","control","current","angles","isEnd","isCommandOrEnd","isRelativeCommand","getToken","getScalar","nextCommand","getPoint","makeAbsolute","getAsControlPoint","getAsCurrentPoint","getReflectedControlPoint","addMarker","from","priorTo","addMarkerAngle","getMarkerPoints","getMarkerAngles","pp","newP","curr","cntrl","cp","quadraticCurveTo","xAxisRotation","largeArcFlag","sweepFlag","currp","cpp","centp","u","acos","a1","ad","dir","ah","halfWay","sx","sy","pattern","tempSvg","cctx","getContext","baseRender","point","defs","GradientBase","stops","getGradient","gradientUnits","attributesToInherit","inheritStopContainer","stopsContainer","attributeToInherit","element","parentOpacityProp","addParentOpacity","addColorStop","rootView","MAX_VIRTUAL_PIXELS","group","tempCtx","linearGradient","createLinearGradient","radialGradient","fx","fy","createRadialGradient","stop","stopColor","AnimateBase","duration","begin","maxDuration","getProperty","attributeType","attributeName","initialValue","initialUnits","removed","calcValue","delta","frozen","animationFrozen","animationFrozenValue","updated","to","values","progress","ret","lb","floor","ub","ceil","animate","animateColor","parseInt","animateTransform","horizAdvX","isRTL","isArabic","fontFace","missingGlyph","glyphs","arabicForm","unicode","fontface","ascent","descent","unitsPerEm","missingglyph","glyph","textBaseline","initializeCoordinates","getAnchorDelta","childBB","getChildBoundingBox","renderChild","startI","textAnchor","measureTextRecursive","adjustChildCoordinates","textParent","measureText","TextElementBase","getGlyph","customFont","strokeText","getText","fillText","reverse","dx","lw","measure","textToMeasure","tref","hasText","baseRenderChildren","checkBoundingBox","onclick","onmousemove","cursor","image","isSvg","img","crossOrigin","self","onload","onerror","src","drawSvg","complete","drawImage","symbol","cssDefs","cssDef","cssClasses","cssProps","cssClass","props","k","prop","substr","getSelectorSpecificity","srcs","urlStart","urlEnd","fonts","getElementsByTagName","use","elementTransform","oldParent","cMask","maskCtx","globalCompositeOperation","fillRect","clipPath","hasContext2D","CanvasRenderingContext2D","oldBeginPath","oldClosePath","px","py","efd","extraFilterDistance","feDropShadow","feMorphology","feComposite","feColorMatrix","m1","m2","m3","imGet","rgba","imSet","val","mi","srcData","getImageData","clearRect","putImageData","feGaussianBlur","blurRadius","canvasRGBA","display","body","title","desc","MISSING","className","load","loadXmlDoc","dom","mapXY","offsetLeft","offsetTop","offsetParent","scrollX","scrollY","clientX","event","clientY","documentElement","isFirstRender","draw","clientWidth","clientHeight","cWidth","cHeight","xRatio","yRatio","waitingForImages","intervalID","setInterval","needUpdate","hasEvents","needAnimationUpdate","FRAMERATE","runEvents","clearInterval","events","run","eventElements","isPointInPath","build","getElementById","svgTags","querySelectorAll","svgTag","getBoundingClientRect","div","innerHTML","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","jQuery","Zepto","$","is","Sizzle","attributeRegex","idRegex","classRegex","pseudoElementRegex","pseudoClassWithBracketsRegex","pseudoClassRegex","elementRegex","typeCount","findMatch","regex","dy","dw","dh","cOpts","ignoreMouse","ignoreAnimation","ignoreDimensions","ignoreClear","offsetX","offsetY","scaleWidth","scaleHeight","amd","ResizeObserver","Map","some","__entries__","size","configurable","delete","has","clear","defineProperties","Function","requestAnimationFrame","setTimeout","Date","now","MutationObserver","connected_","mutationEventsAdded_","mutationsObserver_","observers_","onTransitionEnd_","refresh","h","addObserver","connect_","removeObserver","disconnect_","updateObservers_","gatherActive","hasActive","broadcastActive","addEventListener","observe","childList","characterData","subtree","removeEventListener","disconnect","propertyName","getInstance","instance_","writable","ownerDocument","defaultView","_","reduce","SVGGraphicsElement","SVGElement","getBBox","left","right","top","bottom","boxSizing","round","abs","broadcastWidth","broadcastHeight","contentRect_","isActive","broadcastRect","activeObservations_","observations_","TypeError","callback_","controller_","callbackCtx_","unobserve","clearActive","DOMRectReadOnly","contentRect","WeakMap","w","hmr","locals","location","baseUrl","protocol","host","currentDir","pathname","fullMatch","origUrl","newUrl","unquotedOrigUrl","$1","MARKUP_TYPE_ARROW","MARKUP_TYPE_TEXT","MARKUP_TYPE_RECTANGLE","MARKUP_TYPE_CIRCLE","MARKUP_TYPE_CLOUD","MARKUP_TYPE_FREEHAND","MARKUP_TYPE_HIGHLIGHT","MARKUP_TYPE_POLYLINE","MARKUP_TYPE_POLYCLOUD","MARKUP_TYPE_CALLOUT","MARKUP_TYPE_DIMENSION","EditAction","editor","targetId","addToHistory","selectOnExecution","execute","actionManager","redo","undo","merge","action","isIdentity","createStyle","defaults","getStyleDefaultValues","default","copyStyle","destination","isStyleEqual","cloneStyle","clone","getWidths","normalWidth","getFontSizes","getOpacities","defaultTransparent","normaStrokeWidth","getStrokeWidth","normaFontWidth","getFontWidth","EVENT_EDITMODE_CHANGED","EVENT_EDITMODE_ENTER","EVENT_EDITMODE_LEAVE","EVENT_MARKUP_SELECTED","EVENT_MARKUP_DRAGGING","EVENT_MARKUP_ENTER_EDITION","EVENT_MARKUP_CANCEL_EDITION","EVENT_MARKUP_DELETE_EDITION","EVENT_HISTORY_CHANGED","EVENT_EDITMODE_CREATION_BEGIN","EVENT_EDITMODE_CREATION_END","EVENT_MARKUP_DESELECT","EVENT_EDITFRAME_EDITION_START","EVENT_EDITFRAME_EDITION_END","av","Autodesk","Viewing","Markup","styleAttributes","viewer","position","rotation","getDefaultStyle","highlightColor","constraintWidth","constraintHeight","constraintRotation","minWidth","minHeight","highlighted","selected","addTraitEventDispatcher","proto","SetStyle","markup","newStyle","oldStyle","getStyle","destroy","unselect","setParent","shape","__proto__","overrides","getCloneOverrides","member","cloneNode","parse","cloneShape","hitarea","bindDomEvents","hammer","listeners","select","updateStyle","dispatchEvent","MarkupEvents","highlight","interactionsDisabled","setStyle","edit","cancel","deleteMarkup","getEditMode","warn","getClientPosition","positionFromMarkupsToClient","getClientSize","sizeFromMarkupsToClient","getBoundingRect","setRotation","parentRect","impl","getCanvasBoundingClientRect","boundRect","strokeWidth","getRotation","setPosition","setSize","isWidthConstrained","isHeightConstrained","isRotationConstrained","setMinWidth","setMinHeight","getMinWidth","getMinHeight","disableInteractions","disable","setStrokeWidth","constrainsToBounds","bounds","onMouseDown","editFrame","startDrag","generatePoint3d","idTarget","generateBoundingPolygon","checkLineSegmentAux","point2d","checkLineSegment","point3d","clientToWorld","xVertices","yVertices","midAB","THREE","Vector2","multiplyScalar","midAC","midDB","midDC","center","add","checkPolygon","checkPolygonAux","generateBoundingBox","boundingBox","vertexCount","bbX0","POSITIVE_INFINITY","bbY0","bbX1","NEGATIVE_INFINITY","bbY1","bbX","bbY","halfSize","lt","Vector3","rt","rb","Matrix4","makeTranslation","makeRotationZ","multiply","applyMatrix4","Float32Array","setMetadata","setMouseDisabledWhenTouching","isFirst","onMouseDownBinded","isFinal","_this","isTouchDevice","Hammer","Manager","recognizers","GestureRecognizers","singletap","handlePointerEventMouse","inputClass","isIE11","PointerEventInput","TouchInput","onSingleTapBinded","onHammerInputBinded","on","onMouseOutBinded","onMouseOverBinded","renderToCanvas","callback","getPath","getTransform","radiansToDegrees","constructor","EditMode","selectedMarkup","dragging","draggingAnnotationIniPosition","draggingMouseIniPosition","initialX","initialY","minSize","creating","CREATION_METHOD_DRAG","CREATION_METHOD_CLICK","CREATION_METHOD_CLICKS","creationMethod","getMarkup","DeleteArrow","arrow","createArrow","CreateArrow","tail","removeTraitEventDispatcher","fireEv","selectedId","setMarkup","markupId","creationBegin","creationEnd","isCancelling","isMinSizeValid","creationCancel","finishDragging","closeActionGroup","creationCancelled","cancelActionGroup","setSelection","bringToFront","isTextInputHelperActive","textInputHelper","setEditFrame","getSelection","cantUndo","tmp","startDragging","mousePosition","getMousePosition","getFinalMouseDraggingPosition","getBounds","finalX","finalY","input","makeSameXY","maxDelta","sign","notifyAllowNavigation","allows","onMouseMove","onMouseUp","onMouseDoubleClick","onSave","getDraggingPosition","isInsideBounds","useWithSnapping","model","is2d","SetArrow","newHead","newTail","oldHead","oldTail","applyState","MeasureCommon","EditModeArrow","MarkupTypes","MarkupArrow","createMarkupPathSvg","deleteArrow","lineSnapped","snapper","geomType","getGeometryType","SnapType","SNAP_VERTEX","SNAP_EDGE","SNAP_MIDPOINT","SNAP_CIRCLE_CENTER","getEdge","arrowMinSize","positionFromClientToMarkups","constrain","beginActionGroup","arrowVector","lengthSq","normalize","arrowId","getId","final","isSnapped","project","vertices","end","z","parallel","nearestPointInPointToLine","pEnd","pStart","perpendicular","distanceTo","sizeFromClientToMarkups","xO","yO","xF","yF","vO","vF","vDir","sub","dot","vFDir","vCenter","strokeColor","composeRGBAString","setAttributeToMarkupSvg","updateMarkupPathSvgHitarea","xo","yo","direction","metadata","String","addMarkupMetadata","sizeX","sizeY","sizeYOver3","tailW","headW","spikeOffset","addMarkup","removeMarkup","DeleteRectangle","rectangle","createRectangle","CreateRectangle","SetRectangle","newPosition","newSize","oldPosition","oldSize","EditModeRectangle","MarkupRectangle","deleteRectangle","pos","clientToMarkups","firstCorner","startZ","fillColor","createRectanglePath","DeleteText","createText","CreateText","SetCallout","isFrameUsed","newText","oldText","newIsFrameUsed","oldIsFrameUsed","SetSize","newWidth","oldWidth","newHeight","oldHeight","callout","createEvent","Event","bubbles","evt","initEvent","assign","ta","heightOffset","cachedHeight","pageResize","resize","overflow","overflowX","wordWrap","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","changeOverflow","offsetWidth","originalHeight","overflows","arr","scrollTop","getParentOverflows","docTop","endHeight","scrollHeight","styleHeight","computed","actualHeight","offsetHeight","err","methods","RUNTIME_SUPPORTED","autosize","Array","DomElementStyle","BROWSER_PREFIXES","dirty","styleString","allBrowsers","prefix","removeAttribute","isArray","getStyleString","elements","generateStyle","EditorTextInput","parentDiv","singleLine","defaultText","maxLength","EVENT_TEXT_CHANGE","EVENT_TEXT_SET_ACTIVE","EVENT_TEXT_SET_INACTIVE","textArea","rows","firstEdit","startingHeight","entries","observer","styleTextArea","measureDiv","trimRight","lastNonSpace","charAt","trimLeft","firstNonSpace","setInactive","setActive","textMarkup","placeholderText","i18n","constrainToCanvas","initFromMarkup","isIOSDevice","txtArea","focus","dataBag","blur","onResizeBinded","frameWidth","frameHeight","xPos","yPos","updateStyleFirst","padding","getClientFontSize","lineHeightPercentage","lineHeight","setPosAndSize","container","temp","injectSizeValues","newPos","fontHeight","textAreaStyle","getTextValuesForMarkup","sizeUpdateRequired","active","activeMarkup","activeFirstEdit","textValues","getTextValues","lines","generateLines","acceptAndExit","newLines","ox","oy","onCameraChanged","str","linesBreaks","styleMeasureStr","maxLineLength","linesOutput","len","splitLine","output","remaining","done","innerText","getShorterLine","splitWord","iLastSpace","lastIndexOf","trailingWord","word","lenSoFar","okayWord","extraWord","EditModeCallout","helper","onHelperTextChange","onHelperSetActive","onHistoryChangeBinded","onHistoryChange","deleteCallout","DeleteCallout","clientFontSize","initialWidth","initialHeight","createCallout","CreateCallout","selectMarkup","databag","setIsHelperTextActive","setIsShapeVisible","textStyle","curSelection","updateTextBoxStyle","FONT_SIZE_SCALE","STARTING_WIDTH_FACTOR","MarkupCallout","textShape","createMarkupTextSvg","rectShape","createMarkupGroupSvg","currentText","currentTextLines","prevHighlight","isHelperTextActive","textString","setIsFilledFrameUsed","setText","stylesEqual","getTextLines","highlightChanged","editMode","duringEditMode","rebuildTextSvg","textContainerTransform","getTextContainerTransform","textTransform","getTextTransform","setMarkupTextSvgTransform","updateMarkupTextSvgClipper","updateMarkupTextSvgHitarea","textHelperValues","createSvgElement","yOffset","getLineHeight","hasRectShape","setIsFilledFrameVisible","isVisible","isframeused","margin","EDIT_FRAME_DEFAULT_MARGIN","SetText","EditModeText","deleteText","MarkupText","textDirty","textSize","updateMarkupTextSvgBackground","DeleteCircle","createCircle","CreateCircle","SetCircle","EditModeCircle","MarkupCircle","deleteCircle","firstPosition","ellipseW","ellipseH","createEllipsePath","DeleteCloud","cloud","createCloud","CreateCloud","SetCloud","EditModeCloud","newStrokeWidth","newColor","oldStrokeWidth","oldColor","MarkupCloud","deleteCloud","radius","createArcTo","xRadius","yRadius","createCorner","corner","getSideParameters","diameter","count","xValueInset","yValueOffset","hSidesParameters","vSidesParameters","cornerSizeX","cornerSizeY","cornerRadiusX","cornerRadiusY","halfStrokeWidth","sp","createTSide","createRSide","createBSide","createLSide","MarkupPen","EditModePen","smoothen","bufferSize","locations","isAbsoluteCoords","updatePath","slice","locationsCount","toFixed","locationA","locationB","DeleteFreehand","freehand","createFreehand","CreateFreehand","deletePen","movements","appendToBuffer","amendPath","lastX","lastY","removeFromAbsolutePath","addToAbsolutePath","setPen","absolutePath","clearSnapped","buffer","movementsLastIndex","createPen","createAbsolutePath","cameraWidth","camera","cameraHeight","xs","simplify","ys","error","absolutePathIndexes","numToRemove","shift","getAveragePoint","tmpBuffer","totalX","totalY","SetFreehand","EditModeFreehand","MarkupFreehand","DeletePolyline","createPolyline","CreatePolyline","closed","SetPolyline","EditModePolyline","setPositionAndSize","minFn","collection","targets","maxFn","MarkupPolyline","deletePolyline","lastIndex","lastMove","areMarkupsPointsInClientRange","DeletePolycloud","polycloud","createPolycloud","CreatePolycloud","SetPolycloud","EditModePolycloud","MarkupPolycloud","deletePolycloud","updateCorners","side","cornerA","cornerB","orientation","rA","rB","D","pointA","pointB","xS","xT","yS","yT","intersec","cross","vecAB","createSidePath","bodyCount","bodyRadius","bodyDiameter","createCornerPath","first","large","fstPoint","sndPoint","pointC","getOrientation","sides","sidesCount","vecBA","getSides","corners","sideA","sideB","getCorners","cornersCount","bodyA","bodyB","updateSides","DeleteHighlight","createHighlight","CreateHighlight","SetHighlight","EditModeHighlight","MarkupHighlight","DeleteDimension","dimension","createDimension","CreateDimension","secondAnchor","firstAnchor","SetDimension","newFirstAnchor","newSecondAnchor","oldFirstAnchor","oldSecondAnchor","_cursorPosition","EditModeDimension","measurement","Measurement","MeasurementTypes","MEASUREMENT_DISTANCE","measureExt","getExtension","abortDimensionMarkup","cancelEditModeChange","enterEditMode","sharedMeasureConfig","forceCalibrate","getData","isLeaflet","calibrationTool","isCalibrated","openCalibrationRequiredDialog","deleteDimension","updateTextBox","updateViewportId","getDistance","computeResult","picks","distanceXYZ","Private","convertUnits","getUnitString","units","calibrationFactor","formatValueWithUnits","precision","updateMeasurement","measurementNumber","pick","getPick","geomVertex","intersectPoint","copyResults","viewportId","setViewportId","pickFirstAnchor","clearAllPicks","dimensionId","viewportIndex2d","pickSecondAnchor","mouseDown","correctPerpendicularPicks","getSnapResultPosition","indicator","isRightClick","navigation","inverseProject","constrainAxis","isVisibleChar","keyCode","measureTextLine","initialText","measureTextLines","handleKeyDown","KeyCode","ENTER","BACKSPACE","substring","handleKeyDownBinded","getTextAreaTransform","shouldFlip","DEFAULT_TEXT","MarkupDimension","preventReposition","degreesToRadians","lineSize","edgeH","textOffset","backgroundTransform","inverse","flip","segmentLength","avp","MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS","MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS","MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS","createElementNS","setSvgParentAttributes","hitareaMargin","getAttribute","markupFill","markupStroke","strokeEnabled","fillEnabled","navigating","clipperId","getUniqueID","clipperUrl","clipper","background","clippedArea","addSvgMetadata","metadataNode","dataVersionNode","markupNode","removeAllMetadata","svgNode","nodes","svgChildren","transferChildNodes","nodeFrom","nodeInto","tmpArray","generateUUID","svgNodeToString","domNode","hitareas","removeHitareas","hitareaParent","childrenCount","XMLSerializer","serializeToString","hitareasCount","addHitareas","stringToSvgNode","stringNode","client","listener","hasEventListener","li","typeListeners","worldToClient","snap","worldToViewport","viewportToClient","depth","clientToViewport","unproject","viewportX","viewportY","metersToModel","meters","getUnitScale","radians","degrees","range","hideLmvUi","toolbar","setActiveNavigationTool","dismissLmvHudMessage","hideLmvPanels","hideLmvToolsAndPanels","restoreLmvUi","showLmvToolsAndPanels","hide","dockingPanels","panel","panelContainer","classList","contains","visibilityChanged","ext","displayViewCube","displayHomeButton","anim","getElementsByClassName","viewerContainer","viewerContainerChildrenCount","animator","keyFrameAnimator","isPaused","pauseCameraAnimations","pause","playButton","modelTools","getControl","setIcon","setToolTip","keepDismissing","HudMessage","dismiss","ignore","widthInPixels","createMarkupFromSVG","meta","isClosed","getLocations","locStr","pointPair","getAttributeVector","posVec","strPos","getPosition","getSize","strRot","createMarkup","logger","getCurrentStyle","MarkupType","markupList","svgLayersMap","activeLayer","markups","hexRGBString","x0","y0","deviceRatio","devicePixelRatio","idTargetWidth","idTargetHeight","idTargetBuffer","check","verxtexCount","isInsidePolygon","bbW","bbH","endX","endY","createStyleSheet","sheet","addRuleToStyleSheet","insertRule","addRule","measureStyle","linesCount","relative","halfW","halfH","tmpSvg","markupGroup","renderWithCanvg","renderCallback","Image","tolerance","highestQuality","getSqDist","getSqSegDist","sqTolerance","last","simplified","simplifyDPStep","maxSqDist","sqDist","simplifyDouglasPeucker","prevPoint","newPoints","simplifyRadialDist","EditActionGroup","actions","EditActionManager","historySize","undoStack","redoStack","close","actionsCount","isOpen","isEmpty","addAction","compact","actionA","actionB","getTargetId","CloneMarkup","getEditActionGroup","undoStackCount","isUndoStackEmpty","isRedoStackEmpty","getLastElementInUndoStack","Clipboard","pastePosition","copy","cut","paste","_mouseEnabled","_mousePrevValue","_lock","InputHandler","snapRotations","keepAspectRatio","onWheelBinded","onWheel","onTouchDragBinded","onTouchDrag","onTouchPanBinded","onTouchPan","onTouchPinchBinded","onTouchPinch","onSingleTap","onDoubleTapBinded","onDoubleTap","onMouseMoveBinded","onMouseUpBinded","onMouseDoubleClickBinded","onHammerInput","isMouseDown","processMouseEvent","shiftKey","convertEventHammerToMouse","pointers","SetPosition","attachTo","detachFrom","drag","doubletap","doubletap2","singletap2","press","pan","pinch","recognizeWith","requireFailure","enableMouseButtons","state","isMobileDevice","leaveEditMode","off","enterViewMode","leaveViewMode","toolController","mousewheel","preventDefault","mousemove","onMouseDownRightClick","inFullscreen","activeElement","__clientToCanvasCoords","markupTool","handleButtonDown","onMouseUpRightClick","handleButtonUp","isMiddleClick","getTool","distributeGesture","callSnapperMouseMove","SetRotation","curAngle","newRotation","oldRotation","EditFrame","containingDiv","selectionLayer","visibility","togglePointerEvents","createSelectionLayer","frameMargin","selection","resizing","handle","selectorBox","rotationBridge","setResizeCursor","createRotationBridge","rotationHandle","createRotatePoint","createDragPoint","createDragPoints","updateSelectionBoxState","createSelectorBox","onHammerDragBinded","onHammerDrag","onHammerDoubleTapBinded","onHammerDoubleTap","_onRepositionMouseDown","handleSelectionBoxDragging","_onResizeMouseDown","handleSelectionBoxResizing","doubleClick","defaultPrevented","handleSelectionDoubleClick","_onRotationMouseDown","handleSelectionBoxRotating","pageX","pageY","isDragPoint","matchesSelectorAux","isRotatePoint","updateSelectorBoxPosition","toTranslate3d","transformOrigin","msTransform","webkitTransform","msTransformOrigin","webkitTransformOrigin","unload","doubleMargin","updateSelectorBoxDimensions","enable","enableResizeHandles","enableRotationHandle","_onRepositionMouseMove","_onRepositionMouseUp","isDragging","isResizing","isRotating","rotating","updateEditorInput","callSnapperMouseDown","_handleRightClickDown","initialRotation","initialHandlePosition","ignoreFirstMouseMove","setHandleSelected","isSelected","pointerEvents","getAngleBetweenPoints","domElem","syntheticStart","MouseEvent","initialCursor","initialPosition","areAxisConstrained","axisConstrains","altKey","movement","initial","mouseX","mouseY","_onResizeMouseMove","_onResizeMouseUp","vector","undoRotation","localSpaceDelta","projectOnVector","nw","ne","sw","se","redoRotation","actualDelta","_onRotationMouseMove","_onRotationMouseUp","MarkupTool","ToolInterface","names","panTool","allowNav","coreExt","hotkeysEnabled","_ctrlDown","_shiftDown","allowNavigation","allow","setCoreExtension","setHotkeysEnabled","enabled","activate","viewerApi","deactivate","CONTROL","SHIFT","ESCAPE","onUserCancel","DELETE","F12","handleKeyUp","handleSingleClick","button","handleDoubleClick","handleSingleTap","handleDoubleTap","handleWheelInput","handleMouseMove","handleGesture","handleBlur","_editModes","theEditModeManager","EditModeManager","_classCallCheck","clazz","register","MarkupsCore","Extension","duringViewMode","onEditActionHistoryChanged","nextId","clipboard","CAMERA_CHANGE_EVENT","once","onCameraChangeBinded","onCameraChange","onViewerResizeBinded","onViewerResize","onMarkupSelectedBinded","onMarkupSelected","onMarkupEnterEditionBinded","onMarkupEnterEdition","onMarkupCancelEditionBinded","onMarkupCancelEdition","onMarkupDeleteEditionBinded","onMarkupDeleteEdition","onToolChangeBinded","onToolChange","onUnitsCalibrationStartsBinded","onUnitsCalibrationStarts","Events","UNITS_CALIBRATION_STARTS_EVENT","svgStyle","disableMarkupInteractions","toolClass","markupToolClass","changeMarkupTool","markupDisableHotkeys","Snapper","markupMode","registerTool","enableHotKeys","deregisterTool","editModeSvgLayerNode","initialStrokeWidth","initialFontWidth","toggleEditMode","layerId","disableLayerMarkups","layer","layerMarkups","show","parSvg","editModeLayerParentNode","editingLayer","svgParent","activateTool","defaultStyle","changeEditMode","clearOverlays","toggle","VIEWER_RESIZE_EVENT","reorderElements","onViewerRolloverObject","rolloverObject","unloadMarkupsAllLayers","editModeLayer","generateData","defaultLayer","tmpNode","metadataNodes","data-model-version","addedNode","generatePoints3d","main","markupsCount","renderer","readbackTargetId","collision","context","renderAllMarkups","getSvgViewBox","numberOfScreenshotsTaken","onMarkupScreenshotTaken","svgKeys","layersKeys","oldEditMode","isNavigationAllowed","isPerspective","cachedNavigationTool","getActiveNavigationTool","TOOL_CHANGE_EVENT","getName","defaultToolName","getDefaultNavigationToolName","toolName","navAllowed","setNavigationLockSettings","zoom","orbit","roll","fov","walk","gotoview","setNavigationLock","changeInputHandler","inputHandler","dontAddToHistory","layerObject","markupIndex","editLayerMarkups","removeMarkupIfExists","sendMarkupTo","sendToBack","bringForward","bringBackward","loadMarkups","markupString","svgLayerNode","svgString","createLayerNode","localName","svgParentNode","newSvgLayerNode","revertLayer","currentMarkups","layerSvg","unloadMarkups","numMarkups","unloadSvgLayerNode","hideMarkups","showMarkups","markupsToClient","vectorFromClientToMarkups","vectorFromMarkupsToClient","matrixWorld","globalOffset","matrixWorldInverse","getSnapPosition","getSnapResult","getCamera","containerBounds","getScreenViewport","ignoreNextMouseUp","theExtensionManager","registerExtension","MarkupsGui","domEvents","onEditModeEnter","onEditModeLeave","onEditModeChange","loadExtension","then","core","unhookAllEvents","destroyToolUi","destroyToolbarUI","onToolbarCreated","markupToolButton","UI","Button","onClick","TOOLBAR","MODELTOOLSID","addControl","getToolbar","removeFromParent","showToolsUi","hideToolsUi","domToolSelect","ignoreChangeEvent","optionList","selectedIndex","setStylesUi","createToolsUi","canNavigate","setControlVisibility","exitNavigationMode","domContent","domRoot","html","createEditModeOption","domStylesRoot","hookEvent","onToggleCollapse","onEditModeDone","enterNavigationMode","onUndoClick","onRedoClick","onDeleteClick","onCutClick","onCopyClick","onPasteClick","onDuplicateClick","onSelectEditMode","onStyleChange","locLabel","editModeType","EditModeClass","getClass","option","styleKey","valueType","getTypedValue","getUiForStyleKey","selectionIndex","optLine","valueEquals","value1","value2","visibleValue","elem","eventStr","callbackFn","handler","getStyleOptions","activeStatus","__webpack_exports__","Core","Gui","Utils","markupType","eventType","thing","StyleUtils","Extensions","Markups","RGBColor","color_string","simple_colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","feldspar","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslateblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","violetred","wheat","white","whitesmoke","yellow","yellowgreen","color_defs","re","example","process","bits","processor","exec","channels","toRGB","toHex","getHelpXML","examples","sc","list_item","list_color","example_div","list_item_value"],"mappings":"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","file":"Markup/Markup.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 355);\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getTarget = function (target, parent) {\n  if (parent){\n    return parent.querySelector(target);\n  }\n  return document.querySelector(target);\n};\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(target, parent) {\n                // If passing function in options, then use it for resolve \"head\" element.\n                // Useful for Shadow Root style i.e\n                // {\n                //   insertInto: function () { return document.querySelector(\"#foo\").shadowRoot }\n                // }\n                if (typeof target === 'function') {\n                        return target();\n                }\n                if (typeof memo[target] === \"undefined\") {\n\t\t\tvar styleTarget = getTarget.call(this, target, parent);\n\t\t\t// Special case to return head of iframe instead of iframe itself\n\t\t\tif (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n\t\t\t\ttry {\n\t\t\t\t\t// This will throw an exception if access to iframe is blocked\n\t\t\t\t\t// due to cross-origin restrictions\n\t\t\t\t\tstyleTarget = styleTarget.contentDocument.head;\n\t\t\t\t} catch(e) {\n\t\t\t\t\tstyleTarget = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmemo[target] = styleTarget;\n\t\t}\n\t\treturn memo[target]\n\t};\n})();\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = require(\"./urls\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton && typeof options.singleton !== \"boolean\") options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n        if (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else if (typeof options.insertAt === \"object\" && options.insertAt.before) {\n\t\tvar nextSibling = getElement(options.insertAt.before, target);\n\t\ttarget.insertBefore(style, nextSibling);\n\t} else {\n\t\tthrow new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\n\tif(options.attrs.nonce === undefined) {\n\t\tvar nonce = getNonce();\n\t\tif (nonce) {\n\t\t\toptions.attrs.nonce = nonce;\n\t\t}\n\t}\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction getNonce() {\n\tif (typeof __webpack_nonce__ === 'undefined') {\n\t\treturn null;\n\t}\n\n\treturn __webpack_nonce__;\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = options.transform(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n","/*\n * canvg.js - Javascript SVG parser and renderer on Canvas\n * version 2.0.0\n * MIT Licensed\n * Gabe Lerner (gabelerner@gmail.com)\n * https://github.com/canvg/canvg\n *\n */\n\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('./rgbcolor')) :\n        typeof define === 'function' && define.amd ? define(['./rgbcolor'], factory) :\n            (global.canvg = factory(global.RGBColor,global.StackBlur,global.Canvas));\n}(this, (function (rgbcolor,stackblurCanvas,canvas) { 'use strict';\n\n    rgbcolor = rgbcolor && rgbcolor.hasOwnProperty('default') ? rgbcolor['default'] : rgbcolor;\n    stackblurCanvas = stackblurCanvas && stackblurCanvas.hasOwnProperty('default') ? stackblurCanvas['default'] : stackblurCanvas;\n    canvas = canvas && canvas.hasOwnProperty('default') ? canvas['default'] : canvas;\n\n    function createCommonjsModule(fn, module) {\n        return module = { exports: {} }, fn(module, module.exports), module.exports;\n    }\n\n    var canvg_1 = createCommonjsModule(function (module) {\n        /* eslint-env browser, node */\n        /* globals $, Sizzle, Windows, ActiveXObject */\n        /* eslint-disable no-redeclare */\n\n\n        var isNode = (module.exports && typeof window === 'undefined'),\n            nodeEnv = false;\n        var windowEnv;\n\n        {\n            windowEnv = window;\n            windowEnv.DOMParser = window.DOMParser;\n        }\n\n        var doc = windowEnv.document,\n            defaultClientWidth = 800,\n            defaultClientHeight = 600;\n\n        function createCanvas(width, height) {\n            var c;\n            {\n                c = doc.createElement('canvas');\n                c.width = width;\n                c.height = height;\n            }\n            return c;\n        }\n\n        // canvg(target, s)\n        // empty parameters: replace all 'svg' elements on page with 'canvas' elements\n        // target: canvas element or the id of a canvas element\n        // s: svg string, url to svg file, or xml document\n        // opts: optional hash of options\n        //       ignoreMouse: true => ignore mouse events\n        //       ignoreAnimation: true => ignore animations\n        //       ignoreDimensions: true => does not try to resize canvas\n        //       ignoreClear: true => does not clear canvas\n        //       offsetX: int => draws at a x offset\n        //       offsetY: int => draws at a y offset\n        //       scaleWidth: int => scales horizontally to width\n        //       scaleHeight: int => scales vertically to height\n        //       renderCallback: function => will call the function after the first render is completed\n        //       enableRedraw: function => whether enable the redraw interval in node environment\n        //       forceRedraw: function => will call the function on every frame, if it returns true, will redraw\n        var canvg = function (target, s, opts) {\n            // no parameters\n            if (target == null && s == null && opts == null) {\n                var svgTags = doc.querySelectorAll('svg');\n                for (var i = 0; i < svgTags.length; i++) {\n                    var svgTag = svgTags[i];\n                    var c = doc.createElement('canvas');\n                    if (typeof(svgTag.clientWidth) !== 'undefined' && typeof(svgTag.clientHeight) !== 'undefined') {\n                        c.width = svgTag.clientWidth;\n                        c.height = svgTag.clientHeight;\n                    } else {\n                        var rect = svgTag.getBoundingClientRect();\n                        c.width = rect.width;\n                        c.height = rect.height;\n                    }\n                    svgTag.parentNode.insertBefore(c, svgTag);\n                    svgTag.parentNode.removeChild(svgTag);\n                    var div = doc.createElement('div');\n                    div.appendChild(svgTag);\n                    canvg(c, div.innerHTML);\n                }\n                return;\n            }\n\n            var svg = build(opts || {});\n\n            if (typeof target == 'string') {\n                target = doc.getElementById(target);\n            }\n\n            // store class on canvas\n            if (target.svg != null) target.svg.stop();\n\n            // on i.e. 8 for flash canvas, we can't assign the property so check for it\n            if (!(target.childNodes && target.childNodes.length == 1 && target.childNodes[0].nodeName == 'OBJECT')) target.svg = svg;\n\n            var ctx = target.getContext('2d');\n\n            if (typeof s.documentElement != 'undefined') {\n                // load from xml doc\n                svg.loadXmlDoc(ctx, s);\n            } else if (s.substr(0, 1) == '<') {\n                // load from xml string\n                svg.loadXml(ctx, s);\n            } else {\n                // load from url\n                svg.load(ctx, s);\n            }\n        };\n\n        var matchesSelector;\n        {\n            // see https://developer.mozilla.org/en-US/docs/Web/API/Element.matches\n            if (typeof Element == 'undefined') ; else if (typeof Element.prototype.matches != 'undefined') {\n                matchesSelector = function (node, selector) {\n                    return node.matches(selector);\n                };\n            } else if (typeof Element.prototype.webkitMatchesSelector != 'undefined') {\n                matchesSelector = function (node, selector) {\n                    return node.webkitMatchesSelector(selector);\n                };\n            } else if (typeof Element.prototype.mozMatchesSelector != 'undefined') {\n                matchesSelector = function (node, selector) {\n                    return node.mozMatchesSelector(selector);\n                };\n            } else if (typeof Element.prototype.msMatchesSelector != 'undefined') {\n                matchesSelector = function (node, selector) {\n                    return node.msMatchesSelector(selector);\n                };\n            } else if (typeof Element.prototype.oMatchesSelector != 'undefined') {\n                matchesSelector = function (node, selector) {\n                    return node.oMatchesSelector(selector);\n                };\n            } else {\n                // requires Sizzle: https://github.com/jquery/sizzle/wiki/Sizzle-Documentation\n                // or jQuery: http://jquery.com/download/\n                // or Zepto: http://zeptojs.com/#\n                // without it, this is a ReferenceError\n\n                if (typeof jQuery === 'function' || typeof Zepto === 'function') {\n                    matchesSelector = function (node, selector) {\n                        return $(node).is(selector);\n                    };\n                }\n\n                if (typeof matchesSelector === 'undefined' && typeof Sizzle !== 'undefined') {\n                    matchesSelector = Sizzle.matchesSelector;\n                }\n            }\n        }\n\n        // slightly modified version of https://github.com/keeganstreet/specificity/blob/master/specificity.js\n        var attributeRegex = /(\\[[^\\]]+\\])/g;\n        var idRegex = /(#[^\\s\\+>~\\.\\[:]+)/g;\n        var classRegex = /(\\.[^\\s\\+>~\\.\\[:]+)/g;\n        var pseudoElementRegex = /(::[^\\s\\+>~\\.\\[:]+|:first-line|:first-letter|:before|:after)/gi;\n        var pseudoClassWithBracketsRegex = /(:[\\w-]+\\([^\\)]*\\))/gi;\n        var pseudoClassRegex = /(:[^\\s\\+>~\\.\\[:]+)/g;\n        var elementRegex = /([^\\s\\+>~\\.\\[:]+)/g;\n\n        function getSelectorSpecificity(selector) {\n            var typeCount = [0, 0, 0];\n            var findMatch = function (regex, type) {\n                var matches = selector.match(regex);\n                if (matches == null) {\n                    return;\n                }\n                typeCount[type] += matches.length;\n                selector = selector.replace(regex, ' ');\n            };\n\n            selector = selector.replace(/:not\\(([^\\)]*)\\)/g, '     $1 ');\n            selector = selector.replace(/{[\\s\\S]*/gm, ' ');\n            findMatch(attributeRegex, 1);\n            findMatch(idRegex, 0);\n            findMatch(classRegex, 1);\n            findMatch(pseudoElementRegex, 2);\n            findMatch(pseudoClassWithBracketsRegex, 1);\n            findMatch(pseudoClassRegex, 1);\n            selector = selector.replace(/[\\*\\s\\+>~]/g, ' ');\n            selector = selector.replace(/[#\\.]/g, ' ');\n            findMatch(elementRegex, 2);\n            return typeCount.join('');\n        }\n\n        function build(opts) {\n            var svg = { opts: opts };\n\n            svg.FRAMERATE = 30;\n            svg.MAX_VIRTUAL_PIXELS = 30000;\n\n            svg.rootEmSize = 12;\n            svg.emSize = 12;\n\n            svg.log = function (/* msg */) { };\n            if (svg.opts['log'] == true && typeof console != 'undefined') {\n                svg.log = function (msg) { console.log(msg); }; // eslint-disable-line no-console\n            }\n\n            // globals\n            svg.init = function (ctx) {\n                var uniqueId = 0;\n                svg.UniqueId = function () { uniqueId++; return 'canvg' + uniqueId; };\n                svg.Definitions = {};\n                svg.Styles = {};\n                svg.StylesSpecificity = {};\n                svg.Animations = [];\n                svg.Images = [];\n                svg.ctx = ctx;\n                svg.ViewPort = new (function () {\n\n                    this.viewPorts = [];\n                    this.Clear = function () { this.viewPorts = []; };\n                    this.SetCurrent = function (width, height) { this.viewPorts.push({ width: width, height: height }); };\n                    this.RemoveCurrent = function () { this.viewPorts.pop(); };\n                    this.Current = function () { return this.viewPorts[this.viewPorts.length - 1]; };\n                    this.width = function () { return this.Current().width; };\n                    this.height = function () { return this.Current().height; };\n                    this.ComputeSize = function (d) {\n                        if (d != null && typeof d == 'number') return d;\n                        if (d == 'x') return this.width();\n                        if (d == 'y') return this.height();\n                        return Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2);\n                    };\n                });\n            };\n            svg.init();\n\n            // images loaded\n            svg.ImagesLoaded = function () {\n                for (var i = 0; i < svg.Images.length; i++) {\n                    if (!svg.Images[i].loaded) return false;\n                }\n                return true;\n            };\n\n            // trim\n            svg.trim = function (s) { return s.replace(/^\\s+|\\s+$/g, ''); };\n\n            // compress non-ideographic spaces\n            svg.compressSpaces = function (s) { return s.replace(/(?!\\u3000)\\s+/gm, ' '); };\n\n            // ajax\n            svg.ajax = function (url) {\n                var AJAX;\n                if (windowEnv.XMLHttpRequest) { AJAX = new windowEnv.XMLHttpRequest(); } else { AJAX = new ActiveXObject('Microsoft.XMLHTTP'); }\n                if (AJAX) {\n                    AJAX.open('GET', url, false);\n                    AJAX.send(null);\n                    return AJAX.responseText;\n                }\n                return null;\n            };\n\n            // parse xml\n            svg.parseXml = function (xml) {\n                if (typeof Windows != 'undefined' && typeof Windows.Data != 'undefined' && typeof Windows.Data.Xml != 'undefined') {\n                    var xmlDoc = new Windows.Data.Xml.Dom.XmlDocument();\n                    var settings = new Windows.Data.Xml.Dom.XmlLoadSettings();\n                    settings.prohibitDtd = false;\n                    xmlDoc.loadXml(xml, settings);\n                    return xmlDoc;\n                } else if (windowEnv.DOMParser) {\n                    try {\n                        var parser = opts.xmldom ? new windowEnv.DOMParser(opts.xmldom) : new windowEnv.DOMParser();\n                        return parser.parseFromString(xml, 'image/svg+xml');\n                    } catch (e) {\n                        parser = opts.xmldom ? new windowEnv.DOMParser(opts.xmldom) : new windowEnv.DOMParser();\n                        return parser.parseFromString(xml, 'text/xml');\n                    }\n                } else {\n                    xml = xml.replace(/<!DOCTYPE svg[^>]*>/, '');\n                    var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\n                    xmlDoc.async = 'false';\n                    xmlDoc.loadXML(xml);\n                    return xmlDoc;\n                }\n            };\n\n            svg.Property = function (name, value) {\n                this.name = name;\n                this.value = value;\n            };\n            svg.Property.prototype.getValue = function () {\n                return this.value;\n            };\n\n            svg.Property.prototype.hasValue = function () {\n                return (this.value != null && this.value !== '');\n            };\n\n            // return the numerical value of the property\n            svg.Property.prototype.numValue = function () {\n                if (!this.hasValue()) return 0;\n\n                var n = parseFloat(this.value);\n                if ((this.value + '').match(/%$/)) {\n                    n = n / 100.0;\n                }\n                return n;\n            };\n\n            svg.Property.prototype.valueOrDefault = function (def) {\n                if (this.hasValue()) return this.value;\n                return def;\n            };\n\n            svg.Property.prototype.numValueOrDefault = function (def) {\n                if (this.hasValue()) return this.numValue();\n                return def;\n            };\n\n            // color extensions\n            // augment the current color value with the opacity\n            svg.Property.prototype.addOpacity = function (opacityProp) {\n                var newValue = this.value;\n                if (opacityProp.value != null && opacityProp.value != '' && typeof this.value == 'string') { // can only add opacity to colors, not patterns\n                    var color = new rgbcolor(this.value);\n                    if (color.ok) {\n                        newValue = 'rgba(' + color.r + ', ' + color.g + ', ' + color.b + ', ' + opacityProp.numValue() + ')';\n                    }\n                }\n                return new svg.Property(this.name, newValue);\n            };\n\n            // definition extensions\n            // get the definition from the definitions table\n            svg.Property.prototype.getDefinition = function () {\n                var name = this.value.match(/#([^\\)'\"]+)/);\n                if (name) { name = name[1]; }\n                if (!name) { name = this.value; }\n                return svg.Definitions[name];\n            };\n\n            svg.Property.prototype.isUrlDefinition = function () {\n                return this.value.indexOf('url(') == 0\n            };\n\n            svg.Property.prototype.getFillStyleDefinition = function (e, opacityProp) {\n                var def = this.getDefinition();\n\n                // gradient\n                if (def != null && def.createGradient) {\n                    return def.createGradient(svg.ctx, e, opacityProp);\n                }\n\n                // pattern\n                if (def != null && def.createPattern) {\n                    if (def.getHrefAttribute().hasValue()) {\n                        var pt = def.attribute('patternTransform');\n                        def = def.getHrefAttribute().getDefinition();\n                        if (pt.hasValue()) { def.attribute('patternTransform', true).value = pt.value; }\n                    }\n                    return def.createPattern(svg.ctx, e);\n                }\n\n                return null;\n            };\n\n            // length extensions\n            svg.Property.prototype.getDPI = function (/* viewPort */) {\n                return 96.0; // TODO: compute?\n            };\n\n            svg.Property.prototype.getREM = function (/* viewPort */) {\n                return svg.rootEmSize;\n            };\n\n            svg.Property.prototype.getEM = function (/* viewPort */) {\n                return svg.emSize;\n            };\n\n            svg.Property.prototype.getUnits = function () {\n                var s = this.value + '';\n                return s.replace(/[0-9\\.\\-]/g, '');\n            };\n\n            svg.Property.prototype.isPixels = function () {\n                if (!this.hasValue()) return false;\n                var s = this.value + '';\n                if (s.match(/px$/)) return true;\n                if (s.match(/^[0-9]+$/)) return true;\n                return false;\n            };\n\n            // get the length as pixels\n            svg.Property.prototype.toPixels = function (viewPort, processPercent) {\n                if (!this.hasValue()) return 0;\n                var s = this.value + '';\n                if (s.match(/rem$/)) return this.numValue() * this.getREM(viewPort);\n                if (s.match(/em$/)) return this.numValue() * this.getEM(viewPort);\n                if (s.match(/ex$/)) return this.numValue() * this.getEM(viewPort) / 2.0;\n                if (s.match(/px$/)) return this.numValue();\n                if (s.match(/pt$/)) return this.numValue() * this.getDPI(viewPort) * (1.0 / 72.0);\n                if (s.match(/pc$/)) return this.numValue() * 15;\n                if (s.match(/cm$/)) return this.numValue() * this.getDPI(viewPort) / 2.54;\n                if (s.match(/mm$/)) return this.numValue() * this.getDPI(viewPort) / 25.4;\n                if (s.match(/in$/)) return this.numValue() * this.getDPI(viewPort);\n                if (s.match(/%$/)) return this.numValue() * svg.ViewPort.ComputeSize(viewPort);\n                var n = this.numValue();\n                if (processPercent && n < 1.0) return n * svg.ViewPort.ComputeSize(viewPort);\n                return n;\n            };\n\n            // time extensions\n            // get the time as milliseconds\n            svg.Property.prototype.toMilliseconds = function () {\n                if (!this.hasValue()) return 0;\n                var s = this.value + '';\n                if (s.match(/s$/)) return this.numValue() * 1000;\n                if (s.match(/ms$/)) return this.numValue();\n                return this.numValue();\n            };\n\n            // angle extensions\n            // get the angle as radians\n            svg.Property.prototype.toRadians = function () {\n                if (!this.hasValue()) return 0;\n                var s = this.value + '';\n                if (s.match(/deg$/)) return this.numValue() * (Math.PI / 180.0);\n                if (s.match(/grad$/)) return this.numValue() * (Math.PI / 200.0);\n                if (s.match(/rad$/)) return this.numValue();\n                return this.numValue() * (Math.PI / 180.0);\n            };\n\n            // text extensions\n            // get the text baseline\n            var textBaselineMapping = {\n                'baseline': 'alphabetic',\n                'before-edge': 'top',\n                'text-before-edge': 'top',\n                'middle': 'middle',\n                'central': 'middle',\n                'after-edge': 'bottom',\n                'text-after-edge': 'bottom',\n                'ideographic': 'ideographic',\n                'alphabetic': 'alphabetic',\n                'hanging': 'hanging',\n                'mathematical': 'alphabetic'\n            };\n            svg.Property.prototype.toTextBaseline = function () {\n                if (!this.hasValue()) return null;\n                return textBaselineMapping[this.value];\n            };\n\n            // fonts\n            svg.Font = new (function () {\n                this.Styles = 'normal|italic|oblique|inherit';\n                this.Variants = 'normal|small-caps|inherit';\n                this.Weights = 'normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit';\n\n                this.CreateFont = function (fontStyle, fontVariant, fontWeight, fontSize, fontFamily, inherit) {\n                    var f = inherit != null ? this.Parse(inherit) : this.CreateFont('', '', '', '', '', svg.ctx.font);\n                    fontFamily = fontFamily || f.fontFamily;\n                    return {\n                        fontFamily: fontFamily,\n                        fontSize: fontSize || f.fontSize,\n                        fontStyle: fontStyle || f.fontStyle,\n                        fontWeight: fontWeight || f.fontWeight,\n                        fontVariant: fontVariant || f.fontVariant,\n                        toString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') }\n                    }\n                };\n\n                var that = this;\n                this.Parse = function (s) {\n                    var f = {};\n                    var d = svg.trim(svg.compressSpaces(s || '')).split(' ');\n                    var set = { fontSize: false, fontStyle: false, fontWeight: false, fontVariant: false };\n                    var ff = '';\n                    for (var i = 0; i < d.length; i++) {\n                        if (!set.fontStyle && that.Styles.indexOf(d[i]) != -1) {\n                            if (d[i] != 'inherit') f.fontStyle = d[i];\n                            set.fontStyle = true;\n                        } else if (!set.fontVariant && that.Variants.indexOf(d[i]) != -1) {\n                            if (d[i] != 'inherit') f.fontVariant = d[i];\n                            set.fontStyle = set.fontVariant = true;\n                        } else if (!set.fontWeight && that.Weights.indexOf(d[i]) != -1) {\n                            if (d[i] != 'inherit') f.fontWeight = d[i];\n                            set.fontStyle = set.fontVariant = set.fontWeight = true;\n                        } else if (!set.fontSize) {\n                            if (d[i] != 'inherit') f.fontSize = d[i].split('/')[0];\n                            set.fontStyle = set.fontVariant = set.fontWeight = set.fontSize = true;\n                        } else { if (d[i] != 'inherit') ff += d[i]; }\n                    }\n                    if (ff != '') f.fontFamily = ff;\n                    return f;\n                };\n            });\n\n            // points and paths\n            svg.ToNumberArray = function (s) {\n                var a = svg.trim(svg.compressSpaces((s || '').replace(/,/g, ' '))).split(' ');\n                for (var i = 0; i < a.length; i++) {\n                    a[i] = parseFloat(a[i]);\n                }\n                return a;\n            };\n            svg.Point = function (x, y) {\n                this.x = x;\n                this.y = y;\n            };\n            svg.Point.prototype.angleTo = function (p) {\n                return Math.atan2(p.y - this.y, p.x - this.x);\n            };\n\n            svg.Point.prototype.applyTransform = function (v) {\n                var xp = this.x * v[0] + this.y * v[2] + v[4];\n                var yp = this.x * v[1] + this.y * v[3] + v[5];\n                this.x = xp;\n                this.y = yp;\n            };\n\n            svg.CreatePoint = function (s) {\n                var a = svg.ToNumberArray(s);\n                return new svg.Point(a[0], a[1]);\n            };\n            svg.CreatePath = function (s) {\n                var a = svg.ToNumberArray(s);\n                var path = [];\n                for (var i = 0; i < a.length; i += 2) {\n                    path.push(new svg.Point(a[i], a[i + 1]));\n                }\n                return path;\n            };\n\n            // bounding box\n            svg.BoundingBox = function (x1, y1, x2, y2) { // pass in initial points if you want\n                this.x1 = Number.NaN;\n                this.y1 = Number.NaN;\n                this.x2 = Number.NaN;\n                this.y2 = Number.NaN;\n\n                this.x = function () { return this.x1; };\n                this.y = function () { return this.y1; };\n                this.width = function () { return this.x2 - this.x1; };\n                this.height = function () { return this.y2 - this.y1; };\n\n                this.addPoint = function (x, y) {\n                    if (x != null) {\n                        if (isNaN(this.x1) || isNaN(this.x2)) {\n                            this.x1 = x;\n                            this.x2 = x;\n                        }\n                        if (x < this.x1) this.x1 = x;\n                        if (x > this.x2) this.x2 = x;\n                    }\n\n                    if (y != null) {\n                        if (isNaN(this.y1) || isNaN(this.y2)) {\n                            this.y1 = y;\n                            this.y2 = y;\n                        }\n                        if (y < this.y1) this.y1 = y;\n                        if (y > this.y2) this.y2 = y;\n                    }\n                };\n                this.addX = function (x) { this.addPoint(x, null); };\n                this.addY = function (y) { this.addPoint(null, y); };\n\n                this.addBoundingBox = function (bb) {\n                    this.addPoint(bb.x1, bb.y1);\n                    this.addPoint(bb.x2, bb.y2);\n                };\n\n                this.addQuadraticCurve = function (p0x, p0y, p1x, p1y, p2x, p2y) {\n                    var cp1x = p0x + 2 / 3 * (p1x - p0x); // CP1 = QP0 + 2/3 *(QP1-QP0)\n                    var cp1y = p0y + 2 / 3 * (p1y - p0y); // CP1 = QP0 + 2/3 *(QP1-QP0)\n                    var cp2x = cp1x + 1 / 3 * (p2x - p0x); // CP2 = CP1 + 1/3 *(QP2-QP0)\n                    var cp2y = cp1y + 1 / 3 * (p2y - p0y); // CP2 = CP1 + 1/3 *(QP2-QP0)\n                    this.addBezierCurve(p0x, p0y, cp1x, cp2x, cp1y, cp2y, p2x, p2y);\n                };\n\n                this.addBezierCurve = function (p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y) {\n                    // from http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\n                    var p0 = [p0x, p0y],\n                        p1 = [p1x, p1y],\n                        p2 = [p2x, p2y],\n                        p3 = [p3x, p3y];\n                    this.addPoint(p0[0], p0[1]);\n                    this.addPoint(p3[0], p3[1]);\n\n                    for (var i = 0; i <= 1; i++) {\n                        var f = function (t) {\n                            return Math.pow(1 - t, 3) * p0[i] +\n                                3 * Math.pow(1 - t, 2) * t * p1[i] +\n                                3 * (1 - t) * Math.pow(t, 2) * p2[i] +\n                                Math.pow(t, 3) * p3[i];\n                        };\n\n                        var b = 6 * p0[i] - 12 * p1[i] + 6 * p2[i];\n                        var a = -3 * p0[i] + 9 * p1[i] - 9 * p2[i] + 3 * p3[i];\n                        var c = 3 * p1[i] - 3 * p0[i];\n\n                        if (a == 0) {\n                            if (b == 0) continue;\n                            var t = -c / b;\n                            if (0 < t && t < 1) {\n                                if (i == 0) this.addX(f(t));\n                                if (i == 1) this.addY(f(t));\n                            }\n                            continue;\n                        }\n\n                        var b2ac = Math.pow(b, 2) - 4 * c * a;\n                        if (b2ac < 0) continue;\n                        var t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\n                        if (0 < t1 && t1 < 1) {\n                            if (i == 0) this.addX(f(t1));\n                            if (i == 1) this.addY(f(t1));\n                        }\n                        var t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\n                        if (0 < t2 && t2 < 1) {\n                            if (i == 0) this.addX(f(t2));\n                            if (i == 1) this.addY(f(t2));\n                        }\n                    }\n                };\n\n                this.isPointInBox = function (x, y) {\n                    return (this.x1 <= x && x <= this.x2 && this.y1 <= y && y <= this.y2);\n                };\n\n                this.addPoint(x1, y1);\n                this.addPoint(x2, y2);\n            };\n\n            // transforms\n            svg.Transform = function (v) {\n                var that = this;\n                this.Type = {};\n\n                // translate\n                this.Type.translate = function (s) {\n                    this.p = svg.CreatePoint(s);\n                    this.apply = function (ctx) {\n                        ctx.translate(this.p.x || 0.0, this.p.y || 0.0);\n                    };\n                    this.unapply = function (ctx) {\n                        ctx.translate(-1.0 * this.p.x || 0.0, -1.0 * this.p.y || 0.0);\n                    };\n                    this.applyToPoint = function (p) {\n                        p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\n                    };\n                };\n\n                // rotate\n                this.Type.rotate = function (s) {\n                    var a = svg.ToNumberArray(s);\n                    this.angle = new svg.Property('angle', a[0]);\n                    this.cx = a[1] || 0;\n                    this.cy = a[2] || 0;\n                    this.apply = function (ctx) {\n                        ctx.translate(this.cx, this.cy);\n                        ctx.rotate(this.angle.toRadians());\n                        ctx.translate(-this.cx, -this.cy);\n                    };\n                    this.unapply = function (ctx) {\n                        ctx.translate(this.cx, this.cy);\n                        ctx.rotate(-1.0 * this.angle.toRadians());\n                        ctx.translate(-this.cx, -this.cy);\n                    };\n                    this.applyToPoint = function (p) {\n                        var a = this.angle.toRadians();\n                        p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\n                        p.applyTransform([Math.cos(a), Math.sin(a), -Math.sin(a), Math.cos(a), 0, 0]);\n                        p.applyTransform([1, 0, 0, 1, -this.p.x || 0.0, -this.p.y || 0.0]);\n                    };\n                };\n\n                this.Type.scale = function (s) {\n                    this.p = svg.CreatePoint(s);\n                    this.apply = function (ctx) {\n                        ctx.scale(this.p.x || 1.0, this.p.y || this.p.x || 1.0);\n                    };\n                    this.unapply = function (ctx) {\n                        ctx.scale(1.0 / this.p.x || 1.0, 1.0 / this.p.y || this.p.x || 1.0);\n                    };\n                    this.applyToPoint = function (p) {\n                        p.applyTransform([this.p.x || 0.0, 0, 0, this.p.y || 0.0, 0, 0]);\n                    };\n                };\n\n                this.Type.matrix = function (s) {\n                    this.m = svg.ToNumberArray(s);\n                    this.apply = function (ctx) {\n                        ctx.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]);\n                    };\n                    this.unapply = function (ctx) {\n                        var a = this.m[0];\n                        var b = this.m[2];\n                        var c = this.m[4];\n                        var d = this.m[1];\n                        var e = this.m[3];\n                        var f = this.m[5];\n                        var g = 0.0;\n                        var h = 0.0;\n                        var i = 1.0;\n                        var det = 1 / (a * (e * i - f * h) - b * (d * i - f * g) + c * (d * h - e * g));\n                        ctx.transform(\n                            det * (e * i - f * h),\n                            det * (f * g - d * i),\n                            det * (c * h - b * i),\n                            det * (a * i - c * g),\n                            det * (b * f - c * e),\n                            det * (c * d - a * f)\n                        );\n                    };\n                    this.applyToPoint = function (p) {\n                        p.applyTransform(this.m);\n                    };\n                };\n\n                this.Type.SkewBase = function (s) {\n                    this.base = that.Type.matrix;\n                    this.base(s);\n                    this.angle = new svg.Property('angle', s);\n                };\n                this.Type.SkewBase.prototype = new this.Type.matrix;\n\n                this.Type.skewX = function (s) {\n                    this.base = that.Type.SkewBase;\n                    this.base(s);\n                    this.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0];\n                };\n                this.Type.skewX.prototype = new this.Type.SkewBase;\n\n                this.Type.skewY = function (s) {\n                    this.base = that.Type.SkewBase;\n                    this.base(s);\n                    this.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0];\n                };\n                this.Type.skewY.prototype = new this.Type.SkewBase;\n\n                this.transforms = [];\n\n                this.apply = function (ctx) {\n                    for (var i = 0; i < this.transforms.length; i++) {\n                        this.transforms[i].apply(ctx);\n                    }\n                };\n\n                this.unapply = function (ctx) {\n                    for (var i = this.transforms.length - 1; i >= 0; i--) {\n                        this.transforms[i].unapply(ctx);\n                    }\n                };\n\n                this.applyToPoint = function (p) {\n                    for (var i = 0; i < this.transforms.length; i++) {\n                        this.transforms[i].applyToPoint(p);\n                    }\n                };\n\n                var data = svg.trim(svg.compressSpaces(v)).replace(/\\)([a-zA-Z])/g, ') $1').replace(/\\)(\\s?,\\s?)/g, ') ').split(/\\s(?=[a-z])/);\n                for (var i = 0; i < data.length; i++) {\n                    if (data[i] === 'none') {\n                        continue;\n                    }\n\n                    var type = svg.trim(data[i].split('(')[0]);\n                    var s = data[i].split('(')[1].replace(')', '');\n                    var transformType = this.Type[type];\n                    if (typeof transformType != 'undefined') {\n                        var transform = new transformType(s);\n                        transform.type = type;\n                        this.transforms.push(transform);\n                    }\n                }\n            };\n\n            // aspect ratio\n            svg.AspectRatio = function (ctx, aspectRatio, width, desiredWidth, height, desiredHeight, minX, minY, refX, refY) {\n                // aspect ratio - http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n                aspectRatio = svg.compressSpaces(aspectRatio);\n                aspectRatio = aspectRatio.replace(/^defer\\s/, ''); // ignore defer\n                var align = aspectRatio.split(' ')[0] || 'xMidYMid';\n                var meetOrSlice = aspectRatio.split(' ')[1] || 'meet';\n\n                // calculate scale\n                var scaleX = width / desiredWidth;\n                var scaleY = height / desiredHeight;\n                var scaleMin = Math.min(scaleX, scaleY);\n                var scaleMax = Math.max(scaleX, scaleY);\n                if (meetOrSlice == 'meet') {\n                    desiredWidth *= scaleMin;\n                    desiredHeight *= scaleMin;\n                }\n                if (meetOrSlice == 'slice') {\n                    desiredWidth *= scaleMax;\n                    desiredHeight *= scaleMax;\n                }\n\n                refX = new svg.Property('refX', refX);\n                refY = new svg.Property('refY', refY);\n                if (refX.hasValue() && refY.hasValue()) {\n                    ctx.translate(-scaleMin * refX.toPixels('x'), -scaleMin * refY.toPixels('y'));\n                } else {\n                    // align\n                    if (align.match(/^xMid/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width / 2.0 - desiredWidth / 2.0, 0);\n                    if (align.match(/YMid$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height / 2.0 - desiredHeight / 2.0);\n                    if (align.match(/^xMax/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width - desiredWidth, 0);\n                    if (align.match(/YMax$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height - desiredHeight);\n                }\n\n                // scale\n                if (align == 'none') ctx.scale(scaleX, scaleY);\n                else if (meetOrSlice == 'meet') ctx.scale(scaleMin, scaleMin);\n                else if (meetOrSlice == 'slice') ctx.scale(scaleMax, scaleMax);\n\n                // translate\n                ctx.translate(minX == null ? 0 : -minX, minY == null ? 0 : -minY);\n            };\n\n            // elements\n            svg.Element = {};\n\n            svg.EmptyProperty = new svg.Property('EMPTY', '');\n\n            svg.Element.ElementBase = function (node) {\n                this.attributes = {};\n                this.styles = {};\n                this.stylesSpecificity = {};\n                this.children = [];\n\n                // get or create attribute\n                this.attribute = function (name, createIfNotExists) {\n                    var a = this.attributes[name];\n                    if (a != null) return a;\n\n                    if (createIfNotExists == true) {\n                        a = new svg.Property(name, '');\n                        this.attributes[name] = a;\n                    }\n                    return a || svg.EmptyProperty;\n                };\n\n                this.getHrefAttribute = function () {\n                    for (var a in this.attributes) {\n                        if (a == 'href' || a.match(/:href$/)) {\n                            return this.attributes[a];\n                        }\n                    }\n                    return svg.EmptyProperty;\n                };\n\n                // get or create style, crawls up node tree\n                this.style = function (name, createIfNotExists, skipAncestors) {\n                    var s = this.styles[name];\n                    if (s != null) return s;\n\n                    var a = this.attribute(name);\n                    if (a != null && a.hasValue()) {\n                        this.styles[name] = a; // move up to me to cache\n                        return a;\n                    }\n\n                    if (skipAncestors != true) {\n                        var p = this.parent;\n                        if (p != null) {\n                            var ps = p.style(name);\n                            if (ps != null && ps.hasValue()) {\n                                return ps;\n                            }\n                        }\n                    }\n\n                    if (createIfNotExists == true) {\n                        s = new svg.Property(name, '');\n                        this.styles[name] = s;\n                    }\n                    return s || svg.EmptyProperty;\n                };\n\n                // base render\n                this.render = function (ctx) {\n                    // don't render display=none\n                    if (this.style('display').value == 'none') return;\n\n                    // don't render visibility=hidden\n                    if (this.style('visibility').value == 'hidden') return;\n\n                    ctx.save();\n                    if (this.style('mask').hasValue()) { // mask\n                        var mask = this.style('mask').getDefinition();\n                        if (mask != null) mask.apply(ctx, this);\n                    } else if (this.style('filter').hasValue()) { // filter\n                        var filter = this.style('filter').getDefinition();\n                        if (filter != null) filter.apply(ctx, this);\n                    } else {\n                        this.setContext(ctx);\n                        this.renderChildren(ctx);\n                        this.clearContext(ctx);\n                    }\n                    ctx.restore();\n                };\n\n                // base set context\n                this.setContext = function (/* ctx */) {\n                    // OVERRIDE ME!\n                };\n\n                // base clear context\n                this.clearContext = function (/* ctx */) {\n                    // OVERRIDE ME!\n                };\n\n                // base render children\n                this.renderChildren = function (ctx) {\n                    for (var i = 0; i < this.children.length; i++) {\n                        this.children[i].render(ctx);\n                    }\n                };\n\n                this.addChild = function (childNode, create) {\n                    var child = childNode;\n                    if (create) child = svg.CreateElement(childNode);\n                    child.parent = this;\n                    if (child.type != 'title') { this.children.push(child); }\n                };\n\n                this.addStylesFromStyleDefinition = function () {\n                    // add styles\n                    for (var selector in svg.Styles) {\n                        if (selector[0] != '@' && matchesSelector(node, selector)) {\n                            var styles = svg.Styles[selector];\n                            var specificity = svg.StylesSpecificity[selector];\n                            if (styles != null) {\n                                for (var name in styles) {\n                                    var existingSpecificity = this.stylesSpecificity[name];\n                                    if (typeof existingSpecificity == 'undefined') {\n                                        existingSpecificity = '000';\n                                    }\n                                    if (specificity >= existingSpecificity) {\n                                        this.styles[name] = styles[name];\n                                        this.stylesSpecificity[name] = specificity;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                };\n\n                // Microsoft Edge fix\n                var allUppercase = new RegExp('^[A-Z\\-]+$');\n                var normalizeAttributeName = function (name) {\n                    if (allUppercase.test(name)) {\n                        return name.toLowerCase();\n                    }\n                    return name;\n                };\n\n                if (node != null && node.nodeType == 1) { //ELEMENT_NODE\n                    // add attributes\n                    for (var i = 0; i < node.attributes.length; i++) {\n                        var attribute = node.attributes[i];\n                        var nodeName = normalizeAttributeName(attribute.nodeName);\n                        this.attributes[nodeName] = new svg.Property(nodeName, attribute.value);\n                    }\n\n                    this.addStylesFromStyleDefinition();\n\n                    // add inline styles\n                    if (this.attribute('style').hasValue()) {\n                        var styles = this.attribute('style').value.split(';');\n                        for (var i = 0; i < styles.length; i++) {\n                            if (svg.trim(styles[i]) != '') {\n                                var style = styles[i].split(':');\n                                var name = svg.trim(style[0]);\n                                var value = svg.trim(style[1]);\n                                this.styles[name] = new svg.Property(name, value);\n                            }\n                        }\n                    }\n\n                    // add id\n                    if (this.attribute('id').hasValue()) {\n                        if (svg.Definitions[this.attribute('id').value] == null) {\n                            svg.Definitions[this.attribute('id').value] = this;\n                        }\n                    }\n\n                    // add children\n                    for (var i = 0; i < node.childNodes.length; i++) {\n                        var childNode = node.childNodes[i];\n                        if (childNode.nodeType == 1) this.addChild(childNode, true); //ELEMENT_NODE\n                        if (this.captureTextNodes && (childNode.nodeType == 3 || childNode.nodeType == 4)) {\n                            var text = childNode.value || childNode.text || childNode.textContent || '';\n                            if (svg.compressSpaces(text) != '') {\n                                this.addChild(new svg.Element.tspan(childNode), false); // TEXT_NODE\n                            }\n                        }\n                    }\n                }\n            };\n\n            svg.Element.RenderedElementBase = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.calculateOpacity = function() {\n                    var opacity = 1.0;\n\n                    var el = this;\n                    while (el != null) {\n                        var opacityStyle = el.style('opacity', false, true); // no ancestors on style call\n                        if (opacityStyle.hasValue()) {\n                            opacity = opacity * opacityStyle.numValue();\n                        }\n                        el = el.parent;\n                    }\n\n                    return opacity;\n                };\n\n                this.setContext = function (ctx, fromMeasure) {\n                    if (!fromMeasure) { // causes stack overflow when measuring text with gradients\n                        // fill\n                        if (this.style('fill').isUrlDefinition()) {\n                            var fs = this.style('fill').getFillStyleDefinition(this, this.style('fill-opacity'));\n                            if (fs != null) ctx.fillStyle = fs;\n                        } else if (this.style('fill').hasValue()) {\n                            var fillStyle = this.style('fill');\n                            if (fillStyle.value == 'currentColor') fillStyle.value = this.style('color').value;\n                            if (fillStyle.value != 'inherit') ctx.fillStyle = (fillStyle.value == 'none' ? 'rgba(0,0,0,0)' : fillStyle.value);\n                        }\n                        if (this.style('fill-opacity').hasValue()) {\n                            var fillStyle = new svg.Property('fill', ctx.fillStyle);\n                            fillStyle = fillStyle.addOpacity(this.style('fill-opacity'));\n                            ctx.fillStyle = fillStyle.value;\n                        }\n\n                        // stroke\n                        if (this.style('stroke').isUrlDefinition()) {\n                            var fs = this.style('stroke').getFillStyleDefinition(this, this.style('stroke-opacity'));\n                            if (fs != null) ctx.strokeStyle = fs;\n                        } else if (this.style('stroke').hasValue()) {\n                            var strokeStyle = this.style('stroke');\n                            if (strokeStyle.value == 'currentColor') strokeStyle.value = this.style('color').value;\n                            if (strokeStyle.value != 'inherit') ctx.strokeStyle = (strokeStyle.value == 'none' ? 'rgba(0,0,0,0)' : strokeStyle.value);\n                        }\n                        if (this.style('stroke-opacity').hasValue()) {\n                            var strokeStyle = new svg.Property('stroke', ctx.strokeStyle);\n                            strokeStyle = strokeStyle.addOpacity(this.style('stroke-opacity'));\n                            ctx.strokeStyle = strokeStyle.value;\n                        }\n                        if (this.style('stroke-width').hasValue()) {\n                            var newLineWidth = this.style('stroke-width').toPixels();\n                            ctx.lineWidth = newLineWidth == 0 ? 0.001 : newLineWidth; // browsers don't respect 0\n                        }\n                        if (this.style('stroke-linecap').hasValue()) ctx.lineCap = this.style('stroke-linecap').value;\n                        if (this.style('stroke-linejoin').hasValue()) ctx.lineJoin = this.style('stroke-linejoin').value;\n                        if (this.style('stroke-miterlimit').hasValue()) ctx.miterLimit = this.style('stroke-miterlimit').value;\n                        if (this.style('paint-order').hasValue()) ctx.paintOrder = this.style('paint-order').value;\n                        if (this.style('stroke-dasharray').hasValue() && this.style('stroke-dasharray').value != 'none') {\n                            var gaps = svg.ToNumberArray(this.style('stroke-dasharray').value);\n                            if (typeof ctx.setLineDash != 'undefined') { ctx.setLineDash(gaps); } else if (typeof ctx.webkitLineDash != 'undefined') { ctx.webkitLineDash = gaps; } else if (typeof ctx.mozDash != 'undefined' && !(gaps.length == 1 && gaps[0] == 0)) { ctx.mozDash = gaps; }\n\n                            var offset = this.style('stroke-dashoffset').toPixels();\n                            if (typeof ctx.lineDashOffset != 'undefined') { ctx.lineDashOffset = offset; } else if (typeof ctx.webkitLineDashOffset != 'undefined') { ctx.webkitLineDashOffset = offset; } else if (typeof ctx.mozDashOffset != 'undefined') { ctx.mozDashOffset = offset; }\n                        }\n                    }\n\n                    // font\n                    if (typeof ctx.font != 'undefined') {\n                        ctx.font = svg.Font.CreateFont(\n                            this.style('font-style').value,\n                            this.style('font-variant').value,\n                            this.style('font-weight').value,\n                            this.style('font-size').hasValue() ? this.style('font-size').toPixels() + 'px' : '',\n                            this.style('font-family').value).toString();\n\n                        // update em size if needed\n                        var currentFontSize = this.style('font-size', false, false);\n                        if (currentFontSize.isPixels()) {\n                            svg.emSize = currentFontSize.toPixels();\n                        }\n                    }\n\n                    // transform\n                    if (this.style('transform', false, true).hasValue()) {\n                        var transform = new svg.Transform(this.style('transform', false, true).value);\n                        transform.apply(ctx);\n                    }\n\n                    // clip\n                    if (this.style('clip-path', false, true).hasValue()) {\n                        var clip = this.style('clip-path', false, true).getDefinition();\n                        if (clip != null) clip.apply(ctx);\n                    }\n\n                    // opacity\n                    ctx.globalAlpha = this.calculateOpacity();\n                };\n            };\n            svg.Element.RenderedElementBase.prototype = new svg.Element.ElementBase;\n\n            svg.Element.PathElementBase = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.path = function (ctx) {\n                    if (ctx != null) ctx.beginPath();\n                    return new svg.BoundingBox();\n                };\n\n                this.renderChildren = function (ctx) {\n                    this.path(ctx);\n                    svg.Mouse.checkPath(this, ctx);\n                    if (ctx.fillStyle != '') {\n                        if (this.style('fill-rule').valueOrDefault('inherit') != 'inherit') { ctx.fill(this.style('fill-rule').value); } else { ctx.fill(); }\n                    }\n                    if (ctx.strokeStyle != '') ctx.stroke();\n\n                    var markers = this.getMarkers();\n                    if (markers != null) {\n                        if (this.style('marker-start').isUrlDefinition()) {\n                            var marker = this.style('marker-start').getDefinition();\n                            marker.render(ctx, markers[0][0], markers[0][1]);\n                        }\n                        if (this.style('marker-mid').isUrlDefinition()) {\n                            var marker = this.style('marker-mid').getDefinition();\n                            for (var i = 1; i < markers.length - 1; i++) {\n                                marker.render(ctx, markers[i][0], markers[i][1]);\n                            }\n                        }\n                        if (this.style('marker-end').isUrlDefinition()) {\n                            var marker = this.style('marker-end').getDefinition();\n                            marker.render(ctx, markers[markers.length - 1][0], markers[markers.length - 1][1]);\n                        }\n                    }\n                };\n\n                this.getBoundingBox = function () {\n                    return this.path();\n                };\n\n                this.getMarkers = function () {\n                    return null;\n                };\n            };\n            svg.Element.PathElementBase.prototype = new svg.Element.RenderedElementBase;\n\n            // svg element\n            svg.Element.svg = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.baseClearContext = this.clearContext;\n                this.clearContext = function (ctx) {\n                    this.baseClearContext(ctx);\n                    svg.ViewPort.RemoveCurrent();\n                };\n\n                this.baseSetContext = this.setContext;\n                this.setContext = function (ctx) {\n                    // initial values and defaults\n                    ctx.strokeStyle = 'rgba(0,0,0,0)';\n                    ctx.lineCap = 'butt';\n                    ctx.lineJoin = 'miter';\n                    ctx.miterLimit = 4;\n                    if (ctx.canvas.style && typeof ctx.font != 'undefined' && typeof windowEnv.getComputedStyle != 'undefined') {\n                        ctx.font = windowEnv.getComputedStyle(ctx.canvas).getPropertyValue('font');\n\n                        var fontSize = new svg.Property('fontSize', svg.Font.Parse(ctx.font).fontSize);\n                        if (fontSize.hasValue()) svg.rootEmSize = svg.emSize = fontSize.toPixels('y');\n                    }\n\n                    this.baseSetContext(ctx);\n\n                    // create new view port\n                    if (!this.attribute('x').hasValue()) this.attribute('x', true).value = 0;\n                    if (!this.attribute('y').hasValue()) this.attribute('y', true).value = 0;\n                    ctx.translate(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y'));\n\n                    var width = svg.ViewPort.width();\n                    var height = svg.ViewPort.height();\n\n                    if (!this.attribute('width').hasValue()) this.attribute('width', true).value = '100%';\n                    if (!this.attribute('height').hasValue()) this.attribute('height', true).value = '100%';\n                    if (typeof this.root == 'undefined') {\n                        width = this.attribute('width').toPixels('x');\n                        height = this.attribute('height').toPixels('y');\n\n                        var x = 0;\n                        var y = 0;\n                        if (this.attribute('refX').hasValue() && this.attribute('refY').hasValue()) {\n                            x = -this.attribute('refX').toPixels('x');\n                            y = -this.attribute('refY').toPixels('y');\n                        }\n\n                        if (this.attribute('overflow').valueOrDefault('hidden') != 'visible') {\n                            ctx.beginPath();\n                            ctx.moveTo(x, y);\n                            ctx.lineTo(width, y);\n                            ctx.lineTo(width, height);\n                            ctx.lineTo(x, height);\n                            ctx.closePath();\n                            ctx.clip();\n                        }\n                    }\n                    svg.ViewPort.SetCurrent(width, height);\n\n                    // viewbox\n                    if (this.attribute('viewBox').hasValue()) {\n                        var viewBox = svg.ToNumberArray(this.attribute('viewBox').value);\n                        var minX = viewBox[0];\n                        var minY = viewBox[1];\n                        width = viewBox[2];\n                        height = viewBox[3];\n\n                        svg.AspectRatio(ctx,\n                            this.attribute('preserveAspectRatio').value,\n                            svg.ViewPort.width(),\n                            width,\n                            svg.ViewPort.height(),\n                            height,\n                            minX,\n                            minY,\n                            this.attribute('refX').value,\n                            this.attribute('refY').value);\n\n                        svg.ViewPort.RemoveCurrent();\n                        svg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);\n                    }\n                };\n            };\n            svg.Element.svg.prototype = new svg.Element.RenderedElementBase;\n\n            // rect element\n            svg.Element.rect = function (node) {\n                this.base = svg.Element.PathElementBase;\n                this.base(node);\n\n                this.path = function (ctx) {\n                    var x = this.attribute('x').toPixels('x');\n                    var y = this.attribute('y').toPixels('y');\n                    var width = this.attribute('width').toPixels('x');\n                    var height = this.attribute('height').toPixels('y');\n                    var rx = this.attribute('rx').toPixels('x');\n                    var ry = this.attribute('ry').toPixels('y');\n                    if (this.attribute('rx').hasValue() && !this.attribute('ry').hasValue()) ry = rx;\n                    if (this.attribute('ry').hasValue() && !this.attribute('rx').hasValue()) rx = ry;\n                    rx = Math.min(rx, width / 2.0);\n                    ry = Math.min(ry, height / 2.0);\n                    if (ctx != null) {\n                        var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\n                        ctx.beginPath();\n                        ctx.moveTo(x + rx, y);\n                        ctx.lineTo(x + width - rx, y);\n                        ctx.bezierCurveTo(x + width - rx + (KAPPA * rx), y, x + width, y + ry - (KAPPA * ry), x + width, y + ry);\n                        ctx.lineTo(x + width, y + height - ry);\n                        ctx.bezierCurveTo(x + width, y + height - ry + (KAPPA * ry), x + width - rx + (KAPPA * rx), y + height, x + width - rx, y + height);\n                        ctx.lineTo(x + rx, y + height);\n                        ctx.bezierCurveTo(x + rx - (KAPPA * rx), y + height, x, y + height - ry + (KAPPA * ry), x, y + height - ry);\n                        ctx.lineTo(x, y + ry);\n                        ctx.bezierCurveTo(x, y + ry - (KAPPA * ry), x + rx - (KAPPA * rx), y, x + rx, y);\n                        ctx.closePath();\n                    }\n\n                    return new svg.BoundingBox(x, y, x + width, y + height);\n                };\n            };\n            svg.Element.rect.prototype = new svg.Element.PathElementBase;\n\n            // circle element\n            svg.Element.circle = function (node) {\n                this.base = svg.Element.PathElementBase;\n                this.base(node);\n\n                this.path = function (ctx) {\n                    var cx = this.attribute('cx').toPixels('x');\n                    var cy = this.attribute('cy').toPixels('y');\n                    var r = this.attribute('r').toPixels();\n\n                    if (ctx != null) {\n                        ctx.beginPath();\n                        ctx.arc(cx, cy, r, 0, Math.PI * 2, false);\n                        ctx.closePath();\n                    }\n\n                    return new svg.BoundingBox(cx - r, cy - r, cx + r, cy + r);\n                };\n            };\n            svg.Element.circle.prototype = new svg.Element.PathElementBase;\n\n            // ellipse element\n            svg.Element.ellipse = function (node) {\n                this.base = svg.Element.PathElementBase;\n                this.base(node);\n\n                this.path = function (ctx) {\n                    var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\n                    var rx = this.attribute('rx').toPixels('x');\n                    var ry = this.attribute('ry').toPixels('y');\n                    var cx = this.attribute('cx').toPixels('x');\n                    var cy = this.attribute('cy').toPixels('y');\n\n                    if (ctx != null) {\n                        ctx.beginPath();\n                        ctx.moveTo(cx + rx, cy);\n                        ctx.bezierCurveTo(cx + rx, cy + (KAPPA * ry), cx + (KAPPA * rx), cy + ry, cx, cy + ry);\n                        ctx.bezierCurveTo(cx - (KAPPA * rx), cy + ry, cx - rx, cy + (KAPPA * ry), cx - rx, cy);\n                        ctx.bezierCurveTo(cx - rx, cy - (KAPPA * ry), cx - (KAPPA * rx), cy - ry, cx, cy - ry);\n                        ctx.bezierCurveTo(cx + (KAPPA * rx), cy - ry, cx + rx, cy - (KAPPA * ry), cx + rx, cy);\n                        ctx.closePath();\n                    }\n\n                    return new svg.BoundingBox(cx - rx, cy - ry, cx + rx, cy + ry);\n                };\n            };\n            svg.Element.ellipse.prototype = new svg.Element.PathElementBase;\n\n            // line element\n            svg.Element.line = function (node) {\n                this.base = svg.Element.PathElementBase;\n                this.base(node);\n\n                this.getPoints = function () {\n                    return [\n                        new svg.Point(this.attribute('x1').toPixels('x'), this.attribute('y1').toPixels('y')),\n                        new svg.Point(this.attribute('x2').toPixels('x'), this.attribute('y2').toPixels('y'))\n                    ];\n                };\n\n                this.path = function (ctx) {\n                    var points = this.getPoints();\n\n                    if (ctx != null) {\n                        ctx.beginPath();\n                        ctx.moveTo(points[0].x, points[0].y);\n                        ctx.lineTo(points[1].x, points[1].y);\n                    }\n\n                    return new svg.BoundingBox(points[0].x, points[0].y, points[1].x, points[1].y);\n                };\n\n                this.getMarkers = function () {\n                    var points = this.getPoints();\n                    var a = points[0].angleTo(points[1]);\n                    return [\n                        [points[0], a],\n                        [points[1], a]\n                    ];\n                };\n            };\n            svg.Element.line.prototype = new svg.Element.PathElementBase;\n\n            // polyline element\n            svg.Element.polyline = function (node) {\n                this.base = svg.Element.PathElementBase;\n                this.base(node);\n\n                this.points = svg.CreatePath(this.attribute('points').value);\n                this.path = function (ctx) {\n                    var bb = new svg.BoundingBox(this.points[0].x, this.points[0].y);\n                    if (ctx != null) {\n                        ctx.beginPath();\n                        ctx.moveTo(this.points[0].x, this.points[0].y);\n                    }\n                    for (var i = 1; i < this.points.length; i++) {\n                        bb.addPoint(this.points[i].x, this.points[i].y);\n                        if (ctx != null) ctx.lineTo(this.points[i].x, this.points[i].y);\n                    }\n                    return bb;\n                };\n\n                this.getMarkers = function () {\n                    var markers = [];\n                    for (var i = 0; i < this.points.length - 1; i++) {\n                        markers.push([this.points[i], this.points[i].angleTo(this.points[i + 1])]);\n                    }\n                    if (markers.length > 0) {\n                        markers.push([this.points[this.points.length - 1], markers[markers.length - 1][1]]);\n                    }\n                    return markers;\n                };\n            };\n            svg.Element.polyline.prototype = new svg.Element.PathElementBase;\n\n            // polygon element\n            svg.Element.polygon = function (node) {\n                this.base = svg.Element.polyline;\n                this.base(node);\n\n                this.basePath = this.path;\n                this.path = function (ctx) {\n                    var bb = this.basePath(ctx);\n                    if (ctx != null) {\n                        ctx.lineTo(this.points[0].x, this.points[0].y);\n                        ctx.closePath();\n                    }\n                    return bb;\n                };\n            };\n            svg.Element.polygon.prototype = new svg.Element.polyline;\n\n            // path element\n            svg.Element.path = function (node) {\n                this.base = svg.Element.PathElementBase;\n                this.base(node);\n\n                var d = this.attribute('d').value;\n                // TODO: convert to real lexer based on http://www.w3.org/TR/SVG11/paths.html#PathDataBNF\n                d = d.replace(/,/gm, ' '); // get rid of all commas\n                // As the end of a match can also be the start of the next match, we need to run this replace twice.\n                for (var i = 0; i < 2; i++)\n                    d = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\\s])/gm, '$1 $2'); // suffix commands with spaces\n                d = d.replace(/([^\\s])([MmZzLlHhVvCcSsQqTtAa])/gm, '$1 $2'); // prefix commands with spaces\n                d = d.replace(/([0-9])([+\\-])/gm, '$1 $2'); // separate digits on +- signs\n                // Again, we need to run this twice to find all occurances\n                for (var i = 0; i < 2; i++)\n                    d = d.replace(/(\\.[0-9]*)(\\.)/gm, '$1 $2'); // separate digits when they start with a comma\n                d = d.replace(/([Aa](\\s+[0-9]+){3})\\s+([01])\\s*([01])/gm, '$1 $3 $4 '); // shorthand elliptical arc path syntax\n                d = svg.compressSpaces(d); // compress multiple spaces\n                d = svg.trim(d);\n                this.PathParser = new (function (d) {\n                    this.tokens = d.split(' ');\n\n                    this.reset = function () {\n                        this.i = -1;\n                        this.command = '';\n                        this.previousCommand = '';\n                        this.start = new svg.Point(0, 0);\n                        this.control = new svg.Point(0, 0);\n                        this.current = new svg.Point(0, 0);\n                        this.points = [];\n                        this.angles = [];\n                    };\n\n                    this.isEnd = function () {\n                        return this.i >= this.tokens.length - 1;\n                    };\n\n                    this.isCommandOrEnd = function () {\n                        if (this.isEnd()) return true;\n                        return this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null;\n                    };\n\n                    this.isRelativeCommand = function () {\n                        switch (this.command) {\n                            case 'm':\n                            case 'l':\n                            case 'h':\n                            case 'v':\n                            case 'c':\n                            case 's':\n                            case 'q':\n                            case 't':\n                            case 'a':\n                            case 'z':\n                                return true;\n                        }\n                        return false;\n                    };\n\n                    this.getToken = function () {\n                        this.i++;\n                        return this.tokens[this.i];\n                    };\n\n                    this.getScalar = function () {\n                        return parseFloat(this.getToken());\n                    };\n\n                    this.nextCommand = function () {\n                        this.previousCommand = this.command;\n                        this.command = this.getToken();\n                    };\n\n                    this.getPoint = function () {\n                        var p = new svg.Point(this.getScalar(), this.getScalar());\n                        return this.makeAbsolute(p);\n                    };\n\n                    this.getAsControlPoint = function () {\n                        var p = this.getPoint();\n                        this.control = p;\n                        return p;\n                    };\n\n                    this.getAsCurrentPoint = function () {\n                        var p = this.getPoint();\n                        this.current = p;\n                        return p;\n                    };\n\n                    this.getReflectedControlPoint = function () {\n                        if (this.previousCommand.toLowerCase() != 'c' &&\n                            this.previousCommand.toLowerCase() != 's' &&\n                            this.previousCommand.toLowerCase() != 'q' &&\n                            this.previousCommand.toLowerCase() != 't') {\n                            return this.current;\n                        }\n\n                        // reflect point\n                        var p = new svg.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y);\n                        return p;\n                    };\n\n                    this.makeAbsolute = function (p) {\n                        if (this.isRelativeCommand()) {\n                            p.x += this.current.x;\n                            p.y += this.current.y;\n                        }\n                        return p;\n                    };\n\n                    this.addMarker = function (p, from, priorTo) {\n                        // if the last angle isn't filled in because we didn't have this point yet ...\n                        if (priorTo != null && this.angles.length > 0 && this.angles[this.angles.length - 1] == null) {\n                            this.angles[this.angles.length - 1] = this.points[this.points.length - 1].angleTo(priorTo);\n                        }\n                        this.addMarkerAngle(p, from == null ? null : from.angleTo(p));\n                    };\n\n                    this.addMarkerAngle = function (p, a) {\n                        this.points.push(p);\n                        this.angles.push(a);\n                    };\n\n                    this.getMarkerPoints = function () { return this.points; };\n                    this.getMarkerAngles = function () {\n                        for (var i = 0; i < this.angles.length; i++) {\n                            if (this.angles[i] == null) {\n                                for (var j = i + 1; j < this.angles.length; j++) {\n                                    if (this.angles[j] != null) {\n                                        this.angles[i] = this.angles[j];\n                                        break;\n                                    }\n                                }\n                            }\n                        }\n                        return this.angles;\n                    };\n                })(d);\n\n                this.path = function (ctx) {\n                    var pp = this.PathParser;\n                    pp.reset();\n\n                    var bb = new svg.BoundingBox();\n                    if (ctx != null) ctx.beginPath();\n                    while (!pp.isEnd()) {\n                        pp.nextCommand();\n                        switch (pp.command) {\n                            case 'M':\n                            case 'm':\n                                var p = pp.getAsCurrentPoint();\n                                pp.addMarker(p);\n                                bb.addPoint(p.x, p.y);\n                                if (ctx != null) ctx.moveTo(p.x, p.y);\n                                pp.start = pp.current;\n                                while (!pp.isCommandOrEnd()) {\n                                    var p = pp.getAsCurrentPoint();\n                                    pp.addMarker(p, pp.start);\n                                    bb.addPoint(p.x, p.y);\n                                    if (ctx != null) ctx.lineTo(p.x, p.y);\n                                }\n                                break;\n                            case 'L':\n                            case 'l':\n                                while (!pp.isCommandOrEnd()) {\n                                    var c = pp.current;\n                                    var p = pp.getAsCurrentPoint();\n                                    pp.addMarker(p, c);\n                                    bb.addPoint(p.x, p.y);\n                                    if (ctx != null) ctx.lineTo(p.x, p.y);\n                                }\n                                break;\n                            case 'H':\n                            case 'h':\n                                while (!pp.isCommandOrEnd()) {\n                                    var newP = new svg.Point((pp.isRelativeCommand() ? pp.current.x : 0) + pp.getScalar(), pp.current.y);\n                                    pp.addMarker(newP, pp.current);\n                                    pp.current = newP;\n                                    bb.addPoint(pp.current.x, pp.current.y);\n                                    if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\n                                }\n                                break;\n                            case 'V':\n                            case 'v':\n                                while (!pp.isCommandOrEnd()) {\n                                    var newP = new svg.Point(pp.current.x, (pp.isRelativeCommand() ? pp.current.y : 0) + pp.getScalar());\n                                    pp.addMarker(newP, pp.current);\n                                    pp.current = newP;\n                                    bb.addPoint(pp.current.x, pp.current.y);\n                                    if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\n                                }\n                                break;\n                            case 'C':\n                            case 'c':\n                                while (!pp.isCommandOrEnd()) {\n                                    var curr = pp.current;\n                                    var p1 = pp.getPoint();\n                                    var cntrl = pp.getAsControlPoint();\n                                    var cp = pp.getAsCurrentPoint();\n                                    pp.addMarker(cp, cntrl, p1);\n                                    bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\n                                    if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\n                                }\n                                break;\n                            case 'S':\n                            case 's':\n                                while (!pp.isCommandOrEnd()) {\n                                    var curr = pp.current;\n                                    var p1 = pp.getReflectedControlPoint();\n                                    var cntrl = pp.getAsControlPoint();\n                                    var cp = pp.getAsCurrentPoint();\n                                    pp.addMarker(cp, cntrl, p1);\n                                    bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\n                                    if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\n                                }\n                                break;\n                            case 'Q':\n                            case 'q':\n                                while (!pp.isCommandOrEnd()) {\n                                    var curr = pp.current;\n                                    var cntrl = pp.getAsControlPoint();\n                                    var cp = pp.getAsCurrentPoint();\n                                    pp.addMarker(cp, cntrl, cntrl);\n                                    bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\n                                    if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\n                                }\n                                break;\n                            case 'T':\n                            case 't':\n                                while (!pp.isCommandOrEnd()) {\n                                    var curr = pp.current;\n                                    var cntrl = pp.getReflectedControlPoint();\n                                    pp.control = cntrl;\n                                    var cp = pp.getAsCurrentPoint();\n                                    pp.addMarker(cp, cntrl, cntrl);\n                                    bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\n                                    if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\n                                }\n                                break;\n                            case 'A':\n                            case 'a':\n                                while (!pp.isCommandOrEnd()) {\n                                    var curr = pp.current;\n                                    var rx = pp.getScalar();\n                                    var ry = pp.getScalar();\n                                    var xAxisRotation = pp.getScalar() * (Math.PI / 180.0);\n                                    var largeArcFlag = pp.getScalar();\n                                    var sweepFlag = pp.getScalar();\n                                    var cp = pp.getAsCurrentPoint();\n\n                                    // Conversion from endpoint to center parameterization\n                                    // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n                                    // x1', y1'\n                                    var currp = new svg.Point(\n                                        Math.cos(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.sin(xAxisRotation) * (curr.y - cp.y) / 2.0, -Math.sin(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.cos(xAxisRotation) * (curr.y - cp.y) / 2.0\n                                    );\n                                    // adjust radii\n                                    var l = Math.pow(currp.x, 2) / Math.pow(rx, 2) + Math.pow(currp.y, 2) / Math.pow(ry, 2);\n                                    if (l > 1) {\n                                        rx *= Math.sqrt(l);\n                                        ry *= Math.sqrt(l);\n                                    }\n                                    // cx', cy'\n                                    var s = (largeArcFlag == sweepFlag ? -1 : 1) * Math.sqrt(\n                                        ((Math.pow(rx, 2) * Math.pow(ry, 2)) - (Math.pow(rx, 2) * Math.pow(currp.y, 2)) - (Math.pow(ry, 2) * Math.pow(currp.x, 2))) /\n                                        (Math.pow(rx, 2) * Math.pow(currp.y, 2) + Math.pow(ry, 2) * Math.pow(currp.x, 2))\n                                    );\n                                    if (isNaN(s)) s = 0;\n                                    var cpp = new svg.Point(s * rx * currp.y / ry, s * -ry * currp.x / rx);\n                                    // cx, cy\n                                    var centp = new svg.Point(\n                                        (curr.x + cp.x) / 2.0 + Math.cos(xAxisRotation) * cpp.x - Math.sin(xAxisRotation) * cpp.y,\n                                        (curr.y + cp.y) / 2.0 + Math.sin(xAxisRotation) * cpp.x + Math.cos(xAxisRotation) * cpp.y\n                                    );\n                                    // vector magnitude\n                                    var m = function (v) { return Math.sqrt(Math.pow(v[0], 2) + Math.pow(v[1], 2)); };\n                                    // ratio between two vectors\n                                    var r = function (u, v) { return (u[0] * v[0] + u[1] * v[1]) / (m(u) * m(v)) };\n                                    // angle between two vectors\n                                    var a = function (u, v) { return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(r(u, v)); };\n                                    // initial angle\n                                    var a1 = a([1, 0], [(currp.x - cpp.x) / rx, (currp.y - cpp.y) / ry]);\n                                    // angle delta\n                                    var u = [(currp.x - cpp.x) / rx, (currp.y - cpp.y) / ry];\n                                    var v = [(-currp.x - cpp.x) / rx, (-currp.y - cpp.y) / ry];\n                                    var ad = a(u, v);\n                                    if (r(u, v) <= -1) ad = Math.PI;\n                                    if (r(u, v) >= 1) ad = 0;\n\n                                    // for markers\n                                    var dir = 1 - sweepFlag ? 1.0 : -1.0;\n                                    var ah = a1 + dir * (ad / 2.0);\n                                    var halfWay = new svg.Point(\n                                        centp.x + rx * Math.cos(ah),\n                                        centp.y + ry * Math.sin(ah)\n                                    );\n                                    pp.addMarkerAngle(halfWay, ah - dir * Math.PI / 2);\n                                    pp.addMarkerAngle(cp, ah - dir * Math.PI);\n\n                                    bb.addPoint(cp.x, cp.y); // TODO: this is too naive, make it better\n                                    if (ctx != null && !isNaN(a1) && !isNaN(ad)) {\n                                        var r = rx > ry ? rx : ry;\n                                        var sx = rx > ry ? 1 : rx / ry;\n                                        var sy = rx > ry ? ry / rx : 1;\n\n                                        ctx.translate(centp.x, centp.y);\n                                        ctx.rotate(xAxisRotation);\n                                        ctx.scale(sx, sy);\n                                        ctx.arc(0, 0, r, a1, a1 + ad, 1 - sweepFlag);\n                                        ctx.scale(1 / sx, 1 / sy);\n                                        ctx.rotate(-xAxisRotation);\n                                        ctx.translate(-centp.x, -centp.y);\n                                    }\n                                }\n                                break;\n                            case 'Z':\n                            case 'z':\n                                if (ctx != null) {\n                                    // only close path if it is not a straight line\n                                    if (bb.x1 !== bb.x2 && bb.y1 !== bb.y2) {\n                                        ctx.closePath();\n                                    }\n                                }\n                                pp.current = pp.start;\n                        }\n                    }\n\n                    return bb;\n                };\n\n                this.getMarkers = function () {\n                    var points = this.PathParser.getMarkerPoints();\n                    var angles = this.PathParser.getMarkerAngles();\n\n                    var markers = [];\n                    for (var i = 0; i < points.length; i++) {\n                        markers.push([points[i], angles[i]]);\n                    }\n                    return markers;\n                };\n            };\n            svg.Element.path.prototype = new svg.Element.PathElementBase;\n\n            // pattern element\n            svg.Element.pattern = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.createPattern = function (ctx /* , element */) {\n                    var width = this.attribute('width').toPixels('x', true);\n                    var height = this.attribute('height').toPixels('y', true);\n\n                    // render me using a temporary svg element\n                    var tempSvg = new svg.Element.svg();\n                    tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\n                    tempSvg.attributes['width'] = new svg.Property('width', width + 'px');\n                    tempSvg.attributes['height'] = new svg.Property('height', height + 'px');\n                    tempSvg.attributes['transform'] = new svg.Property('transform', this.attribute('patternTransform').value);\n                    tempSvg.children = this.children;\n\n                    var c = createCanvas(width, height);\n                    var cctx = c.getContext('2d');\n                    if (this.attribute('x').hasValue() && this.attribute('y').hasValue()) {\n                        cctx.translate(this.attribute('x').toPixels('x', true), this.attribute('y').toPixels('y', true));\n                    }\n                    // render 3x3 grid so when we transform there's no white space on edges\n                    for (var x = -1; x <= 1; x++) {\n                        for (var y = -1; y <= 1; y++) {\n                            cctx.save();\n                            tempSvg.attributes['x'] = new svg.Property('x', x * c.width);\n                            tempSvg.attributes['y'] = new svg.Property('y', y * c.height);\n                            tempSvg.render(cctx);\n                            cctx.restore();\n                        }\n                    }\n                    var pattern = ctx.createPattern(c, 'repeat');\n                    return pattern;\n                };\n            };\n            svg.Element.pattern.prototype = new svg.Element.ElementBase;\n\n            // marker element\n            svg.Element.marker = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.baseRender = this.render;\n                this.render = function (ctx, point, angle) {\n                    if (!point) { return; }\n                    ctx.translate(point.x, point.y);\n                    if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(angle);\n                    if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(ctx.lineWidth, ctx.lineWidth);\n                    ctx.save();\n\n                    // render me using a temporary svg element\n                    var tempSvg = new svg.Element.svg();\n                    tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\n                    tempSvg.attributes['refX'] = new svg.Property('refX', this.attribute('refX').value);\n                    tempSvg.attributes['refY'] = new svg.Property('refY', this.attribute('refY').value);\n                    tempSvg.attributes['width'] = new svg.Property('width', this.attribute('markerWidth').value);\n                    tempSvg.attributes['height'] = new svg.Property('height', this.attribute('markerHeight').value);\n                    tempSvg.attributes['fill'] = new svg.Property('fill', this.attribute('fill').valueOrDefault('black'));\n                    tempSvg.attributes['stroke'] = new svg.Property('stroke', this.attribute('stroke').valueOrDefault('none'));\n                    tempSvg.children = this.children;\n                    tempSvg.render(ctx);\n\n                    ctx.restore();\n                    if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(1 / ctx.lineWidth, 1 / ctx.lineWidth);\n                    if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(-angle);\n                    ctx.translate(-point.x, -point.y);\n                };\n            };\n            svg.Element.marker.prototype = new svg.Element.ElementBase;\n\n            // definitions element\n            svg.Element.defs = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.render = function (/* ctx */) {\n                    // NOOP\n                };\n            };\n            svg.Element.defs.prototype = new svg.Element.ElementBase;\n\n            // base for gradients\n            svg.Element.GradientBase = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.stops = [];\n                for (var i = 0; i < this.children.length; i++) {\n                    var child = this.children[i];\n                    if (child.type == 'stop') this.stops.push(child);\n                }\n\n                this.getGradient = function () {\n                    // OVERRIDE ME!\n                };\n\n                this.gradientUnits = function () {\n                    return this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');\n                };\n\n                this.attributesToInherit = ['gradientUnits'];\n\n                this.inheritStopContainer = function (stopsContainer) {\n                    for (var i = 0; i < this.attributesToInherit.length; i++) {\n                        var attributeToInherit = this.attributesToInherit[i];\n                        if (!this.attribute(attributeToInherit).hasValue() && stopsContainer.attribute(attributeToInherit).hasValue()) {\n                            this.attribute(attributeToInherit, true).value = stopsContainer.attribute(attributeToInherit).value;\n                        }\n                    }\n                };\n\n                this.createGradient = function (ctx, element, parentOpacityProp) {\n                    var stopsContainer = this;\n                    if (this.getHrefAttribute().hasValue()) {\n                        stopsContainer = this.getHrefAttribute().getDefinition();\n                        this.inheritStopContainer(stopsContainer);\n                    }\n\n                    var addParentOpacity = function (color) {\n                        if (parentOpacityProp.hasValue()) {\n                            var p = new svg.Property('color', color);\n                            return p.addOpacity(parentOpacityProp).value;\n                        }\n                        return color;\n                    };\n\n                    var g = this.getGradient(ctx, element);\n                    if (g == null) return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length - 1].color);\n                    for (var i = 0; i < stopsContainer.stops.length; i++) {\n                        g.addColorStop(stopsContainer.stops[i].offset, addParentOpacity(stopsContainer.stops[i].color));\n                    }\n\n                    if (this.attribute('gradientTransform').hasValue()) {\n                        // render as transformed pattern on temporary canvas\n                        var rootView = svg.ViewPort.viewPorts[0];\n\n                        var rect = new svg.Element.rect();\n                        rect.attributes['x'] = new svg.Property('x', -svg.MAX_VIRTUAL_PIXELS / 3.0);\n                        rect.attributes['y'] = new svg.Property('y', -svg.MAX_VIRTUAL_PIXELS / 3.0);\n                        rect.attributes['width'] = new svg.Property('width', svg.MAX_VIRTUAL_PIXELS);\n                        rect.attributes['height'] = new svg.Property('height', svg.MAX_VIRTUAL_PIXELS);\n\n                        var group = new svg.Element.g();\n                        group.attributes['transform'] = new svg.Property('transform', this.attribute('gradientTransform').value);\n                        group.children = [rect];\n\n                        var tempSvg = new svg.Element.svg();\n                        tempSvg.attributes['x'] = new svg.Property('x', 0);\n                        tempSvg.attributes['y'] = new svg.Property('y', 0);\n                        tempSvg.attributes['width'] = new svg.Property('width', rootView.width);\n                        tempSvg.attributes['height'] = new svg.Property('height', rootView.height);\n                        tempSvg.children = [group];\n                        var c = createCanvas(rootView.width, rootView.height);\n                        var tempCtx = c.getContext('2d');\n                        tempCtx.fillStyle = g;\n                        tempSvg.render(tempCtx);\n                        return tempCtx.createPattern(c, 'no-repeat');\n                    }\n\n                    return g;\n                };\n            };\n            svg.Element.GradientBase.prototype = new svg.Element.ElementBase;\n\n            // linear gradient element\n            svg.Element.linearGradient = function (node) {\n                this.base = svg.Element.GradientBase;\n                this.base(node);\n\n                this.attributesToInherit.push('x1');\n                this.attributesToInherit.push('y1');\n                this.attributesToInherit.push('x2');\n                this.attributesToInherit.push('y2');\n\n                this.getGradient = function (ctx, element) {\n                    var bb = this.gradientUnits() == 'objectBoundingBox' ? element.getBoundingBox(ctx) : null;\n\n                    if (!this.attribute('x1').hasValue() &&\n                        !this.attribute('y1').hasValue() &&\n                        !this.attribute('x2').hasValue() &&\n                        !this.attribute('y2').hasValue()) {\n                        this.attribute('x1', true).value = 0;\n                        this.attribute('y1', true).value = 0;\n                        this.attribute('x2', true).value = 1;\n                        this.attribute('y2', true).value = 0;\n                    }\n\n                    var x1 = (this.gradientUnits() == 'objectBoundingBox' ?\n                        bb.x() + bb.width() * this.attribute('x1').numValue() :\n                        this.attribute('x1').toPixels('x'));\n                    var y1 = (this.gradientUnits() == 'objectBoundingBox' ?\n                        bb.y() + bb.height() * this.attribute('y1').numValue() :\n                        this.attribute('y1').toPixels('y'));\n                    var x2 = (this.gradientUnits() == 'objectBoundingBox' ?\n                        bb.x() + bb.width() * this.attribute('x2').numValue() :\n                        this.attribute('x2').toPixels('x'));\n                    var y2 = (this.gradientUnits() == 'objectBoundingBox' ?\n                        bb.y() + bb.height() * this.attribute('y2').numValue() :\n                        this.attribute('y2').toPixels('y'));\n\n                    if (x1 == x2 && y1 == y2) return null;\n                    return ctx.createLinearGradient(x1, y1, x2, y2);\n                };\n            };\n            svg.Element.linearGradient.prototype = new svg.Element.GradientBase;\n\n            // radial gradient element\n            svg.Element.radialGradient = function (node) {\n                this.base = svg.Element.GradientBase;\n                this.base(node);\n\n                this.attributesToInherit.push('cx');\n                this.attributesToInherit.push('cy');\n                this.attributesToInherit.push('r');\n                this.attributesToInherit.push('fx');\n                this.attributesToInherit.push('fy');\n\n                this.getGradient = function (ctx, element) {\n                    var bb = element.getBoundingBox(ctx);\n\n                    if (!this.attribute('cx').hasValue()) this.attribute('cx', true).value = '50%';\n                    if (!this.attribute('cy').hasValue()) this.attribute('cy', true).value = '50%';\n                    if (!this.attribute('r').hasValue()) this.attribute('r', true).value = '50%';\n\n                    var cx = (this.gradientUnits() == 'objectBoundingBox' ?\n                        bb.x() + bb.width() * this.attribute('cx').numValue() :\n                        this.attribute('cx').toPixels('x'));\n                    var cy = (this.gradientUnits() == 'objectBoundingBox' ?\n                        bb.y() + bb.height() * this.attribute('cy').numValue() :\n                        this.attribute('cy').toPixels('y'));\n\n                    var fx = cx;\n                    var fy = cy;\n                    if (this.attribute('fx').hasValue()) {\n                        fx = (this.gradientUnits() == 'objectBoundingBox' ?\n                            bb.x() + bb.width() * this.attribute('fx').numValue() :\n                            this.attribute('fx').toPixels('x'));\n                    }\n                    if (this.attribute('fy').hasValue()) {\n                        fy = (this.gradientUnits() == 'objectBoundingBox' ?\n                            bb.y() + bb.height() * this.attribute('fy').numValue() :\n                            this.attribute('fy').toPixels('y'));\n                    }\n\n                    var r = (this.gradientUnits() == 'objectBoundingBox' ?\n                        (bb.width() + bb.height()) / 2.0 * this.attribute('r').numValue() :\n                        this.attribute('r').toPixels());\n\n                    return ctx.createRadialGradient(fx, fy, 0, cx, cy, r);\n                };\n            };\n            svg.Element.radialGradient.prototype = new svg.Element.GradientBase;\n\n            // gradient stop element\n            svg.Element.stop = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.offset = this.attribute('offset').numValue();\n                if (this.offset < 0) this.offset = 0;\n                if (this.offset > 1) this.offset = 1;\n\n                var stopColor = this.style('stop-color', true);\n                if (stopColor.value === '') stopColor.value = '#000';\n                if (this.style('stop-opacity').hasValue()) stopColor = stopColor.addOpacity(this.style('stop-opacity'));\n                this.color = stopColor.value;\n            };\n            svg.Element.stop.prototype = new svg.Element.ElementBase;\n\n            // animation base element\n            svg.Element.AnimateBase = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                svg.Animations.push(this);\n\n                this.duration = 0.0;\n                this.begin = this.attribute('begin').toMilliseconds();\n                this.maxDuration = this.begin + this.attribute('dur').toMilliseconds();\n\n                this.getProperty = function () {\n                    var attributeType = this.attribute('attributeType').value;\n                    var attributeName = this.attribute('attributeName').value;\n\n                    if (attributeType == 'CSS') {\n                        return this.parent.style(attributeName, true);\n                    }\n                    return this.parent.attribute(attributeName, true);\n                };\n\n                this.initialValue = null;\n                this.initialUnits = '';\n                this.removed = false;\n\n                this.calcValue = function () {\n                    // OVERRIDE ME!\n                    return '';\n                };\n\n                this.update = function (delta) {\n                    // set initial value\n                    if (this.initialValue == null) {\n                        this.initialValue = this.getProperty().value;\n                        this.initialUnits = this.getProperty().getUnits();\n                    }\n\n                    // if we're past the end time\n                    if (this.duration > this.maxDuration) {\n                        // loop for indefinitely repeating animations\n                        if (this.attribute('repeatCount').value == 'indefinite' ||\n                            this.attribute('repeatDur').value == 'indefinite') {\n                            this.duration = 0.0;\n                        } else if (this.attribute('fill').valueOrDefault('remove') == 'freeze' && !this.frozen) {\n                            this.frozen = true;\n                            this.parent.animationFrozen = true;\n                            this.parent.animationFrozenValue = this.getProperty().value;\n                        } else if (this.attribute('fill').valueOrDefault('remove') == 'remove' && !this.removed) {\n                            this.removed = true;\n                            this.getProperty().value = this.parent.animationFrozen ? this.parent.animationFrozenValue : this.initialValue;\n                            return true;\n                        }\n                        return false;\n                    }\n                    this.duration = this.duration + delta;\n\n                    // if we're past the begin time\n                    var updated = false;\n                    if (this.begin < this.duration) {\n                        var newValue = this.calcValue(); // tween\n\n                        if (this.attribute('type').hasValue()) {\n                            // for transform, etc.\n                            var type = this.attribute('type').value;\n                            newValue = type + '(' + newValue + ')';\n                        }\n\n                        this.getProperty().value = newValue;\n                        updated = true;\n                    }\n\n                    return updated;\n                };\n\n                this.from = this.attribute('from');\n                this.to = this.attribute('to');\n                this.values = this.attribute('values');\n                if (this.values.hasValue()) this.values.value = this.values.value.split(';');\n\n                // fraction of duration we've covered\n                this.progress = function () {\n                    var ret = { progress: (this.duration - this.begin) / (this.maxDuration - this.begin) };\n                    if (this.values.hasValue()) {\n                        var p = ret.progress * (this.values.value.length - 1);\n                        var lb = Math.floor(p),\n                            ub = Math.ceil(p);\n                        ret.from = new svg.Property('from', parseFloat(this.values.value[lb]));\n                        ret.to = new svg.Property('to', parseFloat(this.values.value[ub]));\n                        ret.progress = (p - lb) / (ub - lb);\n                    } else {\n                        ret.from = this.from;\n                        ret.to = this.to;\n                    }\n                    return ret;\n                };\n            };\n            svg.Element.AnimateBase.prototype = new svg.Element.ElementBase;\n\n            // animate element\n            svg.Element.animate = function (node) {\n                this.base = svg.Element.AnimateBase;\n                this.base(node);\n\n                this.calcValue = function () {\n                    var p = this.progress();\n\n                    // tween value linearly\n                    var newValue = p.from.numValue() + (p.to.numValue() - p.from.numValue()) * p.progress;\n                    return newValue + this.initialUnits;\n                };\n            };\n            svg.Element.animate.prototype = new svg.Element.AnimateBase;\n\n            // animate color element\n            svg.Element.animateColor = function (node) {\n                this.base = svg.Element.AnimateBase;\n                this.base(node);\n\n                this.calcValue = function () {\n                    var p = this.progress();\n                    var from = new rgbcolor(p.from.value);\n                    var to = new rgbcolor(p.to.value);\n\n                    if (from.ok && to.ok) {\n                        // tween color linearly\n                        var r = from.r + (to.r - from.r) * p.progress;\n                        var g = from.g + (to.g - from.g) * p.progress;\n                        var b = from.b + (to.b - from.b) * p.progress;\n                        return 'rgb(' + parseInt(r, 10) + ',' + parseInt(g, 10) + ',' + parseInt(b, 10) + ')';\n                    }\n                    return this.attribute('from').value;\n                };\n            };\n            svg.Element.animateColor.prototype = new svg.Element.AnimateBase;\n\n            // animate transform element\n            svg.Element.animateTransform = function (node) {\n                this.base = svg.Element.AnimateBase;\n                this.base(node);\n\n                this.calcValue = function () {\n                    var p = this.progress();\n\n                    // tween value linearly\n                    var from = svg.ToNumberArray(p.from.value);\n                    var to = svg.ToNumberArray(p.to.value);\n                    var newValue = '';\n                    for (var i = 0; i < from.length; i++) {\n                        newValue += from[i] + (to[i] - from[i]) * p.progress + ' ';\n                    }\n                    return newValue;\n                };\n            };\n            svg.Element.animateTransform.prototype = new svg.Element.animate;\n\n            // font element\n            svg.Element.font = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.horizAdvX = this.attribute('horiz-adv-x').numValue();\n\n                this.isRTL = false;\n                this.isArabic = false;\n                this.fontFace = null;\n                this.missingGlyph = null;\n                this.glyphs = [];\n                for (var i = 0; i < this.children.length; i++) {\n                    var child = this.children[i];\n                    if (child.type == 'font-face') {\n                        this.fontFace = child;\n                        if (child.style('font-family').hasValue()) {\n                            svg.Definitions[child.style('font-family').value] = this;\n                        }\n                    } else if (child.type == 'missing-glyph') this.missingGlyph = child;\n                    else if (child.type == 'glyph') {\n                        if (child.arabicForm != '') {\n                            this.isRTL = true;\n                            this.isArabic = true;\n                            if (typeof this.glyphs[child.unicode] == 'undefined') this.glyphs[child.unicode] = [];\n                            this.glyphs[child.unicode][child.arabicForm] = child;\n                        } else {\n                            this.glyphs[child.unicode] = child;\n                        }\n                    }\n                }\n\n                this.render = function(/* ctx */) {\n                    // NO RENDER\n                };\n            };\n            svg.Element.font.prototype = new svg.Element.ElementBase;\n\n            // font-face element\n            svg.Element.fontface = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.ascent = this.attribute('ascent').value;\n                this.descent = this.attribute('descent').value;\n                this.unitsPerEm = this.attribute('units-per-em').numValue();\n            };\n            svg.Element.fontface.prototype = new svg.Element.ElementBase;\n\n            // missing-glyph element\n            svg.Element.missingglyph = function (node) {\n                this.base = svg.Element.path;\n                this.base(node);\n\n                this.horizAdvX = 0;\n            };\n            svg.Element.missingglyph.prototype = new svg.Element.path;\n\n            // glyph element\n            svg.Element.glyph = function (node) {\n                this.base = svg.Element.path;\n                this.base(node);\n\n                this.horizAdvX = this.attribute('horiz-adv-x').numValue();\n                this.unicode = this.attribute('unicode').value;\n                this.arabicForm = this.attribute('arabic-form').value;\n            };\n            svg.Element.glyph.prototype = new svg.Element.path;\n\n            // text element\n            svg.Element.text = function (node) {\n                this.captureTextNodes = true;\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.baseSetContext = this.setContext;\n                this.setContext = function (ctx) {\n                    this.baseSetContext(ctx);\n\n                    var textBaseline = this.style('dominant-baseline').toTextBaseline();\n                    if (textBaseline == null) textBaseline = this.style('alignment-baseline').toTextBaseline();\n                    if (textBaseline != null) ctx.textBaseline = textBaseline;\n                };\n\n                this.initializeCoordinates = function (ctx) {\n                    this.x = this.attribute('x').toPixels('x');\n                    this.y = this.attribute('y').toPixels('y');\n                    if (this.attribute('dx').hasValue()) this.x += this.attribute('dx').toPixels('x');\n                    if (this.attribute('dy').hasValue()) this.y += this.attribute('dy').toPixels('y');\n                    this.x += this.getAnchorDelta(ctx, this, 0);\n                };\n\n                this.getBoundingBox = function (ctx) {\n                    this.initializeCoordinates(ctx);\n                    var bb = null;\n                    for (var i = 0; i < this.children.length; i++) {\n                        var childBB = this.getChildBoundingBox(ctx, this, this, i);\n                        if (bb == null) bb = childBB;\n                        else bb.addBoundingBox(childBB);\n                    }\n                    return bb;\n                };\n\n                this.renderChildren = function (ctx) {\n                    this.initializeCoordinates(ctx);\n                    for (var i = 0; i < this.children.length; i++) {\n                        this.renderChild(ctx, this, this, i);\n                    }\n                };\n\n                this.getAnchorDelta = function (ctx, parent, startI) {\n                    var textAnchor = this.style('text-anchor').valueOrDefault('start');\n                    if (textAnchor != 'start') {\n                        var width = 0;\n                        for (var i = startI; i < parent.children.length; i++) {\n                            var child = parent.children[i];\n                            if (i > startI && child.attribute('x').hasValue()) break; // new group\n                            width += child.measureTextRecursive(ctx);\n                        }\n                        return -1 * (textAnchor == 'end' ? width : width / 2.0);\n                    }\n                    return 0;\n                };\n\n                this.adjustChildCoordinates = function(ctx, textParent, parent, i) {\n                    var child = parent.children[i];\n\n                    if (child.attribute('x').hasValue()) {\n                        child.x = child.attribute('x').toPixels('x') + textParent.getAnchorDelta(ctx, parent, i);\n                        if (child.attribute('dx').hasValue()) child.x += child.attribute('dx').toPixels('x');\n                    } else {\n                        if (child.attribute('dx').hasValue()) textParent.x += child.attribute('dx').toPixels('x');\n                        child.x = textParent.x;\n                    }\n                    textParent.x = child.x + child.measureText(ctx);\n\n                    if (child.attribute('y').hasValue()) {\n                        child.y = child.attribute('y').toPixels('y');\n                        if (child.attribute('dy').hasValue()) child.y += child.attribute('dy').toPixels('y');\n                    } else {\n                        if (child.attribute('dy').hasValue()) textParent.y += child.attribute('dy').toPixels('y');\n                        child.y = textParent.y;\n                    }\n                    textParent.y = child.y;\n\n                    return child;\n                };\n\n                this.getChildBoundingBox = function (ctx, textParent, parent, i) {\n                    var child = this.adjustChildCoordinates(ctx, textParent, parent, i);\n                    var bb = child.getBoundingBox(ctx);\n\n                    for (var i = 0; i < child.children.length; i++) {\n                        var childBB = textParent.getChildBoundingBox(ctx, textParent, child, i);\n                        bb.addBoundingBox(childBB);\n                    }\n\n                    return bb;\n                };\n\n                this.renderChild = function (ctx, textParent, parent, i) {\n                    var child = this.adjustChildCoordinates(ctx, textParent, parent, i);\n                    child.render(ctx);\n\n                    for (var i = 0; i < child.children.length; i++) {\n                        textParent.renderChild(ctx, textParent, child, i);\n                    }\n                };\n            };\n            svg.Element.text.prototype = new svg.Element.RenderedElementBase;\n\n            // text base\n            svg.Element.TextElementBase = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.getGlyph = function (font, text, i) {\n                    var c = text[i];\n                    var glyph = null;\n                    if (font.isArabic) {\n                        var arabicForm = 'isolated';\n                        if ((i == 0 || text[i - 1] == ' ') && i < text.length - 2 && text[i + 1] != ' ') arabicForm = 'terminal';\n                        if (i > 0 && text[i - 1] != ' ' && i < text.length - 2 && text[i + 1] != ' ') arabicForm = 'medial';\n                        if (i > 0 && text[i - 1] != ' ' && (i == text.length - 1 || text[i + 1] == ' ')) arabicForm = 'initial';\n                        if (typeof font.glyphs[c] != 'undefined') {\n                            glyph = font.glyphs[c][arabicForm];\n                            if (glyph == null && font.glyphs[c].type == 'glyph') glyph = font.glyphs[c];\n                        }\n                    } else {\n                        glyph = font.glyphs[c];\n                    }\n                    if (glyph == null) glyph = font.missingGlyph;\n                    return glyph;\n                };\n\n                this.renderChildren = function (ctx) {\n                    var customFont = this.parent.style('font-family').getDefinition();\n                    if (customFont != null) {\n                        var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\n                        var fontStyle = this.parent.style('font-style').valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);\n                        var text = this.getText();\n                        if (customFont.isRTL) text = text.split('').reverse().join('');\n\n                        var dx = svg.ToNumberArray(this.parent.attribute('dx').value);\n                        for (var i = 0; i < text.length; i++) {\n                            var glyph = this.getGlyph(customFont, text, i);\n                            var scale = fontSize / customFont.fontFace.unitsPerEm;\n                            ctx.translate(this.x, this.y);\n                            ctx.scale(scale, -scale);\n                            var lw = ctx.lineWidth;\n                            ctx.lineWidth = ctx.lineWidth * customFont.fontFace.unitsPerEm / fontSize;\n                            if (fontStyle == 'italic') ctx.transform(1, 0, .4, 1, 0, 0);\n                            glyph.render(ctx);\n                            if (fontStyle == 'italic') ctx.transform(1, 0, -.4, 1, 0, 0);\n                            ctx.lineWidth = lw;\n                            ctx.scale(1 / scale, -1 / scale);\n                            ctx.translate(-this.x, -this.y);\n\n                            this.x += fontSize * (glyph.horizAdvX || customFont.horizAdvX) / customFont.fontFace.unitsPerEm;\n                            if (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\n                                this.x += dx[i];\n                            }\n                        }\n                        return;\n                    }\n                    if (ctx.paintOrder == 'stroke') {\n                        if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\n                        if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\n                    } else {\n                        if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\n                        if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\n                    }\n                };\n\n                this.getText = function () {\n                    // OVERRIDE ME\n                };\n\n                this.measureTextRecursive = function (ctx) {\n                    var width = this.measureText(ctx);\n                    for (var i = 0; i < this.children.length; i++) {\n                        width += this.children[i].measureTextRecursive(ctx);\n                    }\n                    return width;\n                };\n\n                this.measureText = function (ctx) {\n                    var customFont = this.parent.style('font-family').getDefinition();\n                    if (customFont != null) {\n                        var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\n                        var measure = 0;\n                        var text = this.getText();\n                        if (customFont.isRTL) text = text.split('').reverse().join('');\n                        var dx = svg.ToNumberArray(this.parent.attribute('dx').value);\n                        for (var i = 0; i < text.length; i++) {\n                            var glyph = this.getGlyph(customFont, text, i);\n                            measure += (glyph.horizAdvX || customFont.horizAdvX) * fontSize / customFont.fontFace.unitsPerEm;\n                            if (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\n                                measure += dx[i];\n                            }\n                        }\n                        return measure;\n                    }\n\n                    var textToMeasure = svg.compressSpaces(this.getText());\n                    if (!ctx.measureText) return textToMeasure.length * 10;\n\n                    ctx.save();\n                    this.setContext(ctx, true);\n                    var width = ctx.measureText(textToMeasure).width;\n                    ctx.restore();\n                    return width;\n                };\n\n                this.getBoundingBox = function (ctx) {\n                    var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\n                    return new svg.BoundingBox(this.x, this.y - fontSize, this.x + this.measureText(ctx), this.y);\n                };\n            };\n            svg.Element.TextElementBase.prototype = new svg.Element.RenderedElementBase;\n\n            // tspan\n            svg.Element.tspan = function (node) {\n                this.captureTextNodes = true;\n                this.base = svg.Element.TextElementBase;\n                this.base(node);\n\n                this.text = svg.compressSpaces(node.value || node.text || node.textContent || '');\n                this.getText = function () {\n                    // if this node has children, then they own the text\n                    if (this.children.length > 0) { return ''; }\n                    return this.text;\n                };\n            };\n            svg.Element.tspan.prototype = new svg.Element.TextElementBase;\n\n            // tref\n            svg.Element.tref = function (node) {\n                this.base = svg.Element.TextElementBase;\n                this.base(node);\n\n                this.getText = function () {\n                    var element = this.getHrefAttribute().getDefinition();\n                    if (element != null) return element.children[0].getText();\n                };\n            };\n            svg.Element.tref.prototype = new svg.Element.TextElementBase;\n\n            // a element\n            svg.Element.a = function (node) {\n                this.base = svg.Element.TextElementBase;\n                this.base(node);\n\n                this.hasText = node.childNodes.length > 0;\n                for (var i = 0; i < node.childNodes.length; i++) {\n                    if (node.childNodes[i].nodeType != 3) this.hasText = false;\n                }\n\n                // this might contain text\n                this.text = this.hasText ? node.childNodes[0].value || node.childNodes[0].data : '';\n                this.getText = function () {\n                    return this.text;\n                };\n\n                this.baseRenderChildren = this.renderChildren;\n                this.renderChildren = function (ctx) {\n                    if (this.hasText) {\n                        // render as text element\n                        this.baseRenderChildren(ctx);\n                        var fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\n                        svg.Mouse.checkBoundingBox(this, new svg.BoundingBox(this.x, this.y - fontSize.toPixels('y'), this.x + this.measureText(ctx), this.y));\n                    } else if (this.children.length > 0) {\n                        // render as temporary group\n                        var g = new svg.Element.g();\n                        g.children = this.children;\n                        g.parent = this;\n                        g.render(ctx);\n                    }\n                };\n\n                this.onclick = function () {\n                    windowEnv.open(this.getHrefAttribute().value);\n                };\n\n                this.onmousemove = function () {\n                    svg.ctx.canvas.style.cursor = 'pointer';\n                };\n            };\n            svg.Element.a.prototype = new svg.Element.TextElementBase;\n\n            // image element\n            svg.Element.image = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                var href = this.getHrefAttribute().value;\n                if (href == '') { return; }\n                var isSvg = href.match(/\\.svg$/);\n\n                svg.Images.push(this);\n                this.loaded = false;\n                if (!isSvg) {\n                    this.img = doc.createElement('img');\n                    if (svg.opts['useCORS'] == true) { this.img.crossOrigin = 'Anonymous'; }\n                    var self = this;\n                    this.img.onload = function () { self.loaded = true; };\n                    this.img.onerror = function () {\n                        svg.log('ERROR: image \"' + href + '\" not found');\n                        self.loaded = true;\n                    };\n                    this.img.src = href;\n                } else {\n                    this.img = svg.ajax(href);\n                    this.loaded = true;\n                }\n\n                this.renderChildren = function (ctx) {\n                    var x = this.attribute('x').toPixels('x');\n                    var y = this.attribute('y').toPixels('y');\n\n                    var width = this.attribute('width').toPixels('x');\n                    var height = this.attribute('height').toPixels('y');\n                    if (width == 0 || height == 0) return;\n\n                    ctx.save();\n                    if (isSvg) {\n                        ctx.drawSvg(this.img, x, y, width, height);\n                    } else {\n                        ctx.translate(x, y);\n                        svg.AspectRatio(ctx,\n                            this.attribute('preserveAspectRatio').value,\n                            width,\n                            this.img.width,\n                            height,\n                            this.img.height,\n                            0,\n                            0);\n                        if (self.loaded) {\n                            if (this.img.complete === undefined || this.img.complete) {\n                                ctx.drawImage(this.img, 0, 0);\n                            }\n                        }\n                    }\n                    ctx.restore();\n                };\n\n                this.getBoundingBox = function () {\n                    var x = this.attribute('x').toPixels('x');\n                    var y = this.attribute('y').toPixels('y');\n                    var width = this.attribute('width').toPixels('x');\n                    var height = this.attribute('height').toPixels('y');\n                    return new svg.BoundingBox(x, y, x + width, y + height);\n                };\n            };\n            svg.Element.image.prototype = new svg.Element.RenderedElementBase;\n\n            // group element\n            svg.Element.g = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.getBoundingBox = function (ctx) {\n                    var bb = new svg.BoundingBox();\n                    for (var i = 0; i < this.children.length; i++) {\n                        bb.addBoundingBox(this.children[i].getBoundingBox(ctx));\n                    }\n                    return bb;\n                };\n            };\n            svg.Element.g.prototype = new svg.Element.RenderedElementBase;\n\n            // symbol element\n            svg.Element.symbol = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.render = function (/* ctx */) {\n                    // NO RENDER\n                };\n            };\n            svg.Element.symbol.prototype = new svg.Element.RenderedElementBase;\n\n            // style element\n            svg.Element.style = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                // text, or spaces then CDATA\n                var css = '';\n                for (var i = 0; i < node.childNodes.length; i++) {\n                    css += node.childNodes[i].data;\n                }\n                css = css.replace(/(\\/\\*([^*]|[\\r\\n]|(\\*+([^*\\/]|[\\r\\n])))*\\*+\\/)|(^[\\s]*\\/\\/.*)/gm, ''); // remove comments\n                css = svg.compressSpaces(css); // replace whitespace\n                var cssDefs = css.split('}');\n                for (var i = 0; i < cssDefs.length; i++) {\n                    if (svg.trim(cssDefs[i]) != '') {\n                        var cssDef = cssDefs[i].split('{');\n                        var cssClasses = cssDef[0].split(',');\n                        var cssProps = cssDef[1].split(';');\n                        for (var j = 0; j < cssClasses.length; j++) {\n                            var cssClass = svg.trim(cssClasses[j]);\n                            if (cssClass != '') {\n                                var props = svg.Styles[cssClass] || {};\n                                for (var k = 0; k < cssProps.length; k++) {\n                                    var prop = cssProps[k].indexOf(':');\n                                    var name = cssProps[k].substr(0, prop);\n                                    var value = cssProps[k].substr(prop + 1, cssProps[k].length - prop);\n                                    if (name != null && value != null) {\n                                        props[svg.trim(name)] = new svg.Property(svg.trim(name), svg.trim(value));\n                                    }\n                                }\n                                svg.Styles[cssClass] = props;\n                                svg.StylesSpecificity[cssClass] = getSelectorSpecificity(cssClass);\n                                if (cssClass == '@font-face' && !nodeEnv) {\n                                    var fontFamily = props['font-family'].value.replace(/\"/g, '');\n                                    var srcs = props['src'].value.split(',');\n                                    for (var s = 0; s < srcs.length; s++) {\n                                        if (srcs[s].indexOf('format(\"svg\")') > 0) {\n                                            var urlStart = srcs[s].indexOf('url');\n                                            var urlEnd = srcs[s].indexOf(')', urlStart);\n                                            var url = srcs[s].substr(urlStart + 5, urlEnd - urlStart - 6);\n                                            var doc = svg.parseXml(svg.ajax(url));\n                                            var fonts = doc.getElementsByTagName('font');\n                                            for (var f = 0; f < fonts.length; f++) {\n                                                var font = svg.CreateElement(fonts[f]);\n                                                svg.Definitions[fontFamily] = font;\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            };\n            svg.Element.style.prototype = new svg.Element.ElementBase;\n\n            // use element\n            svg.Element.use = function (node) {\n                this.base = svg.Element.RenderedElementBase;\n                this.base(node);\n\n                this.baseSetContext = this.setContext;\n                this.setContext = function (ctx) {\n                    this.baseSetContext(ctx);\n                    if (this.attribute('x').hasValue()) ctx.translate(this.attribute('x').toPixels('x'), 0);\n                    if (this.attribute('y').hasValue()) ctx.translate(0, this.attribute('y').toPixels('y'));\n                };\n\n                var element = this.getHrefAttribute().getDefinition();\n\n                this.path = function (ctx) {\n                    if (element != null) element.path(ctx);\n                };\n\n                this.elementTransform = function () {\n                    if (element != null && element.style('transform', false, true).hasValue()) {\n                        return new svg.Transform(element.style('transform', false, true).value);\n                    }\n                };\n\n                this.getBoundingBox = function (ctx) {\n                    if (element != null) return element.getBoundingBox(ctx);\n                };\n\n                this.renderChildren = function (ctx) {\n                    if (element != null) {\n                        var tempSvg = element;\n                        if (element.type == 'symbol') {\n                            // render me using a temporary svg element in symbol cases (http://www.w3.org/TR/SVG/struct.html#UseElement)\n                            tempSvg = new svg.Element.svg();\n                            tempSvg.type = 'svg';\n                            tempSvg.attributes['viewBox'] = new svg.Property('viewBox', element.attribute('viewBox').value);\n                            tempSvg.attributes['preserveAspectRatio'] = new svg.Property('preserveAspectRatio', element.attribute('preserveAspectRatio').value);\n                            tempSvg.attributes['overflow'] = new svg.Property('overflow', element.attribute('overflow').value);\n                            tempSvg.children = element.children;\n                        }\n                        if (tempSvg.type == 'svg') {\n                            // if symbol or svg, inherit width/height from me\n                            if (this.attribute('width').hasValue()) tempSvg.attributes['width'] = new svg.Property('width', this.attribute('width').value);\n                            if (this.attribute('height').hasValue()) tempSvg.attributes['height'] = new svg.Property('height', this.attribute('height').value);\n                        }\n                        var oldParent = tempSvg.parent;\n                        tempSvg.parent = null;\n                        tempSvg.render(ctx);\n                        tempSvg.parent = oldParent;\n                    }\n                };\n            };\n            svg.Element.use.prototype = new svg.Element.RenderedElementBase;\n\n            // mask element\n            svg.Element.mask = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.apply = function (ctx, element) {\n                    // render as temp svg\n                    var x = this.attribute('x').toPixels('x');\n                    var y = this.attribute('y').toPixels('y');\n                    var width = this.attribute('width').toPixels('x');\n                    var height = this.attribute('height').toPixels('y');\n\n                    if (width == 0 && height == 0) {\n                        var bb = new svg.BoundingBox();\n                        for (var i = 0; i < this.children.length; i++) {\n                            bb.addBoundingBox(this.children[i].getBoundingBox(ctx));\n                        }\n                        var x = Math.floor(bb.x1);\n                        var y = Math.floor(bb.y1);\n                        var width = Math.floor(bb.width());\n                        var height = Math.floor(bb.height());\n                    }\n\n                    // temporarily remove mask to avoid recursion\n                    var mask = element.style('mask').value;\n                    element.style('mask').value = '';\n\n                    var cMask = createCanvas(x + width, y + height);\n                    var maskCtx = cMask.getContext('2d');\n                    this.renderChildren(maskCtx);\n\n                    var c = createCanvas(x + width, y + height);\n                    var tempCtx = c.getContext('2d');\n                    element.render(tempCtx);\n                    tempCtx.globalCompositeOperation = 'destination-in';\n                    tempCtx.fillStyle = maskCtx.createPattern(cMask, 'no-repeat');\n                    tempCtx.fillRect(0, 0, x + width, y + height);\n\n                    ctx.fillStyle = tempCtx.createPattern(c, 'no-repeat');\n                    ctx.fillRect(0, 0, x + width, y + height);\n\n                    // reassign mask\n                    element.style('mask').value = mask;\n                };\n\n                this.render = function (/* ctx */) {\n                    // NO RENDER\n                };\n            };\n            svg.Element.mask.prototype = new svg.Element.ElementBase;\n\n            // clip element\n            svg.Element.clipPath = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.apply = function (ctx) {\n                    var hasContext2D = (typeof CanvasRenderingContext2D !== 'undefined');\n                    var oldBeginPath = ctx.beginPath;\n                    var oldClosePath = ctx.closePath;\n                    if (hasContext2D) {\n                        CanvasRenderingContext2D.prototype.beginPath = function () { };\n                        CanvasRenderingContext2D.prototype.closePath = function () { };\n                    }\n\n                    oldBeginPath.call(ctx);\n                    for (var i = 0; i < this.children.length; i++) {\n                        var child = this.children[i];\n                        if (typeof child.path != 'undefined') {\n                            var transform = typeof child.elementTransform != 'undefined' && child.elementTransform(); // handle <use />\n                            if (!transform && child.style('transform', false, true).hasValue()) {\n                                transform = new svg.Transform(child.style('transform', false, true).value);\n                            }\n                            if (transform) {\n                                transform.apply(ctx);\n                            }\n                            child.path(ctx);\n                            if (hasContext2D) {\n                                CanvasRenderingContext2D.prototype.closePath = oldClosePath;\n                            }\n                            if (transform) { transform.unapply(ctx); }\n                        }\n                    }\n                    oldClosePath.call(ctx);\n                    ctx.clip();\n                    if (hasContext2D) {\n                        CanvasRenderingContext2D.prototype.beginPath = oldBeginPath;\n                        CanvasRenderingContext2D.prototype.closePath = oldClosePath;\n                    }\n                };\n\n                this.render = function (/* ctx */) {\n                    // NO RENDER\n                };\n            };\n            svg.Element.clipPath.prototype = new svg.Element.ElementBase;\n\n            // filters\n            svg.Element.filter = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.apply = function (ctx, element) {\n                    // render as temp svg\n                    var bb = element.getBoundingBox(ctx);\n                    var x = Math.floor(bb.x1);\n                    var y = Math.floor(bb.y1);\n                    var width = Math.floor(bb.width());\n                    var height = Math.floor(bb.height());\n\n                    // temporarily remove filter to avoid recursion\n                    var filter = element.style('filter').value;\n                    element.style('filter').value = '';\n\n                    var px = 0,\n                        py = 0;\n                    for (var i = 0; i < this.children.length; i++) {\n                        var efd = this.children[i].extraFilterDistance || 0;\n                        px = Math.max(px, efd);\n                        py = Math.max(py, efd);\n                    }\n\n                    var c = createCanvas(width + 2 * px, height + 2 * py);\n                    var tempCtx = c.getContext('2d');\n                    tempCtx.translate(-x + px, -y + py);\n                    element.render(tempCtx);\n\n                    // apply filters\n                    for (var i = 0; i < this.children.length; i++) {\n                        if (typeof this.children[i].apply == 'function') {\n                            this.children[i].apply(tempCtx, 0, 0, width + 2 * px, height + 2 * py);\n                        }\n                    }\n\n                    // render on me\n                    ctx.drawImage(c, 0, 0, width + 2 * px, height + 2 * py, x - px, y - py, width + 2 * px, height + 2 * py);\n\n                    // reassign filter\n                    element.style('filter', true).value = filter;\n                };\n\n                this.render = function (/* ctx */) {\n                    // NO RENDER\n                };\n            };\n            svg.Element.filter.prototype = new svg.Element.ElementBase;\n\n            svg.Element.feDropShadow = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n                this.addStylesFromStyleDefinition();\n\n                this.apply = function (/* ctx, x, y, width, height */) {\n                    // TODO: implement\n                };\n            };\n            svg.Element.feDropShadow.prototype = new svg.Element.ElementBase;\n\n            svg.Element.feMorphology = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.apply = function (/* ctx, x, y, width, height */) {\n                    // TODO: implement\n                };\n            };\n            svg.Element.feMorphology.prototype = new svg.Element.ElementBase;\n\n            svg.Element.feComposite = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.apply = function (/* ctx, x, y, width, height */) {\n                    // TODO: implement\n                };\n            };\n            svg.Element.feComposite.prototype = new svg.Element.ElementBase;\n\n            svg.Element.feColorMatrix = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                var matrix = svg.ToNumberArray(this.attribute('values').value);\n                switch (this.attribute('type').valueOrDefault('matrix')) { // http://www.w3.org/TR/SVG/filters.html#feColorMatrixElement\n                    case 'saturate':\n                        var s = matrix[0];\n                        matrix = [0.213 + 0.787 * s, 0.715 - 0.715 * s, 0.072 - 0.072 * s, 0, 0,\n                            0.213 - 0.213 * s, 0.715 + 0.285 * s, 0.072 - 0.072 * s, 0, 0,\n                            0.213 - 0.213 * s, 0.715 - 0.715 * s, 0.072 + 0.928 * s, 0, 0,\n                            0, 0, 0, 1, 0,\n                            0, 0, 0, 0, 1\n                        ];\n                        break;\n                    case 'hueRotate':\n                        var a = matrix[0] * Math.PI / 180.0;\n                        var c = function (m1, m2, m3) { return m1 + Math.cos(a) * m2 + Math.sin(a) * m3; };\n                        matrix = [c(0.213, 0.787, -0.213), c(0.715, -0.715, -0.715), c(0.072, -0.072, 0.928), 0, 0,\n                            c(0.213, -0.213, 0.143), c(0.715, 0.285, 0.140), c(0.072, -0.072, -0.283), 0, 0,\n                            c(0.213, -0.213, -0.787), c(0.715, -0.715, 0.715), c(0.072, 0.928, 0.072), 0, 0,\n                            0, 0, 0, 1, 0,\n                            0, 0, 0, 0, 1\n                        ];\n                        break;\n                    case 'luminanceToAlpha':\n                        matrix = [0, 0, 0, 0, 0,\n                            0, 0, 0, 0, 0,\n                            0, 0, 0, 0, 0,\n                            0.2125, 0.7154, 0.0721, 0, 0,\n                            0, 0, 0, 0, 1\n                        ];\n                        break;\n                }\n\n                function imGet(img, x, y, width, height, rgba) {\n                    return img[y * width * 4 + x * 4 + rgba];\n                }\n\n                function imSet(img, x, y, width, height, rgba, val) {\n                    img[y * width * 4 + x * 4 + rgba] = val;\n                }\n\n                function m(i, v) {\n                    var mi = matrix[i];\n                    return mi * (mi < 0 ? v - 255 : v);\n                }\n\n                this.apply = function (ctx, x, y, width, height) {\n                    // assuming x==0 && y==0 for now\n                    var srcData = ctx.getImageData(0, 0, width, height);\n                    for (var y = 0; y < height; y++) {\n                        for (var x = 0; x < width; x++) {\n                            var r = imGet(srcData.data, x, y, width, height, 0);\n                            var g = imGet(srcData.data, x, y, width, height, 1);\n                            var b = imGet(srcData.data, x, y, width, height, 2);\n                            var a = imGet(srcData.data, x, y, width, height, 3);\n                            imSet(srcData.data, x, y, width, height, 0, m(0, r) + m(1, g) + m(2, b) + m(3, a) + m(4, 1));\n                            imSet(srcData.data, x, y, width, height, 1, m(5, r) + m(6, g) + m(7, b) + m(8, a) + m(9, 1));\n                            imSet(srcData.data, x, y, width, height, 2, m(10, r) + m(11, g) + m(12, b) + m(13, a) + m(14, 1));\n                            imSet(srcData.data, x, y, width, height, 3, m(15, r) + m(16, g) + m(17, b) + m(18, a) + m(19, 1));\n                        }\n                    }\n                    ctx.clearRect(0, 0, width, height);\n                    ctx.putImageData(srcData, 0, 0);\n                };\n            };\n            svg.Element.feColorMatrix.prototype = new svg.Element.ElementBase;\n\n            svg.Element.feGaussianBlur = function (node) {\n                this.base = svg.Element.ElementBase;\n                this.base(node);\n\n                this.blurRadius = Math.floor(this.attribute('stdDeviation').numValue());\n                this.extraFilterDistance = this.blurRadius;\n\n                this.apply = function (ctx, x, y, width, height) {\n                    if (!stackblurCanvas || typeof stackblurCanvas.canvasRGBA === 'undefined') {\n                        svg.log('ERROR: StackBlur.js must be included for blur to work');\n                        return;\n                    }\n\n                    // StackBlur requires canvas be on document\n                    ctx.canvas.id = svg.UniqueId();\n                    {\n                        ctx.canvas.style.display = 'none';\n                        doc.body.appendChild(ctx.canvas);\n                    }\n                    stackblurCanvas.canvasRGBA(ctx.canvas, x, y, width, height, this.blurRadius);\n                    {\n                        doc.body.removeChild(ctx.canvas);\n                    }\n                };\n            };\n            svg.Element.feGaussianBlur.prototype = new svg.Element.ElementBase;\n\n            // title element, do nothing\n            svg.Element.title = function (/* node */) { };\n            svg.Element.title.prototype = new svg.Element.ElementBase;\n\n            // desc element, do nothing\n            svg.Element.desc = function (/* node */) { };\n            svg.Element.desc.prototype = new svg.Element.ElementBase;\n\n            svg.Element.MISSING = function (node) {\n                svg.log('ERROR: Element \\'' + node.nodeName + '\\' not yet implemented.');\n            };\n            svg.Element.MISSING.prototype = new svg.Element.ElementBase;\n\n            // element factory\n            svg.CreateElement = function (node) {\n                var className = node.nodeName.replace(/^[^:]+:/, ''); // remove namespace\n                className = className.replace(/\\-/g, ''); // remove dashes\n                var e = null;\n                if (typeof svg.Element[className] != 'undefined') {\n                    e = new svg.Element[className](node);\n                } else {\n                    e = new svg.Element.MISSING(node);\n                }\n\n                e.type = node.nodeName;\n                return e;\n            };\n\n            // load from url\n            svg.load = function (ctx, url) {\n                svg.loadXml(ctx, svg.ajax(url));\n            };\n\n            // load from xml\n            svg.loadXml = function (ctx, xml) {\n                svg.loadXmlDoc(ctx, svg.parseXml(xml));\n            };\n\n            svg.loadXmlDoc = function (ctx, dom) {\n                svg.init(ctx);\n\n                var mapXY = function (p) {\n                    var e = ctx.canvas;\n                    while (e) {\n                        p.x -= e.offsetLeft;\n                        p.y -= e.offsetTop;\n                        e = e.offsetParent;\n                    }\n                    if (windowEnv.scrollX) p.x += windowEnv.scrollX;\n                    if (windowEnv.scrollY) p.y += windowEnv.scrollY;\n                    return p;\n                };\n\n                // bind mouse\n                if (svg.opts['ignoreMouse'] != true) {\n                    ctx.canvas.onclick = function (e) {\n                        var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\n                        svg.Mouse.onclick(p.x, p.y);\n                    };\n                    ctx.canvas.onmousemove = function (e) {\n                        var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\n                        svg.Mouse.onmousemove(p.x, p.y);\n                    };\n                }\n\n                var e = svg.CreateElement(dom.documentElement);\n                e.root = true;\n                e.addStylesFromStyleDefinition();\n\n                // render loop\n                var isFirstRender = true;\n                var draw = function () {\n                    svg.ViewPort.Clear();\n                    if (ctx.canvas.parentNode) {\n                        svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth, ctx.canvas.parentNode.clientHeight);\n                    } else {\n                        svg.ViewPort.SetCurrent(defaultClientWidth, defaultClientHeight);\n                    }\n\n                    if (svg.opts['ignoreDimensions'] != true) {\n                        // set canvas size\n                        if (e.style('width').hasValue()) {\n                            ctx.canvas.width = e.style('width').toPixels('x');\n                            if (ctx.canvas.style) { ctx.canvas.style.width = ctx.canvas.width + 'px'; }\n                        }\n                        if (e.style('height').hasValue()) {\n                            ctx.canvas.height = e.style('height').toPixels('y');\n                            if (ctx.canvas.style) { ctx.canvas.style.height = ctx.canvas.height + 'px'; }\n                        }\n                    }\n                    var cWidth = ctx.canvas.clientWidth || ctx.canvas.width;\n                    var cHeight = ctx.canvas.clientHeight || ctx.canvas.height;\n                    if (svg.opts['ignoreDimensions'] == true && e.style('width').hasValue() && e.style('height').hasValue()) {\n                        cWidth = e.style('width').toPixels('x');\n                        cHeight = e.style('height').toPixels('y');\n                    }\n                    svg.ViewPort.SetCurrent(cWidth, cHeight);\n\n                    if (svg.opts['offsetX'] != null) e.attribute('x', true).value = svg.opts['offsetX'];\n                    if (svg.opts['offsetY'] != null) e.attribute('y', true).value = svg.opts['offsetY'];\n                    if (svg.opts['scaleWidth'] != null || svg.opts['scaleHeight'] != null) {\n                        var xRatio = null,\n                            yRatio = null,\n                            viewBox = svg.ToNumberArray(e.attribute('viewBox').value);\n\n                        if (svg.opts['scaleWidth'] != null) {\n                            if (e.attribute('width').hasValue()) xRatio = e.attribute('width').toPixels('x') / svg.opts['scaleWidth'];\n                            else if (!isNaN(viewBox[2])) xRatio = viewBox[2] / svg.opts['scaleWidth'];\n                        }\n\n                        if (svg.opts['scaleHeight'] != null) {\n                            if (e.attribute('height').hasValue()) yRatio = e.attribute('height').toPixels('y') / svg.opts['scaleHeight'];\n                            else if (!isNaN(viewBox[3])) yRatio = viewBox[3] / svg.opts['scaleHeight'];\n                        }\n\n                        if (xRatio == null) { xRatio = yRatio; }\n                        if (yRatio == null) { yRatio = xRatio; }\n\n                        e.attribute('width', true).value = svg.opts['scaleWidth'];\n                        e.attribute('height', true).value = svg.opts['scaleHeight'];\n                        e.style('transform', true, true).value += ' scale(' + (1.0 / xRatio) + ',' + (1.0 / yRatio) + ')';\n                    }\n\n                    // clear and render\n                    if (svg.opts['ignoreClear'] != true) {\n                        ctx.clearRect(0, 0, cWidth, cHeight);\n                    }\n                    e.render(ctx);\n                    if (isFirstRender) {\n                        isFirstRender = false;\n                        if (typeof svg.opts['renderCallback'] == 'function') svg.opts['renderCallback'](dom);\n                    }\n                };\n\n                var waitingForImages = true;\n                if (svg.ImagesLoaded()) {\n                    waitingForImages = false;\n                    draw();\n                }\n                {\n                    //In node, in the most cases, we don't need the animation listener.\n                    svg.intervalID = setInterval(function () {\n                        var needUpdate = false;\n\n                        if (waitingForImages && svg.ImagesLoaded()) {\n                            waitingForImages = false;\n                            needUpdate = true;\n                        }\n\n                        // need update from mouse events?\n                        if (svg.opts['ignoreMouse'] != true) {\n                            needUpdate = needUpdate || svg.Mouse.hasEvents();\n                        }\n\n                        // need update from animations?\n                        if (svg.opts['ignoreAnimation'] != true) {\n                            for (var i = 0; i < svg.Animations.length; i++) {\n                                var needAnimationUpdate = svg.Animations[i].update(1000 / svg.FRAMERATE);\n                                needUpdate = needUpdate || needAnimationUpdate;\n                            }\n                        }\n\n                        // need update from redraw?\n                        if (typeof svg.opts['forceRedraw'] == 'function') {\n                            if (svg.opts['forceRedraw']() == true) needUpdate = true;\n                        }\n\n                        // render if needed\n                        if (needUpdate) {\n                            draw();\n                            svg.Mouse.runEvents(); // run and clear our events\n                        }\n                    }, 1000 / svg.FRAMERATE);\n                }\n            };\n\n            svg.stop = function () {\n                if (svg.intervalID) {\n                    clearInterval(svg.intervalID);\n                }\n            };\n\n            svg.Mouse = new (function () {\n                this.events = [];\n                this.hasEvents = function () { return this.events.length != 0; };\n\n                this.onclick = function (x, y) {\n                    this.events.push({\n                        type: 'onclick',\n                        x: x,\n                        y: y,\n                        run: function (e) { if (e.onclick) e.onclick(); }\n                    });\n                };\n\n                this.onmousemove = function (x, y) {\n                    this.events.push({\n                        type: 'onmousemove',\n                        x: x,\n                        y: y,\n                        run: function (e) { if (e.onmousemove) e.onmousemove(); }\n                    });\n                };\n\n                this.eventElements = [];\n\n                this.checkPath = function (element, ctx) {\n                    for (var i = 0; i < this.events.length; i++) {\n                        var e = this.events[i];\n                        if (ctx.isPointInPath && ctx.isPointInPath(e.x, e.y)) this.eventElements[i] = element;\n                    }\n                };\n\n                this.checkBoundingBox = function (element, bb) {\n                    for (var i = 0; i < this.events.length; i++) {\n                        var e = this.events[i];\n                        if (bb.isPointInBox(e.x, e.y)) this.eventElements[i] = element;\n                    }\n                };\n\n                this.runEvents = function () {\n                    svg.ctx.canvas.style.cursor = '';\n\n                    for (var i = 0; i < this.events.length; i++) {\n                        var e = this.events[i];\n                        var element = this.eventElements[i];\n                        while (element) {\n                            e.run(element);\n                            element = element.parent;\n                        }\n                    }\n\n                    // done running, clear\n                    this.events = [];\n                    this.eventElements = [];\n                };\n            });\n\n            return svg;\n        }\n\n        if (typeof CanvasRenderingContext2D != 'undefined') {\n            CanvasRenderingContext2D.prototype.drawSvg = function (s, dx, dy, dw, dh, opts) {\n                var cOpts = {\n                    ignoreMouse: true,\n                    ignoreAnimation: true,\n                    ignoreDimensions: true,\n                    ignoreClear: true,\n                    offsetX: dx,\n                    offsetY: dy,\n                    scaleWidth: dw,\n                    scaleHeight: dh\n                };\n\n                for (var prop in opts) {\n                    if (opts.hasOwnProperty(prop)) {\n                        cOpts[prop] = opts[prop];\n                    }\n                }\n                canvg(this.canvas, s, cOpts);\n            };\n        }\n\n        module.exports = canvg;\n    });\n\n    return canvg_1;\n\n})));","!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):t.ResizeObserver=e()}(this,function(){\"use strict\";var t=function(){if(\"undefined\"!=typeof Map)return Map;function t(t,e){var n=-1;return t.some(function(t,i){return t[0]===e&&(n=i,!0)}),n}return function(){function e(){this.__entries__=[]}var n={size:{configurable:!0}};return n.size.get=function(){return this.__entries__.length},e.prototype.get=function(e){var n=t(this.__entries__,e),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(e,n){var i=t(this.__entries__,e);~i?this.__entries__[i][1]=n:this.__entries__.push([e,n])},e.prototype.delete=function(e){var n=this.__entries__,i=t(n,e);~i&&n.splice(i,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,i=this.__entries__;n<i.length;n+=1){var r=i[n];t.call(e,r[1],r[0])}},Object.defineProperties(e.prototype,n),e}()}(),e=\"undefined\"!=typeof window&&\"undefined\"!=typeof document&&window.document===document,n=\"undefined\"!=typeof global&&global.Math===Math?global:\"undefined\"!=typeof self&&self.Math===Math?self:\"undefined\"!=typeof window&&window.Math===Math?window:Function(\"return this\")(),i=\"function\"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},r=2,o=[\"top\",\"right\",\"bottom\",\"left\",\"width\",\"height\",\"size\",\"weight\"],s=\"undefined\"!=typeof MutationObserver,a=function(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var n=!1,o=!1,s=0;function a(){n&&(n=!1,t()),o&&h()}function c(){i(a)}function h(){var t=Date.now();if(n){if(t-s<r)return;o=!0}else n=!0,o=!1,setTimeout(c,e);s=t}return h}(this.refresh.bind(this),20)};a.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},a.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},a.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},a.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},a.prototype.connect_=function(){e&&!this.connected_&&(document.addEventListener(\"transitionend\",this.onTransitionEnd_),window.addEventListener(\"resize\",this.refresh),s?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener(\"DOMSubtreeModified\",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},a.prototype.disconnect_=function(){e&&this.connected_&&(document.removeEventListener(\"transitionend\",this.onTransitionEnd_),window.removeEventListener(\"resize\",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener(\"DOMSubtreeModified\",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},a.prototype.onTransitionEnd_=function(t){var e=t.propertyName;void 0===e&&(e=\"\"),o.some(function(t){return!!~e.indexOf(t)})&&this.refresh()},a.getInstance=function(){return this.instance_||(this.instance_=new a),this.instance_},a.instance_=null;var c=function(t,e){for(var n=0,i=Object.keys(e);n<i.length;n+=1){var r=i[n];Object.defineProperty(t,r,{value:e[r],enumerable:!1,writable:!1,configurable:!0})}return t},h=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||n},u=_(0,0,0,0);function f(t){return parseFloat(t)||0}function d(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return e.reduce(function(e,n){return e+f(t[\"border-\"+n+\"-width\"])},0)}function p(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return u;var i,r=h(t).getComputedStyle(t),o=function(t){for(var e={},n=0,i=[\"top\",\"right\",\"bottom\",\"left\"];n<i.length;n+=1){var r=i[n],o=t[\"padding-\"+r];e[r]=f(o)}return e}(r),s=o.left+o.right,a=o.top+o.bottom,c=f(r.width),p=f(r.height);if(\"border-box\"===r.boxSizing&&(Math.round(c+s)!==e&&(c-=d(r,\"left\",\"right\")+s),Math.round(p+a)!==n&&(p-=d(r,\"top\",\"bottom\")+a)),(i=t)!==h(i).document.documentElement){var v=Math.round(c+s)-e,l=Math.round(p+a)-n;1!==Math.abs(v)&&(c-=v),1!==Math.abs(l)&&(p-=l)}return _(o.left,o.top,c,p)}var v=\"undefined\"!=typeof SVGGraphicsElement?function(t){return t instanceof h(t).SVGGraphicsElement}:function(t){return t instanceof h(t).SVGElement&&\"function\"==typeof t.getBBox};function l(t){return e?v(t)?_(0,0,(n=t.getBBox()).width,n.height):p(t):u;var n}function _(t,e,n,i){return{x:t,y:e,width:n,height:i}}var b=function(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=_(0,0,0,0),this.target=t};b.prototype.isActive=function(){var t=l(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},b.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t};var m=function(t,e){var n,i,r,o,s,a,h,u=(i=(n=e).x,r=n.y,o=n.width,s=n.height,a=\"undefined\"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),c(h,{x:i,y:r,width:o,height:s,top:r,right:i+o,bottom:s+r,left:i}),h);c(this,{target:t,contentRect:u})},y=function(e,n,i){if(this.activeObservations_=[],this.observations_=new t,\"function\"!=typeof e)throw new TypeError(\"The callback provided as parameter 1 is not a function.\");this.callback_=e,this.controller_=n,this.callbackCtx_=i};y.prototype.observe=function(t){if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");if(\"undefined\"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type \"Element\".');var e=this.observations_;e.has(t)||(e.set(t,new b(t)),this.controller_.addObserver(this),this.controller_.refresh())}},y.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");if(\"undefined\"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type \"Element\".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},y.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},y.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},y.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new m(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},y.prototype.clearActive=function(){this.activeObservations_.splice(0)},y.prototype.hasActive=function(){return this.activeObservations_.length>0};var g=\"undefined\"!=typeof WeakMap?new WeakMap:new t,w=function(t){if(!(this instanceof w))throw new TypeError(\"Cannot call a class as a function.\");if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");var e=a.getInstance(),n=new y(t,e,this);g.set(this,n)};return[\"observe\",\"unobserve\",\"disconnect\"].forEach(function(t){w.prototype[t]=function(){return(e=g.get(this))[t].apply(e,arguments);var e}}),void 0!==n.ResizeObserver?n.ResizeObserver:w});","\nvar content = require(\"!!../../../node_modules/css-loader/index.js!./Markups.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js!./Markups.css\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js!./Markups.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after {\\n\\tcontent: \\\"\\\"; \\n\\tposition: absolute; \\n\\ttop: -15px; \\n\\tbottom: -15px; \\n\\tleft: -15px; \\n\\tright: -15px;\\n}\\n\\n.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after {\\n\\ttop: 0; \\n\\tbottom: 0px; \\n}\\n\\n.adsk-viewing-viewer .selector-box {\\n\\tposition: absolute;\\n    border: 1px dashed #0696D7;\\n    background: rgba(6, 150, 215, 0.05);\\n    z-index: 1;\\n    cursor: move;\\n    box-sizing: border-box;\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point,\\n.adsk-viewing-viewer .selector-rotate-point {\\n\\tposition: absolute;\\n\\theight: 8px;\\n\\twidth: 8px;\\n\\tborder-radius: 8px;\\t\\t\\t\\t\\t/*HANDLE_SIZE*/\\n    background: #FFFFFF;\\t\\t\\t\\t/*HANDLE_BACKGROUND_COLOR*/\\n    border-color: rgba(107,120,127,0.7); /* HANDLE_BORDER_COLOR; */\\n    border-width: 1px; \\t\\t\\t\\t\\t/* BORDER_WIDTH */\\n    border-style: solid;\\n}\\n\\n.adsk-viewing-viewer .selector-rotate-point {\\n\\ttop: calc(100% + 22px); /* 30 - 8 = 22 */\\n\\tleft: calc(50% + 1px);\\n\\ttransform: translate3d(-50%, 0px, 0px);\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.selected,\\n.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge) {\\n\\tbackground: #0696D7;\\n\\tborder-color: #0696D7;\\n}\\n\\n.adsk-viewing-viewer .rotation-bridge {\\n\\tposition: absolute;\\n\\tbackground-color: rgba(0,0,0,0);\\n\\theight: 30px;\\n\\twidth: 0px;\\n\\ttop: 100%;\\n\\tleft: calc(50% + 1px);\\n\\tborder: unset;\\n    border-left: 1px dashed #0696D7;\\n}\\n/*var placementOffset = -6;*/\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-n {\\n\\ttop: -6px;\\n\\tleft: calc(50% - 4px);\\n\\tposition: relative;\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-s {\\n\\ttop: calc(100% - 14px);\\n    left: calc(50% - 4px);\\n    position: relative;\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-w {\\n\\tleft: -6px;\\n\\ttop: 50%;\\n\\ttransform: translate3d(0, -50%, 0);\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-e {\\n\\tright: -6px;\\n\\ttop: 50%;\\n    transform: translate3d(0, -50%, 0);\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw {\\n\\ttop: -6px;\\n\\tleft: -6px;\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne {\\n\\ttop: -6px;\\n\\tright: -6px;\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw {\\n\\tbottom: -6px;\\n\\tleft: -6px;\\n}\\n\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-se {\\n\\tbottom: -6px;\\n\\tright: -6px;\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../node_modules/css-loader/index.js!./MarkupsGui.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js!./MarkupsGui.css\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js!./MarkupsGui.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"\\n.adsk-icon-markup:before {\\n  content: \\\"a\\\";\\n}\\n\\n.lmv-markup-gui-toolbar {\\n  position: absolute;\\n  top: 0;\\n  margin: 5px 5px;\\n  color: #000000;\\n}\\n\\n.lmv-markup-gui-toolbar-content > * {\\n  margin: 0 2px;\\n}\\n\\n.lmv-markup-gui-style-options {\\n  display: inline-block;\\n}\", \"\"]);\n\n// exports\n","\n/**\n * When source maps are enabled, `style-loader` uses a link element with a data-uri to\n * embed the css on the page. This breaks all relative urls because now they are relative to a\n * bundle instead of the current page.\n *\n * One solution is to only use full urls, but that may be impossible.\n *\n * Instead, this function \"fixes\" the relative urls to be absolute according to the current page location.\n *\n * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.\n *\n */\n\nmodule.exports = function (css) {\n  // get current location\n  var location = typeof window !== \"undefined\" && window.location;\n\n  if (!location) {\n    throw new Error(\"fixUrls requires window.location\");\n  }\n\n\t// blank or null?\n\tif (!css || typeof css !== \"string\") {\n\t  return css;\n  }\n\n  var baseUrl = location.protocol + \"//\" + location.host;\n  var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\n\n\t// convert each url(...)\n\t/*\n\tThis regular expression is just a way to recursively match brackets within\n\ta string.\n\n\t /url\\s*\\(  = Match on the word \"url\" with any whitespace after it and then a parens\n\t   (  = Start a capturing group\n\t     (?:  = Start a non-capturing group\n\t         [^)(]  = Match anything that isn't a parentheses\n\t         |  = OR\n\t         \\(  = Match a start parentheses\n\t             (?:  = Start another non-capturing groups\n\t                 [^)(]+  = Match anything that isn't a parentheses\n\t                 |  = OR\n\t                 \\(  = Match a start parentheses\n\t                     [^)(]*  = Match anything that isn't a parentheses\n\t                 \\)  = Match a end parentheses\n\t             )  = End Group\n              *\\) = Match anything and then a close parens\n          )  = Close non-capturing group\n          *  = Match anything\n       )  = Close capturing group\n\t \\)  = Match a close parens\n\n\t /gi  = Get all matches, not the first.  Be case insensitive.\n\t */\n\tvar fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function(fullMatch, origUrl) {\n\t\t// strip quotes (if they exist)\n\t\tvar unquotedOrigUrl = origUrl\n\t\t\t.trim()\n\t\t\t.replace(/^\"(.*)\"$/, function(o, $1){ return $1; })\n\t\t\t.replace(/^'(.*)'$/, function(o, $1){ return $1; });\n\n\t\t// already a full url? no change\n\t\tif (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(unquotedOrigUrl)) {\n\t\t  return fullMatch;\n\t\t}\n\n\t\t// convert the url to a full url\n\t\tvar newUrl;\n\n\t\tif (unquotedOrigUrl.indexOf(\"//\") === 0) {\n\t\t  \t//TODO: should we add protocol?\n\t\t\tnewUrl = unquotedOrigUrl;\n\t\t} else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\n\t\t\t// path should be relative to the base url\n\t\t\tnewUrl = baseUrl + unquotedOrigUrl; // already starts with '/'\n\t\t} else {\n\t\t\t// path should be relative to current directory\n\t\t\tnewUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\"); // Strip leading './'\n\t\t}\n\n\t\t// send back the fixed url(...)\n\t\treturn \"url(\" + JSON.stringify(newUrl) + \")\";\n\t});\n\n\t// send back the fixed css\n\treturn fixedCss;\n};\n","\n// These are all the supported markup types.\n\n    export const MARKUP_TYPE_ARROW = \"arrow\";\n    export const MARKUP_TYPE_TEXT = \"label\";\n    export const MARKUP_TYPE_RECTANGLE = \"rectangle\";\n    export const MARKUP_TYPE_CIRCLE = \"ellipse\";\n    export const MARKUP_TYPE_CLOUD = \"cloud\";\n    export const MARKUP_TYPE_FREEHAND = \"freehand\";\n    export const MARKUP_TYPE_HIGHLIGHT = \"highlight\";\n    export const MARKUP_TYPE_POLYLINE = \"polyline\";\n    export const MARKUP_TYPE_POLYCLOUD = \"polycloud\";\n    export const MARKUP_TYPE_CALLOUT = \"callout\";\n    export const MARKUP_TYPE_DIMENSION = \"dimension\";","'use strict';\n\n    /**\n     * Base class for all markup edit actions.\n     *\n     * EditActions encapsulate {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}\n     * operations (such as creation, edition and deletion) that hook into the undo/redo system.\n     *\n     * The minimum set of methods to implement on an EditAction extension are:\n     * - execute()\n     * - undo()\n     * - redo()\n     *\n     * A good set of classes to check their implementation are:\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.CreateCircle|CreateCircle}.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.DeleteCircle|DeleteCircle}.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.SetCircle|SetCircle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     * @param {String} type - An identifier for the EditAction.\n     * @param {number} targetId - The id of the markup being affected.\n     */\n    export function EditAction(editor, type, targetId) {\n\n        this.type =  type;\n        this.editor = editor;\n        this.targetId = targetId;\n        this.addToHistory = true;\n        this.selectOnExecution = true;\n    }\n\n    /**\n     * Performs the action.\n     */\n    EditAction.prototype.execute = function() {\n\n        this.editor.actionManager.execute(this);\n    };\n\n    /**\n     * @abstract\n     */\n    EditAction.prototype.redo = function() {\n\n    };\n\n    /**\n     * @abstract\n     */\n    EditAction.prototype.undo = function() {\n\n    };\n\n    /**\n     * Provides a mechanism to merge consecutive actions of the same type.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.EditAction} action - Action to check if it can be merged with 'this'.\n     * @returns {boolean} Returns true if merge has been applied. Parameter will be discarded.\n     */\n    EditAction.prototype.merge = function(action) {\n\n        return false;\n    };\n\n    /**\n     * Provides a mechanism to check whether the action yields no results.\n     * @returns {boolean} Returns true if no changes happen with this action.\n     */\n    EditAction.prototype.isIdentity = function() {\n\n        return false;\n    };\n\n","\n/**\n * \n * @param {*} attributes \n * @param {*} editor \n */\nexport var createStyle = function(attributes, editor) {\n\n    var style = {};\n\n    for(var i = 0; i < attributes.length; ++i) {\n\n        style[attributes[i]] = null;\n    }\n\n    var defaults = getStyleDefaultValues(style, editor);\n\n    for(var i = 0; i < attributes.length; ++i) {\n\n        var attribute = attributes[i];\n        style[attribute] = defaults[attribute].values[defaults[attribute].default].value;\n    }\n\n    return style;\n};\n\n/**\n *\n * @param source\n * @param destination\n * @returns {*}\n */\nexport var copyStyle = function(source, destination) {\n\n    for(var attribute in destination) {\n        if (source.hasOwnProperty(attribute)) {\n            destination[attribute] = source[attribute];\n        }\n    }\n\n    return destination;\n};\n\n/**\n *\n * @param source\n * @param destination\n * @returns {*}\n */\nexport var isStyleEqual = function(source, destination) {\n\n    for(var attribute in destination) {\n        if (source.hasOwnProperty(attribute) && source[attribute] !== destination[attribute]) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\n/**\n *\n * @param source\n * @returns {{}}\n */\nexport var cloneStyle = function(source) {\n\n    var clone = {};\n\n    for(var attribute in source) {\n        clone[attribute] = source[attribute];\n    }\n\n    return clone;\n};\n\n/**\n *\n * @param style\n * @param editor\n * @returns {{}}\n */\nexport var getStyleDefaultValues = function(style, editor) {\n\n    function getWidths(normalWidth) {\n\n        return {\n            values: [\n                {name:'Thin', value: normalWidth / 3},\n                {name:'Normal', value: normalWidth},\n                {name:'Thick', value: normalWidth * 3},\n                {name:'Very Thick', value: normalWidth * 9}],\n            default: 1\n        };\n    }\n\n    function getLineJoins() {\n\n        return {\n            values: [\n                {name:'Miter', value: 'miter'},\n                {name:'Round', value: 'round'},\n                {name:'Bevel', value: 'bevel'}],\n            default: 0\n        };\n    }\n\n    function getFontSizes(normalWidth) {\n\n        return {\n            values: [\n                {name:'Thin', value: normalWidth / 2},\n                {name:'Normal', value: normalWidth},\n                {name:'Thick', value: normalWidth * 4}],\n            default: 1\n        };\n    }\n\n    function getColors() {\n\n        return {\n            values: [\n                {name:'red', value: '#ff0000'},\n                {name:'green', value: '#00ff00'},\n                {name:'blue', value: '#0000ff'},\n                {name:'white', value: '#ffffff'},\n                {name:'black', value: '#000000'},\n                {name:'yellow', value: '#ffff00'}],\n            default: 0\n        };\n    }\n\n    function getOpacities(defaultTransparent) {\n\n        return {\n            values: [\n                {name:'100%', value: 1.00},\n                {name:'75%', value:  0.75},\n                {name:'50%', value: 0.50},\n                {name:'25%', value: 0.25},\n                {name:'0%', value: 0.00}],\n            default: (defaultTransparent ? 4 : 0)\n        };\n    }\n\n    function getFontFamilies() {\n\n        // TODO: Localize?\n        // TODO: Validate fonts with design\n        // Source: http://www.webdesigndev.com/web-development/16-gorgeous-web-safe-fonts-to-use-with-css\n        return {\n            values:[\n                {name:'Arial', value: 'Arial'},\n                {name:'Arial Black', value: 'Arial Black'},\n                {name:'Arial Narrow', value: 'Arial Narrow'},\n                {name:'Century Gothic', value: 'Century Gothic'},\n                {name:'Courier New', value: 'Courier New'},\n                {name:'Georgia', value: 'Georgia'},\n                {name:'Impact', value: 'Impact'},\n                {name:'Lucida Console', value: 'Lucida Console'},\n                {name:'Tahoma', value: 'Tahoma'},\n                {name:'Verdana', value: 'Verdana'}\n            ],\n            default: 0\n        };\n    }\n\n    function getFontStyles() {\n        return {\n            values:[\n                {name:'Normal', value: 'normal'},\n                {name:'Italic', value: 'italic'}],\n            default: 0\n        };\n    }\n\n    function getFontWeights() {\n        return {\n            values:[\n                {name:'Normal', value: 'normal'},\n                {name:'Bold', value: 'bold'}],\n            default: 0};\n    }\n\n    var values = cloneStyle(style);\n    var normaStrokeWidth = editor.getStrokeWidth();\n    var normaFontWidth = editor.getFontWidth();\n\n    for(var attribute in values) {\n\n        switch(attribute) {\n            case 'stroke-width':\n                values[attribute] = getWidths(normaStrokeWidth);\n                break;\n\n            case 'stroke-linejoin':\n                values[attribute] = getLineJoins();\n                break;\n\n            case 'font-size':\n                values[attribute] = getFontSizes(normaFontWidth);\n                break;\n\n            case 'font-family':\n                values[attribute] = getFontFamilies();\n                break;\n\n            case 'font-style':\n                values[attribute] = getFontStyles();\n                break;\n\n            case 'font-weight':\n                values[attribute] = getFontWeights();\n                break;\n\n            case 'stroke-color':\n            case 'fill-color':\n                values[attribute] = getColors();\n                break;\n\n            case 'stroke-opacity':\n                var defaultTransparent = false;\n                values[attribute] = getOpacities(defaultTransparent);\n                break;\n\n            case 'fill-opacity':\n                var defaultTransparent = true;\n                values[attribute] = getOpacities(defaultTransparent);\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    return values;\n};\n","'use strict';\n\n    /**\n     * Fired whenever the drawing tool changes. For example, when the Arrow drawing\n     * tool changes into the Rectangle drawing tool.\n     * See {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#changeEditMode|MarkupsCore.changeEditMode()}\n     * for a list of all supported drawing tools (EditModes).\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_CHANGED\n     * @type {string}\n     */\n    export const EVENT_EDITMODE_CHANGED = \"EVENT_EDITMODE_CHANGED\";\n\n    /**\n     * Fired when Edit mode has been enabled, which allows the end user to start\n     * drawing markups over the Viewer canvas.\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|MarkupsCore.enterEditMode()}.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_ENTER\n     * @type {string}\n     */\n    export const EVENT_EDITMODE_ENTER = \"EVENT_EDITMODE_ENTER\";\n\n    /**\n     * Fired when Edit mode has been disabled, preventing the end user from\n     * drawing markups over the Viewer canvas.\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|MarkupsCore.leaveEditMode()}.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_LEAVE\n     * @type {string}\n     */\n    export const EVENT_EDITMODE_LEAVE = \"EVENT_EDITMODE_LEAVE\";\n\n    /**\n     * Fired when a drawn markup has been selected by the end user with a click command.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_SELECTED\n     * @type {string}\n     */\n    export const EVENT_MARKUP_SELECTED = \"EVENT_MARKUP_SELECTED\";\n\n    /**\n     * Fired when a drawn markup is being dragged over the Viewer canvas.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DRAGGING\n     * @type {string}\n     */\n    export const EVENT_MARKUP_DRAGGING = \"EVENT_MARKUP_DRAGGING\";\n\n    /**\n     * Internal usage only.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_ENTER_EDITION\n     * @type {string}\n     * @private\n     */\n    export const EVENT_MARKUP_ENTER_EDITION = \"EVENT_MARKUP_ENTER_EDITION\";\n\n    /**\n     * Internal usage only.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_CANCEL_EDITION\n     * @type {string}\n     * @private\n     */\n    export const EVENT_MARKUP_CANCEL_EDITION = \"EVENT_MARKUP_CANCEL_EDITION\";\n\n    /**\n     * Internal usage only.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DELETE_EDITION\n     * @type {string}\n     * @private\n     */\n    export const EVENT_MARKUP_DELETE_EDITION = \"EVENT_MARKUP_DELETE_EDITION\";\n\n\n    /**\n     * Fired whenever a new undo or redo action is available.\n     */\n    export const EVENT_HISTORY_CHANGED = \"EVENT_HISTORY_CHANGED\";\n\n    /**\n     * Fired when a markup creation begins. \n     * For example, as soon as the user starts dragging with the mouse\n     * to draw an arrow on the screen.\n     */\n    export const EVENT_EDITMODE_CREATION_BEGIN = \"EVENT_EDITMODE_CREATION_BEGIN\";\n\n    /**\n     * Fired when a markup has been created.\n     * For example, as soon as the user stops dragging and releases the\n     * mouse button to finish drawing an arrow on the screen\n     */\n    export const EVENT_EDITMODE_CREATION_END = \"EVENT_EDITMODE_CREATION_END\";\n\n    /**\n     * Fired when a markup is no longer selected.\n     */\n    export const EVENT_MARKUP_DESELECT = \"EVENT_MARKUP_DESELECT\";\n\n    /**\n     * The selected markup is being modified\n     */\n    export const EVENT_EDITFRAME_EDITION_START = \"EVENT_EDITFRAME_EDITION_START\";\n\n    /**\n     * The selected markup is no longer being modified\n     */\n    export const EVENT_EDITFRAME_EDITION_END = \"EVENT_EDITFRAME_EDITION_END\";","'use strict';\n\nimport { addTraitEventDispatcher, renderToCanvas, radiansToDegrees, \n         checkPolygon, checkLineSegment, isTouchDevice } from './MarkupsCoreUtils'\nimport { createStyle, copyStyle, cloneStyle } from './StyleUtils'\nimport * as MarkupEvents from './MarkupEvents'\n\n    var av = Autodesk.Viewing;\n\n    /**\n     * Base class for all markups.\n     *\n     * A Markup is a class that is capable of rendering itself as an Svg node.<br>\n     * It can also render itself into a canvas-2d context.\n     * Component within {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore} extension.\n     *\n     * Any class extending Markup should contain at least the following methods:\n     * - getEditMode()\n     * - set()\n     * - updateStyle()\n     * - setParent()\n     * - setRotation()\n     * - setSize()\n     * - setPosition()\n     * - renderToCanvas()\n     * - setMetadata()\n     *\n     * A good reference is the rectangle markup implementation available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupRectangle|MarkupRectangle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {number} id - Identifier, populated with return value of {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#getId getId()}.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension\n     * @param {Array} styleAttributes - Attributes for customization. Related to {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#setStyle setStyle()}.\n     * @constructor\n     */\n    export function Markup(id, editor, styleAttributes) {\n\n        this.id = id;\n        this.type = \"\";\n        this.editor = editor;\n        this.viewer = editor.viewer;\n        this.position = {x: 0, y: 0};\n        this.size = {x:0, y:0};\n        this.rotation = 0;\n        this.style = createStyle(styleAttributes, this.editor);\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\n        this.highlightColor = '#0696D7';\n        this.constraintWidth = false;\n        this.constraintHeight = false;\n        this.constraintRotation = false;\n        this.minWidth = -10000;\n        this.minHeight = -10000;\n        this.highlighted = false;\n        this.selected = false;\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = Markup.prototype;\n\n    proto.destroy = function () {\n\n        this.unselect();\n        this.setParent(null);\n    };\n\n    /**\n     * Specifies the parent layer which will contain the markup.\n     * @param {HTMLElement} parent\n     */\n    proto.setParent = function(parent) {\n\n        var div = this.shape;\n        div.parentNode && div.parentNode.removeChild(div);\n        parent && parent.appendChild(div);\n    };\n\n    /**\n     * Clones (deep-copy) the markup. Used internally by the copy/cut/paste mechanism in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore}.\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} clone of the current markup\n     */\n    proto.clone = function() {\n\n        var clone = Object.create(this.__proto__);\n        var overrides = this.getCloneOverrides();\n\n        for (var name in this) {\n\n            if(!this.hasOwnProperty(name)) {\n                continue;\n            }\n\n            var member = this[name];\n\n            // Is there an override for this member?\n            if (overrides.hasOwnProperty(name)) {\n                clone[name] = overrides[name];\n                continue;\n            }\n\n            // Member is null or undefined?\n            if (member === null || member === undefined) {\n                clone[name] = member;\n                continue;\n            }\n\n            // Member has a clone function?\n            if (member['clone'] instanceof Function) {\n                clone[name] = member.clone();\n                continue;\n            }\n\n            // Is it a function?\n            if (member instanceof Function) {\n                clone[name] = member.bind(clone);\n                continue;\n            }\n\n            // Is it an html node?\n            if (member.nodeType) {\n                clone[name] = member.cloneNode(true);\n                continue;\n            }\n\n            // Just a plain object?\n            if (member instanceof Object) {\n                clone[name] = JSON.parse(JSON.stringify(member));\n                continue;\n            }\n\n            // Ok, it seems it's just a primitive type.\n            clone[name] = member;\n        }\n\n        this.cloneShape(clone);\n        return clone;\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape.markup = clone.shape.childNodes.item(0);\n        clone.shape.hitarea = clone.shape.childNodes.item(1);\n        clone.bindDomEvents();\n    };\n\n    /**\n     * Used internally by\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#clone clone()},\n     * provides a mechanism to avoid cloning specific attributes.<br>\n     * Developers only need to override this method when creating new Markup types.\n     * When overriding, first call the super() implementation and then include additional attribute/value pairs to it.\n     * @returns {Object} containing attributes that need not to be cloned.\n     */\n    proto.getCloneOverrides = function() {\n\n        return {\n            viewer: this.viewer,\n            editor: this.editor,\n            hammer: null,\n            listeners: {}\n        }\n    };\n\n    /**\n     * Used internally to select a markup.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_SELECTED.\n     */\n    proto.select = function () {\n\n        if (this.selected) {\n            return;\n        }\n\n        this.selected = true;\n        this.highlighted = false;\n        this.updateStyle();\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_SELECTED, markup: this});\n    };\n\n    /**\n     * Used internally to signal that the current markup has been unselected.<br>\n     * No event is fired.\n     */\n    proto.unselect = function() {\n\n        this.selected = false;\n    };\n\n    proto.highlight = function(highlight) {\n\n        if (this.interactionsDisabled) {\n            return;\n        }\n\n        this.highlighted = highlight;\n        this.updateStyle();\n    };\n\n    /**\n     * Returns a copy of the markup's style.\n     * @returns {Object}\n     */\n    proto.getStyle = function() {\n\n        return cloneStyle(this.style);\n    };\n\n    /**\n     * Used internally to set the style object. Triggers a re-render of the markup (Svg)\n     * @param {Object} style - Dictionary with key/value pairs\n     */\n    proto.setStyle = function(style) {\n\n        copyStyle(style, this.style);\n        this.updateStyle();\n    };\n\n    /**\n     * Used internally and implemented by specific Markup types to render themselves as Svg.\n     */\n    proto.updateStyle = function () {\n\n    };\n\n    /**\n     * Used internally to notify the markup that it is now being edited.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_ENTER_EDITION.\n     */\n    proto.edit = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_ENTER_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to signal that it is no longer being edited.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_CANCEL_EDITION.\n     */\n    proto.cancel = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to signal that the markup is being deleted.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_DELETE_EDITION.\n     */\n    proto.deleteMarkup = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_DELETE_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to get the {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode EditMode}\n     * associated with the current Markup.<br>\n     * Implemented by classes extending this one.\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.EditMode}\n     */\n    proto.getEditMode = function() {\n\n        console.warn('EditMode of markup type' + this.type + ' not defined.' );\n        return null;\n    };\n\n    /**\n     * Used internally to get the markup's position in browser pixel space.<br>\n     * Notice that (0,0) is top left.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientSize|getClientSize()}.\n     * @returns {*}\n     */\n    proto.getClientPosition = function() {\n\n        var position = this.position;\n        return this.editor.positionFromMarkupsToClient(position.x, position.y);\n    };\n\n    /**\n     * Used internally to get the markup's bounding rect in browser pixel space.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientPosition|getClientPosition()}.\n     * @returns {*}\n     */\n    proto.getClientSize = function () {\n\n        var size = this.size;\n        return this.editor.sizeFromMarkupsToClient(size.x, size.y);\n    };\n\n    /**\n     * Used internally to get the markup's bounding rect in browser pixel space, including the stroke width.<br>\n     * @returns {Object} a rectangle with right, top, left, bottom attributes\n     */\n    proto.getBoundingRect = function () {\n\n        var rotation = this.rotation;\n\n        if (rotation !== 0) { // Undo rotation to find a tight bounding rect\n            this.setRotation(0);\n        }\n\n        var parentRect = this.viewer.impl.getCanvasBoundingClientRect();\n\n        var boundRect = this.shape.markup.getBoundingClientRect();\n        var top = boundRect.top - parentRect.top;\n\n        var strokeWidth = this.style['stroke-width'] || 0;\n        var offset = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\n\n        if (rotation !== 0) {\n            this.setRotation(rotation);\n        }\n\n        return {\n            x: boundRect.left - parentRect.left - offset,\n            y: top - offset,\n            width: boundRect.width + 2*offset,\n            height: boundRect.height + 2*offset\n        };\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        this.rotation = angle;\n        this.updateStyle();\n    };\n\n    proto.getRotation = function () {\n\n        return this.rotation;\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function(x,y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.isWidthConstrained = function() {\n\n        return this.constraintWidth;\n    };\n\n    proto.isHeightConstrained = function() {\n\n        return this.constraintHeight;\n    };\n\n    proto.isRotationConstrained = function() {\n\n        return this.constraintRotation;\n    };\n\n    proto.setMinWidth = function(minWidth) {\n        this.minWidth = minWidth;\n    };\n\n    proto.setMinHeight = function(minHeight) {\n        this.minHeight = minHeight;\n    };\n\n    proto.getMinWidth = function() {\n        return this.minWidth;\n    };\n\n    proto.getMinHeight = function() {\n        return this.minHeight;\n    };\n\n    /**\n     * Used to disable highlight on annotations while a new annotation is being created.\n     * @param {Boolean} disable - Whether (mouse) interactions are enable.\n     */\n    proto.disableInteractions = function(disable) {\n\n        this.interactionsDisabled = disable;\n    };\n\n    /**\n     *\n     * @param width\n     */\n    proto.setStrokeWidth = function(width) {\n\n    };\n\n    proto.constrainsToBounds = function(bounds) {\n\n    };\n\n    proto.onMouseDown = function(event) {\n\n        if (this.interactionsDisabled) {\n            return;\n        }\n\n        this.select();\n        this.editor.editFrame.startDrag(event);\n    };\n\n    /**\n     *\n     * @param idTarget\n     * @returns *\n     */\n    proto.generatePoint3d = function(idTarget) {\n\n        var viewer = this.viewer;\n        var polygon = this.generateBoundingPolygon();\n\n        function checkLineSegmentAux(a, b) {\n\n            var point2d = checkLineSegment(a.x, a.y, b.x, b.y, idTarget);\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\n            return point3d && point3d.point;\n        }\n\n        function checkPolygonAux(polygon) {\n\n            var point2d = checkPolygon(polygon, idTarget);\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\n            return point3d && point3d.point;\n        }\n\n        // Try to avoid expensive calculations by checking some lines segments first.\n        // If line check cannot find a point the costly one by area is used.\n        // A ----midAB---- B\n        // |               |\n        // |     center    |\n        // |               |\n        // C --------------D\n\n        var xVertices = polygon.xVertices;\n        var yVertices = polygon.yVertices;\n\n        var midAB = new THREE.Vector2(xVertices[0] + xVertices[1], yVertices[0] + yVertices[1]).multiplyScalar(0.5);\n        var midAC = new THREE.Vector2(xVertices[0] + xVertices[3], yVertices[0] + yVertices[3]).multiplyScalar(0.5);\n        var midDB = new THREE.Vector2(xVertices[2] + xVertices[1], yVertices[2] + yVertices[1]).multiplyScalar(0.5);\n        var midDC = new THREE.Vector2(xVertices[2] + xVertices[3], yVertices[2] + yVertices[3]).multiplyScalar(0.5);\n        var center = midAC.clone().add(midDB).multiplyScalar(0.5);\n\n        var point3d =\n            checkLineSegmentAux(center, midDB) ||\n            checkLineSegmentAux(center, midAC) ||\n            checkLineSegmentAux(center, midAB) ||\n            checkLineSegmentAux(center, midDC);\n\n        return point3d || checkPolygonAux(polygon);\n    };\n\n    /**\n     *\n     * @returns {{min: {x: number, y: number}, max: {x: number, y: number}}}\n     */\n    proto.generateBoundingBox = function() {\n\n        var boundingBox = {min: {x: 0,y: 0}, max: {x: 0, y: 0}};\n\n        // Get bounding box from markup bounding polygon.\n        var polygon = this.generateBoundingPolygon();\n\n        var vertexCount = polygon.vertexCount;\n        var xVertices = polygon.xVertices;\n        var yVertices = polygon.yVertices;\n\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < vertexCount; ++i) {\n\n            var bbX = xVertices[i];\n            var bbY = yVertices[i];\n\n            bbX0 = Math.min(bbX0, bbX);\n            bbY0 = Math.min(bbY0, bbY);\n            bbX1 = Math.max(bbX1, bbX);\n            bbY1 = Math.max(bbY1, bbY);\n        }\n\n        boundingBox.min.x = bbX0;\n        boundingBox.min.y = bbY0;\n        boundingBox.max.x = bbX1;\n        boundingBox.max.y = bbY1;\n\n        return boundingBox;\n    };\n\n    /**\n     *\n     * @returns {{vertexCount: number, xVertices: Float32Array, yVertices: Float32Array}}\n     */\n    proto.generateBoundingPolygon = function() {\n\n        var position = this.getClientPosition();\n        var halfSize = this.getClientSize();\n\n        halfSize.x *= 0.5;\n        halfSize.y *= 0.5;\n\n        var lt = new THREE.Vector3(-halfSize.x,-halfSize.y).add(position);\n        var rt = new THREE.Vector3( halfSize.x,-halfSize.y).add(position);\n        var rb = new THREE.Vector3( halfSize.x, halfSize.y).add(position);\n        var lb = new THREE.Vector3(-halfSize.x, halfSize.y).add(position);\n\n        if (this.rotation !== 0) {\n\n            var m1 = new THREE.Matrix4().makeTranslation(-position.x, -position.y, 0);\n            var m2 = new THREE.Matrix4().makeRotationZ(this.rotation);\n            var m3 = new THREE.Matrix4().makeTranslation(position.x, position.y, 0);\n            var transform = m3.multiply(m2).multiply(m1);\n\n            lt.applyMatrix4(transform);\n            rt.applyMatrix4(transform);\n            rb.applyMatrix4(transform);\n            lb.applyMatrix4(transform);\n        }\n\n        return { // packed for fast access in test algorithm.\n            vertexCount: 4,\n            xVertices : new Float32Array([lt.x, rt.x, rb.x, lb.x]),\n            yVertices : new Float32Array([lt.y, rt.y, rb.y, lb.y])\n        };\n    };\n\n    /**\n     * Implemented by extending classes.<br>\n     * Gets called automatically when\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#generateData|generateData()}\n     * @returns {null|Element} - Either null (default) or the metadata Svg node\n     */\n    proto.setMetadata = function() {\n\n        return null; // No metadata is injected by default.\n    };\n\n    proto.setMouseDisabledWhenTouching = function(event) {\n\n        if (event.isFirst) {\n            this.shape.removeEventListener('mousedown', this.onMouseDownBinded);\n        } else if (event.isFinal) {\n            var _this = this;\n            setTimeout(function() {\n                _this.shape.addEventListener('mousedown', _this.onMouseDownBinded);\n            }, 10);\n        }\n    };\n\n    proto.bindDomEvents = function() {\n\n        if (isTouchDevice()) {\n\n            this.hammer = new av.Hammer.Manager(this.shape, {\n                recognizers: [\n                    av.GestureRecognizers.singletap\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\n            });\n\n            this.onSingleTapBinded = function(event) {\n\n                this.onMouseDown(event);\n            }.bind(this);\n\n            this.onHammerInputBinded = function(event) {\n\n                this.setMouseDisabledWhenTouching(event);\n            }.bind(this);\n\n            this.hammer.on('singletap', this.onSingleTapBinded);\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\n        }\n\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\n        this.onMouseOutBinded = function() {\n\n            this.highlight(false);\n        }.bind(this);\n\n        this.onMouseOverBinded = function() {\n\n            this.highlight(true);\n        }.bind(this);\n\n        this.shape.addEventListener('mousedown', this.onMouseDownBinded);\n        this.shape.addEventListener('mouseout', this.onMouseOutBinded);\n        this.shape.addEventListener('mouseover', this.onMouseOverBinded);\n    };\n\n    proto.renderToCanvas = function(ctx, viewBox, width, height, callback) {\n\n        renderToCanvas(this.shape, viewBox, width, height, ctx, callback);\n    };\n\n    proto.getPath = function() {\n\n    };\n\n    proto.getTransform = function() {\n\n        return [\n            'translate(', this.position.x, ',', this.position.y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')'\n        ].join(' ');\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param style\n     * @constructor\n     */\n    export function SetStyle(editor, markup, style) {\n\n        EditAction.call(this, editor, 'SET-STYLE', markup.id);\n\n        this.newStyle = cloneStyle(style);\n        this.oldStyle = markup.getStyle();\n    }\n\n    SetStyle.prototype = Object.create(EditAction.prototype);\n    SetStyle.prototype.constructor = SetStyle;\n\n    var proto = SetStyle.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setStyle(this.newStyle);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setStyle(this.oldStyle);\n    };\n","'use strict';\n\nimport * as MarkupEvents from '../MarkupEvents'\nimport { createStyle, copyStyle } from '../StyleUtils'\nimport { addTraitEventDispatcher, removeTraitEventDispatcher, sign } from '../MarkupsCoreUtils'\nimport { SetStyle } from '../edit-actions/SetStyle'\n\n    /**\n     * Base class for all markup edit modes.\n     *\n     * An EditMode is responsible for handling user input to create and edit a\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     *\n     * Any class extending Markup should contain at least the following methods:\n     * - deleteMarkup()\n     * - onMouseDown()\n     * - onMouseMove()\n     *\n     * A good reference is the Circle EditMode implementation available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle|EditModeCircle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension.\n     * @param {String} type - An identifier for the EditMode type. Not to be confused by the Markup's id.\n     * @param {Array} styleAttributes - Attributes for customization.\n     * @constructor\n     */\n    export function EditMode(editor, type, styleAttributes) {\n\n        this.editor = editor;\n        this.viewer = editor.viewer;\n        this.type = type;\n        this.selectedMarkup = null;\n        this.dragging = false;\n        this.draggingAnnotationIniPosition = null;\n        this.draggingMouseIniPosition = new THREE.Vector2();\n        this.initialX = 0;\n        this.initialY = 0;\n        this.minSize = 9; // In pixels\n        this.creating = false;\n        this.size = {x: 0, y: 0};\n        this.style = createStyle(styleAttributes, this.editor);\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\n\n        this.CREATION_METHOD_DRAG = 'CREATION_METHOD_DRAG';\n        this.CREATION_METHOD_CLICK = 'CREATION_METHOD_CLICK';\n        this.CREATION_METHOD_CLICKS = 'CREATION_METHOD_CLICKS';\n        this.creationMethod = this.CREATION_METHOD_DRAG;\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = EditMode.prototype;\n\n    proto.destroy = function() {\n\n        this.unselect();\n        removeTraitEventDispatcher(this);\n    };\n\n    proto.unselect = function() {\n\n        var fireEv = false;\n        var selectedMarkup = this.selectedMarkup;\n        var selectedId = null;\n\n        if (selectedMarkup) {\n            selectedId = selectedMarkup.id;\n            selectedMarkup.unselect();\n            this.selectedMarkup = null;\n            fireEv = true;\n        }\n\n        this.editor.editFrame.setMarkup(null);\n\n        if (fireEv) {\n            this.dispatchEvent({ type: MarkupEvents.EVENT_MARKUP_DESELECT, markupId: selectedId });\n        }\n    };\n\n    proto.creationBegin = function() {\n\n        if (this.creating) {\n            return;\n        }\n\n        this.creating = true;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN });\n    };\n\n    proto.creationEnd = function(isCancelling) {\n\n        if (!this.creating) {\n            return;\n        }\n\n        if (this.creationMethod !== this.CREATION_METHOD_CLICK) {\n\n            if (this.selectedMarkup && !this.isMinSizeValid()) {\n\n                this.creationCancel();\n                isCancelling = true;\n            } else {\n\n                if (this.creationMethod === this.CREATION_METHOD_DRAG) {\n                    this.finishDragging();\n                }\n\n                if (this.selectedMarkup) {\n\n                    // Opened on mouse down.\n                    this.editor.closeActionGroup();\n                    this.selectedMarkup = null;\n                }\n            }\n        }\n\n        this.creating = false;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_END, creationCancelled: !!isCancelling });\n    };\n\n    proto.creationCancel = function() {\n\n        this.editor.cancelActionGroup();\n        this.creationEnd(true);\n        this.selectedMarkup = null; // No need to call unselect\n    };\n\n    /**\n     *\n     * @param style\n     */\n    proto.setStyle = function(style) {\n\n        this.style = style;\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup) {\n            return;\n        }\n\n        var setStyle = new SetStyle(this.editor, selectedMarkup, style);\n        setStyle.execute();\n    };\n\n    proto.getStyle = function() {\n\n        return this.style;\n    };\n\n    proto.setSelection = function(markup) {\n\n        if (this.selectedMarkup !== markup) {\n            this.unselect();\n            markup && markup.select();\n        }\n\n        this.selectedMarkup = markup;\n\n        var editor = this.editor;\n        markup && editor.bringToFront(markup);\n\n        if (this.isTextInputHelperActive() && editor.editFrame.markup) {\n            this.textInputHelper.setEditFrame();\n        } else if (!this.creating) {\n            editor.editFrame.setMarkup(markup);\n        }\n    };\n\n    proto.getSelection = function() {\n\n        return this.selectedMarkup;\n    };\n\n    /**\n     *\n     * @param [markup] If provided deletes markup (has to have same type that the edit mode), otherwise deletes selected one.\n     * @param [cantUndo] If true to not add deletion to undo history.\n     * @returns {boolean}\n     */\n    proto.deleteMarkup = function (markup, cantUndo) {\n\n        return false;\n    };\n\n    /**\n     * Used by classes extending EditMode to validate the minimum size (in screen coordinates) of the markup.\n     * See minSize attribute\n     * @return {Boolean} Whether current size is valid for creating the markup\n     * @private\n     */\n    proto.isMinSizeValid = function() {\n\n        if (this.minSize !== 0) {\n\n            var tmp = this.editor.sizeFromMarkupsToClient(this.size.x, this.size.y);\n            return (tmp.x*tmp.x + tmp.y*tmp.y) >= (this.minSize * this.minSize);\n\n        }\n        return true;\n    };\n\n    /**\n     * @private\n     */\n    proto.startDragging = function() {\n\n        var selectedMarkup = this.selectedMarkup;\n        var mousePosition = this.editor.getMousePosition();\n\n        if (selectedMarkup) {\n\n            this.dragging = true;\n            this.draggingAnnotationIniPosition = selectedMarkup.getClientPosition();\n            this.draggingMouseIniPosition.set(mousePosition.x, mousePosition.y);\n        }\n    };\n\n    /**\n     * @private\n     */\n    proto.finishDragging = function() {\n\n        var dragging = this.dragging;\n        var selectedMarkup = this.selectedMarkup;\n\n        this.dragging = false;\n\n        if (selectedMarkup && dragging) {\n\n            selectedMarkup.finishDragging();\n        }\n    };\n\n    /**\n     *\n     * @returns {{x: number, y: number}}\n     */\n    proto.getFinalMouseDraggingPosition = function() {\n\n        var editor = this.editor;\n        var bounds = editor.getBounds();\n        var mousePosition = editor.getMousePosition();\n\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\n\n        if (finalX == initialX &&\n            finalY == initialY) {\n            finalX++;\n            finalY++;\n        }\n\n        // Make equal x/y when shift is down\n        if (editor.input.makeSameXY) {\n            var dx = Math.abs(finalX - initialX);\n            var dy = Math.abs(finalY - initialY);\n\n            var maxDelta = Math.max(dx, dy);\n\n            // These calculations have the opportunity to go beyond 'bounds'.\n            finalX = initialX + maxDelta * sign(finalX - initialX);\n            finalY = initialY + maxDelta * sign(finalY - initialY);\n        }\n\n        return { x:finalX, y:finalY };\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n    };\n\n    proto.onMouseMove = function (event) {\n\n    };\n\n    proto.onMouseDown = function () {\n\n    };\n\n    /**\n     * Handler to mouse up events, used to start annotations creation.\n     * It will cancel the creation of a markup if its minSize conditions are not met.\n     *\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        if (this.creationMethod !== this.CREATION_METHOD_DRAG) {\n            return;\n        }\n\n        this.creationEnd();\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if (this.creationMethod !== this.CREATION_METHOD_CLICKS) {\n            return;\n        }\n\n        this.creationEnd();\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        if (this.creating) {\n            this.creationCancel();\n        }\n    };\n\n    /**\n     *\n     * @returns {{x: *, y: *}}\n     */\n    proto.getDraggingPosition = function () {\n\n        var mousePosition = this.editor.getMousePosition();\n\n        var dx = mousePosition.x - this.draggingMouseIniPosition.x;\n        var dy = mousePosition.y - this.draggingMouseIniPosition.y;\n\n        return {\n            x: this.draggingAnnotationIniPosition.x + dx,\n            y: this.draggingAnnotationIniPosition.y + dy\n        };\n    };\n\n    /**\n     *\n     * @param x\n     * @param y\n     * @param bounds\n     * @returns {boolean}\n     * @orivate\n     */\n    proto.isInsideBounds = function (x, y, bounds) {\n\n        return x >= bounds.x && x <= bounds.x + bounds.width &&\n               y >= bounds.y && y <= bounds.y + bounds.height;\n    };\n\n    /*\n     * Decides whether to use the snapper in the current edit mode or not.\n     * \n     * @returns {boolean}\n     */\n    proto.useWithSnapping = function () {\n        return this.viewer.model.is2d();\n    };\n\n    \n    proto.isTextInputHelperActive = function() {\n        return this.textInputHelper && this.textInputHelper.isActive();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateArrow } from './CreateArrow'\n\n    /**\n     *\n     * @param editor\n     * @param arrow\n     * @constructor\n     */\n    export function DeleteArrow(editor, arrow) {\n\n        // Confusing naming here. Arrow.tail is the starting point of the arrow,\n        // and arrow.head is the final point. In CreateArrow the head argument\n        // is the first point of the arrow and the tail argument is the second\n        // point of the argument. So construct CreateArrow with the tail before\n        // the head. \n        EditAction.call(this, editor, 'DELETE-ARROW', arrow.id);\n        this.createArrow = new CreateArrow(\n            editor,\n            arrow.id,\n            arrow.tail,\n            arrow.head,\n            arrow.getStyle());\n    }\n\n    DeleteArrow.prototype = Object.create(EditAction.prototype);\n    DeleteArrow.prototype.constructor = DeleteArrow;\n\n    var proto = DeleteArrow.prototype;\n\n    proto.redo = function() {\n\n        this.createArrow.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createArrow.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param arrow\n     * @param head\n     * @param tail\n     * @constructor\n     */\n    export function SetArrow(editor, arrow, head, tail) {\n\n        EditAction.call(this, editor, 'SET-ARROW', arrow.id);\n\n        this.newHead = {x: head.x, y: head.y};\n        this.newTail = {x: tail.x, y: tail.y};\n        this.oldHead = {x: arrow.head.x, y: arrow.head.y};\n        this.oldTail = {x: arrow.tail.x, y: arrow.tail.y};\n    }\n\n    SetArrow.prototype = Object.create(EditAction.prototype);\n    SetArrow.prototype.constructor = SetArrow;\n\n    var proto = SetArrow.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newHead, this.newTail);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldHead, this.oldTail);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newHead = action.newHead;\n            this.newTail = action.newTail;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, head, tail) {\n\n        var arrow = this.editor.getMarkup(targetId);\n        if(!arrow) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(arrow.head.x - head.x) >= epsilon || Math.abs(arrow.head.y - head.y) >= epsilon ||\n            Math.abs(arrow.tail.x - tail.x) >= epsilon || Math.abs(arrow.tail.y - tail.y) >= epsilon) {\n\n            // Confusing naming here. in arrow.set the first two numbers are\n            // the point you drag from and the second two are the point you\n            // drag to. So the head point is actually where the tail of the\n            // arrow is positioned and the tail point is the head is positioned.\n            arrow.set(head.x, head.y, tail.x, tail.y);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newHead.x === this.oldHead.x &&\n            this.newHead.y === this.oldHead.y &&\n            this.newTail.x === this.oldTail.x &&\n            this.newTail.y === this.oldTail.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteArrow } from '../edit-actions/DeleteArrow'\nimport { CreateArrow } from '../edit-actions/CreateArrow'\nimport { SetArrow } from '../edit-actions/SetArrow'\nimport * as MarkupTypes from '../MarkupTypes'\n\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeArrow(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_ARROW, styleAttributes);\n    }\n\n    EditModeArrow.prototype = Object.create(EditMode.prototype);\n    EditModeArrow.prototype.constructor = EditModeArrow;\n\n\n    var proto = EditModeArrow.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteArrow = new DeleteArrow(this.editor, markup);\n            deleteArrow.addToHistory = !cantUndo;\n            deleteArrow.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        this.size.x = 0;\n        this.size.y = 0;\n\n        // Snap to parallel/perpendicular of underlying vectors\n        this.lineSnapped = null;\n        if (editor.snapper) {\n            var geomType = editor.snapper.getGeometryType();\n            if (geomType === MeasureCommon.SnapType.SNAP_VERTEX || \n                geomType === MeasureCommon.SnapType.SNAP_EDGE || \n                geomType === MeasureCommon.SnapType.SNAP_MIDPOINT || \n                geomType === MeasureCommon.SnapType.SNAP_CIRCLE_CENTER) \n            {\n                this.lineSnapped = editor.snapper.getEdge();\n            }\n        }\n\n        // Calculate head and tail.\n        var arrowMinSize = this.style['stroke-width'] * 3.5;\n\n        var head = this.head = editor.positionFromClientToMarkups(this.initialX, this.initialY);\n        var tail = {\n            x: head.x + Math.cos( Math.PI * 0.25) * arrowMinSize,\n            y: head.y + Math.sin(-Math.PI * 0.25) * arrowMinSize\n        };\n        // Constrain head and tail inside working area.\n        var constrain = function(head, tail, size, bounds) {\n\n            if (this.isInsideBounds(tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.y = head.y + Math.sin( Math.PI * 0.25) * size;\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.x = head.x + Math.cos(-Math.PI * 0.25) * size;\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.y = head.y + Math.sin(-Math.PI * 0.25) * size;\n\n        }.bind(this);\n\n        constrain( head, tail, arrowMinSize, editor.getBounds());\n\n        // Create arrow.\n        editor.beginActionGroup();\n\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\n\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\n            tail.x = head.x + arrowVector.x;\n            tail.y = head.y + arrowVector.y;\n        }\n\n        var arrowId = editor.getId();\n        var create = new CreateArrow(editor, arrowId, head, tail, this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(arrowId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call( this, event );\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        var editor = this.editor;\n        var final = this.getFinalMouseDraggingPosition();\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        // Snap to parallel/perpendicular of underlying vectors\n        if (editor.snapper && !editor.snapper.isSnapped() && this.lineSnapped) {\n            var start = editor.project(this.lineSnapped.vertices[0]);\n            var end = editor.project(this.lineSnapped.vertices[1]);\n            var p = new THREE.Vector3(final.x, final.y, start.z);\n\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\n\n            // select an arbitrary point on the perpendicular line\n            var k = -(start.x - end.x) / (start.y - end.y);\n            var b = initialY - k * initialX;\n            var x = initialX + 1;\n            var y = k * x + b;\n            var pEnd = new THREE.Vector3(x, y, start.z);\n\n            var pStart = new THREE.Vector3(initialX, initialY, start.z);\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\n\n            // Snap to parallel of underlying vectors\n            if (parallel.distanceTo(p) <= 20) {\n                final.x = parallel.x;\n                final.y = parallel.y;\n            }\n            // Snap to perpendicular of underlying vectors\n            else if (perpendicular.distanceTo(p) <= 20) {\n                final.x = perpendicular.x;\n                final.y = perpendicular.y;\n            }\n        }\n\n        var head = this.head;\n        var tail = editor.positionFromClientToMarkups(final.x, final.y);\n\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\n        var arrowMinSize = selectedMarkup.style['stroke-width'] * 3.5;\n\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\n\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\n            tail.x = head.x + arrowVector.x;\n            tail.y = head.y + arrowVector.y;\n        }\n\n        this.size = editor.sizeFromClientToMarkups((final.x - initialX), (final.y - initialY));\n\n        var setArrow = new SetArrow(editor, selectedMarkup, head, tail);\n        setArrow.execute();\n    };","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, checkLineSegment, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupArrow(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_ARROW;\n        this.constraintHeight = true;\n\n        // Create head and tail.\n        this.head = new THREE.Vector3();\n        this.tail = new THREE.Vector3();\n        this.size.y = this.style['stroke-width'] * 3;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupArrow.prototype = Object.create(Markup.prototype);\n    MarkupArrow.prototype.constructor = MarkupArrow;\n\n    var proto = MarkupArrow.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeArrow(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * Notice that for the arrow, the top left is the \"tail\" of the arrow and\n     * the bottom right is the \"head\" of it.\n     *\n     * @param {Number} xO - tail\n     * @param {Number} yO - tail\n     * @param {Number} xF - head\n     * @param {Number} yF - head\n     */\n    proto.set = function(xO, yO, xF, yF) {\n\n        var vO = new THREE.Vector2(xO, yO);\n        var vF = new THREE.Vector2(xF, yF);\n        var vDir = vF.clone().sub(vO).normalize();\n\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\n\n        var head = this.head;\n        var tail = this.tail;\n\n        head.set(xF, yF, 0);\n        tail.set(xO, yO, 0);\n\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        this.rotation = angle;\n\n        var xF = Math.cos(-angle);\n        var yF = Math.sin(-angle);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(this.size.x*0.5);\n\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.head.set(vF.x, vF.y, 0);\n        this.tail.set(vO.x, vO.y, 0);\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the namespace.SetSize edit action\n     * @param {{x: Number, y: Number}} position - arrow's center\n     * @param {Number} width - Arrow's length\n     * @param {Number} height - We ignore this one because we use the arrow's stroke width instead\n     */\n    proto.setSize = function(position, width, height) {\n\n        var xF = Math.cos(-this.rotation);\n        var yF = Math.sin(-this.rotation);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(width*0.5);\n\n        var vCenter = new THREE.Vector2(position.x, position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.head.set(vF.x, vF.y, 0);\n        this.tail.set(vO.x, vO.y, 0);\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n\n        this.updateStyle();\n    };\n\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var strokeWidth = style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var transform = this.getTransform();\n\n        this.size.y = strokeWidth * 3;\n        this.style['fill-color'] = style['stroke-color'];\n        this.style['fill-opacity'] = style['stroke-opacity'];\n\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function (x, y) {\n\n        var head = this.head;\n        var tail = this.tail;\n\n        var dx = head.x - tail.x;\n        var dy = head.y - tail.y;\n\n        var xo = x + dx * 0.5;\n        var yo = y + dy * 0.5;\n\n        head.x = xo;\n        head.y = yo;\n\n        tail.x = xo - dx;\n        tail.y = yo - dy;\n\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    proto.generatePoint3d = function(idTarget) {\n\n        var head = this.editor.positionFromMarkupsToClient(this.head.x, this.head.y);\n        var tail = this.editor.positionFromMarkupsToClient(this.tail.x, this.tail.y);\n\n        var direction = head.clone().sub(tail).normalize();\n\n        var point2d = checkLineSegment(head.x, head.y, head.x + direction.x * 200, head.y + direction.y * 200, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n\n        return point3d && point3d.point;\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.head = [this.head.x, this.head.y].join(\" \");\n        metadata.tail = [this.tail.x, this.tail.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        // To build the arrow we need 7 points in total\n        // The 'default' arrow built here has the following characteristics:\n        //\n        // 1. It is built horizontally facing right\n        // 2. It's bounding rectangle has length: this.size.x\n        // 3. It's bounding rectangle has height: 2 * this.strokeWidth\n        // 4. The arrow tail's thickness is: this.strokeWidth\n        // 5. The arrow head's length is: 2/3 of (point 3)\n        // 6. The arrow head's thickness is: (point 3)\n        // 7. The arrow generated is centered in its local (0,0), meaning that\n        //    two points are placed with negative x values, and all other have\n        //    positive x values:\n        //\n        //                            (3)\\\n        //                              \\  \\\n        //             (1)-------------(2)   \\\n        //              |         (0)        (4)\n        //             (7)-------------(6)   /\n        //                              /  /\n        //                            (5)/\n        //\n\n        var sizeX = this.size.x;\n        var sizeY = this.size.y;\n        var sizeYOver3 = sizeY/3;\n        var strokeWidth = this.style['stroke-width'];\n        var tailW = sizeX - strokeWidth * 3;\n        var headW = sizeX - tailW;\n        var spikeOffset = strokeWidth * 0.3;\n\n        return [\n            'M', -sizeX * 0.5        , -sizeY * 0.5 + sizeYOver3,    // (1)\n            'l',  tailW              ,  0,                           // (2)\n            'l', -spikeOffset        , -sizeYOver3,                  // (3)\n            'l',  headW + spikeOffset,  sizeYOver3 * 1.5,            // (4)\n            'l', -headW - spikeOffset,  sizeYOver3 * 1.5,            // (5)\n            'l',  spikeOffset        , -sizeYOver3,                  // (6)\n            'l', -tailW              ,  0,                           // (7)\n            'z'\n        ];\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupArrow } from '../MarkupArrow'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     * @constructor\n     */\n    export function CreateArrow(editor, id, head, tail, style) {\n\n        EditAction.call(this, editor, 'CREATE-ARROW', id);\n\n        this.selectOnExecution = false;\n        this.tail = tail;\n        this.head = head;\n        this.style = cloneStyle(style);\n    }\n\n    CreateArrow.prototype = Object.create(EditAction.prototype);\n    CreateArrow.prototype.constructor = CreateArrow;\n\n    var proto = CreateArrow.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var arrow = new MarkupArrow(this.targetId, editor);\n\n        editor.addMarkup(arrow);\n\n        // Confusing naming here. in arrow.set the first two numbers are\n        // the point you drag from and the second two are the point you\n        // drag to. So the head point is actually where the tail of the\n        // arrow is positioned and the tail point is the head is positioned.\n\n        //TODO: In MarkupArrow \"set\" function has tail x, tail y, head x, head y but used here in the opposite way\n        arrow.set(this.head.x, this.head.y, this.tail.x, this.tail.y);\n        arrow.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateRectangle } from './CreateRectangle'\n\n    /**\n     *\n     * @param editor\n     * @param rectangle\n     * @constructor\n     */\n    export var DeleteRectangle = function(editor, rectangle) {\n\n        EditAction.call(this, editor, 'DELETE-RECTANGLE', rectangle.id);\n        this.createRectangle = new CreateRectangle(\n            editor,\n            rectangle.id,\n            rectangle.position,\n            rectangle.size,\n            rectangle.rotation,\n            rectangle.getStyle());\n    };\n\n    DeleteRectangle.prototype = Object.create(EditAction.prototype);\n    DeleteRectangle.prototype.constructor = DeleteRectangle;\n\n    var proto = DeleteRectangle.prototype;\n\n    proto.redo = function() {\n\n        this.createRectangle.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createRectangle.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param rectangle\n     * @param position\n     * @param size\n     * @constructor\n     */\n    export function SetRectangle(editor, rectangle, position, size) {\n\n        EditAction.call(this, editor, 'SET-RECTANGLE', rectangle.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: rectangle.position.x, y: rectangle.position.y};\n        this.oldSize = {x: rectangle.size.x, y: rectangle.size.y};\n    }\n\n    SetRectangle.prototype = Object.create(EditAction.prototype);\n    SetRectangle.prototype.constructor = SetRectangle;\n\n    var proto = SetRectangle.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var rectangle = this.editor.getMarkup(targetId);\n        if(!rectangle) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(rectangle.position.x - position.x) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon ||\n            Math.abs(rectangle.position.y - position.y) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon) {\n\n            rectangle.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return(\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteRectangle } from '../edit-actions/DeleteRectangle'\nimport { CreateRectangle } from '../edit-actions/CreateRectangle'\nimport { SetRectangle } from '../edit-actions/SetRectangle'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeRectangle(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_RECTANGLE, styleAttributes);\n    }\n\n    EditModeRectangle.prototype = Object.create(EditMode.prototype);\n    EditModeRectangle.prototype.constructor = EditModeRectangle;\n\n    var proto = EditModeRectangle.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteRectangle = new DeleteRectangle(this.editor, markup);\n            deleteRectangle.addToHistory = !cantUndo;\n            deleteRectangle.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call( this, event );\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        var editor = this.editor;\n\n        var pos = this.getFinalMouseDraggingPosition();\n        var final = editor.clientToMarkups(pos.x, pos.y);\n        var position = {x: (this.firstCorner.x + final.x) / 2, y: (this.firstCorner.y + final.y) / 2};\n\n        var width, height;\n        // Snap to parallel/perpendicular of underlying vectors\n        if (editor.snapper && this.lineSnapped) {\n            var start = editor.project(this.lineSnapped.vertices[0]);\n            var end = editor.project(this.lineSnapped.vertices[1]);\n\n            var startZ = start.z;\n\n            start = editor.clientToMarkups(start.x, start.y);\n            end = editor.clientToMarkups(end.x, end.y);\n\n            start = new THREE.Vector3(start.x, start.y, startZ);\n            end = new THREE.Vector3(end.x, end.y, startZ);\n\n            var p = new THREE.Vector3(final.x, final.y, startZ);\n\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\n            height = p.distanceTo(parallel);\n\n            // select an arbitrary point on the perpendicular line\n            var k = -(start.x - end.x) / (start.y - end.y);\n            var b = this.firstCorner.y - k * this.firstCorner.x;\n            var x = this.firstCorner.x + 1;\n            var y = k * x + b;\n            var pEnd = new THREE.Vector3(x, y, startZ);\n\n            var pStart = new THREE.Vector3(this.firstCorner.x, this.firstCorner.y, startZ);\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\n            width = p.distanceTo(perpendicular);\n        }\n        else {\n            width = final.x - this.firstCorner.x;\n            height = final.y - this.firstCorner.y;\n        }\n\n        var size = this.size = {x: Math.abs(width), y: Math.abs(height)};\n\n        var setRectangle = new SetRectangle(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setRectangle.execute();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstCorner = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Calculate rotation\n        var rotation = 0;\n        this.lineSnapped = null;\n        if (editor.snapper) {\n            // Snap to parallel/perpendicular of underlying vectors\n            var geomType = editor.snapper.getGeometryType();\n            if (geomType === MeasureCommon.SnapType.SNAP_EDGE) {\n                this.lineSnapped = editor.snapper.getEdge();\n                var start = editor.project(this.lineSnapped.vertices[0]);\n                var end = editor.project(this.lineSnapped.vertices[1]);\n                var dx = end.x - start.x;\n                var dy = end.y - start.y;\n                rotation = this.rotation = Math.atan2(dy, dx);\n            }\n        }\n\n        // Create rectangle.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateRectangle(\n            editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, createRectanglePath,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeRectangle } from './edit-modes/EditModeRectangle'\n\n    /**\n     * Rectangle markup.\n     *\n     * Implements a Rectangle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific markup type. Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.Markup\n     *\n     * @param {number} id\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     * @constructor\n     */\n    export function MarkupRectangle(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_RECTANGLE;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupRectangle.prototype = Object.create(Markup.prototype);\n    MarkupRectangle.prototype.constructor = MarkupRectangle;\n\n    var proto = MarkupRectangle.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeRectangle(this.editor);\n    };\n\n    /**\n     * Sets position and size in markup space coordinates\n     * @param {Object} position\n     * @param {Object} size\n     */\n    proto.set = function(position, size) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var strokeWidth = this.style['stroke-width'];\n\n        var w = this.size.x - strokeWidth;\n        var h = this.size.y - strokeWidth;\n        var x =-w * 0.5;\n        var y =-h * 0.5;\n\n        var path = [];\n        createRectanglePath(x, y, w, h, false, path);\n\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupRectangle } from '../MarkupRectangle'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     * @constructor\n     */\n    export function CreateRectangle(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-RECTANGLE', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateRectangle.prototype = Object.create(EditAction.prototype);\n    CreateRectangle.prototype.constructor = CreateRectangle;\n\n    var proto = CreateRectangle.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var rectangle = new MarkupRectangle(this.targetId, editor);\n\n        editor.addMarkup(rectangle);\n\n        rectangle.set(this.position, this.size);\n        rectangle.setRotation(this.rotation);\n        rectangle.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateText } from './CreateText'\n\n    /**\n     *\n     * @param editor\n     * @param text\n     * @constructor\n     */\n    export function DeleteText(editor, text) {\n\n        EditAction.call(this, editor, 'DELETE-TEXT', text.id);\n\n        var position = {x: text.position.x, y: text.position.y};\n        var size = {x: text.size.x, y: text.size.y};\n\n        this.createText = new CreateText(\n            editor,\n            text.id,\n            position,\n            size,\n            text.getText(),\n            text.getStyle());\n    }\n\n    DeleteText.prototype = Object.create(EditAction.prototype);\n    DeleteText.prototype.constructor = DeleteText;\n\n    var proto = DeleteText.prototype;\n\n    proto.redo = function() {\n\n        this.createText.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createText.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param size\n     * @param text\n     * @constructor\n     */\n    export function SetCallout(editor, markup, position, size, text, isFrameUsed) {\n\n        EditAction.call(this, editor, 'SET-CALLOUT', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\n        this.newText = text;\n        this.oldText = markup.getText();\n        this.newIsFrameUsed = isFrameUsed;\n        this.oldIsFrameUsed = markup.isFrameUsed;\n    }\n\n    SetCallout.prototype = Object.create(EditAction.prototype);\n    SetCallout.prototype.constructor = SetCallout;\n\n    var proto = SetCallout.prototype;\n\n    proto.redo = function() {\n\n        var callout = this.editor.getMarkup(this.targetId);\n        callout && callout.set(this.newPosition, this.newSize, this.newText, this.newIsFrameUsed);\n    };\n\n    proto.undo = function() {\n\n        var callout = this.editor.getMarkup(this.targetId);\n        callout && callout.set(this.oldPosition, this.oldSize, this.oldText, this.oldIsFrameUsed);\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param width\n     * @param height\n     * @constructor\n     */\n    export function SetSize(editor, markup, position, width, height) {\n\n        EditAction.call(this, editor, 'SET-SIZE', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newWidth = width;\n        this.oldWidth = markup.size.x;\n        this.newHeight = height;\n        this.oldHeight = markup.size.y;\n    }\n\n    SetSize.prototype = Object.create(EditAction.prototype);\n    SetSize.prototype.constructor = SetSize;\n\n    var proto = SetSize.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setSize(this.newPosition, this.newWidth, this.newHeight);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setSize(this.oldPosition, this.oldWidth, this.oldHeight);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newWidth = action.newWidth;\n            this.newHeight = action.newHeight;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        var identity =\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newWidth === this.oldWidth &&\n            this.newHeight === this.oldHeight;\n\n        return identity;\n    };\n","\n'use strict';\n\n/*!\n    Based on Autosize 4.0.0\n    license: MIT\n    http://www.jacklmoore.com/autosize\n*/\nvar map = typeof Map === \"function\" ? new Map() : (function () {\n    var keys = [];\n    var values = [];\n\n    return {\n        has: function has(key) {\n            return keys.indexOf(key) > -1;\n        },\n        get: function get(key) {\n            return values[keys.indexOf(key)];\n        },\n        set: function set(key, value) {\n            if (keys.indexOf(key) === -1) {\n                keys.push(key);\n                values.push(value);\n            }\n        },\n        'delete': function _delete(key) {\n            var index = keys.indexOf(key);\n            if (index > -1) {\n                keys.splice(index, 1);\n                values.splice(index, 1);\n            }\n        }\n    };\n})();\n\nvar createEvent = function createEvent(name) {\n    return new Event(name, { bubbles: true });\n};\ntry {\n    new Event('test');\n} catch (e) {\n    // IE does not support `new Event()`\n    createEvent = function (name) {\n        var evt = document.createEvent('Event');\n        evt.initEvent(name, true, false);\n        return evt;\n    };\n}\n\nfunction assign(ta) {\n    if (!ta || !ta.nodeName || ta.nodeName !== 'TEXTAREA' || map.has(ta)) return;\n\n    var heightOffset = null;\n    var clientWidth = ta.clientWidth;\n    var cachedHeight = null;\n\n    function init() {\n        var style = window.getComputedStyle(ta, null);\n\n        if (style.resize === 'vertical') {\n            ta.style.resize = 'none';\n        } else if (style.resize === 'both') {\n            ta.style.resize = 'horizontal';\n        }\n\n        if (style.boxSizing === 'content-box') {\n            heightOffset = -(parseFloat(style.paddingTop) + parseFloat(style.paddingBottom));\n        } else {\n            heightOffset = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);\n        }\n        // Fix when a textarea is not on document body and heightOffset is Not a Number\n        if (isNaN(heightOffset)) {\n            heightOffset = 0;\n        }\n\n        update();\n    }\n\n    function changeOverflow(value) {\n        {\n            // Chrome/Safari-specific fix:\n            // When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space\n            // made available by removing the scrollbar. The following forces the necessary text reflow.\n            var width = ta.style.width;\n            ta.style.width = '0px';\n            // Force reflow:\n            /* jshint ignore:start */\n            ta.offsetWidth;\n            /* jshint ignore:end */\n            ta.style.width = width;\n        }\n\n        ta.style.overflow = value;\n    }\n\n    function getParentOverflows(el) {\n        var arr = [];\n\n        while (el && el.parentNode && el.parentNode instanceof Element) {\n            if (el.parentNode.scrollTop) {\n                arr.push({\n                    node: el.parentNode,\n                    scrollTop: el.parentNode.scrollTop\n                });\n            }\n            el = el.parentNode;\n        }\n\n        return arr;\n    }\n\n    function resize() {\n        var originalHeight = ta.style.height;\n        var overflows = getParentOverflows(ta);\n        var docTop = document.documentElement && document.documentElement.scrollTop; // Needed for Mobile IE (ticket #240)\n\n        ta.style.height = '';\n\n        var endHeight = ta.scrollHeight + heightOffset;\n\n        if (ta.scrollHeight === 0) {\n            // If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.\n            ta.style.height = originalHeight;\n            return;\n        }\n\n        ta.style.height = endHeight + 'px';\n\n        // used to check if an update is actually necessary on window.resize\n        clientWidth = ta.clientWidth;\n\n        // prevents scroll-position jumping\n        overflows.forEach(function (el) {\n            // This condition is necessary for iOS 11, where you can't assign value to body.scrollTop\n            if (el.node.scrollTop !== el.scrollTop) {\n                el.node.scrollTop = el.scrollTop;\n            }\n        });\n\n        if (docTop) {\n            document.documentElement.scrollTop = docTop;\n        }\n    }\n\n    function update() {\n        resize();\n\n        var styleHeight = Math.round(parseFloat(ta.style.height));\n        var computed = window.getComputedStyle(ta, null);\n\n        // Using offsetHeight as a replacement for computed.height in IE, because IE does not account use of border-box\n        var actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(computed.height)) : ta.offsetHeight;\n\n        // The actual height not matching the style height (set via the resize method) indicates that\n        // the max-height has been exceeded, in which case the overflow should be allowed.\n        if (actualHeight !== styleHeight) {\n            if (computed.overflow === 'hidden') {\n                changeOverflow('scroll');\n                resize();\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\n            }\n        } else {\n            // Normally keep overflow set to hidden, to avoid flash of scrollbar as the textarea expands.\n            if (computed.overflow !== 'hidden') {\n                changeOverflow('hidden');\n                resize();\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\n            }\n        }\n\n        if (cachedHeight !== actualHeight) {\n            cachedHeight = actualHeight;\n            var evt = createEvent('autosize:resized');\n            try {\n                ta.dispatchEvent(evt);\n            } catch (err) {\n                // Firefox will throw an error on dispatchEvent for a detached element\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=889376\n            }\n        }\n    }\n\n    var pageResize = function pageResize() {\n        if (ta.clientWidth !== clientWidth) {\n            update();\n        }\n    };\n\n    var destroy = (function (style) {\n        window.removeEventListener('resize', pageResize, false);\n        ta.removeEventListener('input', update, false);\n        ta.removeEventListener('keyup', update, false);\n        ta.removeEventListener('autosize:destroy', destroy, false);\n        ta.removeEventListener('autosize:update', update, false);\n\n        Object.keys(style).forEach(function (key) {\n            ta.style[key] = style[key];\n        });\n\n        map['delete'](ta);\n    }).bind(ta, {\n        height: ta.style.height,\n        resize: ta.style.resize,\n        overflow: ta.style.overflow,\n        overflowX: ta.style.overflowX,\n        wordWrap: ta.style.wordWrap\n    });\n\n    ta.addEventListener('autosize:destroy', destroy, false);\n\n    // IE9 does not fire onpropertychange or oninput for deletions,\n    // so binding to onkeyup to catch most of those events.\n    // There is no way that I know of to detect something like 'cut' in IE9.\n    if ('onpropertychange' in ta && 'oninput' in ta) {\n        ta.addEventListener('keyup', update, false);\n    }\n\n    window.addEventListener('resize', pageResize, false);\n    ta.addEventListener('input', update, false);\n    ta.addEventListener('autosize:update', update, false);\n    ta.style.overflowX = 'hidden';\n    ta.style.wordWrap = 'break-word';\n\n    map.set(ta, {\n        destroy: destroy,\n        update: update\n    });\n\n    init();\n}\n\nfunction destroy(ta) {\n    var methods = map.get(ta);\n    if (methods) {\n        methods.destroy();\n    }\n}\n\nfunction update(ta) {\n    var methods = map.get(ta);\n    if (methods) {\n        methods.update();\n    }\n}\n\nfunction isRuntimeSupported() {\n    // Don't support Node.js and IE8 (or lower)\n    if (typeof window === 'undefined' || typeof window.getComputedStyle !== 'function')\n        return false;\n    return true;\n}\n\nconst RUNTIME_SUPPORTED = isRuntimeSupported();\n\n\nexport var autosize = function(el, options) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], function (x) {\n            return assign(x, options);\n        });\n    } \n    return el;\n};\n\nautosize.destroy = function(el) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], destroy);\n    }\n    return el;\n}\n\nautosize.update = function(el) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], update);\n    }\n    return el;\n}\n","'use strict';\n\n    /**\n     * Curring object which generate a string that can be used\n     * as a Dom element's 'style' value.\n     *\n     * @constructor\n     */\n    export function DomElementStyle() {\n\n        this.reset();\n    }\n\n    /*\n     * Constants\n     */\n    var BROWSER_PREFIXES = ['-ms-', '-webkit-', '-moz-', '-o-'];\n\n    var proto = DomElementStyle.prototype;\n\n    proto.reset = function() {\n\n        this.attributes = {};\n        this.dirty = false;\n        this.styleString = '';\n\n        return this;\n    };\n\n    /**\n     *\n     * @param {String} key\n     * @param {*} value\n     * @param {Object} [options]\n     * @param {Boolean} [options.allBrowsers] - Whether to add browser prefix to key\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomeElemStyle}\n     */\n    proto.setAttribute = function(key, value, options) {\n\n        this.attributes[key] = value;\n\n        if (options && options.allBrowsers) {\n            var that = this;\n            BROWSER_PREFIXES.forEach(function(prefix){\n                that.attributes[(prefix+key)] = value;\n            });\n        }\n        this.dirty = true; // Could be optimized\n        return this;\n    };\n\n    /**\n     * Removes one or more attributes\n     * @param {String|Array} key - Key or Keys to be removed\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle} this\n     */\n    proto.removeAttribute = function(key) {\n\n        if (!Array.isArray(key)) {\n            key = [key];\n        }\n\n        var self = this;\n        key.forEach(function(k) {\n            if (k in self.attributes) {\n                delete self.attributes[k];\n                self.dirty = true;\n            }\n        });\n        return this;\n    };\n\n    /**\n     * Gets the String representation of this style object\n     * @returns {string}\n     */\n    proto.getStyleString = function() {\n\n        if (this.dirty) {\n            this.styleString = generateStyle(this.attributes);\n            this.dirty = false;\n        }\n        return this.styleString;\n    };\n\n    /**\n     * Clones the current Object\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle}\n     */\n    proto.clone = function() {\n\n        var clone = new DomElementStyle();\n        var attributes = this.attributes;\n\n        for (var key in attributes) {\n            clone.setAttribute(key, attributes[key]);\n        }\n        return clone;\n    };\n\n    /**\n     * Generates the style value string. Non mutable function.\n     *\n     * @param {Object} attributes\n     * @private\n     */\n    function generateStyle(attributes) {\n\n        var elements = [];\n        for (var key in attributes) {\n            var val = attributes[key];\n            elements.push(key);\n            elements.push(':');\n            elements.push(val);\n            elements.push('; ');\n        }\n        return elements.join('');\n    }\n","'use strict';\n\nconst ResizeObserver = require('../../../../thirdparty/resize-observer-polyfill/ResizeObserver.min.js'); // Required for Markup Text Input\nimport { autosize } from './EditorTextAutosize'\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\nimport { cloneStyle } from '../StyleUtils'\nimport { DomElementStyle } from '../DomElementStyle'\n\n    /**\n     * Auxiliary class that handles all input for the Label Markup (MarkupText.js)\n     * It instantiates a TEXTAREA where the user can input text. When user input is\n     * disabled, the textarea gets hidden and further rendering is delegated to\n     * MarkupText.js\n     *\n     * @param {HTMLElement} parentDiv\n     * @param {Object} editor - Core Extension\n     * @constructor\n     */\n    export function EditorTextInput(parentDiv, editor, singleLine, defaultText, maxLength) {\n\n        this.parentDiv = parentDiv;\n        this.editor = editor;\n\n        // Constants\n        this.EVENT_TEXT_CHANGE = 'EVENT_CO2_TEXT_CHANGE';\n        this.EVENT_TEXT_SET_ACTIVE = 'EVENT_CO2_TEXT_SET_ACTIVE';\n        this.EVENT_TEXT_SET_INACTIVE = 'EVENT_CO2_TEXT_SET_INACTIVE';\n\n        // The actual TextArea input\n        if (singleLine) {\n            this.textArea = document.createElement('input');\n            this.textArea.setAttribute('type', 'text');\n        }\n        else {\n            this.textArea = document.createElement('textarea');\n            this.textArea.rows = '1';\n            if (!Autodesk.Viewing.isIE11) { // auto parameter not available in IE11\n                this.textArea.dir = 'auto';\n            }\n        }\n\n        this.firstEdit = true;\n        this.defaultText = defaultText;\n        this.textArea.setAttribute('maxlength', maxLength); // TODO: Make constant? Change value?\n        this.textArea.setAttribute('data-i18n', defaultText);\n        this.startingHeight = 0;\n\n        autosize(this.textArea);\n\n        var ro = new ResizeObserver(function(entries, observer) {\n            this.setEditFrame();\n        }.bind(this));\n\n        ro.observe(this.textArea);\n\n        this.styleTextArea = new DomElementStyle(); // TODO: Move this to EditMode.\n        this.styleTextArea\n                .setAttribute('position', 'absolute')\n                .setAttribute('resize', 'none')\n                .setAttribute('box-sizing', 'border-box')\n                .setAttribute('-moz-box-sizing', 'border-box')\n                .setAttribute('-webkit-box-sizing', 'border-box')\n                .setAttribute('overflow', 'hidden')\n                .setAttribute('outline', 'none')\n                .setAttribute('border', 'none')\n                .setAttribute('z-index', '1')\n                .setAttribute('padding', '10px');\n\n        // Helper div to measure text width\n        this.measureDiv = document.createElement('div');\n\n        // Become an event dispatcher\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = EditorTextInput.prototype;\n\n    proto.destroy = function() {\n\n        this.setInactive();\n    };\n\n    /**\n     * Initializes itself given an Label Markup (textMarkup)\n     * @param {Object} textMarkup\n     * @param {Boolean} firstEdit - Whether the markup is being edited for the first time.\n     */\n    proto.setActive = function(textMarkup, firstEdit) {\n\n        if (this.textMarkup === textMarkup) {\n            return;\n        }\n\n        var placeholderText = Autodesk.Viewing.i18n.translate(this.defaultText);\n        this.textArea.setAttribute('placeholder', placeholderText);\n\n        this.setInactive();\n        this.parentDiv.appendChild(this.textArea);\n        this.textMarkup = textMarkup;\n        this.firstEdit = firstEdit || false;\n\n        this.constrainToCanvas = firstEdit;\n\n        this.initFromMarkup();\n\n        this.constrainToCanvas = false;\n\n        // On iOS this doesn't work quite well, the keyboard will dismiss after call focus programatically.\n        // http://stackoverflow.com/questions/32407185/wkwebview-cant-open-keyboard-for-input-field\n        if (!Autodesk.Viewing.isIOSDevice()) {\n          // Focus on next frame\n          var txtArea = this.textArea;\n          window.requestAnimationFrame(function(){\n              txtArea.focus();\n          });\n        }\n\n        var dataBag = {\n            markup: this.textMarkup,\n            firstEdit: this.firstEdit,\n            isActive: true\n        };\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_ACTIVE, data: dataBag });\n    };\n\n    /**\n     * Closes the editor text input and goes back into normal markup edition mode.\n     */\n    proto.setInactive = function() {\n        var dataBag = {\n            markup: this.textMarkup,\n            isActive: false\n        };\n\n        // In iOS10, the keyboard always show on screen after tap screen out of text\n        // area or save markup to end text edit, call blur to make sure keyboard dismiss.\n        if (Autodesk.Viewing.isIOSDevice())\n        {\n            this.textArea.blur();\n        }\n\n        window.removeEventListener('resize', this.onResizeBinded);\n\n        if (this.textMarkup) {\n            this.textMarkup = null;\n            this.parentDiv.removeChild(this.textArea);\n        }\n        this.style = null;\n\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_INACTIVE, data: dataBag });\n    };\n\n    proto.isActive = function() {\n\n        return !!this.textMarkup;\n    };\n\n    proto.setEditFrame = function() {\n        if (this.editor.editFrame.markup && this.textMarkup && this.editor.editFrame.markup === this.textMarkup) {\n            var frameWidth = parseFloat(this.textArea.style.width);\n            var frameHeight = parseFloat(this.textArea.style.height);\n\n            var position = this.textMarkup.getClientPosition();\n            var rotation = this.textMarkup.getRotation();\n\n            var xPos = position.x - (frameWidth / 2);\n            var yPos = position.y - (this.startingHeight / 2);\n\n            this.editor.editFrame.setSelection(xPos, yPos, frameWidth, frameHeight, rotation);\n        }\n    };\n\n    /**\n     * Applies Markup styles to TextArea used for editing.\n     * It also saves a copy of the style object.\n     * @private\n     */\n    proto.initFromMarkup = function(updateStyleFirst) {\n\n        var markup = this.textMarkup;\n        var position = markup.getClientPosition();\n        var size = markup.getClientSize();\n\n        // Text area padding is relative to the current font size\n        var padding = markup.getClientFontSize() / 2;\n\n        this.startingHeight = size.y;\n\n        var left = position.x - size.x * 0.5;\n        var top = position.y - size.y * 0.5;\n\n        var lineHeightPercentage = markup.lineHeight + \"%\";\n        this.styleTextArea.setAttribute('line-height', lineHeightPercentage);\n        this.styleTextArea.setAttribute('padding', padding + 'px');\n\n        this.setPosAndSize(left, top, size.x, size.y);\n        if (updateStyleFirst) {\n            this.setStyle(markup.getStyle());\n            this.textArea.value = markup.getText();\n        } else {\n            this.textArea.value = markup.getText();\n            this.setStyle(markup.getStyle());\n        }\n    };\n\n    proto.setPosAndSize = function(left, top, width, height) {\n        if (this.constrainToCanvas) {\n            // Check that it doesn't overflow out of the canvas\n            if (left + width >= this.editor.viewer.container.clientWidth) {\n                left = this.editor.viewer.container.clientWidth - (width + 10);\n            }\n            if (top + height >= this.editor.viewer.container.clientHeight) {\n                top = this.editor.viewer.container.clientHeight - (height + 10);\n            }\n\n            // Make sure text input left side always in the canvas area.\n            // Especially on iPhone6 & iPhone7\n            if (left < 5) {\n                left = 5;\n                width = this.editor.viewer.container.clientWidth - 10;\n            }\n        }\n\n        this.styleTextArea\n            // Size and position\n            .setAttribute('left', left + 'px')\n            .setAttribute('top', top + 'px')\n            .setAttribute('width', width + 'px')\n            .setAttribute('height', height + 'px');\n    };\n\n    proto.setStyle = function(style) {\n\n        if (this.style) {\n            // An already present style means that the user\n            // has changed the style using the UI buttons.\n            // We need to account for the user having changed the\n            // width/height of the TextArea. Since there is no event\n            // we can detect for it, we do it here.\n            var temp = {};\n            this.injectSizeValues(temp);\n            this.setPosAndSize(\n                temp.newPos.x - temp.width * 0.5,\n                temp.newPos.y - temp.height * 0.5,\n                temp.width, temp.height);\n        }\n        var fontHeight = this.editor.sizeFromMarkupsToClient(0, style['font-size']).y;\n        var strokeWidth = this.editor.sizeFromMarkupsToClient(0, style['stroke-width']).y;\n        var textAreaStyle = this.styleTextArea\n            // Visuals\n            .setAttribute('color', style['stroke-color'])\n            .setAttribute('outline', strokeWidth + 'px solid ' + style['stroke-color'])\n            .setAttribute('font-family', style['font-family'])\n            .setAttribute('font-size', fontHeight + 'px')\n            .setAttribute('font-weight', style['font-weight'])\n            .setAttribute('font-style', style['font-style'])\n            .getStyleString();\n        this.textArea.setAttribute('style', textAreaStyle);\n        this.style = cloneStyle(style);\n        autosize.update(this.textArea);\n    };\n\n    /**\n     * Helper function that, for a given markup with some text in it\n     * returns an Array of lines in it.\n     * @param {Object} markup\n     * @returns {{text, lines}|{text: String, lines: Array.<String>}}\n     */\n    proto.getTextValuesForMarkup = function(markup, sizeUpdateRequired) {\n        var active = this.isActive();\n        var activeMarkup = this.textMarkup;\n        var activeFirstEdit = this.firstEdit;\n\n        this.setActive(markup, false);\n        var textValues = this.getTextValues();\n\n        var dataBag = {\n            markup: markup,\n            textValues: textValues\n        };\n\n        if (active) {\n            this.setActive(activeMarkup, activeFirstEdit);\n        } else {\n            if (sizeUpdateRequired) {\n                this.injectSizeValues(dataBag);\n            }\n\n            this.setInactive();\n        }\n\n        return dataBag;\n    };\n\n    /**\n     * Returns the current text as one string and an array of lines\n     * of how the text is being rendered (1 string per line)\n     * @returns {{text: String, lines: Array.<String>}}\n     */\n    proto.getTextValues = function() {\n\n        var newText = this.textArea.value;\n        if (newText === this.defaultText) {\n            newText = '';\n        }\n        return {\n            text: newText,\n            lines: this.generateLines()\n        };\n    };\n\n    /**\n     * Function called by UI\n     */\n    proto.acceptAndExit = function() {\n\n        // If placeholder text, then remove.\n        var textValues = this.getTextValues();\n        var textMarkup = this.textMarkup;\n\n        var dataBag = {\n            markup: this.textMarkup,\n            style: this.style,\n            firstEdit: this.firstEdit,\n            newText: textValues.text,\n            newLines: textValues.lines\n        };\n        this.injectSizeValues(dataBag);\n\n        this.dispatchEvent({ type: this.EVENT_TEXT_CHANGE, data: dataBag });\n        this.setInactive();\n        textMarkup.updateStyle(true); // Hack: LMV-3628\n    };\n\n    /**\n     * Injects position, width and height of the textarea rect\n     * @param {Object} dataBag\n     * @private\n     */\n    proto.injectSizeValues = function(dataBag) {\n\n        // Explicit usage of parseFloat to remove the 'px' suffix.\n        var width = parseFloat(this.textArea.style.width);\n        var height = parseFloat(this.textArea.style.height);\n        var ox = parseFloat(this.textArea.style.left);\n        var oy = parseFloat(this.textArea.style.top);\n\n        dataBag.width = width;\n        dataBag.height = height;\n        dataBag.newPos = {\n            x: ox + (width * 0.5),\n            y: oy + (height * 0.5)\n        };\n    };\n\n    /**\n     * Handler for when the camera moves\n     * @param {Object} event - Camera moves event\n     * @private\n     */\n    proto.onCameraChanged = function(event) {\n        var str = this.textArea.value;\n        this.textMarkup.style = cloneStyle(this.style);\n        this.style = null; // TODO: Revisit this code because style changes are lost by doing this.\n        this.initFromMarkup(true);\n        this.textArea.value = str;\n        this.setEditFrame();\n    };\n\n    /**\n     * Grabs the text content of the textarea and returns\n     * an Array of lines.  Wrapped lines are returned as 2 lines.\n     */\n    proto.generateLines = function() {\n\n        // First, get lines separated by line breaks:\n        var textContent = this.textArea.value;\n        var linesBreaks = textContent.split(/\\r*\\n/);\n\n        var styleMeasureStr = this.styleTextArea.clone()\n            .removeAttribute(['top', 'left', 'width', 'height'])\n            .setAttribute('position','absolute')\n            .setAttribute('white-space','nowrap')\n            .setAttribute('float','left')\n            .setAttribute('visibility','hidden')\n            .getStyleString();\n        this.measureDiv.setAttribute('style', styleMeasureStr);\n        this.parentDiv.appendChild(this.measureDiv);\n\n        var maxLineLength = this.textArea.clientWidth - (2 * parseFloat(this.textArea.style.padding));\n\n        // Now check whether the lines are wrapped.\n        // If so, subdivide into other lines.\n        var linesOutput = [];\n\n        for (var i= 0, len = linesBreaks.length; i<len; ++i) {\n            var line = trimRight(linesBreaks[i]);\n\n            // Add a space in an empty line so it appears in the lines output\n            line = (line === '') ? ' ' : line;\n            this.splitLine(line, maxLineLength, linesOutput);\n        }\n\n        this.parentDiv.removeChild(this.measureDiv);\n        return linesOutput;\n    };\n\n    /**\n     * Given a String that represents one line of text that is\n     * longer than the max length a line is allowed, this method\n     * cuts text into several ones that are no longer than the max\n     * length.\n     *\n     * @param {String} text\n     * @param {Number} maxLength\n     * @param {Array} output\n     * @private\n     */\n    proto.splitLine = function(text, maxLength, output) {\n\n        // End condition\n        if (text === '') {\n            return;\n        }\n\n        var remaining = '';\n        var done = false;\n\n        while (!done){\n            this.measureDiv.innerText = text;\n            var lineLen = this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\n            if (lineLen <= maxLength) {\n                output.push(text);\n                this.splitLine(trimLeft(remaining), maxLength, output);\n                done = true;\n            } else {\n                // Need to try with a shorter word!\n                var parts = this.getShorterLine(text);\n                if (parts.length === 1) {\n                    // text is only one word that is way too long.\n                    this.splitWord(text, remaining, maxLength, output);\n                    done = true;\n                } else {\n                    text = parts[0];\n                    remaining = parts[1] + remaining;\n                }\n            }\n        }\n    };\n\n    /**\n     * Given a line of text such as \"hi there programmer\", it returns\n     * an array with 2 parts: [\"hi there\", \" programmer\"].\n     *\n     * It accounts for special cases with multi-spaces, such as for\n     * \"hi there  two-spaces\" returns [\"hi there\", \"  two-spaces\"]\n     *\n     * When there is only one word, it returns the whole word:\n     * \"JustOneWord\" returns [\"JustOneWord\"] (an array of 1 element)\n     *\n     * @param {String} line\n     * @returns {Array}\n     */\n    proto.getShorterLine = function(line) {\n\n        // TODO: Account for TABs\n        // Will probably never do unless a bug is reported.\n\n        var iLastSpace = line.lastIndexOf(' ');\n        if (iLastSpace === -1) {\n            return [line]; // This is a single word\n        }\n\n        // Else\n        // Iterate back removing additional spaces (multi spaces)\n        while (line.charAt(iLastSpace-1) === ' ') {\n            iLastSpace--\n        }\n\n        var trailingWord = line.substr(iLastSpace); // Contains the spaces\n        var shorterLine = line.substr(0,iLastSpace);\n        return [shorterLine, trailingWord];\n    };\n\n    /**\n     * Given a single word, splits it into multiple lines that fits in maxWidth\n     * @param {String} word\n     * @param {String} remaining\n     * @param {Number} maxLength\n     * @param {Array} output\n     */\n    proto.splitWord = function(word, remaining, maxLength, output) {\n\n        var lenSoFar = 1;\n        var fits = true;\n        while (fits) {\n\n            var part = word.substr(0,lenSoFar);\n            this.measureDiv.innerText = part;\n            var lineLen =  this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\n\n            if (lineLen > maxLength) {\n\n                if (lenSoFar === 1) {\n                    // we can't split 1 character any longer.\n                    output.push(part);\n                    this.splitWord(word.substr(1), remaining, maxLength, output);\n                    return;\n                }\n\n                // It was fine until one less char //\n                var okayWord = word.substr(0,lenSoFar-1);\n                output.push(okayWord);\n                var extraWord = word.substr(lenSoFar-1);\n                this.splitLine(extraWord + remaining, maxLength, output);\n                return;\n            }\n\n            // Try one more character\n            lenSoFar++;\n\n            // Check if we are done with all characters\n            if (lenSoFar > word.length) {\n                // Okay it fits\n                output.push(word);\n                return;\n            }\n        }\n    };\n\n    function trimRight(text) {\n        if (text.length === 0) {\n            return \"\";\n        }\n        var lastNonSpace = text.length-1;\n        for (var i=lastNonSpace; i>=0; --i) {\n            if (text.charAt(i) !== ' ') {\n                lastNonSpace = i;\n                break;\n            }\n        }\n        return text.substr(0, lastNonSpace+1);\n    }\n\n    function trimLeft(text) {\n        if (text.length === 0) {\n            return \"\";\n        }\n        var firstNonSpace = 0;\n        for (var i=0; i<text.length; ++i) {\n            if (text.charAt(i) !== ' ') {\n                firstNonSpace = i;\n                break;\n            }\n        }\n        return text.substr(firstNonSpace);\n    }\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\nimport { CreateCallout } from '../edit-actions/CreateCallout'\nimport { SetCallout } from '../edit-actions/SetCallout'\nimport { SetStyle } from '../edit-actions/SetStyle'\nimport { SetSize } from '../edit-actions/SetSize'\nimport * as MarkupTypes from '../MarkupTypes'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditorTextInput } from './EditorTextInput'\n\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeCallout(editor) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-width',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CALLOUT, styleAttributes);\n\n        this.style['fill-opacity'] = 1.0;\n        this.style['fill-color'] = '#ffffff';\n\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 360);\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\n\n        this.textInputHelper = helper;\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n        this.minSize = 0; // No need to size it initially\n        this.creationMethod = this.CREATION_METHOD_CLICK;\n    }\n\n    EditModeCallout.prototype = Object.create(EditMode.prototype);\n    EditModeCallout.prototype.constructor = EditModeCallout;\n\n    var proto = EditModeCallout.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type === this.type) {\n            var deleteCallout = new DeleteCallout(this.editor, markup);\n            deleteCallout.addToHistory = !cantUndo;\n            deleteCallout.execute();\n            return true;\n        }\n        return false;\n    };\n\n    proto.setStyle = function(style) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n\n            this.textInputHelper.setStyle(style);\n        } else {\n            EditMode.prototype.setStyle.call(this, style);\n        }\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n        EditMode.prototype.destroy.call(this);\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     */\n    proto.onMouseDown = function() {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n        var initialWidth = clientFontSize * STARTING_WIDTH_FACTOR; // Find better way to initialize size.\n        var initialHeight = clientFontSize * 1;\n\n        // Center position.\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\n        var position = editor.positionFromClientToMarkups(\n            mousePosition.x + (initialWidth * 0.5),\n            mousePosition.y + (initialHeight * 0.5));\n\n        this.creationBegin();\n        editor.beginActionGroup();\n\n        // Given the initial width and font size, we assume that the text fits in one line.\n        var createCallout = new CreateCallout(\n            editor,\n            editor.getId(),\n            position,\n            size,\n            '',\n            this.style,\n            true);\n\n        createCallout.execute();\n        this.creationEnd();\n\n        this.selectedMarkup = editor.getMarkup(createCallout.targetId);\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n    };\n\n    proto.onMouseUp = function(event) {\n\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(markup);\n            this.editor.editFrame.setMarkup(markup);\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\n        }\n    };\n\n    proto.onHelperSetActive = function(event) {\n        var databag = event.data;\n        var markup = databag.markup;\n        if (markup) {\n            markup.setIsHelperTextActive(databag.isActive);\n            markup.setIsShapeVisible(!databag.isActive);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var textMarkup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var curSelection = this.selectedMarkup;\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n        // Deal with edge case first: Creating a Label without text\n        if (dataBag.newText === '') {\n            this.editor.cancelActionGroup();\n\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\n            deleteCallout.execute();\n\n            if (textMarkup !== curSelection) {\n                this.editor.selectMarkup(curSelection);\n            }\n\n            return;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateCallout action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            this.editor.beginActionGroup();\n        }\n\n        // Size change action //\n        var position = this.editor.positionFromClientToMarkups(\n            dataBag.newPos.x, dataBag.newPos.y\n        );\n        var size = this.editor.sizeFromClientToMarkups(\n            dataBag.width, dataBag.height\n        );\n        var setSize = new SetSize(\n            this.editor,\n            textMarkup,\n            position,\n            size.x,\n            size.y);\n        setSize.execute();\n\n        // Text change action //\n        var setCallout = new SetCallout(\n            this.editor,\n            textMarkup,\n            textMarkup.position,\n            textMarkup.size,\n            dataBag.newText,\n            textMarkup.isFrameUsed);\n        setCallout.execute();\n\n        var setStyle = new SetStyle(\n            this.editor,\n            textMarkup,\n            textStyle\n        );\n        setStyle.execute();\n\n        // However, we do need to close the action group at this point. For both cases.\n        this.editor.closeActionGroup();\n        this.editor.selectMarkup(curSelection);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            var firstEdit = this.textInputHelper.firstEdit;\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n\n            // Close action group if open (first edit).\n            if (firstEdit) {\n                this.editor.cancelActionGroup();\n            }\n\n            this.editor.selectMarkup(null);\n            this.selectedMarkup = null;\n        }\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupTextSvg, createMarkupPathSvg, createMarkupGroupSvg,\n    composeRGBAString, setAttributeToMarkupSvg, setMarkupTextSvgTransform,\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, updateMarkupPathSvgHitarea,\n    createSvgElement, addMarkupMetadata, radiansToDegrees, createRectanglePath,\n    EDIT_FRAME_DEFAULT_MARGIN } from './MarkupsCoreUtils'\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils'\nimport { EditModeCallout } from './edit-modes/EditModeCallout'\n\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\n    var FONT_SIZE_SCALE = 100;\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     * Callout Markup.\n     * @constructor\n     */\n    export function MarkupCallout(id, editor, size) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-width',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n\n        Markup.call(this, id, editor, styleAttributes);\n        this.type = MarkupTypes.MARKUP_TYPE_CALLOUT;\n        this.textShape = createMarkupTextSvg();\n        this.rectShape = createMarkupPathSvg();\n        this.shape = createMarkupGroupSvg([this.rectShape, this.textShape]);\n        this.isFrameUsed = true;\n        this.constraintRotation = true;\n        this.constraintHeight = true;\n        this.constraintWidth = false;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.currentText = \"\";\n        this.currentTextLines = [\"\"];\n        this.prevHighlight = false;\n        this.isHelperTextActive = false;\n\n        // Note: We could have this property be a style property.\n        // However, there is no need for this property to be exposed to the user for alteration\n        // This value is a percentage of the font size used to offset vertically 2 text lines\n        // of the same paragraph.\n        // Notice that this value is used by EditorTextInput.js\n        this.lineHeight = 130;\n\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\n\n        this.bindDomEvents();\n    }\n\n    MarkupCallout.prototype = Object.create(Markup.prototype);\n    MarkupCallout.prototype.constructor = MarkupCallout;\n\n    var proto = MarkupCallout.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCallout(this.editor);\n    };\n\n    /**\n     *\n     * @param {Object} position\n     * @param {Object} size\n     * @param {String} textString\n     */\n    proto.set = function(position, size, textString, isFrameUsed) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.setIsFilledFrameUsed(isFrameUsed);\n        this.setText(textString);\n    };\n\n    proto.setSize = function(position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        var sizeUpdateRequired = true;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle(sizeUpdateRequired);\n        }\n    };\n\n    proto.setPosition = function(x, y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle();\n        }\n    };\n\n    proto.setStyle = function(style) {\n        var stylesEqual = isStyleEqual(style, this.style);\n\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    };\n\n    proto.setText = function(text) {\n\n        this.currentText = text;\n    };\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        return this.currentText;\n    };\n\n    /**\n     * Returns a shallow copy of the text lines used for rendering SVG text\n     * @returns {Array.<String>}\n     */\n    proto.getTextLines = function() {\n\n        return this.currentTextLines.concat();\n    };\n\n    proto.highlightChanged = function() {\n\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\n            var rect = this.rectShape;\n            var text = this.textShape;\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\n\n            if (this.isFrameUsed) {\n                setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\n            }\n\n            this.prevHighlight = true;\n            return false;\n        }\n\n        return true;\n    };\n\n    proto.updateTextBoxStyle = function() {\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n        }\n\n        editMode.updateTextBoxStyle();\n    };\n\n    proto.setIsHelperTextActive = function(isActive) {\n        this.isHelperTextActive = isActive;\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function(sizeUpdateRequired) {\n\n        if (this.highlightChanged()) {\n            this.prevHighlight = false;\n            var style = this.style;\n            var rect = this.rectShape;\n            var text = this.textShape;\n            var fontSize = this.style['font-size'];\n            var fontFamily = this.style['font-family'];\n            var fontWeight = this.style['font-weight'];\n            var fontStyle =  this.style['font-style'];\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            var strokeWidth = this.style['stroke-width'];\n\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\n\n            this.rebuildTextSvg(sizeUpdateRequired);\n\n            var editor = this.editor;\n            var textContainerTransform = this.getTextContainerTransform();\n            var textTransform = this.getTextTransform();\n\n            setAttributeToMarkupSvg(text, 'font-family', fontFamily);\n            setAttributeToMarkupSvg(text, 'font-size', fontSize * FONT_SIZE_SCALE);\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\n            setAttributeToMarkupSvg(text, 'font-weight', fontWeight);\n            setAttributeToMarkupSvg(text, 'font-style', fontStyle);\n\n            setMarkupTextSvgTransform(text, textContainerTransform, textTransform);\n            updateMarkupTextSvgClipper(text, this.size.x, this.size.y);\n            updateMarkupTextSvgHitarea(text, this.size.x, this.size.y, editor);\n\n            var path = this.getPath().join(' ');\n            var transform = this.getTransform();\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n\n            setAttributeToMarkupSvg(rect, 'd', path);\n            setAttributeToMarkupSvg(rect, 'stroke-width', strokeWidth);\n            setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\n            setAttributeToMarkupSvg(rect, 'transform', transform);\n            setAttributeToMarkupSvg(rect, 'fill', fillColor);\n            updateMarkupPathSvgHitarea(rect, editor);\n        }\n    };\n\n    /**\n     * Re-creates SVG tags that render SVG text.\n     * Each line is placed around tspan tags which are vertically offset to each other.\n     */\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\n\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\n        // editMode needs to be set to load markups in view mode\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n            editMode.textInputHelper.textArea.value = this.currentText;\n            editMode.textInputHelper.setStyle(this.style);\n        }\n\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\n            return;\n        }\n\n        var style = cloneStyle(editMode.textInputHelper.style);\n        var text = editMode.textInputHelper.textArea.value;\n\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\n\n        this.currentTextLines = textHelperValues.textValues.lines;\n\n        if (textHelperValues.newPos) {\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\n\n            this.position.x = position.x;\n            this.position.y = position.y;\n            this.size.x = size.x;\n            this.size.y = size.y;\n        }\n\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\n            editMode.textInputHelper.textArea.value = text;\n            editMode.textInputHelper.setStyle(style);\n        }\n\n        var markup = createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        this.textShape.childNodes[0].removeChild(this.textShape.markup);\n        this.textShape.childNodes[0].appendChild(markup);\n        this.textShape.markup = markup;\n\n        // For each line, create a tspan, add as child and offset it vertically.\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\n\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\n        var dx = padding;\n        var dy = padding;\n\n        this.currentTextLines.forEach(function(line){\n\n            var tspan = createSvgElement('tspan');\n\n            tspan.setAttribute('x', dx);\n            tspan.setAttribute('y', dy);\n            tspan.textContent = line;\n\n            markup.appendChild(tspan);\n            dy += yOffset;\n        }.bind(this));\n    };\n\n    proto.setIsFilledFrameUsed = function(isFrameUsed) {\n\n        this.isFrameUsed = isFrameUsed;\n\n        var hasRectShape = this.rectShape.parentNode === this.shape;\n        if (isFrameUsed && !hasRectShape) {\n            this.shape.insertBefore(this.rectShape, this.shape.firstChild);\n        } else if (!isFrameUsed && hasRectShape) {\n            this.shape.removeChild(this.rectShape);\n        }\n    };\n\n    proto.setIsFilledFrameVisible = function(isVisible) {\n\n        this.rectShape.markup.style.display = (isVisible && this.isFrameUsed) ? 'block' : 'none';\n    };\n\n    proto.setIsShapeVisible = function(isVisible) {\n\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\n    };\n\n    proto.setMetadata = function() {\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.text = String(this.currentText);\n        metadata.isframeused = this.isFrameUsed ? 1 : 0;\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.getLineHeight = function() {\n        return this.style['font-size'];\n    };\n\n    proto.getTextContainerTransform = function() {\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(1,-1)'\n        ].join(' ');\n    };\n\n    proto.getTextTransform = function() {\n\n        var lineHeight = this.getLineHeight();\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\n        ].join(' ');\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.textShape = createMarkupTextSvg();\n        clone.rectShape = createMarkupPathSvg();\n        clone.shape = createMarkupGroupSvg([clone.rectShape, clone.textShape]);\n        clone.bindDomEvents();\n    };\n\n    proto.getPath = function() {\n        var strokeWidth = this.style['stroke-width'];\n\n        var w = this.size.x + strokeWidth;\n        var h = this.size.y + strokeWidth;\n        var x = -w * 0.5;\n        var y = -h * 0.5;\n\n        var path = [];\n        createRectanglePath(x, y, w, h, false, path);\n\n        return path;\n    };\n\n    proto.getBoundingRect = function() {\n\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        var strokeWidth = this.style['stroke-width'];\n        var width = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\n        var margin = width + EDIT_FRAME_DEFAULT_MARGIN;\n\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y,\n            margin: margin\n        }\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupCallout } from '../MarkupCallout'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param text\n     * @param style\n     * @constructor\n     */\n    export function CreateCallout(editor, id, position, size, text, style, isFrameUsed) {\n\n        EditAction.call(this, editor, 'CREATE-CALLOUT', id);\n\n        this.text = text;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.style = cloneStyle(style);\n        this.isFrameUsed = isFrameUsed;\n    }\n\n    CreateCallout.prototype = Object.create(EditAction.prototype);\n    CreateCallout.prototype.constructor = CreateCallout;\n\n    var proto = CreateCallout.prototype;\n\n    proto.redo = function () {\n\n        var editor = this.editor;\n        var position = this.position;\n        var size = this.size;\n\n        var callout = new MarkupCallout(this.targetId, editor, size);\n\n        editor.addMarkup(callout);\n\n        callout.setIsFilledFrameUsed(this.isFrameUsed);\n        callout.setText(this.text);\n        callout.setSize(position, size.x, size.y);\n        callout.setStyle(this.style);\n    };\n\n    proto.undo = function () {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        if (markup) {\n            this.editor.removeMarkup(markup);\n            markup.destroy();\n        }\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateCallout } from './CreateCallout'\n\n    /**\n     *\n     * @param editor\n     * @param text\n     * @constructor\n     */\n    export function DeleteCallout(editor, callout) {\n\n        EditAction.call(this, editor, 'DELETE-CALLOUT', callout.id);\n\n        var position = {x: callout.position.x, y: callout.position.y};\n        var size = {x: callout.size.x, y: callout.size.y};\n\n        this.createCallout = new CreateCallout(\n            editor,\n            callout.id,\n            position,\n            size,\n            callout.getText(),\n            callout.getStyle(),\n            callout.isFrameUsed);\n    }\n\n    DeleteCallout.prototype = Object.create(EditAction.prototype);\n    DeleteCallout.prototype.constructor = DeleteCallout;\n\n    var proto = DeleteCallout.prototype;\n\n    proto.redo = function() {\n\n        this.createCallout.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCallout.redo();\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param size\n     * @param text\n     * @constructor\n     */\n    export function SetText(editor, markup, position, size, text) {\n\n        EditAction.call(this, editor, 'SET-TEXT', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\n        this.newText = text;\n        this.oldText = markup.getText();\n    }\n\n    SetText.prototype = Object.create(EditAction.prototype);\n    SetText.prototype.constructor = SetText;\n\n    var proto = SetText.prototype;\n\n    proto.redo = function() {\n\n        var text = this.editor.getMarkup(this.targetId);\n        text && text.set(this.newPosition, this.newSize, this.newText);\n    };\n\n    proto.undo = function() {\n\n        var text = this.editor.getMarkup(this.targetId);\n        text && text.set(this.oldPosition, this.oldSize, this.oldText);\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteText } from '../edit-actions/DeleteText'\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\nimport { CreateText } from '../edit-actions/CreateText'\nimport { SetText } from '../edit-actions/SetText'\nimport { SetSize } from '../edit-actions/SetSize'\nimport { SetStyle } from '../edit-actions/SetStyle'\nimport * as MarkupTypes from '../MarkupTypes'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditorTextInput } from './EditorTextInput'\n\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeText(editor) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_TEXT, styleAttributes);\n\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 260);\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\n\n        this.textInputHelper = helper;\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n        this.minSize = 0; // No need to size it initially\n        this.creationMethod = this.CREATION_METHOD_CLICK;\n    }\n\n    EditModeText.prototype = Object.create(EditMode.prototype);\n    EditModeText.prototype.constructor = EditModeText;\n\n    var proto = EditModeText.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteText = new DeleteText(this.editor, markup);\n            deleteText.addToHistory = !cantUndo;\n            deleteText.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @param style\n     */\n    proto.setStyle = function(style) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n\n            this.textInputHelper.setStyle(style);\n        } else {\n            EditMode.prototype.setStyle.call(this, style);\n        }\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n        EditMode.prototype.destroy.call(this);\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     */\n    proto.onMouseDown = function() {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n        var initialWidth = clientFontSize * 15; // Find better way to initialize size.\n        var initialHeight = clientFontSize * 1;\n\n        // Center position.\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\n        var position = editor.positionFromClientToMarkups(\n            mousePosition.x + (initialWidth * 0.5),\n            mousePosition.y + (initialHeight * 0.5));\n\n        this.creationBegin();\n        editor.beginActionGroup();\n\n        // Given the initial width and font size, we assume that the text fits in one line.\n        var createText = new CreateText(\n            editor,\n            editor.getId(),\n            position,\n            size,\n            '',\n            this.style);\n\n        createText.execute();\n        this.creationEnd();\n\n        this.selectedMarkup = editor.getMarkup(createText.targetId);\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n\n    proto.onMouseUp = function(event) {\n\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(markup);\n            this.editor.editFrame.setMarkup(markup);\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\n        }\n    };\n\n    proto.onHelperSetActive = function(event) {\n        var databag = event.data;\n        var markup = databag.markup;\n        if (markup) {\n            markup.setIsHelperTextActive(databag.isActive);\n            markup.setIsShapeVisible(!databag.isActive);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var textMarkup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var curSelection = this.selectedMarkup;\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n        // Deal with edge case first: Creating a Label without text\n        if (dataBag.newText === '') {\n            this.editor.cancelActionGroup();\n\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\n            deleteCallout.execute();\n\n            if (textMarkup !== curSelection) {\n                this.editor.selectMarkup(curSelection);\n            }\n\n            return;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateText action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            this.editor.beginActionGroup();\n        }\n\n        // Size change action //\n        var position = this.editor.positionFromClientToMarkups(\n            dataBag.newPos.x, dataBag.newPos.y\n        );\n        var size = this.editor.sizeFromClientToMarkups(\n            dataBag.width, dataBag.height\n        );\n        var setSize = new SetSize(\n            this.editor,\n            textMarkup,\n            position,\n            size.x,\n            size.y);\n        setSize.execute();\n\n        // Text change action //\n        var setText = new SetText(\n            this.editor,\n            textMarkup,\n            textMarkup.position,\n            textMarkup.size,\n            dataBag.newText);\n        setText.execute();\n\n        var setStyle = new SetStyle(\n            this.editor,\n            textMarkup,\n            textStyle\n        );\n        setStyle.execute();\n\n        // However, we do need to close the action group at this point. For both cases.\n        this.editor.closeActionGroup();\n        this.editor.selectMarkup(curSelection);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            var firstEdit = this.textInputHelper.firstEdit;\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n\n            // Close action group if open (first edit).s\n            if (firstEdit) {\n                this.editor.cancelActionGroup();\n            }\n\n            this.editor.selectMarkup(null);\n            this.selectedMarkup = null;\n        }\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { composeRGBAString, setAttributeToMarkupSvg, addMarkupMetadata, radiansToDegrees,\n    createMarkupTextSvg, setMarkupTextSvgTransform, updateMarkupTextSvgBackground,\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, createSvgElement } from './MarkupsCoreUtils'\nimport { cloneStyle, isStyleEqual, copyStyle } from './StyleUtils'\nimport { EditModeText } from './edit-modes/EditModeText'\n\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\n    var FONT_SIZE_SCALE = 100;\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     * Text Markup.\n     * @constructor\n     */\n    export function MarkupText(id, editor, size) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_TEXT;\n        this.shape = createMarkupTextSvg();\n        this.constraintRotation = true;\n        this.constraintHeight = true;\n        this.constraintWidth = false;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.currentText = \"\";\n        this.currentTextLines = [\"\"];\n        this.textDirty = true;\n        this.textSize = {x: 0, y: 0};\n        this.prevHighlight = false;\n        this.isHelperTextActive = false;\n\n        // Note: We could have this property be a style property.\n        // However, there is no need for this property to be exposed to the user for alteration\n        // This value is a percentage of the font size used to offset vertically 2 text lines\n        // of the same paragraph.\n        // Notice that this value is used by EditorTextInput.js\n        this.lineHeight = 130;\n\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\n\n        this.bindDomEvents();\n    }\n\n    MarkupText.prototype = Object.create(Markup.prototype);\n    MarkupText.prototype.constructor = MarkupText;\n\n    var proto = MarkupText.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeText(this.editor);\n    };\n\n    /**\n     *\n     * @param {String} position\n     * @param {String} size\n     * @param {String} textString\n     */\n    proto.set = function(position, size, textString) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n\n        this.setText(textString);\n    };\n\n    proto.setSize = function(position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        var sizeUpdateRequired = true;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle(sizeUpdateRequired);\n        }\n    };\n\n    proto.setPosition = function(x, y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle();\n        }\n    };\n\n    proto.setStyle = function(style) {\n\n        var stylesEqual = isStyleEqual(style, this.style);\n\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    };\n\n    /**\n     *\n     * @param {String} text\n     */\n    proto.setText = function(text) {\n\n        this.currentText = text;\n    };\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        return this.currentText;\n    };\n\n    /**\n     * Returns a shallow copy of the text lines used for rendering SVG text\n     * @returns {Array.<String>}\n     */\n    proto.getTextLines = function() {\n\n        return this.currentTextLines.concat();\n    };\n\n    proto.highlightChanged = function() {\n\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\n            var shape = this.shape;\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n\n            this.prevHighlight = true;\n            return false;\n        }\n\n        return true;\n    };\n\n    proto.updateTextBoxStyle = function() {\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n        }\n\n        editMode.updateTextBoxStyle();\n    };\n\n    proto.setIsHelperTextActive = function(isActive) {\n        this.isHelperTextActive = isActive;\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function(sizeUpdateRequired) {\n\n        if (this.highlightChanged()) {\n            this.prevHighlight = false;\n            var style = this.style;\n            var shape = this.shape;\n            var fontSize = this.style['font-size'];\n            var fontFamily = this.style['font-family'];\n            var fontWeight = this.style['font-weight'];\n            var fontStyle = this.style['font-style'];\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\n\n            this.rebuildTextSvg(sizeUpdateRequired);\n\n            setAttributeToMarkupSvg(shape, 'font-family', fontFamily);\n            setAttributeToMarkupSvg(shape, 'font-size', fontSize * FONT_SIZE_SCALE);\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n            setAttributeToMarkupSvg(shape, 'font-weight', fontWeight);\n            setAttributeToMarkupSvg(shape, 'font-style', fontStyle);\n\n            var editor = this.editor;\n            var transform = this.getTransform();\n            var textTransform = this.getTextTransform();\n\n            setMarkupTextSvgTransform(shape, transform, textTransform);\n            updateMarkupTextSvgBackground(shape, this.size.x, this.size.y, fillColor);\n            updateMarkupTextSvgClipper(shape, this.size.x, this.size.y);\n            updateMarkupTextSvgHitarea(shape, this.size.x, this.size.y, editor);\n        }\n    };\n\n    /**\n     * Re-creates SVG tags that render SVG text.\n     * Each line is placed around tspan tags which are vertically offset to each other.\n     */\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\n\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\n        // editMode needs to be set to load markups in view mode\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n            editMode.textInputHelper.textArea.value = this.currentText;\n            editMode.textInputHelper.setStyle(this.style);\n        }\n\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\n            return;\n        }\n\n        var style = cloneStyle(editMode.textInputHelper.style);\n        var text = editMode.textInputHelper.textArea.value;\n\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\n\n        this.currentTextLines = textHelperValues.textValues.lines;\n\n        if (textHelperValues.newPos) {\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\n\n            this.position.x = position.x;\n            this.position.y = position.y;\n            this.size.x = size.x;\n            this.size.y = size.y;\n        }\n\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\n            editMode.textInputHelper.textArea.value = text;\n            editMode.textInputHelper.setStyle(style);\n        }\n\n        var markup = createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        this.shape.childNodes[0].removeChild(this.shape.markup);\n        this.shape.childNodes[0].appendChild(markup);\n        this.shape.markup = markup;\n\n        // For each line, create a tspan, add as child and offset it vertically.\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\n\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\n        var dx = padding;\n        var dy = padding;\n\n        this.currentTextLines.forEach(function(line){\n\n            var tspan = createSvgElement('tspan');\n\n            tspan.setAttribute('x', dx);\n            tspan.setAttribute('y', dy);\n            tspan.textContent = line;\n\n            markup.appendChild(tspan);\n            dy += yOffset;\n        }.bind(this));\n    };\n\n    proto.setIsShapeVisible = function(isVisible) {\n\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.text = String(this.currentText);\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.getLineHeight = function() {\n\n        return this.style['font-size'];\n    };\n\n    proto.getTransform = function() {\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(1,-1)'\n        ].join(' ');\n    };\n\n    proto.getTextTransform = function() {\n\n        var lineHeight = this.getLineHeight();\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\n        ].join(' ');\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape = createMarkupTextSvg();\n        clone.bindDomEvents();\n    };\n\n    proto.getBoundingRect = function() {\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y\n        }\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupText } from '../MarkupText'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param text\n     * @param style\n     * @constructor\n     */\n    export function CreateText(editor, id, position, size, text, style ) {\n\n        EditAction.call(this, editor, 'CREATE-TEXT', id);\n\n        this.text = text;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.style = cloneStyle(style);\n    }\n\n    CreateText.prototype = Object.create(EditAction.prototype);\n    CreateText.prototype.constructor = CreateText;\n\n    var proto = CreateText.prototype;\n\n    proto.redo = function () {\n\n        var editor = this.editor;\n        var position = this.position;\n        var size = this.size;\n\n        var text = new MarkupText(this.targetId, editor, size);\n\n        editor.addMarkup(text);\n\n        text.set(position, size, this.text);\n        text.setStyle(this.style);\n    };\n\n    proto.undo = function () {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        if (markup) {\n            this.editor.removeMarkup(markup);\n            markup.destroy();\n        }\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateCircle } from './CreateCircle'\n\n    /**\n     * Markup delete circle action.\n     * \n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for deleting a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup deletion.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param circle\n     */\n    export function DeleteCircle(editor, circle) {\n\n        EditAction.call(this, editor, 'DELETE-CIRCLE', circle.id);\n        this.createCircle = new CreateCircle(\n            editor,\n            circle.id,\n            circle.position,\n            circle.size,\n            circle.rotation,\n            circle.getStyle());\n    }\n\n    DeleteCircle.prototype = Object.create(EditAction.prototype);\n    DeleteCircle.prototype.constructor = DeleteCircle;\n\n    var proto = DeleteCircle.prototype;\n\n    proto.redo = function() {\n\n        this.createCircle.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCircle.redo();\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     * Markup set circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for editing properties of a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup edition.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param circle\n     * @param position\n     * @param size\n     */\n    export function SetCircle(editor, circle, position, size) {\n\n        EditAction.call(this, editor, 'SET-CIRCLE', circle.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: circle.position.x, y: circle.position.y};\n        this.oldSize = {x: circle.size.x, y: circle.size.y};\n    }\n\n    SetCircle.prototype = Object.create(EditAction.prototype);\n    SetCircle.prototype.constructor = SetCircle;\n\n    var proto = SetCircle.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var circle = this.editor.getMarkup(targetId);\n        if(!circle) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(circle.position.x - position.x) > epsilon || Math.abs(circle.size.y - size.y) > epsilon ||\n            Math.abs(circle.position.y - position.y) > epsilon || Math.abs(circle.size.y - size.y) > epsilon) {\n\n            circle.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteCircle } from '../edit-actions/DeleteCircle'\nimport { CreateCircle } from '../edit-actions/CreateCircle'\nimport { SetCircle } from '../edit-actions/SetCircle'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     * Markup circle edit mode.\n     *\n     * Implements a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode|EditMode}.\n     * Included in documentation as an example of how to create\n     * an EditMode for a specific markup type. Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditMode\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     */\n    export function EditModeCircle(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CIRCLE, styleAttributes);\n    }\n\n    EditModeCircle.prototype = Object.create(EditMode.prototype);\n    EditModeCircle.prototype.constructor = EditModeCircle;\n\n    var proto = EditModeCircle.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteCircle = new DeleteCircle(this.editor, markup);\n            deleteCircle.addToHistory = !cantUndo;\n            deleteCircle.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call( this, event );\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        var editor = this.editor;\n\n        var final = this.getFinalMouseDraggingPosition();\n        final = editor.clientToMarkups(final.x, final.y);\n\n        var sizeX = Math.abs(this.firstPosition.x - final.x);\n        var sizeY = Math.abs(this.firstPosition.y - final.y);\n\n        var position = {x: (this.firstPosition.x + final.x) * 0.5, y: (this.firstPosition.y + final.y) * 0.5};\n        var size = this.size = {x: sizeX, y: sizeY};\n\n        var setCircle = new SetCircle(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setCircle.execute();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create circle.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateCircle(\n            editor,\n            markupId,\n            position,\n            size,\n            0,\n            this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg, \n        updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeCircle } from './edit-modes/EditModeCircle'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupCircle(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_CIRCLE;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupCircle.prototype = Object.create(Markup.prototype);\n    MarkupCircle.prototype.constructor = MarkupCircle;\n\n    var proto = MarkupCircle.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCircle(this.editor);\n    };\n\n    proto.set = function(position, size) {\n\n        this.setSize(position, size.x, size.y);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var size = this.size;\n        if (size.x === 1 || size.y === 1) {\n            return [''];\n        }\n\n        var strokeWidth = this.style['stroke-width'];\n\n        var ellipseW = size.x - strokeWidth;\n        var ellipseH = size.y - strokeWidth;\n\n        var ellipseX = -0.5*ellipseW;\n        var ellipseY = 0;\n\n        var path = [];\n        createEllipsePath(ellipseX, ellipseY, ellipseW, ellipseH, false, path);\n\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupCircle } from '../MarkupCircle'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     * Markup create circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for creating a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup creation.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     */\n    export function CreateCircle(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-CIRCLE', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateCircle.prototype = Object.create(EditAction.prototype);\n    CreateCircle.prototype.constructor = CreateCircle;\n\n    var proto = CreateCircle.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var circle = new MarkupCircle(this.targetId, editor);\n\n        editor.addMarkup(circle);\n\n        circle.setSize(this.position, this.size.x, this.size.y);\n        circle.setRotation(this.rotation);\n        circle.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateCloud } from './CreateCloud'\n\n    /**\n     *\n     * @param editor\n     * @param cloud\n     * @constructor\n     */\n    export function DeleteCloud(editor, cloud) {\n\n        EditAction.call(this, editor, 'DELETE-CLOUD', cloud.id);\n        this.createCloud = new CreateCloud(\n            editor,\n            cloud.id,\n            cloud.position,\n            cloud.size,\n            cloud.rotation,\n            cloud.getStyle());\n    }\n\n    DeleteCloud.prototype = Object.create(EditAction.prototype);\n    DeleteCloud.prototype.constructor = DeleteCloud;\n\n    var proto = DeleteCloud.prototype;\n\n    proto.redo = function() {\n\n        this.createCloud.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCloud.redo();\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param cloud\n     * @param position\n     * @param size\n     * @constructor\n     */\n    export function SetCloud(editor, cloud, position, size) {\n\n        EditAction.call(this, editor, 'SET-CLOUD', cloud.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: cloud.position.x, y: cloud.position.y};\n        this.oldSize = {x: cloud.size.x, y: cloud.size.y};\n    }\n\n    SetCloud.prototype = Object.create(EditAction.prototype);\n    SetCloud.prototype.constructor = SetCloud;\n\n    var proto = SetCloud.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize, this.newStrokeWidth, this.newColor);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize, this.oldStrokeWidth, this.oldColor);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var cloud = this.editor.getMarkup(targetId);\n        if(!cloud) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(cloud.position.x - position.x) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon ||\n            Math.abs(cloud.position.y - position.y) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon) {\n\n            cloud.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteCloud } from '../edit-actions/DeleteCloud'\nimport { CreateCloud } from '../edit-actions/CreateCloud'\nimport { SetCloud } from '../edit-actions/SetCloud'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeCloud(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CLOUD, styleAttributes);\n    }\n\n    EditModeCloud.prototype = Object.create(EditMode.prototype);\n    EditModeCloud.prototype.constructor = EditModeCloud;\n\n    var proto = EditModeCloud.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteCloud = new DeleteCloud(this.editor, markup);\n            deleteCloud.addToHistory = !cantUndo;\n            deleteCloud.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call( this, event );\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        var editor = this.editor;\n\n        var pos = this.getFinalMouseDraggingPosition();\n        var final = editor.clientToMarkups(pos.x, pos.y);\n        var position = { x: (this.firstPosition.x + final.x) / 2, y: (this.firstPosition.y + final.y) / 2 };\n        var size = this.size = { x: Math.abs(final.x - this.firstPosition.x), y: Math.abs(final.y - this.firstPosition.y) };\n        var setCloud = new SetCloud(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setCloud.execute();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create Cloud.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateCloud(\n            editor,\n            markupId,\n            position,\n            size,\n            0,\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeCloud } from './edit-modes/EditModeCloud'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupCloud(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-linejoin', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_CLOUD;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupCloud.prototype = Object.create(Markup.prototype);\n    MarkupCloud.prototype.constructor = MarkupCloud;\n\n    var proto = MarkupCloud.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCloud(this.editor);\n    };\n\n    /**\n     * Sets position and size in markup space coordinates.\n     * @param {Object} position\n     * @param {Object} size\n     */\n    proto.set = function(position, size) {\n\n        this.setSize(position, size.x, size.y);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper function that creates intermediate points given the\n     * current position and size.\n     * @returns {Array}\n     */\n    proto.getPath = function() {\n\n        var position = this.position;\n        var size = this.size;\n        var strokeWidth = this.style['stroke-width'];\n        var radius = strokeWidth * 2;\n\n        function createArcTo(x, y, xRadius, yRadius, path) {\n\n            path.push('a');\n            path.push(xRadius);\n            path.push(yRadius);\n            path.push(0);\n            path.push(1);\n            path.push(1);\n            path.push(x);\n            path.push(y);\n\n            return path;\n        }\n\n        function createCorner(corner, xRadius, yRadius, strokeWidth, path) {\n\n            switch(corner) {\n\n                case 'LT':\n                    return createArcTo( xRadius,-yRadius, xRadius, yRadius, path);\n                    break;\n\n                case 'RT':\n                    return createArcTo( xRadius, yRadius, xRadius, yRadius, path);\n                    break;\n\n                case 'RB':\n                    return createArcTo(-xRadius, yRadius, xRadius, yRadius, path);\n                    break;\n\n                case 'LB':\n                    return createArcTo(-xRadius,-yRadius, xRadius, yRadius, path);\n                    break;\n            }\n        }\n\n        function getSideParameters(x1, x2, radius, strokeWidth) {\n\n            var diameter = radius * 2;\n            var length = Math.abs(x2 - x1 - strokeWidth);\n            var count = Math.round(length / diameter);\n\n            diameter += (length - diameter * count) / count;\n            radius = diameter * 0.5;\n\n            var xValueInset = diameter * 0.05;\n            var yValueOffset = radius * 3.5 / 3.0;\n\n            return {\n                count: count,\n                radius: radius,\n                diameter: diameter,\n                p1: {x: xValueInset, y: -yValueOffset },\n                p2: {x: diameter - xValueInset, y: -yValueOffset},\n                p3: {x: diameter, y: 0}\n            };\n        }\n\n        function createTSide(hSidesParameters, path){\n\n            var sp = hSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n\n                path.push('c');\n                path.push(sp.p1.x);\n                path.push(sp.p1.y);\n                path.push(sp.p2.x);\n                path.push(sp.p2.y);\n                path.push(sp.p3.x);\n                path.push(sp.p3.y);\n            }\n\n            return path;\n        }\n\n        function createRSide(vSidesParameters, path){\n\n            var sp = vSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(-sp.p1.y);\n                path.push(sp.p1.x);\n                path.push(-sp.p2.y);\n                path.push(sp.p2.x);\n                path.push(-sp.p3.y);\n                path.push(sp.p3.x);\n            }\n\n            return path;\n        }\n\n        function createBSide(hSidesParameters, path){\n\n            var sp = hSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(-sp.p1.x);\n                path.push(-sp.p1.y);\n                path.push(-sp.p2.x);\n                path.push(-sp.p2.y);\n                path.push(-sp.p3.x);\n                path.push(-sp.p3.y);\n            }\n\n            return path;\n        }\n\n        function createLSide(vSidesParameters, path){\n\n            var sp = vSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(sp.p1.y);\n                path.push(-sp.p1.x);\n                path.push(sp.p2.y);\n                path.push(-sp.p2.x);\n                path.push(sp.p3.y);\n                path.push(-sp.p3.x);\n            }\n\n            return path;\n        }\n\n        var l = position.x;\n        var t = position.y;\n        var r = position.x + size.x;\n        var b = position.y + size.y;\n\n        var minSize = radius * 5;\n        var path = [];\n\n        if (size.x < minSize || size.y < minSize) {\n\n            var w = size.x - strokeWidth;\n            var h = size.y - strokeWidth;\n            var x = -w * 0.5;\n            var y = 0;\n\n            createEllipsePath(x, y, w, h, false, path);\n        } else {\n\n            var hSidesParameters = getSideParameters(l, r, radius, strokeWidth);\n            var vSidesParameters = getSideParameters(t, b, radius, strokeWidth);\n\n            var cornerSizeX = hSidesParameters.diameter;\n            var cornerSizeY = vSidesParameters.diameter;\n            var cornerRadiusX = hSidesParameters.radius;\n            var cornerRadiusY = vSidesParameters.radius;\n\n            hSidesParameters = getSideParameters(l + cornerSizeX, r - cornerSizeX, radius, strokeWidth);\n            vSidesParameters = getSideParameters(t + cornerSizeY, b - cornerSizeY, radius, strokeWidth);\n\n            var halfStrokeWidth = strokeWidth * 0.5;\n            var x =-size.x * 0.5 + halfStrokeWidth + cornerRadiusX;\n            var y =-size.y * 0.5 + halfStrokeWidth + cornerRadiusY * 2;\n\n            path.push('M');\n            path.push(x);\n            path.push(y);\n\n            createCorner('LT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createTSide(hSidesParameters, path);\n            createCorner('RT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createRSide(vSidesParameters, path);\n            createCorner('RB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createBSide(hSidesParameters, path);\n            createCorner('LB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createLSide(vSidesParameters, path);\n        }\n\n        path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupCloud } from '../MarkupCloud'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     * @constructor\n     */\n    export function CreateCloud(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-CLOUD', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateCloud.prototype = Object.create(EditAction.prototype);\n    CreateCloud.prototype.constructor = CreateCloud;\n\n    var proto = CreateCloud.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var cloud = new MarkupCloud(this.targetId, editor);\n\n        editor.addMarkup(cloud);\n\n        cloud.set(this.position, this.size);\n        cloud.setRotation(this.rotation);\n        cloud.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n","'use strict';\n\nimport { Markup } from './Markup'\nimport { createMarkupPathSvg, setAttributeToMarkupSvg, updateMarkupPathSvgHitarea,\n    composeRGBAString, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\n\n    /**\n     * Base class for Pen Markup rendering (currently freehand and highlighter)\n     *\n     * Derived classes must implement getEditMode()\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPen(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupPen.prototype = Object.create(Markup.prototype);\n    MarkupPen.prototype.constructor = MarkupPen;\n\n    var proto = MarkupPen.prototype;\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     *\n     * @param position\n     * @param size\n     * @param locations\n     */\n    proto.set = function(position, size, locations, isAbsoluteCoords) {\n\n        this.rotation = 0; // Reset angle //\n        this.isAbsoluteCoords = isAbsoluteCoords;\n        if (this.isAbsoluteCoords) {\n            this.updatePath(locations);\n        } else {\n            this.locations = locations.slice(0);\n\n            this.size.x = (size.x === 0) ? 1 : size.x;\n            this.size.y = (size.y === 0) ? 1 : size.y;\n\n            this.setSize(position, size.x, size.y);\n            this.updateStyle();\n        }\n    };\n\n    proto.setPosition = function(x,y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        var shape = this.shape;\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = 'none';\n\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke-linejoin', 'round');\n        setAttributeToMarkupSvg(shape, 'stroke-linecap', 'round');\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n\n        this.updatePath(path);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.updatePath = function(path) {\n        var shape = this.shape;\n        var transform = this.isAbsoluteCoords ? 'scale(1)' : this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        setAttributeToMarkupSvg(shape, 'd', path);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var path = [];\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        if (locationsCount > 1) {\n\n            path.push('M');\n            path.push(+(locations[0].x).toFixed(6));\n            path.push(+(locations[0].y).toFixed(6));\n\n            for (var i = 1; i < locationsCount; ++i) {\n\n                var locationA = locations[i - 1];\n                var locationB = locations[i];\n\n                path.push('l');\n                path.push(+(locationB.x - locationA.x).toFixed(6));\n                path.push(+(locationB.y - locationA.y).toFixed(6));\n            }\n        }\n\n        return path;\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { simplify } from '../MarkupsCoreUtils'\n\n    /**\n     * Base class for editing Pen tools (currently freehand and highlighter)\n     *\n     * Any class extending EditModePen should contain at least the following methods:\n     * - createPen()\n     * - deletePen()\n     * - setPen()\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePen(editor, type, styleAttributes) {\n        EditMode.call(this, editor, type, styleAttributes);\n\n        this.smoothen = true;\n        this.bufferSize = 8;\n    }\n\n    EditModePen.prototype = Object.create(EditMode.prototype);\n\n    var proto = EditModePen.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type === this.type) {\n            var deleteMarkup = this.deletePen(markup);\n            deleteMarkup.addToHistory = !cantUndo;\n            deleteMarkup.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call( this, event );\n\n        var selectedMarkup = this.selectedMarkup;\n        if (!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n\n        var location = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n        if (this.smoothen) {\n            this.appendToBuffer(location);\n            this.amendPath();\n        } else {\n            var dx = this.lastX - mousePosition.x;\n            var dy = this.lastY - mousePosition.y;\n            var moveTol = 25; // 5^2, compare to square to avoid using square root of distance\n\n            if (movements.length > 1 && (dx*dx + dy*dy) < moveTol) {\n                movements[movements.length - 1] = location;\n                this.removeFromAbsolutePath(1);\n            } else {\n                movements.push(location);\n                this.lastX = mousePosition.x;\n                this.lastY = mousePosition.y;\n            }\n\n            this.addToAbsolutePath([location]);\n        }\n\n        var setPen = this.setPen(this.position, this.size, this.absolutePath, true);\n        setPen.execute();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n\n        editor.snapper && editor.snapper.clearSnapped();\n        var mousePosition = editor.getMousePosition();\n\n        this.lastX = this.initialX = mousePosition.x;\n        this.lastY = this.initialY = mousePosition.y;\n\n        //set the starting point\n        var position = this.position = editor.clientToMarkups(this.initialX, this.initialY);\n        this.movements = [position];\n        if (this.smoothen) {\n            this.buffer = []; // Reset buffer\n            this.movementsLastIndex = null;\n            this.appendToBuffer(position);\n        }\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create pen.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = this.createPen(markupId, position, size, 0, [{x: 0, y: 0 }]);\n\n        create.execute();\n\n        this.createAbsolutePath(position);\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    proto.onMouseUp = function() {\n\n        if (!this.creating) {\n            EditMode.prototype.onMouseUp.call(this);\n            return;\n        }\n\n        var movements = this.movements;\n        var cameraWidth = this.viewer.impl.camera.right - this.viewer.impl.camera.left;\n        var cameraHeight = this.viewer.impl.camera.top - this.viewer.impl.camera.bottom;\n        var cameraDiagSq = cameraWidth*cameraWidth + cameraHeight*cameraHeight;\n\n        movements = simplify(movements, cameraDiagSq * 0.00000001, true);\n\n        var xs = movements.map(function(item) { return item.x });\n        var ys = movements.map(function(item) { return item.y });\n\n        var l = Math.min.apply(null, xs);\n        var t = Math.min.apply(null, ys);\n        var r = Math.max.apply(null, xs);\n        var b = Math.max.apply(null, ys);\n\n        var width = r - l;  // Already in markup coords space\n        var height = b - t; // Already in markup coords space\n\n        var position = {\n            x: l + width * 0.5,\n            y: t + height * 0.5\n        };\n        var size = this.size = {x: width, y: height};\n\n        // Adjust points to relate from the shape's center\n        var locations = movements.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n\n        var setPen = this.setPen(position, size, locations, false);\n        setPen.execute();\n\n        EditMode.prototype.onMouseUp.call(this);\n    };\n\n    proto.createPen = function() {\n        console.error('createPen not implemented');\n    };\n\n    proto.deletePen = function() {\n        console.error('deletePen not implemented');\n    };\n\n    proto.setPen = function() {\n        console.error('setPen not implemented');\n    };\n\n    proto.useWithSnapping = function () {\n        return false;\n    };\n\n    proto.createAbsolutePath = function(point) {\n\n        this.absolutePath = 'M' + +(point.x).toFixed(6) + ' ' + +(point.y).toFixed(6);\n        this.absolutePathIndexes = [0];\n    };\n\n    proto.removeFromAbsolutePath = function(numToRemove) {\n\n        numToRemove = Math.min(numToRemove, this.absolutePathIndexes.length);\n        if (numToRemove > 0) {\n            this.absolutePath = this.absolutePath.slice(0, this.absolutePathIndexes[this.absolutePathIndexes.length - numToRemove]);\n            this.absolutePathIndexes.splice(this.absolutePathIndexes.length - numToRemove);\n        }\n    };\n\n    proto.addToAbsolutePath = function(points) {\n\n       for (var i = 0; i < points.length; i++) {\n            this.absolutePathIndexes.push(this.absolutePath.length);\n            this.absolutePath += ' L' + +(points[i].x).toFixed(6) + ' ' + +(points[i].y).toFixed(6);\n        }\n    };\n\n    proto.appendToBuffer = function(point) {\n\n        this.buffer.push(point);\n        while (this.buffer.length > this.bufferSize) {\n            this.buffer.shift();\n        }\n    };\n\n    proto.amendPath = function() {\n\n        var point = this.getAveragePoint(0);\n        if (point) {\n            if (this.movementsLastIndex) {\n                this.removeFromAbsolutePath(this.movements.length - this.movementsLastIndex);\n                this.movements.splice(this.movementsLastIndex);\n            }\n\n            // Add the smoothed part of the path that will not change\n            var tmpBuffer = [point];\n            this.movementsLastIndex = this.movements.length + 1;\n\n            // Get the last part of the path (close to the current mouse position)\n            // This part will change if the mouse moves again\n            for (var offset = 2; offset < this.buffer.length; offset += 2) {\n                var pt = this.getAveragePoint(offset);\n                tmpBuffer.push(pt);\n            }\n\n            this.addToAbsolutePath(tmpBuffer);\n\n            // Set the complete current path coordinates\n            this.movements.push.apply(this.movements, tmpBuffer);\n\n        }\n    };\n\n    // Calculate the average point, starting at offset in the buffer\n    proto.getAveragePoint = function(offset) {\n\n        var len = this.buffer.length;\n        if (len % 2 === 1 || len >= this.bufferSize) {\n            var totalX = 0;\n            var totalY = 0;\n            var pt;\n            var count = 0;\n            for (var i = offset; i < len; i++) {\n                count++;\n                pt = this.buffer[i];\n                totalX += pt.x;\n                totalY += pt.y;\n            }\n            return {\n                x: totalX / count,\n                y: totalY / count\n            }\n        }\n        return null;\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateFreehand } from './CreateFreehand'\n\n    /**\n     *\n     * @param editor\n     * @param freehand\n     * @constructor\n     */\n    export function DeleteFreehand(editor, freehand) {\n        EditAction.call(this, editor, 'DELETE-FREEHAND', freehand.id);\n        this.createFreehand = new CreateFreehand(\n            editor,\n            freehand.id,\n            freehand.position,\n            freehand.size,\n            freehand.rotation,\n            freehand.locations,\n            freehand.getStyle());\n    }\n\n    DeleteFreehand.prototype = Object.create(EditAction.prototype);\n    DeleteFreehand.prototype.constructor = DeleteFreehand;\n\n    var proto = DeleteFreehand.prototype;\n\n    proto.redo = function() {\n\n        this.createFreehand.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createFreehand.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param freehand\n     * @param position\n     * @param size\n     * @param locations\n     * @constructor\n     */\n    export function SetFreehand(editor, freehand, position, size, locations, isAbsoluteCoords) {\n\n        EditAction.call(this, editor, 'SET-FREEHAND', freehand.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\n        this.isAbsoluteCoords = isAbsoluteCoords;\n\n        // No need to save old data\n    }\n\n    SetFreehand.prototype = Object.create(EditAction.prototype);\n    SetFreehand.prototype.constructor = SetFreehand;\n\n    var proto = SetFreehand.prototype;\n\n    proto.redo = function() {\n\n        var freehand = this.editor.getMarkup(this.targetId);\n        if (!freehand) {\n            return;\n        }\n\n        freehand.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\n            this.position = action.position;\n            this.size = action.size;\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n","'use strict';\n\nimport { EditModePen } from './EditModePen'\nimport { DeleteFreehand } from '../edit-actions/DeleteFreehand'\nimport { CreateFreehand } from '../edit-actions/CreateFreehand'\nimport { SetFreehand } from '../edit-actions/SetFreehand'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeFreehand(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_FREEHAND, styleAttributes);\n    }\n\n    EditModeFreehand.prototype = Object.create(EditModePen.prototype);\n    EditModeFreehand.prototype.constructor = EditModeFreehand;\n\n    var proto = EditModeFreehand.prototype;\n\n    proto.createPen = function(markupId, position, size, rotation, locations) {\n        return new CreateFreehand(this.editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            locations,\n            this.style);\n    };\n\n    proto.deletePen = function(markup) {\n        return new DeleteFreehand(this.editor, markup);\n    };\n\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\n        return new SetFreehand(this.editor,\n            this.selectedMarkup,\n            position,\n            size,\n            locations,\n            isAbsoluteCoords);\n    };\n\n","'use strict';\n\nimport { MarkupPen } from './MarkupPen'\nimport * as MarkupTypes from './MarkupTypes'\nimport { EditModeFreehand } from './edit-modes/EditModeFreehand'\n\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupFreehand(id, editor) {\n\n        MarkupPen.call(this, id, editor);\n        this.type = MarkupTypes.MARKUP_TYPE_FREEHAND;\n    }\n\n    MarkupFreehand.prototype = Object.create(MarkupPen.prototype);\n    MarkupFreehand.prototype.constructor = MarkupFreehand;\n\n    var proto = MarkupFreehand.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeFreehand(this.editor);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupFreehand } from '../MarkupFreehand'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param style\n     * @constructor\n     */\n    export function CreateFreehand(editor, id, position, size, rotation, locations, style) {\n\n        EditAction.call(this, editor, 'CREATE-FREEHAND', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.slice(0);\n        this.style = cloneStyle(style);\n    }\n\n    CreateFreehand.prototype = Object.create(EditAction.prototype);\n    CreateFreehand.prototype.constructor = CreateFreehand;\n\n    var proto = CreateFreehand.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var freehand = new MarkupFreehand(this.targetId, editor);\n\n        editor.addMarkup(freehand);\n\n        freehand.set(this.position, this.size, this.movements, false);\n        freehand.setRotation(this.rotation);\n        freehand.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreatePolyline } from './CreatePolyline'\n\n    /**\n     *\n     * @param editor\n     * @param polyline\n     * @constructor\n     */\n    export function DeletePolyline(editor, polyline) {\n\n        EditAction.call(this, editor, 'DELETE-POLYLINE', polyline.id);\n        this.createPolyline = new CreatePolyline(\n            editor,\n            polyline.id,\n            polyline.position,\n            polyline.size,\n            polyline.rotation,\n            polyline.locations,\n            polyline.getStyle(),\n            polyline.closed);\n    }\n\n    DeletePolyline.prototype = Object.create(EditAction.prototype);\n    DeletePolyline.prototype.constructor = DeletePolyline;\n\n    var proto =  DeletePolyline.prototype;\n\n    proto.redo = function() {\n\n        this.createPolyline.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createPolyline.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param polyline\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     * @constructor\n     */\n    export function SetPolyline(editor, polyline, position, size, locations, closed) {\n\n        EditAction.call(this, editor, 'SET-POLYLINE', polyline.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = locations.concat();\n        this.closed = closed;\n\n        // No need to save old data\n    }\n\n    SetPolyline.prototype = Object.create(EditAction.prototype);\n    SetPolyline.prototype.constructor = SetPolyline;\n\n    var proto = SetPolyline.prototype;\n\n    proto.redo = function() {\n\n        var polyline = this.editor.getMarkup(this.targetId);\n        if(!polyline) {\n            return;\n        }\n\n        polyline.set(this.position, this.size, this.locations, this.closed);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.locations.concat();\n            this.position = action.position;\n            this.size = action.size;\n            this.closed = action.closed;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeletePolyline } from '../edit-actions/DeletePolyline'\nimport { CreatePolyline } from '../edit-actions/CreatePolyline'\nimport { SetPolyline } from '../edit-actions/SetPolyline'\nimport * as MarkupTypes from '../MarkupTypes'\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\n\n    var SNAP_RANGE = 25;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePolyline(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYLINE, styleAttributes);\n\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\n        this.movements = [];\n    }\n\n    EditModePolyline.prototype = Object.create(EditMode.prototype);\n    EditModePolyline.prototype.constructor = EditModePolyline;\n\n    var proto = EditModePolyline.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var movements = this.movements;\n            if (this.creating && movements.length >= 2) {\n                movements.pop();\n                movements.pop();\n                var lastIndex = movements.length - 1;\n                if (lastIndex >= 0) {\n                    // duplicate last location\n                    var lastMove = movements[lastIndex];\n                    movements.push(lastMove);\n                    var locations = setPositionAndSize(movements, this);\n                    var setPolyline = new SetPolyline(\n                        this.editor,\n                        markup,\n                        this.position,\n                        this.size,\n                        locations);\n\n                    setPolyline.execute();\n                }\n            }\n            else {\n                var deletePolyline = new DeletePolyline(this.editor, markup);\n                deletePolyline.addToHistory = !cantUndo;\n                deletePolyline.execute();\n                this.creationEnd();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call(this, event);\n\n        var editor = this.editor;\n        var selectedMarkup = this.selectedMarkup;\n\n        if(!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        this.dragging = true;\n\n        var movements = this.movements;\n        movements.splice(movements.length-1, 1);\n\n        var mousePosition = editor.getMousePosition();\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        // Close polyline if user clicks close to initial point.\n        if (movements.length >= 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n        }\n\n        movements.push(mousePosition);\n\n        var locations = setPositionAndSize(movements, this);\n        var setPolyline = new SetPolyline(\n            editor,\n            selectedMarkup,\n            this.position,\n            this.size,\n            locations);\n\n        setPolyline.execute();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        if (this.creating) {\n            return;\n        }\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n        this.movements = [mousePosition, mousePosition];\n\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreatePolyline(\n            editor,\n            markupId,\n            mousePosition,\n            size,\n            0,\n            [{x:0, y:0}],\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseUp = function() {\n\n        EditMode.prototype.onMouseUp.call(this);\n\n        if(!this.creating) {\n            return;\n        }\n\n        this.dragging = false;\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n        var closed = false;\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        if (movements.length > 1 &&\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\n            return;\n        }\n\n        // Close polyline if user clicks close to initial point.\n        if (movements.length > 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n            closed = true;\n        }\n\n        movements.splice(movements.length-1, 1);\n\n        if (!closed) {\n            movements.push(mousePosition);\n            movements.push(mousePosition);\n        }\n\n        var polyline = this.selectedMarkup;\n        var locations = setPositionAndSize(movements, polyline);\n        var setPolyline = new SetPolyline(\n            editor,\n            polyline,\n            polyline.position,\n            polyline.size,\n            locations,\n            closed);\n\n        setPolyline.execute();\n\n        if (closed) {\n            this.creationEnd();\n        }\n    };\n\n    proto.destroy = function() {\n        this.onMouseDoubleClick();\n        EditMode.prototype.creationEnd.call(this);\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        // To pass isMinSizeValid,\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\n        if (this.selectedMarkup) {\n            this.size.x = this.selectedMarkup.size.x;\n            this.size.y = this.selectedMarkup.size.y;\n        }\n\n        EditMode.prototype.creationEnd.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if(!this.creating) {\n           return;\n        }\n\n        var movements = this.movements;\n        movements.splice(Math.max(0, movements.length-1));\n\n        if (movements.length < 2 ) {\n\n            this.creationCancel();\n        } else {\n\n            var polyline = this.selectedMarkup;\n            var locations = setPositionAndSize(movements, polyline);\n            var setPolyline = new SetPolyline(\n                this.editor,\n                polyline,\n                polyline.position,\n                polyline.size,\n                locations,\n                this.closed);\n\n            setPolyline.execute();\n            this.creationEnd();\n        }\n    };\n\n    function setPositionAndSize(locations, markup) {\n\n        // determine the position of the top-left and bottom-right points\n        var minFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.min.apply(null, targets);\n        };\n\n        var maxFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.max.apply(null, targets);\n        };\n\n        var l = minFn(locations, 'x');\n        var t = minFn(locations, 'y');\n        var r = maxFn(locations, 'x');\n        var b = maxFn(locations, 'y');\n        var w = r - l;\n        var h = b - t;\n\n        markup.size = {x: w, y: h};\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\n\n        // Adjust points to relate from the shape's center\n        var position = markup.position;\n        return locations.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n    }\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModePolyline } from './edit-modes/EditModePolyline'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPolyline(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_POLYLINE;\n        this.shape = createMarkupPathSvg('path');\n\n        this.bindDomEvents();\n    }\n\n    MarkupPolyline.prototype = Object.create(Markup.prototype);\n    MarkupPolyline.prototype.constructor = MarkupPolyline;\n\n    var proto = MarkupPolyline.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModePolyline(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     *\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     */\n    proto.set = function(position, size, locations, closed) {\n\n        this.rotation = 0; // Reset angle //\n        this.locations = locations.concat();\n\n        this.size.x = (size.x === 0) ? 1 : size.x;\n        this.size.y = (size.y === 0) ? 1 : size.y;\n\n        this.closed = closed;\n\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    };\n\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd',  this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var path = [];\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        if (locationsCount === 0) {\n            return ' ';\n        }\n\n        path.push('M');\n        path.push(locations[0].x);\n        path.push(locations[0].y);\n\n        for (var i = 1; i < locationsCount; ++i) {\n\n            var locationA = locations[i - 1];\n            var locationB = locations[i];\n\n            path.push('l');\n            path.push(locationB.x - locationA.x);\n            path.push(locationB.y - locationA.y);\n        }\n\n        this.closed && path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupPolyline } from '../MarkupPolyLine'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param closed\n     * @param style\n     * @constructor\n     */\n    export function CreatePolyline(editor, id, position, size, rotation, locations, style, closed) {\n\n        EditAction.call(this, editor, 'CREATE-POLYLINE', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.concat();\n        this.closed = closed;\n        this.style = cloneStyle(style);\n    }\n\n    CreatePolyline.prototype = Object.create(EditAction.prototype);\n    CreatePolyline.prototype.constructor = CreatePolyline;\n\n    var proto = CreatePolyline.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var polyline = new MarkupPolyline(this.targetId, editor);\n\n        editor.addMarkup(polyline);\n\n        polyline.set(this.position, this.size, this.movements, this.closed);\n        polyline.setRotation(this.rotation);\n        polyline.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreatePolycloud } from './CreatePolycloud'\n\n    /**\n     *\n     * @param editor\n     * @param polycloud\n     * @constructor\n     */\n    export function DeletePolycloud(editor, polycloud) {\n\n        EditAction.call(this, editor, 'DELETE-POLYCLOUD', polycloud.id);\n        this.createPolycloud = new CreatePolycloud(\n            editor,\n            polycloud.id,\n            polycloud.position,\n            polycloud.size,\n            polycloud.rotation,\n            polycloud.locations,\n            polycloud.getStyle(),\n            polycloud.closed);\n    }\n\n    DeletePolycloud.prototype = Object.create(EditAction.prototype);\n    DeletePolycloud.prototype.constructor = DeletePolycloud;\n\n    var proto =  DeletePolycloud.prototype;\n\n    proto.redo = function() {\n\n        this.createPolycloud.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createPolycloud.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param polycloud\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     * @constructor\n     */\n    export function SetPolycloud(editor, polycloud, position, size, locations, closed) {\n\n        EditAction.call(this, editor, 'SET-POLYCLOUD', polycloud.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = locations.concat();\n        this.closed = closed;\n\n        // No need to save old data\n    }\n\n    SetPolycloud.prototype = Object.create(EditAction.prototype);\n    SetPolycloud.prototype.constructor = SetPolycloud;\n\n    var proto = SetPolycloud.prototype;\n\n    proto.redo = function() {\n\n        var polycloud = this.editor.getMarkup(this.targetId);\n        if(!polycloud) {\n            return;\n        }\n\n        polycloud.set(this.position, this.size, this.locations, this.closed);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.locations.concat();\n            this.position = action.position;\n            this.size = action.size;\n            this.closed = action.closed;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeletePolycloud } from '../edit-actions/DeletePolycloud'\nimport { CreatePolycloud } from '../edit-actions/CreatePolycloud'\nimport { SetPolycloud } from '../edit-actions/SetPolycloud'\nimport * as MarkupTypes from '../MarkupTypes'\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\n\n    var SNAP_RANGE = 25;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePolycloud(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYCLOUD, styleAttributes);\n\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\n        this.movements = [];\n    }\n\n    EditModePolycloud.prototype = Object.create(EditMode.prototype);\n    EditModePolycloud.prototype.constructor = EditModePolycloud;\n\n    var proto = EditModePolycloud.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var movements = this.movements;\n            if (this.creating && movements.length >= 2) {\n                movements.pop();\n                movements.pop();\n                var lastIndex = movements.length - 1;\n                if (lastIndex >= 0) {\n                    // duplicate last location\n                    var lastMove = movements[lastIndex];\n                    movements.push(lastMove);\n                    var locations = setPositionAndSize(movements, this);\n                    var setPolycloud = new SetPolycloud(\n                        this.editor,\n                        markup,\n                        this.position,\n                        this.size,\n                        locations);\n\n                    setPolycloud.execute();\n                }\n            }\n            else {\n                var deletePolycloud = new DeletePolycloud(this.editor, markup);\n                deletePolycloud.addToHistory = !cantUndo;\n                deletePolycloud.execute();\n                this.creationEnd();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        EditMode.prototype.onMouseMove.call(this, event);\n\n        var editor = this.editor;\n        var selectedMarkup = this.selectedMarkup;\n\n        if(!selectedMarkup || !this.creating) {\n            return;\n        }\n\n        this.dragging = true;\n\n        var movements = this.movements;\n        movements.splice(movements.length-1, 1);\n\n        var mousePosition = editor.getMousePosition();\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        // Close polycloud if user clicks close to initial point.\n        if (movements.length >= 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n        }\n\n        movements.push(mousePosition);\n\n        var locations = setPositionAndSize(movements, this);\n        var setPolycloud = new SetPolycloud(\n            editor,\n            selectedMarkup,\n            this.position,\n            this.size,\n            locations);\n\n        setPolycloud.execute();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        if (this.creating) {\n            return;\n        }\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n        this.movements = [mousePosition, mousePosition];\n\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreatePolycloud(\n            editor,\n            markupId,\n            mousePosition,\n            size,\n            0,\n            [{x: 0, y: 0 }],\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        EditMode.prototype.onMouseUp.call(this);\n\n        if(!this.creating) {\n            return;\n        }\n\n        this.dragging = false;\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n        var closed = false;\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        if (movements.length > 1 &&\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\n            return;\n        }\n\n        // Close polycloud if user clicks close to initial point.\n        if (movements.length > 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n            closed = true;\n        }\n\n        movements.splice(movements.length-1, 1);\n\n        if (!closed) {\n            movements.push(mousePosition);\n            movements.push(mousePosition);\n        }\n\n        var polycloud = this.selectedMarkup;\n        var locations = setPositionAndSize(movements, polycloud);\n        var setPolycloud = new SetPolycloud(\n            editor,\n            polycloud,\n            polycloud.position,\n            polycloud.size,\n            locations,\n            closed);\n\n        setPolycloud.execute();\n\n        if (closed) {\n            this.creationEnd();\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if(!this.creating) {\n            return;\n        }\n\n        var movements = this.movements;\n        movements.splice(Math.max(0, movements.length-1));\n\n        if (movements.length < 2 ) {\n\n            this.creationCancel();\n        } else {\n\n            var polycloud = this.selectedMarkup;\n            var locations = setPositionAndSize(movements, polycloud);\n            var setPolycloud = new SetPolycloud(\n                this.editor,\n                polycloud,\n                polycloud.position,\n                polycloud.size,\n                locations,\n                true);\n\n            setPolycloud.execute();\n            this.creationEnd();\n        }\n    };\n\n    proto.destroy = function() {\n        this.onMouseDoubleClick();\n        EditMode.prototype.creationEnd.call(this);\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        // To pass isMinSizeValid,\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\n        if (this.selectedMarkup) {\n            this.size.x = this.selectedMarkup.size.x;\n            this.size.y = this.selectedMarkup.size.y;\n        }\n        \n        EditMode.prototype.creationEnd.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    function setPositionAndSize(locations, markup) {\n\n        // determine the position of the top-left and bottom-right points\n        var minFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.min.apply(null, targets);\n        };\n\n        var maxFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.max.apply(null, targets);\n        };\n\n        var strokeWidth = markup.style['stroke-width'];\n        var radius = strokeWidth * 2 + strokeWidth * 0.5;\n\n        var l = minFn(locations, 'x') - radius;\n        var t = minFn(locations, 'y') - radius;\n        var r = maxFn(locations, 'x') + radius;\n        var b = maxFn(locations, 'y') + radius;\n        var w = r - l;\n        var h = b - t;\n\n        markup.size = {x: w, y: h};\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\n\n        // Adjust points to relate from the shape's center\n        var position = markup.position;\n        return locations.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n    }\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModePolycloud } from './edit-modes/EditModePolycloud'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPolycloud(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_POLYCLOUD;\n        this.locations = [];\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupPolycloud.prototype = Object.create(Markup.prototype);\n    MarkupPolycloud.prototype.constructor = MarkupPolycloud;\n\n    var proto = MarkupPolycloud.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModePolycloud(this.editor);\n    };\n\n    /**\n     *\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     */\n    proto.set = function(position, size, locations, closed) {\n\n        this.rotation = 0; // Reset angle //\n        this.locations = locations.concat();\n\n        this.size.x = (size.x === 0) ? 1 : size.x;\n        this.size.y = (size.y === 0) ? 1 : size.y;\n\n        this.closed = closed;\n\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        function getOrientation(locations) {\n\n            switch (locations.length) {\n\n                case 0:\n                case 1:\n                    return 1;\n                case 2:\n\n                    var fstPoint = locations[0];\n                    var sndPoint = locations[1];\n\n                    return fstPoint.y > sndPoint.y ? 1 : -1;\n                default:\n\n                    var pointA = locations[0];\n                    var pointB = locations[1];\n                    var pointC = locations[2];\n\n                    var orientation =\n                        (pointB.x - pointA.x) * (pointB.y + pointA.y) +\n                        (pointC.x - pointB.x) * (pointC.y + pointB.y);\n\n                    return orientation < 0 ? 1 : -1;\n            }\n        }\n\n        function getSides(locations, closed) {\n\n            var locationsCount = locations.length;\n\n            var sides = [];\n            var sidesCount = locationsCount - (closed ? 0 : 1);\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var locationA = locations[i];\n                var locationB = locations[(i+1)%locationsCount];\n\n                var dx = locationB.x - locationA.x;\n                var dy = locationB.y - locationA.y;\n\n                var length = Math.sqrt(dx * dx + dy * dy);\n\n                sides.push({\n                    index: i,\n                    pointA: new THREE.Vector3(locationA.x, locationA.y, 0),\n                    pointB: new THREE.Vector3(locationB.x, locationB.y, 0),\n                    vecAB:  new THREE.Vector3(dx / length, dy / length, 0),\n                    vecBA:  new THREE.Vector3(-dx / length, -dy / length, 0),\n                    length: length\n                });\n            }\n\n            return sides;\n        }\n\n        function updateCorners(side, cornerA, cornerB, orientation) {\n            var rA = cornerA.radius;\n            var rB = cornerB.radius;\n            var D = side.length;\n\n            if (rA > 0 && rB > 0 && rA + rB > D && Math.abs(rA - rB) < D) {\n                // Corner arcs overlap, so correct them by finding the circle-circle intersection\n                var a = side.pointA.x;\n                var b = side.pointA.y;\n                var c = side.pointB.x;\n                var d = side.pointB.y;\n\n                var delta = 0.25 * Math.sqrt((D + rA + rB) * (D + rA - rB) * (D - rA + rB) * (-D + rA + rB));\n                var xS = (a + c) / 2 + (c - a) * (rA*rA - rB*rB) / (2*D*D);\n                var xT = 2*(b - d) / (D*D) * delta;\n                var yS = (b + d) / 2 + (d - b) * (rA*rA - rB*rB) / (2*D*D);\n                var yT = 2*(a - c) / (D*D) * delta;\n                var x1 = xS + xT;\n                var x2 = xS - xT;\n                var y1 = yS - yT;\n                var y2 = yS + yT;\n                var testPointOnCircle = Math.abs((x1 - a) * (x1 - a) + (y1 - b) * (y1 - b) - rA * rA);\n                if (testPointOnCircle > 0.0000001) {\n                    var tmp = y1;\n                    y1 = y2;\n                    y2 = tmp;\n                }\n\n                var intersec = new THREE.Vector3(x1, y1, 0);\n                var intersecSide = Math.sign(intersec.clone().sub(side.pointA).cross(side.vecAB).z);\n                if (intersecSide !== orientation) {\n                    intersec.set(x2, y2, 0);\n                }\n\n                cornerA.pointB = intersec.clone();\n                cornerB.pointA = intersec.clone();\n\n                return true;\n            }\n\n            return false;\n        }\n\n        function updateSides(sides, corners, radius, orientation) {\n\n            var diameter = radius * 2;\n            var sidesCount = sides.length;\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var side = sides[i];\n                var cornerA = corners[i];\n                var cornerB = corners[(i+1)%sidesCount];\n\n                side.bodyA = side.vecAB.clone().multiplyScalar(cornerA.radius).add(side.pointA);\n                side.bodyB = side.vecBA.clone().multiplyScalar(cornerB.radius).add(side.pointB);\n\n                if (updateCorners(side, cornerA, cornerB, orientation)) {\n                    side.body = 0;\n                    side.bodyDiameter = side.bodyCount = 0;\n                } else {\n                    side.body = side.bodyB.clone().sub(side.bodyA).length();\n                    side.bodyCount = Math.round(side.body / diameter);\n                    if (side.bodyCount === 0 && side.body > 0.5*radius) {\n                        side.bodyCount = 1;\n                    }\n                    side.bodyDiameter = diameter + (side.body - diameter * side.bodyCount) / side.bodyCount;\n                }\n\n                side.bodyRadius = side.bodyDiameter * 0.5;\n            }\n        }\n\n        function getCorners(sides, radius, closed) {\n\n            var corners = [];\n            var sidesCount = sides.length;\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var sideA = sides[i !== 0 ? i-1 : sidesCount-1];\n                var sideB = sides[i];\n                var large = sideA.vecBA.clone().cross(sideB.vecAB).z < 0;\n\n                var sidesTooShort = sideA.length < radius || sideB.length < radius;\n                if (sidesTooShort || (i === 0 && !closed)) {\n\n                    corners.push({\n                        pointA: sideB.pointA.clone(),\n                        pointB: sideB.pointA.clone(),\n                        radius: 0,\n                        large: false\n                    });\n                } else {\n\n                    corners.push({\n                        pointA: sideB.pointA.clone().add(sideA.vecBA.clone().multiplyScalar(radius)),\n                        pointB: sideB.pointA.clone().add(sideB.vecAB.clone().multiplyScalar(radius)),\n                        radius: radius,\n                        large: large\n                    });\n                }\n            }\n\n            return corners;\n        }\n\n        function createSidePath(side, orientation, path) {\n\n            var count = side.bodyCount;\n            if (count === 0) {\n                return;\n            }\n\n            var radius = side.bodyRadius;\n            var diameter = side.bodyDiameter;\n\n            var xValueInset = diameter * 0.05;\n            var yValueOffset = radius * 3.5 / 3.0;\n\n            var p1 = new THREE.Vector3(xValueInset, orientation * -yValueOffset);\n            var p2 = new THREE.Vector3(diameter - xValueInset, orientation * -yValueOffset);\n            var p3 = new THREE.Vector3(diameter, 0);\n\n            var angle = Math.acos(side.vecAB.x) * (side.vecAB.y < 0 ? -1 : 1);\n            var rotation = new THREE.Matrix4().makeRotationZ(angle);\n\n            p1.applyMatrix4(rotation);\n            p2.applyMatrix4(rotation);\n            p3.applyMatrix4(rotation);\n\n            for (var i = 0; i < count; ++i) {\n\n                path.push('c');\n                path.push(p1.x);\n                path.push(p1.y);\n                path.push(p2.x);\n                path.push(p2.y);\n                path.push(p3.x);\n                path.push(p3.y);\n            }\n        }\n\n        function createCornerPath(corner, first, orientation, path) {\n\n            if (first) {\n\n                path.push('M');\n                path.push(corner.pointA.x);\n                path.push(corner.pointA.y);\n            }\n\n            var large = orientation === 1 ? corner.large : !corner.large;\n\n            if (corner.radius !== 0) {\n\n                path.push('a');\n                path.push(corner.radius);\n                path.push(corner.radius);\n                path.push(0);\n                path.push(large ? 1 : 0);\n                path.push(orientation === 1 ? 1 : 0);\n                path.push(corner.pointB.x - corner.pointA.x);\n                path.push(corner.pointB.y - corner.pointA.y);\n            }\n            return path;\n        }\n\n\n        var strokeWidth = this.style['stroke-width'];\n        var radius = strokeWidth * 2;\n        var orientation = getOrientation(this.locations);\n        var closed = this.closed;\n        var path = [];\n\n        var sides = getSides(this.locations, closed);\n        var corners = getCorners(sides, radius, closed);\n        var cornersCount = corners.length;\n\n        updateSides(sides, corners, radius, orientation);\n\n        for(var i = 0; i < cornersCount; ++i) {\n\n            createCornerPath(corners[i], i === 0, orientation, path);\n            createSidePath(sides[i], orientation, path);\n        }\n\n        closed && path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupPolycloud } from '../MarkupPolycloud'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param closed\n     * @param style\n     * @constructor\n     */\n    export function CreatePolycloud(editor, id, position, size, rotation, locations, style, closed) {\n\n        EditAction.call(this, editor, 'CREATE-POLYCLOUD', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.concat();\n        this.style = cloneStyle(style);\n        this.closed = closed;\n    }\n\n    CreatePolycloud.prototype = Object.create(EditAction.prototype);\n    CreatePolycloud.prototype.constructor = CreatePolycloud;\n\n    var proto = CreatePolycloud.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var polyline = new MarkupPolycloud(this.targetId, editor);\n\n        editor.addMarkup(polyline);\n\n        polyline.set(this.position, this.size, this.movements, this.closed);\n        polyline.setRotation(this.rotation);\n        polyline.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateHighlight } from './CreateHighlight'\n\n    /**\n     *\n     * @param editor\n     * @param highlight\n     * @constructor\n     */\n    export function DeleteHighlight(editor, highlight) {\n        EditAction.call(this, editor, 'DELETE-HIGHLIGHT', highlight.id);\n        this.createHighlight = new CreateHighlight(\n            editor,\n            highlight.id,\n            highlight.position,\n            highlight.size,\n            highlight.rotation,\n            highlight.locations,\n            highlight.getStyle());\n    }\n\n    DeleteHighlight.prototype = Object.create(EditAction.prototype);\n    DeleteHighlight.prototype.constructor = DeleteHighlight;\n\n    var proto = DeleteHighlight.prototype;\n\n    proto.redo = function() {\n\n        this.createHighlight.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createHighlight.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param highlight\n     * @param position\n     * @param size\n     * @param locations\n     * @constructor\n     */\n    export function SetHighlight(editor, highlight, position, size, locations, isAbsoluteCoords) {\n\n        EditAction.call(this, editor, 'SET-HIGHLIGHT', highlight.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\n        this.isAbsoluteCoords = isAbsoluteCoords;\n\n        // No need to save old data\n    }\n\n    SetHighlight.prototype = Object.create(EditAction.prototype);\n    SetHighlight.prototype.constructor = SetHighlight;\n\n    var proto = SetHighlight.prototype;\n\n    proto.redo = function() {\n\n        var highlight = this.editor.getMarkup(this.targetId);\n        if (!highlight) {\n            return;\n        }\n\n        highlight.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\n            this.position = action.position;\n            this.size = action.size;\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditModePen } from './EditModePen'\nimport { DeleteHighlight } from '../edit-actions/DeleteHighlight'\nimport { CreateHighlight } from '../edit-actions/CreateHighlight'\nimport { SetHighlight } from '../edit-actions/SetHighlight'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeHighlight(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_HIGHLIGHT, styleAttributes);\n\n        var normaStrokeWidth = editor.getStrokeWidth();\n        this.style['stroke-opacity'] = 0.50;\n        this.style['stroke-color'] = '#ffff00';\n        this.style['stroke-width'] = 4 * normaStrokeWidth; // Very Thick\n    }\n\n    EditModeHighlight.prototype = Object.create(EditModePen.prototype);\n    EditModeHighlight.prototype.constructor = EditModeHighlight;\n\n    var proto = EditModeHighlight.prototype;\n\n    proto.createPen = function(markupId, position, size, rotation, locations) {\n        return new CreateHighlight(this.editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            locations,\n            this.style);\n    };\n\n    proto.deletePen = function(markup) {\n        return new DeleteHighlight(this.editor, markup);\n    };\n\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\n        return new SetHighlight(this.editor,\n            this.selectedMarkup,\n            position,\n            size,\n            locations,\n            isAbsoluteCoords);\n    };\n\n","'use strict';\n\nimport { MarkupPen } from './MarkupPen'\nimport * as MarkupTypes from './MarkupTypes'\nimport { EditModeHighlight } from './edit-modes/EditModeHighlight'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupHighlight(id, editor) {\n\n        MarkupPen.call(this, id, editor);\n        this.type = MarkupTypes.MARKUP_TYPE_HIGHLIGHT;\n    }\n\n    MarkupHighlight.prototype = Object.create(MarkupPen.prototype);\n    MarkupHighlight.prototype.constructor = MarkupHighlight;\n\n    var proto = MarkupHighlight.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeHighlight(this.editor);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupHighlight } from '../MarkupHighlight'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param style\n     * @constructor\n     */\n    export function CreateHighlight(editor, id, position, size, rotation, locations, style) {\n\n        EditAction.call(this, editor, 'CREATE-HIGHLIGHT', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.slice(0);\n        this.style = cloneStyle(style);\n    }\n\n    CreateHighlight.prototype = Object.create(EditAction.prototype);\n    CreateHighlight.prototype.constructor = CreateHighlight;\n\n    var proto = CreateHighlight.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var highlight = new MarkupHighlight(this.targetId, editor);\n\n        editor.addMarkup(highlight);\n\n        highlight.set(this.position, this.size, this.movements, false);\n        highlight.setRotation(this.rotation);\n        highlight.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateDimension } from './CreateDimension'\n\n    /**\n     *\n     * @param editor\n     * @param dimension\n     * @constructor\n     */\n    export function DeleteDimension(editor, dimension) {\n\n        // Confusing naming here. Dimension.secondAnchor is the starting point of the dimension,\n        // and dimension.firstAnchor is the final point. In CreateDimension the firstAnchor argument\n        // is the first point of the dimension and the secondAnchor argument is the second\n        // point of the argument. So construct CreateDimension with the secondAnchor before\n        // the firstAnchor. \n        EditAction.call(this, editor, 'DELETE-DIMENSION', dimension.id);\n        this.createDimension = new CreateDimension(\n            editor,\n            dimension.id,\n            dimension.secondAnchor,\n            dimension.firstAnchor,\n            dimension.currentText,\n            dimension.getStyle());\n    }\n\n    DeleteDimension.prototype = Object.create(EditAction.prototype);\n    DeleteDimension.prototype.constructor = DeleteDimension;\n\n    var proto = DeleteDimension.prototype;\n\n    proto.redo = function() {\n\n        this.createDimension.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createDimension.redo();\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param dimension\n     * @param firstAnchor\n     * @param secondAnchor\n     * @constructor\n     */\n    export function SetDimension(editor, dimension, firstAnchor, secondAnchor, text) {\n\n        EditAction.call(this, editor, 'SET-DIMENSION', dimension.id);\n\n        this.newFirstAnchor = {x: firstAnchor.x, y: firstAnchor.y};\n        this.newSecondAnchor = {x: secondAnchor.x, y: secondAnchor.y};   \n        this.oldFirstAnchor = {x: dimension.firstAnchor.x, y: dimension.firstAnchor.y};\n        this.oldSecondAnchor = {x: dimension.secondAnchor.x, y: dimension.secondAnchor.y}; \n        this.newText = text;\n        this.oldText = dimension.currentText;\n    }\n\n    SetDimension.prototype = Object.create(EditAction.prototype);\n    SetDimension.prototype.constructor = SetDimension;\n\n    var proto = SetDimension.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.newFirstAnchor, this.newSecondAnchor, this.newText);    \n\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.oldFirstAnchor, this.oldSecondAnchor, this.oldText);\n\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newFirstAnchor = action.newFirstAnchor;\n            this.newSecondAnchor = action.newSecondAnchor;\n            this.newText = action.newText;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(firstAnchor, secondAnchor, text) {\n\n        var dimension = this.editor.getMarkup(this.targetId);\n\n        if(!dimension) {\n            return;\n        }\n\n        dimension.set(firstAnchor.x, firstAnchor.y, secondAnchor.x, secondAnchor.y, text);\n\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return ((this.newText === this.oldText) && (\n            !this.newFirstAnchor || !this.newSecondAnchor ||\n            this.newFirstAnchor.x === this.oldFirstAnchor.x &&\n            this.newFirstAnchor.y === this.oldFirstAnchor.y &&\n            this.newSecondAnchor.x === this.oldSecondAnchor.x &&\n            this.newSecondAnchor.y === this.oldSecondAnchor.y));\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteDimension } from '../edit-actions/DeleteDimension'\nimport { CreateDimension } from '../edit-actions/CreateDimension'\nimport { SetDimension } from '../edit-actions/SetDimension'\nimport { SetStyle } from '../edit-actions/SetStyle'\nimport * as MarkupTypes from '../MarkupTypes'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditorTextInput } from './EditorTextInput'\nimport { measureTextLines, radiansToDegrees } from '../MarkupsCoreUtils'\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n    \n    var MAX_LETTERS = 15;\n    var SPACE = '\\u00A0'; // Non-breaking space\n    var _cursorPosition;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeDimension(editor) {\n\n        var self = this;\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_DIMENSION, styleAttributes);\n\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n\n        this.measurement = new MeasureCommon.Measurement(MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE);\n        var viewer = this.viewer;\n        var measureExt = viewer.getExtension('Autodesk.Measure');\n        \n        function abortDimensionMarkup() {\n            self.cancelEditModeChange = true;\n            editor.enterEditMode(); // Selects default edit mode.\n        }\n\n        if (!measureExt) {\n            console.error('Demension markup cant work without measure extension. Please load measure extension first');\n            abortDimensionMarkup();\n        }\n\n        this.sharedMeasureConfig = measureExt.sharedMeasureConfig;\n        \n        // If PDF, force calibration\n        if ((measureExt.forceCalibrate || viewer.model.getData().isLeaflet) && !measureExt.calibrationTool.isCalibrated()) {\n            measureExt.openCalibrationRequiredDialog('dimension');\n            abortDimensionMarkup();\n        }\n    }\n\n    EditModeDimension.prototype = Object.create(EditMode.prototype);\n    EditModeDimension.prototype.constructor = EditModeDimension;\n\n    var proto = EditModeDimension.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteDimension = new DeleteDimension(this.editor, markup);\n            deleteDimension.addToHistory = !cantUndo;\n            deleteDimension.execute();\n            this.creating = false;\n            this.dragging = false;\n            return true;\n        }\n        return false;\n    };\n\n    proto.updateTextBoxStyle = function(style) {\n        if (this.isTextInputHelperActive()) {\n            if (!style) {\n                style = this.textInputHelper.textMarkup.getStyle();\n            }\n\n            this.textInputHelper.setStyle(style);\n            this.updateTextBox(this.textInputHelper.textMarkup);\n        }\n    };\n\n    proto.setStyle = function(style) {\n\n        EditMode.prototype.setStyle.call(this, style);\n        this.updateTextBoxStyle(style);\n\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.isTextInputHelperActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.creationBegin = function() {\n        EditMode.prototype.creationBegin.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        this.dragging = false;\n        EditMode.prototype.creationEnd.call(this);\n    };\n\n    proto.isMinSizeValid = function() {\n\n        if (this.minSize !== 0) {\n            var tmp = this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x, this.selectedMarkup.size.y);\n            return (tmp.x*tmp.x) >= (this.minSize * this.minSize);\n        }\n\n        return true;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.creating = false;\n        this.dragging = false;\n\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n\n        this.updateViewportId();\n\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.getDistance = function() {\n\n        var distance = null;\n\n        this.measurement.computeResult(this.measurement.picks, this.viewer);\n\n        if (this.viewer.model && this.measurement.distanceXYZ) {\n            var d = Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(), this.sharedMeasureConfig.units, this.sharedMeasureConfig.calibrationFactor, this.measurement.distanceXYZ);\n            return Autodesk.Viewing.Private.formatValueWithUnits(d, this.sharedMeasureConfig.units, 3, this.sharedMeasureConfig.precision);\n        }\n\n        return distance;\n    };\n\n    proto.updateMeasurement = function(measurementNumber) {\n        var editor = this.editor;\n\n        var pick = this.measurement.getPick(measurementNumber);\n        \n        if (_cursorPosition) {\n            pick.geomType = MeasureCommon.SnapType.SNAP_VERTEX;\n            pick.geomVertex = _cursorPosition;\n            pick.intersectPoint = _cursorPosition;\n        } else {\n            editor.snapper.copyResults(pick);\n        }\n\n        return pick;\n    };\n\n    proto.updateViewportId = function(viewportId) {\n        if (this.viewer.model && this.viewer.model.is2d()) {\n            if (!viewportId) {\n                this.viewer.impl.updateViewportId(0);\n                this.editor.snapper.setViewportId(null);\n            }\n            else {\n                // Pass viewport Id to LineShader to make all other geometries with different viewport transparent\n                this.viewer.impl.updateViewportId(viewportId);\n                this.editor.snapper.setViewportId(viewportId);  \n            \n            }\n        }\n    };\n\n    proto.pickFirstAnchor = function() {\n        var editor = this.editor;\n        this.measurement.clearAllPicks();\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        this.firstAnchor = editor.positionFromClientToMarkups(this.initialX, this.initialY);\n\n        editor.beginActionGroup();\n\n        var dimensionId = editor.getId();\n        var create = new CreateDimension(editor, dimensionId, this.firstAnchor, null, this.currentText, this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(dimensionId);\n        this.creationBegin();\n        \n        var pick = this.updateMeasurement(1);\n        this.updateViewportId(pick.viewportIndex2d);\n    };\n\n    proto.pickSecondAnchor = function(mouseDown) {\n\n        var editor = this.editor;\n        var selectedMarkup = this.selectedMarkup;\n\n        this.secondAnchor = this.getFinalMouseDraggingPosition();\n\n        this.updateMeasurement(2);\n\n        // Correct Perpendicular\n        if (MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1), this.measurement.getPick(2), this.viewer, editor.snapper)){\n            var newPos = MeasureCommon.getSnapResultPosition(this.measurement.getPick(2), this.viewer);\n            this.secondAnchor = editor.project(newPos);\n            editor.snapper.indicator.render();\n        }\n\n        var secondAnchor = editor.positionFromClientToMarkups(this.secondAnchor.x, this.secondAnchor.y);\n\n        this.size.x = selectedMarkup.size.x;\n        this.size.y = selectedMarkup.size.y;\n\n        selectedMarkup.currentText = this.getDistance();         \n\n        var setDimension = new SetDimension(editor, selectedMarkup, this.firstAnchor, secondAnchor, selectedMarkup.currentText);\n        setDimension.execute();\n\n        var setStyle = new SetStyle(editor, selectedMarkup, this.style);\n        setStyle.execute();\n\n        // Open 'Add Length' textbox if no measurement has being taken.\n        if (mouseDown && !selectedMarkup.currentText && this.isMinSizeValid()) {\n            selectedMarkup.currentText = '';\n            this.editor.selectMarkup(null);\n            this.updateTextBox(selectedMarkup);\n        } \n    };\n\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        // Right click - do nothing.\n        if (Autodesk.Viewing.Private.isRightClick(event, this.viewer.navigation)) {\n            return;\n        }\n\n        _cursorPosition = null;\n\n        // Textbox is open.\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n        \n        var isSnapped = this.editor.snapper.isSnapped();\n\n        // Picked first point.\n        if (!this.selectedMarkup && !this.creating && isSnapped) {\n            this.pickFirstAnchor();\n        }\n\n        // Picked second point.\n        else if (this.selectedMarkup && this.creating) {\n\n            if (isSnapped) {\n                this.pickSecondAnchor(true);   \n            } else {\n                this.deleteMarkup(this.selectedMarkup, true);\n                this.creating = true;\n            }\n\n            this.updateViewportId();\n            this.creationEnd();\n        }\n    };\n\n    proto.onMouseUp = function(event) {\n\n        if (this.dragging) {\n            this.onMouseDown(event);   \n            this.dragging = false; \n        }\n    };\n\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        _cursorPosition = null;\n\n        if(!this.selectedMarkup || !this.creating) {\n            return;\n        }\n\n        this.dragging = true;\n        this.pickSecondAnchor(false);\n    };\n\n    proto.getFinalMouseDraggingPosition = function() {\n\n        var editor = this.editor;\n        var bounds = editor.getBounds();\n        var mousePosition = editor.getMousePosition();\n\n        if (!editor.snapper.isSnapped()) {\n            if (editor.viewer.model && editor.viewer.model.is2d()) {\n                _cursorPosition = MeasureCommon.inverseProject(mousePosition, editor.viewer);\n            }\n        }\n\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\n\n        if (finalX == initialX &&\n            finalY == initialY) {\n            finalX++;\n            finalY++;\n        }\n\n        // Make straight line when shift key is down.\n        if (editor.input.constrainAxis && editor.viewer.model.is2d()) {\n            var dx = Math.abs(finalX - initialX);\n            var dy = Math.abs(finalY - initialY);\n\n            if (dx > dy) {\n                finalY = initialY;\n            } \n            else {\n                finalX = initialX;\n            }\n\n            editor.snapper.onMouseMove({ x:finalX, y:finalY });\n            \n            if (editor.snapper.isSnapped()) {\n                editor.snapper.copyResults(this.measurement.getPick(2));\n                _cursorPosition = null;\n            } else {\n                _cursorPosition = MeasureCommon.inverseProject({ x:finalX, y:finalY }, editor.viewer);\n            }\n        }\n\n        return { x:finalX, y:finalY };\n    };\n\n    proto.isVisibleChar = function(keyCode) {\n\n    return  ((keyCode > 47 && keyCode < 58)  || // number keys\n            (keyCode == 32)                  || // spacebar\n            (keyCode > 64 && keyCode < 91)   || // letter keys\n            (keyCode > 95 && keyCode < 112)  || // numpad keys\n            (keyCode > 185 && keyCode < 193) || // ;=,-./` (in order)\n            (keyCode > 218 && keyCode < 223));   // [\\]' (in order)\n    };\n\n    proto.measureTextLine = function(text, markup, editor) {\n\n        text = text.replace(new RegExp(' ', 'g'), SPACE);\n        text = text.length === 0 ? markup.initialText : text;\n        return measureTextLines([text + '|'], this.style, editor)[0];\n\n    };\n\n    proto.handleKeyDown = function (e) {\n        var textInputHelper = this.textInputHelper;\n        \n        if (e.keyCode === Autodesk.Viewing.KeyCode.ENTER) {\n            return;\n        }\n\n        var markup = textInputHelper.textMarkup;\n        var text = textInputHelper.textArea.value;\n\n        if (e.keyCode === Autodesk.Viewing.KeyCode.BACKSPACE) {\n            text = text.substring(0, text.length-1);\n        }\n\n        if (text.length < MAX_LETTERS && this.isVisibleChar(e.keyCode)) {\n            text = text + e.key;            \n        }\n\n        var size = this.measureTextLine(text, markup, this.editor);\n                \n        this.updateTextBox(markup, size);\n    };\n\n    proto.updateTextBox = function(markup, size) {\n\n        if (!this.textInputHelper) {\n            this.textInputHelper = new EditorTextInput(this.viewer.container, this.editor, true, markup.initialText, MAX_LETTERS);\n            this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n            this.handleKeyDownBinded = this.handleKeyDown.bind(this);\n        }\n\n        markup.text.style.display = 'none';\n        \n        if (!size) {\n            size = this.measureTextLine(this.textInputHelper.textArea.value, markup, this.editor);\n        }\n\n        var transform = this.getTextAreaTransform(markup, size);\n\n        this.textInputHelper.styleTextArea.setAttribute('text-align', 'center');\n        \n        this.textInputHelper.setActive(markup, false);\n\n        \n        // Override textArea attributes\n        this.textInputHelper.textArea.style.position = 'static';\n        this.textInputHelper.textArea.style.padding = '0';\n        this.textInputHelper.textArea.style.width = size.width + 'px';\n        this.textInputHelper.textArea.style.height = size.height + 'px';\n        this.textInputHelper.textArea.style.transform = transform; // Maybe need to add 'allBrowsers' support\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);    \n        this.textInputHelper.textArea.removeEventListener('keydown', this.handleKeyDownBinded);\n        this.textInputHelper.textArea.addEventListener('keydown', this.handleKeyDownBinded);    \n        \n    };\n\n    proto.getTextAreaTransform = function(markup, size) {\n\n        var position = markup.getClientPosition();\n        var rotation = radiansToDegrees(markup.rotation) % 360;\n\n        if (rotation > 90 && rotation <= 270 && markup.shouldFlip()) {\n            rotation = 180 + rotation;\n        }\n    \n        return [\n            'translate(', (position.x - (size.width/2)) + 'px,',(position.y - this.viewer.container.clientHeight - size.height) + 'px)',\n            'rotate(', rotation + 'deg)',\n            'translate(0px,', size.height +'px)'\n        ].join(' ');\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(null);\n            this.updateTextBox(markup);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var markup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var editor = this.editor;\n\n        markup.text.style.display = 'block';\n\n        if (dataBag.newText === '') {\n            dataBag.newText = markup.initialText;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateText action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            editor.beginActionGroup();\n        }\n\n        var setStyle = new SetStyle(editor, markup, textStyle);\n        setStyle.execute();\n\n        var setDimension = new SetDimension(editor, markup, markup.firstAnchor, markup.secondAnchor, dataBag.newText);\n        setDimension.execute();\n\n        editor.closeActionGroup();\n        editor.selectMarkup(null);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.textMarkup.text.style.display = 'block';\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.isTextInputHelperActive()) {\n            var editor = this.editor;\n            editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            var markup = this.textInputHelper.textMarkup;\n            this.textInputHelper.acceptAndExit();\n            markup.text.style.display = 'block';\n        }\n    };\n\n    proto.useWithSnapping = function () {\n        return true;\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, createMarkupTextSvg, composeRGBAString, addMarkupMetadata,\n    radiansToDegrees, degreesToRadians, measureTextLines, setMarkupTextSvgTransform,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, createSvgElement, checkLineSegment,\n    updateMarkupTextSvgBackground, updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea \n} from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeDimension } from './edit-modes/EditModeDimension'\n\n    var DIMENSION_MARKUP_HEIGHT = 10;\n    var TEXT_OFFSET = 2;\n    var DEFAULT_TEXT = 'Add Length';\n    var BACKGROUND_COLOR = 'none';//'#ffffff';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupDimension(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_DIMENSION;\n        this.constraintHeight = true;\n        this.constraintWidth = true;\n        \n        this.firstAnchor = new THREE.Vector3();\n        this.secondAnchor = new THREE.Vector3();\n        this.shape = createMarkupPathSvg();\n        this.text = createMarkupTextSvg();\n        this.shape.appendChild(this.text);\n        this.textSize = {x: 0, y: 0};\n        this.initialText = DEFAULT_TEXT;\n        this.currentText = ' ';\n\n        if (!this.viewer.model.is2d()) {\n            this.preventReposition = true;\n            this.constraintRotation = true;\n        }\n\n        this.bindDomEvents();\n    }\n\n    MarkupDimension.prototype = Object.create(Markup.prototype);\n    MarkupDimension.prototype.constructor = MarkupDimension;\n\n    var proto = MarkupDimension.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeDimension(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * Notice that for the Dimension, the top left is the \"secondAnchor\" of the Dimension and\n     * the bottom right is the \"firstAnchor\" of it.\n     *\n     * @param {Number} xO - secondAnchor\n     * @param {Number} yO - secondAnchor\n     * @param {Number} xF - firstAnchor\n     * @param {Number} yF - firstAnchor\n     */\n    proto.set = function(xO, yO, xF, yF, text) {\n\n        var vO = new THREE.Vector2(xO, yO);\n        var vF = new THREE.Vector2(xF, yF);\n        var vDir = vF.clone().sub(vO).normalize();\n\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\n\n        var firstAnchor = this.firstAnchor;\n        var secondAnchor = this.secondAnchor;\n\n        firstAnchor.set(xF, yF, 0);\n        secondAnchor.set(xO, yO, 0);\n\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\n\n        this.currentText = text;\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        if (radiansToDegrees(angle) === 90) {\n            angle = degreesToRadians(-90);\n        }\n\n        this.rotation = angle;\n\n        var xF = Math.cos(-angle);\n        var yF = Math.sin(-angle);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(this.size.x*0.5);\n\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.firstAnchor.set(vF.x, vF.y, 0);\n        this.secondAnchor.set(vO.x, vO.y, 0);\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the namespace.SetSize edit action\n     * @param {{x: Number, y: Number}} position - Dimension's center\n     * @param {Number} width - Dimension's length\n     * @param {Number} height - We ignore this one because we use the Dimension's stroke width instead\n     */\n    proto.setSize = function(position, width, height) {\n\n        var xF = Math.cos(-this.rotation);\n        var yF = Math.sin(-this.rotation);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(width*0.5);\n\n        var vCenter = new THREE.Vector2(position.x, position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.firstAnchor.set(vF.x, vF.y, 0);\n        this.secondAnchor.set(vO.x, vO.y, 0);\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var strokeWidth = style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var transform = this.getTransform();\n\n        this.rebuildTextSvg(this.currentText);\n\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth / 2);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.rebuildTextSvg = function(value) {\n        var style = this.style;\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var strokeWidth = style['stroke-width'];\n        var backgroundColor = (value === ' ') ? 'none' : BACKGROUND_COLOR;\n\n        var markup = createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        var text = this.text;\n        var editor = this.editor;\n\n        text.childNodes[0].removeChild(text.markup);\n        text.childNodes[0].appendChild(markup);\n        text.markup = markup;\n\n        var tspan = createSvgElement('tspan');\n        tspan.textContent = value;\n        markup.appendChild(tspan);\n\n        var lineSize = measureTextLines([value], style, editor)[0]; // Only one line for measurement\n        var textSize = this.textSize = editor.sizeFromClientToMarkups(lineSize.width, lineSize.height);\n        \n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2;\n        var textOffset = TEXT_OFFSET * strokeWidth / 2;\n        var offset = (textSize.x + (2 * strokeWidth) >= this.size.x) ? textOffset + edgeH / 2 : textOffset; // If the line is too short for the given text, put it under.\n\n        this.size.y = edgeH + textSize.y + offset;\n\n        var textTransform = this.getTextTransform((4/5 * textSize.y) +  offset, true); // Text height is Always 4/5 of the entire label height.\n        var backgroundTransform = this.getTextTransform(textSize.y + offset, false);\n\n        setAttributeToMarkupSvg(text, 'font-family', style['font-family']);\n        setAttributeToMarkupSvg(text, 'font-size', style['font-size']);\n        setAttributeToMarkupSvg(text, 'font-weight', style['font-weight']);\n        setAttributeToMarkupSvg(text, 'font-style', style['font-style']);\n        setAttributeToMarkupSvg(text, 'text-rendering', 'auto');\n        setAttributeToMarkupSvg(text, 'fill', strokeColor);\n        setMarkupTextSvgTransform(text, backgroundTransform, textTransform); \n        updateMarkupTextSvgBackground(text, textSize.x, textSize.y, backgroundColor);\n        updateMarkupTextSvgClipper(text, textSize.x, textSize.y);\n        updateMarkupTextSvgHitarea(text, textSize.x, textSize.y, editor);\n    };\n\n    proto.shouldFlip = function(){\n        return (this.firstAnchor.x < this.secondAnchor.x);\n    };\n\n    proto.getTextTransform = function(offset, inverse) {\n\n        var flip = this.shouldFlip() ? -1 : 1;\n\n        inverse = inverse ? -1 : 1;\n\n        if (radiansToDegrees(this.rotation) === 90) {\n            this.rotation = degreesToRadians(-90);\n        }\n\n        return [\n            'translate(', this.position.x , ',', this.position.y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'translate(', -flip * this.textSize.x / 2, ',', -flip*offset, ')',\n            'scale(' + flip + ',' + flip*inverse + ')'\n        ].join(' ');\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function (x, y) {\n\n        var firstAnchor = this.firstAnchor;\n        var secondAnchor = this.secondAnchor;\n\n        var dx = firstAnchor.x - secondAnchor.x;\n        var dy = firstAnchor.y - secondAnchor.y;\n\n        var xo = x + dx * 0.5;\n        var yo = y + dy * 0.5;\n\n        firstAnchor.x = xo;\n        firstAnchor.y = yo;\n\n        secondAnchor.x = xo - dx;\n        secondAnchor.y = yo - dy;\n\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    proto.generatePoint3d = function(idTarget) {\n\n        var firstAnchor = this.editor.positionFromMarkupsToClient(this.firstAnchor.x, this.firstAnchor.y);\n        var secondAnchor = this.editor.positionFromMarkupsToClient(this.secondAnchor.x, this.secondAnchor.y);\n\n        var direction = firstAnchor.clone().sub(secondAnchor).normalize();\n\n        var point2d = checkLineSegment(firstAnchor.x, firstAnchor.y, firstAnchor.x + direction.x * 200, firstAnchor.y + direction.y * 200, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n\n        return point3d && point3d.point;\n    };\n\n    proto.setMetadata = function() {\n\n        this.text.setAttribute('pointer-events', 'none');\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.firstAnchor = [this.firstAnchor.x, this.firstAnchor.y].join(\" \");\n        metadata.secondAnchor = [this.secondAnchor.x, this.secondAnchor.y].join(\" \");\n        metadata.text = String(this.currentText);\n\n        return addMarkupMetadata(this.shape, metadata);\n    };\n\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        // if the current text is 'Add Length', you want the textbox will be empty when the user open it.\n        return (this.currentText === this.initialText) ? '' : this.currentText;\n    };\n\n    proto.getPath = function() {\n\n        //   1_                            _4\n        //   | |                          | |\n        //   | |2                        3| |\n        //  0|  --------------------------  |\n        //   |  --------------------------  |\n        //   | |7                       6 | |\n        //   |_|          TEXT            |_|\n        //   8                             5\n        \n        var strokeWidth = this.style['stroke-width'];\n        var segmentLength = this.size.x - strokeWidth / 2; // segment length (p2 to p3 length)\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2; // Edge height (p1 to p8 length)\n\n        return [\n            'M', -segmentLength * 0.5           ,    0              ,   // 0\n            'l', 0                              ,    edgeH / 2      ,   // 1\n            'l', 0                              ,    -edgeH / 2     ,   // 2\n            'l', segmentLength                  ,    0              ,   // 3\n            'l', 0                              ,    edgeH / 2      ,   // 4\n            'l', 0                              ,    -edgeH         ,   // 5\n            'l', 0                              ,    edgeH / 2      ,   // 6\n            'l', -segmentLength                 ,    0              ,   // 7\n            'l', 0                              ,    -edgeH / 2     ,   // 8\n            'z'\n        ];\n    };\n\n    proto.cloneShape = function(clone) {\n        \n        clone.shape = createMarkupPathSvg();\n        clone.text = createMarkupTextSvg();\n        clone.shape.appendChild(clone.text);\n        clone.bindDomEvents();\n    };\n\n    proto.getBoundingRect = function() {\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y\n        }\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupDimension } from '../MarkupDimension'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     * @constructor\n     */\n    export function CreateDimension(editor, id, firstAnchor, secondAnchor, text, style) {\n\n        EditAction.call(this, editor, 'CREATE-DIMENSION', id);\n\n        this.selectOnExecution = false;\n        this.secondAnchor = secondAnchor;\n        this.firstAnchor = firstAnchor;\n        this.text = text;\n        this.style = cloneStyle(style);\n    }\n\n    CreateDimension.prototype = Object.create(EditAction.prototype);\n    CreateDimension.prototype.constructor = CreateDimension;\n\n    var proto = CreateDimension.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var dimension = new MarkupDimension(this.targetId, editor);\n\n        editor.addMarkup(dimension);\n\n        // Don't display the dimension markup when there is only one Anchor (First click, before mouse move).\n        if (this.secondAnchor) {\n            dimension.set(this.firstAnchor.x, this.firstAnchor.y, this.secondAnchor.x, this.secondAnchor.y, this.text);\n            dimension.setStyle(this.style);\n        }        \n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","const canvg = require('../../../thirdparty/canvg/canvg.js'); // Required for Markup Thumbnails\nimport * as MarkupType from '../core/MarkupTypes'\nimport { CreateArrow } from './edit-actions/CreateArrow'\nimport { CreateRectangle } from './edit-actions/CreateRectangle'\nimport { CreateText } from './edit-actions/CreateText'\nimport { CreateCallout } from './edit-actions/CreateCallout'\nimport { CreateCircle } from './edit-actions/CreateCircle'\nimport { CreateCloud } from './edit-actions/CreateCloud'\nimport { CreateFreehand } from './edit-actions/CreateFreehand'\nimport { CreatePolyline } from './edit-actions/CreatePolyline'\nimport { CreatePolycloud } from './edit-actions/CreatePolycloud'\nimport { CreateHighlight } from './edit-actions/CreateHighlight'\nimport { CreateDimension } from './edit-actions/CreateDimension'\nimport { DomElementStyle } from './DomElementStyle'\n\n\n    var av = Autodesk.Viewing;\n    var avp = Autodesk.Viewing.Private;\n\n    // Change these constants to alter the default sizes in pixels of strokes and fonts.\n    export var MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS = 1;\n    export var MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS = 10;\n    export var MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS = 15;\n    export var EDIT_FRAME_DEFAULT_MARGIN = 7;\n\n    /**\n     * // isTouchDevice is an LMV function. Hammer is included by LMV as well\n     * @returns {boolean}\n     */\n    export var isTouchDevice = function() {\n        // isTouchDevice() is an LMV function.\n        // Hammer (a touch detection lib) is packaged with LMV as well\n        if (av.isTouchDevice && typeof Hammer === \"function\") {\n            return av.isTouchDevice();\n        }\n        return false;\n    };\n\n    //// SVG  //////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param type\n     * @returns {Element}\n     */\n    export var createSvgElement = function(type) {\n\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS\n        var namespace = 'http://www.w3.org/2000/svg';\n        return  document.createElementNS(namespace, type);\n    };\n\n    /**\n     *\n     * @param {Element} svg - an SVGElement\n     * @returns {Element} svg param is returned back\n     */\n    export var setSvgParentAttributes = function(svg) {\n\n        // See: https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course\n        svg.setAttribute('version', '1.1'); // Notice that this is the SVG version, not the \"MARKUP DATA VERSION\"!\n        svg.setAttribute('baseProfile', 'full');\n        svg.setAttribute('layer-order-id', 'markups-svg');\n        return svg;\n    };\n\n    export var createMarkupGroupSvg = function(children) {\n        children = children || [];\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'default');\n        svg.setAttribute('pointer-events', 'none');\n\n        for (var i = 0; i < children.length; i++) {\n            svg.appendChild(children[i]);\n        }\n\n        return svg;\n    };\n\n    export var createMarkupPathSvg = function() {\n\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'inherit');\n        svg.setAttribute('pointer-events', 'none');\n\n        var markup = createSvgElement('path');\n        markup.setAttribute('id', 'markup');\n\n        var hitarea = createSvgElement('path');\n        hitarea.setAttribute('id', 'hitarea');\n        hitarea.setAttribute('fill', 'transparent');\n        hitarea.setAttribute('stroke', 'transparent');\n\n        svg.markup = markup;\n        svg.hitarea = hitarea;\n\n        svg.appendChild(markup);\n        svg.appendChild(hitarea);\n\n        return svg;\n    };\n\n    export var setAttributeToMarkupSvg = function(svg, attribute, value) {\n\n        svg.markup.setAttribute(attribute, value);\n    };\n\n    export var updateMarkupPathSvgHitarea = function(svg, editor) {\n\n        var markup = svg.markup;\n        var hitarea = svg.hitarea;\n\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\n        hitareaMargin += parseFloat(markup.getAttribute('stroke-width')) + hitareaMargin;\n\n        var markupFill = markup.getAttribute('fill');\n        var markupStroke = markup.getAttribute('stroke');\n        var strokeEnabled = markupStroke !== '' && markupStroke !== 'none';\n        var fillEnabled = markupFill !== '' && markupFill !== 'none';\n\n        hitarea.setAttribute('d', markup.getAttribute('d'));\n        hitarea.setAttribute('stroke-width', hitareaMargin);\n        hitarea.setAttribute('transform', markup.getAttribute('transform'));\n\n        if (editor.duringEditMode && !editor.navigating) {\n            if (strokeEnabled && fillEnabled) {\n                svg.setAttribute('pointer-events', 'painted');\n                return;\n            }\n\n            if (strokeEnabled) {\n                svg.setAttribute('pointer-events', 'stroke');\n                return;\n            }\n\n            if (fillEnabled) {\n                svg.setAttribute('pointer-events', 'fill');\n                return;\n            }\n        }\n\n        svg.setAttribute('pointer-events', 'none');\n    };\n    \n    export var createMarkupTextSvg = function() {\n\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'default');\n\n        var clipperId = 'markup-clipper-' + getUniqueID();\n        var clipperUrl = 'url(#' + clipperId + ')';\n\n        var clipper = createSvgElement('clipPath');\n        clipper.setAttribute('id', clipperId);\n        clipper.removeAttribute('pointer-events');\n        clipper.rect = createSvgElement('rect');\n        clipper.appendChild(clipper.rect);\n\n        var background = createSvgElement('rect');\n        background.setAttribute('id', 'markup-background');\n        background.removeAttribute('pointer-events');\n\n        var markup = createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n\n        var hitarea = createSvgElement('rect');\n        hitarea.setAttribute('id', 'hitarea');\n        hitarea.setAttribute('fill', 'transparent');\n        hitarea.setAttribute('stroke', 'none');\n        hitarea.setAttribute('stroke-width', '0');\n\n        var clippedArea = createSvgElement('g');\n        clippedArea.setAttribute('clip-path', clipperUrl);\n        clippedArea.appendChild(clipper);\n        clippedArea.appendChild(background);\n        clippedArea.appendChild(markup);\n\n        svg.appendChild(clippedArea);\n        svg.appendChild(hitarea);\n\n        svg.clipper = clipper;\n        svg.background = background;\n        svg.markup = markup;\n        svg.hitarea = hitarea;\n\n        return svg;\n    };\n\n    export var setMarkupTextSvgTransform = function(svg, transform, textTransform) {\n\n        svg.clipper.rect.setAttribute('transform', transform);\n        svg.background.setAttribute('transform', transform);\n        svg.markup.setAttribute('transform', textTransform);\n        svg.hitarea.setAttribute('transform', transform);\n    };\n\n    export var updateMarkupTextSvgHitarea = function(svg, w, h, editor) {\n\n        var hitarea = svg.hitarea;\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\n\n        hitarea.setAttribute('x', -hitareaMargin);\n        hitarea.setAttribute('y', -hitareaMargin);\n        hitarea.setAttribute('width', w + hitareaMargin * 2);\n        hitarea.setAttribute('height', h + hitareaMargin * 2);\n        svg.setAttribute(\"pointer-events\", editor.navigating ? \"none\" : \"painted\");\n    };\n\n    export var updateMarkupTextSvgBackground = function(svg, w, h, color) {\n\n        var background = svg.background;\n\n        background.setAttribute('x', 0);\n        background.setAttribute('y', 0);\n        background.setAttribute('width', w);\n        background.setAttribute('height', h);\n        background.setAttribute('fill', color);\n    };\n\n    export var updateMarkupTextSvgClipper = function(svg, w, h) {\n\n        var clipper = svg.clipper;\n\n        clipper.rect.setAttribute('x', 0);\n        clipper.rect.setAttribute('y', 0);\n        clipper.rect.setAttribute('width', w);\n        clipper.rect.setAttribute('height', h);\n    };\n\n    /**\n     * Helper function that injects metadata for the whole Markup document.\n     * Metadata includes: version.\n     * @param {Element} svg - an SVGElement\n     * @param {Object} metadata - Dictionary with attributes\n     */\n    export var addSvgMetadata = function(svg ,metadata) {\n\n        var metadataNode = document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\n        var dataVersionNode = document.createElement('markup_document');\n\n        metadataNode.appendChild(dataVersionNode);\n\n        // NOTE: We could iterate over the properties, but we don't because these are the only ones supported\n        dataVersionNode.setAttribute(\"data-model-version\", metadata[\"data-model-version\"]); // Version. For example: \"1\"\n\n        svg.insertBefore(metadataNode, svg.firstChild);\n        return metadataNode;\n    };\n\n    /**\n     * Helper function that injects metadata for specific markup svg nodes.\n     * @param {Element} markupNode - an SVGElement for the markup\n     * @param {Object} metadata - Dictionary where all key/value pairs are added as metadata entries.\n     * @returns {Element}\n     */\n    export var addMarkupMetadata = function(markupNode, metadata) {\n\n        var metadataNode = document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\n        var dataVersionNode = document.createElement('markup_element');\n\n        metadataNode.appendChild(dataVersionNode);\n        for (var key in metadata) {\n            if (metadata.hasOwnProperty(key)) {\n                dataVersionNode.setAttribute(key, metadata[key]);\n            }\n        }\n\n        markupNode.insertBefore(metadataNode, markupNode.firstChild);\n        return metadataNode;\n    };\n\n    /**\n     * Removes al metadata nodes from an Svg node structure.\n     * Method will remove all metadata nodes from children nodes as well.\n     * @param svgNode\n     */\n    export var removeAllMetadata = function(svgNode) {\n\n        if (svgNode.getElementsByTagName) {\n            var nodes = svgNode.getElementsByTagName(\"metadata\");\n            for (var i=0; i<nodes.length; ++i) {\n                var metadataNode = nodes[i];\n                metadataNode.parentNode && metadataNode.parentNode.removeChild(metadataNode);\n            }\n        }\n\n        // Transverse children nodes\n        var svgChildren = svgNode.children || svgNode.childNodes;\n        if (svgChildren) {\n            for (i=0; i<svgChildren.length; ++i) {\n                removeAllMetadata(svgChildren[i]);\n            }\n        }\n    };\n\n    /**\n     * Utility function that transfers children from an Html/Svg node into another one.\n     * @param nodeFrom - The node instance from where children will be taken.\n     * @param nodeInto - The node that's going to parent the transferred children.\n     */\n    export var transferChildNodes = function(nodeFrom, nodeInto) {\n\n        var svgChildren = nodeFrom.children || nodeFrom.childNodes;\n        var tmpArray = [];\n        for (var i=0; i<svgChildren.length; ++i){\n            tmpArray.push(svgChildren[i]); // Avoid appendChild\n        }\n        tmpArray.forEach(function(node){\n            nodeInto.appendChild(node);\n        });\n    };\n\n    /**\n     * Generate a unique id.\n     * @returns {string}\n     */\n    export var getUniqueID = function() {\n        return THREE.Math.generateUUID();\n    };\n\n\n    /**\n     * Serializes an SVG node into a String.\n     * @param domNode\n     * @returns {string}\n     */\n    export var svgNodeToString = function(domNode){\n\n        function removeHitareas(svg, hitareas) {\n\n            var hitarea = svg.hitarea;\n            var hitareaParent = hitarea && hitarea.parentNode;\n\n            if (hitareaParent) {\n\n                hitareas.push({hitarea: hitarea, parent: hitareaParent});\n                hitareaParent.removeChild(hitarea);\n            }\n\n            var children = svg.childNodes;\n            var childrenCount = children.length;\n\n            for(var i = 0; i < childrenCount; ++i) {\n                removeHitareas(children.item(i), hitareas);\n            }\n        }\n\n        function addHitareas(hitareas) {\n\n            var hitareasCount = hitareas.length;\n            for(var i = 0; i < hitareasCount; ++i) {\n\n                var hitarea = hitareas[i];\n                hitarea.parent.appendChild(hitarea.hitarea);\n            }\n        }\n\n        var result;\n        try {\n            var hitareas = [];\n            removeHitareas(domNode, hitareas);\n\n            var xmlSerializer = new XMLSerializer();\n            result = xmlSerializer.serializeToString(domNode);\n\n            addHitareas(hitareas);\n\n        } catch (err) {\n            result = '';\n            console.warn('svgNodeToString failed to generate string representation of domNode.');\n        }\n        return result;\n    };\n\n    export var stringToSvgNode = function(stringNode){\n\n        var node = null;\n        try {\n            var domParser = new DOMParser();\n            var doc = domParser.parseFromString(stringNode, \"text/xml\");\n            node = doc.firstChild; // We should only be getting 1 child anyway.\n        } catch (err) {\n            node = null;\n            console.warn('stringToSvgNode failed to generate an HTMLElement from its string representation.');\n        }\n        return node;\n    };\n\n    /**\n     * Injects functions and members to a client object which will\n     * receive the ability to dispatch events.\n     * Mechanism is the same as in Autodesk.Viewing.Viewer.\n     *\n     * Note: All of the code here comes from Autodesk.Viewing.Viewer\n     *\n     * @param {Object} client - Object that will become an event dispatcher.\n     */\n    export var addTraitEventDispatcher = function(client) {\n\n        // Inject member variable\n        client.listeners = {};\n\n        // Inject functions\n        client.addEventListener = function(type, listener) {\n            if (typeof this.listeners[type] == \"undefined\"){\n                this.listeners[type] = [];\n            }\n            this.listeners[type].push(listener);\n        };\n        client.hasEventListener = function (type, listener) {\n            if (this.listeners === undefined) return false;\n            var listeners = this.listeners;\n            if (listeners[ type ] !== undefined && listeners[ type ].indexOf(listener) !== -1) {\n                return true;\n            }\n            return false;\n        };\n        client.removeEventListener = function(type, listener) {\n            if (this.listeners[type] instanceof Array){\n                var li = this.listeners[type];\n                for (var i=0, len=li.length; i < len; i++){\n                    if (li[i] === listener){\n                        li.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        };\n        client.dispatchEvent = function(event) {\n            if (typeof event == \"string\"){\n                event = { type: event };\n            }\n            if (!event.target){\n                event.target = this;\n            }\n\n            if (!event.type){\n                throw new Error(\"event type unknown.\");\n            }\n\n            if (this.listeners[event.type] instanceof Array) {\n                var typeListeners = this.listeners[event.type].slice();\n                for (var i=0; i < typeListeners.length; i++) {\n                    typeListeners[i].call(this, event);\n                }\n            }\n        };\n    };\n\n    /**\n     * Removes the EventDispatcher trait\n     *\n     * @param {Object} client\n     */\n    export var removeTraitEventDispatcher = function(client) {\n\n        try {\n            delete client.listeners;\n            delete client.addEventListener;\n            delete client.hasEventListener;\n            delete client.removeEventListener;\n            delete client.dispatchEvent;\n        } catch (e) {\n            // nothing\n        }\n    };\n\n    //// Math  /////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     * Calculates the pixel position in client space coordinates of a point in world space.\n     * @param {THREE.Vector3} point Point in world space coordinates.\n     * @param viewer\n     * @param snap Round values to closest pixel center.\n     * @returns {THREE.Vector3} Point transformed and projected into client space coordinates.\n     */\n    export var worldToClient = function(point, viewer, snap) {\n\n        var p = worldToViewport(point, viewer);\n        var result = viewportToClient(p.x, p.y, viewer);\n        result.z = 0;\n\n        // snap to the center of the\n        if (snap) {\n            result.x = Math.floor(result.x) + 0.5;\n            result.y = Math.floor(result.y) + 0.5;\n        }\n\n        return result;\n    };\n\n    export var clientToWorld = function(clientX, clientY, depth, viewer) {\n\n        var point = clientToViewport(clientX, clientY, viewer);\n        point.z = depth;\n\n        point.unproject(viewer.impl.camera);\n        return point;\n    };\n\n    export var clientToViewport = function(clientX, clientY, viewer) {\n\n        return viewer.impl.clientToViewport(clientX, clientY);\n    };\n\n    export var viewportToClient = function(viewportX, viewportY, viewer) {\n\n        return viewer.impl.viewportToClient(viewportX, viewportY);\n    };\n\n    /**\n     * Calculates the world position of a point in client space coordinates.\n     * @param {Object} point - { x:Number, y:Number, z:Number }\n     * @param {Object} viewer - LMV instance\n     * @returns {THREE.Vector3}\n     */\n    export var worldToViewport = function(point, viewer) {\n\n        var p = new THREE.Vector3();\n\n        p.x = point.x;\n        p.y = point.y;\n        p.z = point.z;\n\n        p.project(viewer.impl.camera);\n        return p;\n    };\n\n    export var metersToModel = function(meters, viewer) {\n\n        var modelToMeter = viewer.model.getUnitScale();\n        var meterToModel = 1 / modelToMeter;\n\n        return meterToModel * meters;\n    };\n\n    export var radiansToDegrees = function (radians) {\n\n        return radians * (180 / Math.PI);\n    };\n\n    export var degreesToRadians = function(degrees) {\n\n        return degrees * (Math.PI / 180);\n    };\n\n    /**\n     *\n     * @param value\n     * @returns {number}\n     */\n    export var sign = function (value) {\n\n        return (value >= 0) ? 1 : -1;\n    };\n\n    /**\n     *\n     * @param pointA\n     * @param pointB\n     * @param range\n     * @param editor\n     * @returns {boolean}\n     */\n    export var areMarkupsPointsInClientRange = function(pointA, pointB, range, editor){\n\n        range = editor.sizeFromClientToMarkups(0, range).y;\n\n        var dx = pointA.x - pointB.x;\n        var dy = pointA.y - pointB.y;\n\n        return range * range >= dx * dx + dy * dy;\n    };\n\n    //// LMV ui ////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    export var hideLmvUi = function(viewer) {\n\n        // If the viewer is no gui, then there is nothing to hide\n        if(!viewer.toolbar) {\n            return;\n        }\n\n        // Exit other tools and hide HudMessages.\n        viewer.setActiveNavigationTool();\n\n        dismissLmvHudMessage();\n        hideLmvPanels(true, viewer);\n        hideLmvToolsAndPanels(viewer);\n    };\n\n    export var restoreLmvUi = function(viewer) {\n\n        // If the viewer is no gui, then there is nothing to hide\n        if(!viewer.toolbar) {\n            return;\n        }\n\n        dismissLmvHudMessage();\n        hideLmvPanels(false, viewer);\n        showLmvToolsAndPanels(viewer);\n    };\n\n    /**\n     *\n     * @param hide\n     * @param viewer\n     */\n    export var hideLmvPanels = function(hide, viewer) {\n\n        var dockingPanels = viewer.dockingPanels;\n\n        // Panels may not be present when dealing with an instance of Viewer3D.js\n        // (as opposed to an instance of GuiViewer3D.js)\n        if (!dockingPanels) return;\n\n        for (var i = 0; i < dockingPanels.length; ++i) {\n\n            var panel = dockingPanels[i];\n            var panelContainer = panel.container;\n\n            if (panelContainer.classList.contains(\"dockingPanelVisible\")) {\n                panelContainer.style.display = hide ? \"none\" : \"block\";\n\n                // Call the visibility changed notification if any additional\n                // stuff needs to be done (update the date i.e. PropertyPanel, etc).\n                panel.visibilityChanged();\n            }\n        }\n    };\n\n    /**\n     * Shows panels and tools in the viewer.\n     * @param viewer\n     */\n    export var showLmvToolsAndPanels = function(viewer) {\n\n        // Restore view cube.\n        if(viewer && viewer.model && !viewer.model.is2d()) {\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\n                ext.displayViewCube(true, false);\n                ext.displayHomeButton(true);\n            }); \n        }\n\n        // TODO: Find or ask for a better way to restore this buttons.\n        var anim = document.getElementsByClassName('toolbar-animation-subtoolbar');\n\n        if (anim.length > 0) {\n            anim[0].style.display = '';\n        }\n\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\n        if (viewer.toolbar) {\n            var viewerContainer = viewer.toolbar.container;\n            var viewerContainerChildrenCount = viewerContainer.children.length;\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\n                viewerContainer.children[i].style.display = \"\";\n            }\n        }\n    };\n\n    /**\n     * Hides panels and tools in the viewer.\n     * @param viewer\n     */\n    export var hideLmvToolsAndPanels = function(viewer) {\n\n        // Hide Panels and tools.\n        if (viewer && viewer.model && !viewer.model.is2d()) {\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\n                ext.displayViewCube(false, false);\n                ext.displayHomeButton(false);\n            });\n            \n        }\n\n        // TODO: Find or ask for a better way to hide this buttons.\n        var anim = document.getElementsByClassName('toolbar-animation-subtoolbar');\n\n        if (anim.length > 0) {\n            anim[0].style.display = 'none';\n\n            var animator = viewer.impl.keyFrameAnimator;\n            if (animator && !animator.isPaused) {\n                animator.pauseCameraAnimations();\n                animator.pause();\n\n                var playButton = viewer.modelTools.getControl('toolbar-animationPlay');\n                if (playButton) {\n                    playButton.setIcon('toolbar-animation-pause-icon');\n                    playButton.setToolTip('Pause');\n                }\n            }\n        }\n\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\n        if (viewer.toolbar) {\n            var viewerContainer = viewer.toolbar.container;\n            var viewerContainerChildrenCount = viewerContainer.children.length;\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\n                viewerContainer.children[i].style.display = \"none\";\n            }\n        }\n    };\n\n    /**\n     * Dismisses all LMV HudMessages\n     */\n    export var dismissLmvHudMessage = function() {\n\n        // Using try/catch block since we are accessing the Private namespace of LMV.\n        try {\n            var keepDismissing = true;\n            while (keepDismissing) {\n                keepDismissing = Autodesk.Viewing.Private.HudMessage.dismiss();\n            }\n        } catch (ignore) {\n            // Failing to show the message is an okay fallback scenario\n            console.warn(\"[CO2]Failed to dismiss LMV HudMessage\");\n        }\n    };\n\n    //// Styles ////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    export var getStrokeWidth = function(widthInPixels, editor) {\n\n        var size = editor.sizeFromClientToMarkups(0, widthInPixels);\n        return size.y;\n    };\n\n    /**\n     * Creates markups from a parsed svg string child\n     * @param child - child of a parsed SVG string\n     * @param editor - MarkupsCore\n     * @returns {*} Markup Object\n     */\n    export var createMarkupFromSVG = function(child, editor) {\n        // var self = this;\n        if (!child.childNodes[0]) {\n            return null;\n        }\n\n        var meta = child.childNodes[0].childNodes[0] || '';\n\n        var getCurrentStyle = function(editor, metadata) {\n\n            var source = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity',\n                'font-family', 'font-size','font-style','font-weight','stroke-linejoin'];\n            var style = {};\n            for (var i=0; i < source.length; i++) {\n                var value = metadata.getAttribute(source[i]);\n                if(value == null) {\n                    continue;\n                }\n                switch (source[i]) {\n                    case 'font-size':\n                    case 'stroke-width':\n                    case 'stroke-opacity':\n                    case 'fill-opacity':\n                        style[source[i]] = parseFloat(value);\n                        break;\n                    case 'stroke-linejoin':\n                        break;\n                    case 'font-family':\n                    case 'font-style':\n                    case 'font-weight':\n                    case 'stroke-color':\n                    case 'fill-color':\n                        style[source[i]] = value;\n                        break;\n                    default:\n                        avp.logger.warn('Style not recognized.');\n                        break;\n                }\n            }\n            return style;\n        };\n\n        var isClosed = function() {\n            var path = child.childNodes[1] || '';\n            var closed = false;\n            if (typeof path !== 'string'){\n                var d = path.getAttribute('d').split(' ');\n                if (d[d.length-1].toLowerCase() === 'z'){\n                    closed = true;\n                }\n            }\n            return closed;\n        };\n\n        var getLocations = function() {\n            var locations = [];\n            var locStr = meta.getAttribute('locations').split(\" \") || '';\n\n            for(var i=0; i< locStr.length; i+=2) {\n                var pointPair = {x:parseFloat(locStr[i]), y:parseFloat(locStr[i+1])};\n                locations.push( pointPair )\n            }\n            return locations;\n        };\n\n        var getAttributeVector = function(attribute) {\n            var posVec = new THREE.Vector3();\n            var value = meta.getAttribute(attribute) || meta.getAttribute(attribute.toLowerCase());\n            var strPos = value.split(\" \");\n            posVec.x = parseFloat(strPos[0]);\n            posVec.y = parseFloat(strPos[1]);\n            return posVec;\n        };\n\n        var getPosition = function() {\n            return getAttributeVector('position');\n        };\n\n        var getSize = function() {\n            return getAttributeVector('size');\n        };\n\n        var getRotation = function() {\n            var strRot = meta.getAttribute('rotation') || '';\n            return parseFloat(strRot);\n        };\n\n        var getText = function() {\n            return meta.getAttribute('text') || '';\n        };\n\n        var getIsFrameUsed = function() {\n            return !!parseInt(meta.getAttribute('isframeused'));\n        };\n\n        if (typeof meta !== 'string') {\n            // get the type of the child\n            var position, size, rotation, locations, tail, head, closed, text, firstAnchor, secondAnchor;\n            var id = editor.getId();\n            var style = getCurrentStyle(editor, meta);\n            var type = meta.getAttribute('type') || '';\n            var createMarkup;\n            switch(type) {\n                case MarkupType.MARKUP_TYPE_ARROW:\n                    tail = getAttributeVector('tail');\n                    head = getAttributeVector('head');\n                    createMarkup = new CreateArrow(editor, id, tail, head, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_RECTANGLE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateRectangle(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_TEXT:\n                    position = getPosition();\n                    size = getSize();\n                    text = getText();\n                    createMarkup = new CreateText(editor, id, position, size, text, style );\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CALLOUT:\n                    position = getPosition();\n                    size = getSize();\n                    text = getText();\n                    var isFrameUsed = getIsFrameUsed();\n                    createMarkup = new CreateCallout(editor, id, position, size, text, style, isFrameUsed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CIRCLE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateCircle(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CLOUD:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateCloud(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_FREEHAND:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    createMarkup = new CreateFreehand(editor, id, position, size, rotation, locations, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_POLYLINE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    closed = isClosed();\n                    createMarkup = new CreatePolyline(editor, id, position, size, rotation, locations, style, closed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_POLYCLOUD:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    closed = isClosed();\n                    createMarkup = new CreatePolycloud(editor, id, position, size, rotation, locations, style, closed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_HIGHLIGHT:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    createMarkup = new CreateHighlight(editor, id, position, size, rotation, locations, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_DIMENSION:\n                    firstAnchor = getAttributeVector('firstAnchor');\n                    secondAnchor = getAttributeVector('secondAnchor');\n                    text = getText();\n                    createMarkup = new CreateDimension(editor, id, firstAnchor, secondAnchor, text, style);\n                    break;\n\n                default:\n                    createMarkup = null;\n                    break;\n            }\n            if (createMarkup){\n                createMarkup.addToHistory = false;\n                createMarkup.execute();\n                var markupList = editor.svgLayersMap[editor.activeLayer].markups;\n\n                for(var i = 0; i < markupList.length; ++i) {\n                    if (markupList[i].id === id) {\n                        return markupList[i];\n                    }\n                }\n            }\n            return null;\n        }\n    };\n    \n\n    export var composeRGBAString = function(hexRGBString, opacity) {\n\n        if(!hexRGBString || !opacity || opacity <= 0) {\n            return 'none';\n        }\n\n        return ['rgba(' +\n            parseInt('0x' + hexRGBString.substr(1,2)), ',',\n            parseInt('0x' + hexRGBString.substr(3,2)), ',',\n            parseInt('0x' + hexRGBString.substr(5,2)), ',', opacity, ')'].join('');\n    };\n\n    //// Id Target Collision ///////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param x0\n     * @param y0\n     * @param x1\n     * @param y1\n     * @param idTarget\n     */\n    export var checkLineSegment = function(x0, y0, x1, y1, idTarget) {\n\n        var deviceRatio = window.devicePixelRatio || 1;\n\n        x0 *= deviceRatio;\n        y0 *= deviceRatio;\n        x1 *= deviceRatio;\n        y1 *= deviceRatio;\n\n        var idTargetWidth = idTarget.width;\n        var idTargetHeight = idTarget.height;\n        var idTargetBuffer = idTarget.buffer;\n\n        x0 = Math.round(x0);\n        x1 = Math.round(x1);\n        y0 = Math.round(idTargetHeight - y0);\n        y1 = Math.round(idTargetHeight - y1);\n\n        function point(x, y) {\n\n            x = Math.round(x);\n            y = Math.round(y);\n\n            var dx = 0;\n            var dy = 0;\n\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\n                dy += check(x,y+j) ? j : 0;\n            }\n\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\n                dx += check(x+i,y) ? i : 0;\n            }\n\n            return {\n                x: Math.round(x / deviceRatio + dx),\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\n        }\n\n        function check(x, y) {\n\n            // Probably better to clip line at the beginning.\n            if (x < 0 || x >= idTargetWidth ||\n                y < 0 || y >= idTargetHeight) {\n                return false;\n            }\n\n            var index = (y * idTargetWidth + x) *4;\n            return (\n                idTargetBuffer[index  ] !== 0xFF ||\n                idTargetBuffer[index+1] !== 0xFF ||\n                idTargetBuffer[index+2] !== 0xFF);\n        }\n\n        // DDA Line algorithm\n        var dx = (x1 - x0);\n        var dy = (y1 - y0);\n\n        var m = dx !== 0 ? dy / dx : 1;\n        var x = x0;\n        var y = y0;\n\n        if (dx !== 0 && Math.abs(m) <= 1) {\n\n            if (x0 <= x1) {\n                for (; x <= x1; ++x, y += m) {\n                    if (check(x, Math.round(y))) {\n                        return point(x, y);\n                    }\n                }\n            } else {\n                for (; x >= x1; --x, y -= m) {\n                    if (check(x, Math.round(y))) {\n                        return point(x, y);\n                    }\n                }\n            }\n        } else {\n\n            m = dx !== 0 ? 1/m : 0;\n            if (y0 <= y1) {\n                for (; y <= y1; ++y, x += m) {\n                    if (check(Math.round(x), y)) {\n                        return point(x, y);\n                    }\n                }\n            } else {\n                for (; y >= y1; --y, x -= m) {\n                    if (check(Math.round(x), y)) {\n                        return point(x, y);\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     *\n     * @param polygon\n     * @param idTarget\n     */\n    export var checkPolygon = function(polygon, idTarget) {\n\n        // Return if incorrect parameters.\n        if(!polygon || polygon.verxtexCount < 3 || !idTarget) {\n            return null;\n        }\n\n        var deviceRatio = window.devicePixelRatio || 1;\n\n        var idTargetWidth = idTarget.width;\n        var idTargetHeight = idTarget.height;\n        var idTargetBuffer = idTarget.buffer;\n\n        var vertexCount = polygon.vertexCount;\n        var xVertices = Float32Array.from(polygon.xVertices); // Clone to scale by device pixel ratio and to\n        var yVertices = Float32Array.from(polygon.yVertices); // change y coordinates to OpenGL style.\n\n        function point(x, y) {\n\n            var dx = 0;\n            var dy = 0;\n\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\n                dy += check(x,y+j) ? j : 0;\n            }\n\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\n                dx += check(x+i,y) ? i : 0;\n            }\n\n            return {\n                x: Math.round(x / deviceRatio) + dx,\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\n        }\n\n        function check(x, y) {\n\n            if (x < 0 || x >= idTargetWidth ||\n                y < 0 || y >= idTargetHeight) {\n                return false;\n            }\n\n            var index = (y * idTargetWidth + x) * 4;\n            return (\n                idTargetBuffer[index  ] !== 0xFF ||\n                idTargetBuffer[index+1] !== 0xFF ||\n                idTargetBuffer[index+2] !== 0xFF) && isInsidePolygon(x, y);\n        }\n\n        function isInsidePolygon(x, y) {\n\n            var result = false;\n            var vertexCount = polygon.vertexCount;\n            for(var i = 0, j = vertexCount-1; i < vertexCount; j = i++) {\n\n                if (((yVertices[i] > y) != (yVertices[j] > y)) &&\n                     (x < (xVertices[j] - xVertices[i]) * (y - yVertices[i]) / (yVertices[j] - yVertices[i]) + xVertices[i]) ) {\n                    result = !result;\n                }\n            }\n            return result;\n        }\n\n        // Change coordinates to OpenGL style and calculate polygon's bounding box.\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < vertexCount; ++i) {\n\n            var bbX = xVertices[i] = xVertices[i] * deviceRatio;\n            var bbY = yVertices[i] = idTargetHeight - yVertices[i] * deviceRatio;\n\n            bbX0 = Math.min(bbX0, bbX);\n            bbY0 = Math.min(bbY0, bbY);\n            bbX1 = Math.max(bbX1, bbX);\n            bbY1 = Math.max(bbY1, bbY);\n        }\n\n        if (bbX1 < 0 || bbX0 > idTargetWidth ||\n            bbY1 < 0 || bbY0 > idTargetHeight) {\n            return null;\n        }\n\n        var bbW = Math.round(bbX1 - bbX0);\n        var bbH = Math.round(bbY1 - bbY0);\n\n        var bbCenterX = Math.round((bbX0 + bbX1)*0.5);\n        var bbCenterY = Math.round((bbY0 + bbY1)*0.5);\n\n        // Check\n        var x = bbCenterX;\n        var y = bbCenterY;\n\n        var w = 1;\n        var h = 1;\n\n        do {\n\n            var endX = x + w;\n            var endY = y + h;\n\n            for(; x < endX; ++x) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            for(; y < endY; ++y) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            if (w < bbW) {\n                endX = x - ++w; ++w;\n            } else {\n                endX = x - w;\n            }\n\n            if (h < bbH) {\n                endY = y - ++h; ++h;\n            } else {\n                endY = y - h;\n            }\n\n            for(; x > endX; --x) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            for(; y > endY; --y) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n        } while(w < bbW || h < bbH);\n     };\n\n    //// CSS ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @returns {*}\n     */\n    export var createStyleSheet = function() {\n\n        var style = document.createElement(\"style\");\n\n        // This is WebKit hack.\n        style.appendChild(document.createTextNode(\"\"));\n        document.head.appendChild(style);\n\n        return style.sheet;\n    };\n\n    /**\n     *\n     * @param styleSheet\n     * @param selector\n     * @param styles\n     * @param index\n     */\n    export var addRuleToStyleSheet = function(styleSheet, selector, styles, index) {\n\n        if(\"insertRule\" in styleSheet) {\n            styleSheet.insertRule(selector + \"{\" + styles + \"}\", index);\n        }\n        else if(\"addRule\" in styleSheet) {\n            styleSheet.addRule(selector, styles, index);\n        }\n    };\n\n    //// SVG ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param lines\n     * @param style\n     * @param editor\n     */\n    export var measureTextLines = function(lines, style, editor) {\n\n        // Measure div style is line style with some custom layout properties.\n        var fontSize = editor.sizeFromMarkupsToClient(0, style['font-size']).y;\n\n        var measureStyle = new DomElementStyle()\n            .setAttribute('font-family', style['font-family'])\n            .setAttribute('font-size', fontSize + 'px')\n            .setAttribute('font-weight', style['font-weight'] ? 'bold' : '')\n            .setAttribute('font-style', style['font-style'] ? 'italic' : '')\n\n            .removeAttribute(['top', 'left', 'width', 'height', 'overflow-y'])\n            .setAttribute('position','absolute')\n            .setAttribute('white-space','nowrap')\n            .setAttribute('float','left')\n            .setAttribute('visibility','hidden')\n            .getStyleString();\n\n        // Create measure div.\n        var measure = document.createElement('div');\n\n        measure.setAttribute('style', measureStyle);\n        editor.viewer.container.appendChild(measure);\n\n        // Measure.\n        var result = [];\n\n        var linesCount = lines.length;\n        for(var i = 0; i < linesCount; ++i) {\n\n            measure.innerText = lines[i];\n            result.push({\n                line: lines[i],\n                width: measure.clientWidth,\n                height: measure.clientHeight\n            });\n        }\n\n        // Remove measure div and return result.\n        editor.viewer.container.removeChild(measure);\n        return result;\n    };\n\n    export var createArcTo = function(x, y, xRadius, yRadius, relative, path) {\n\n        path.push(relative ? 'a' : 'A');\n        path.push(xRadius);\n        path.push(yRadius);\n        path.push(0);\n        path.push(1);\n        path.push(1);\n        path.push(x);\n        path.push(y);\n\n        return path;\n    };\n\n    export var createEllipsePath = function (x, y, w, h, relative, path) {\n\n        var halfW = w * 0.5;\n        var halfH = h * 0.5;\n\n        path.push(relative ? 'm' : 'M');\n        path.push(x);\n        path.push(y);\n\n        createArcTo(w, 0, halfW, halfH, true, path);\n        createArcTo(-w, 0, halfW, halfH, true, path);\n\n        path.push('z');\n    };\n\n    export var createRectanglePath = function (x, y, w, h, relative, path) {\n\n        path.push(relative ? 'm' : 'M');\n        path.push(x);\n        path.push(y);\n        path.push('l');\n        path.push(w);\n        path.push(0);\n        path.push('l');\n        path.push(0);\n        path.push(h);\n        path.push('l');\n        path.push(-w);\n        path.push(0);\n        path.push('z');\n    };\n\n    export var renderToCanvas = function(svg, viewBox, width, height, ctx, callback) {\n\n        // Creating a new svg element, that will be drawn into the canvas.\n        var tmpSvg = createSvgElement('svg');\n        \n        if (!av.isIE11) {\n            tmpSvg.setAttribute('xmlns','http://www.w3.org/2000/svg');    \n        }\n\n        tmpSvg.setAttribute('width',width);\n        tmpSvg.setAttribute('height',height);\n        tmpSvg.setAttribute('viewBox',viewBox);\n        tmpSvg.setAttribute('transform', 'scale(1,-1)');\n        \n        var markupGroup = svg.parentNode.cloneNode(true);\n\n        // Adding the markup itself to the temp SVG\n        tmpSvg.appendChild(markupGroup);\n        \n        // Get the SVG as string\n        var temp = document.createElement('div');\n        var node = tmpSvg.cloneNode(true);\n        temp.appendChild(node);\n        var data = temp.innerHTML;\n        \n        tmpSvg = temp = node = null;\n\n        var renderWithCanvg = function() {\n            canvg(ctx.canvas, data, {ignoreMouse: true, ignoreDimensions: true, ignoreClear: true, renderCallback: callback});\n        };\n\n        // IE11 blocks 'tainted' canvas for security reasons. canvg is a library that solves that issue, and draws on the canvas without tainting it.\n        if (av.isIE11) {\n            renderWithCanvg();\n        }\n        else {\n            var img = new Image();\n\n            img.onload = function() {\n                ctx.drawImage(img, 0, 0);\n                callback();\n            };\n\n            img.onerror = function() {\n                renderWithCanvg();\n            };\n\n            img.src = 'data:image/svg+xml;base64,' + window.btoa(unescape( encodeURIComponent( data )));\n        }\n    };\n\n    /*\n     Taken from Simplify.js, a high-performance JS polyline simplification library\n     (c) 2013, Vladimir Agafonkin\n     mourner.github.io/simplify-js\n    */\n   export var simplify = function(points, tolerance, highestQuality) {\n\n        if (points.length <= 2) return points;\n\n        // square distance between 2 points\n        function getSqDist(p1, p2) {\n\n            var dx = p1.x - p2.x,\n                dy = p1.y - p2.y;\n\n            return dx * dx + dy * dy;\n        }\n\n        // square distance from a point to a segment\n        function getSqSegDist(p, p1, p2) {\n\n            var x = p1.x,\n                y = p1.y,\n                dx = p2.x - x,\n                dy = p2.y - y;\n\n            if (dx !== 0 || dy !== 0) {\n\n                var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n\n                if (t > 1) {\n                    x = p2.x;\n                    y = p2.y;\n\n                } else if (t > 0) {\n                    x += dx * t;\n                    y += dy * t;\n                }\n            }\n\n            dx = p.x - x;\n            dy = p.y - y;\n\n            return dx * dx + dy * dy;\n        }\n        // rest of the code doesn't care about point format\n\n        // basic distance-based simplification\n        function simplifyRadialDist(points, sqTolerance) {\n\n            var prevPoint = points[0],\n                newPoints = [prevPoint],\n                point;\n\n            for (var i = 1, len = points.length; i < len; i++) {\n                point = points[i];\n\n                if (getSqDist(point, prevPoint) > sqTolerance) {\n                    newPoints.push(point);\n                    prevPoint = point;\n                }\n            }\n\n            if (prevPoint !== point) newPoints.push(point);\n\n            return newPoints;\n        }\n\n        function simplifyDPStep(points, first, last, sqTolerance, simplified) {\n            var maxSqDist = sqTolerance,\n                index;\n\n            for (var i = first + 1; i < last; i++) {\n                var sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n                if (sqDist > maxSqDist) {\n                    index = i;\n                    maxSqDist = sqDist;\n                }\n            }\n\n            if (maxSqDist > sqTolerance) {\n                if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);\n                simplified.push(points[index]);\n                if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);\n            }\n        }\n\n        // simplification using Ramer-Douglas-Peucker algorithm\n        function simplifyDouglasPeucker(points, sqTolerance) {\n            var last = points.length - 1;\n\n            var simplified = [points[0]];\n            simplifyDPStep(points, 0, last, sqTolerance, simplified);\n            simplified.push(points[last]);\n\n            return simplified;\n        }\n\n        // both algorithms combined for awesome performance\n        var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\n\n        points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\n        points = simplifyDouglasPeucker(points, sqTolerance);\n\n        return points;\n    }\n\n","'use strict';\n\n    /**\n     * This class will group actions edit actions that should be executed as a whole.\n     * When a group is open actions can be added to it, similar actions will be merged into one during this process.\n     * This class is not intended to be used by users, it's a helper class of EditActionManager.\n     * @constructor\n     */\n    export function EditActionGroup() {\n\n        this.actions = [];\n        this.closed = true;\n    }\n\n    var proto = EditActionGroup.prototype;\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.open = function() {\n\n        if(!this.closed) {\n            return false;\n        }\n\n        this.closed = false;\n        return true;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.close = function() {\n\n        if (this.closed) {\n            return false;\n        }\n\n        this.closed = true;\n        return true;\n    };\n\n    /**\n     *\n     * @returns {number} targetId\n     */\n    proto.undo = function() {\n\n        var actions = this.actions;\n        var actionsMaxIndex = actions.length - 1;\n\n        var targetId = -1;\n        for(var i = actionsMaxIndex; i >= 0; --i) {\n\n            var action =  actions[i];\n            action.undo();\n\n            if (action.targetId !== -1) {\n                targetId = action.targetId;\n            }\n        }\n\n        return targetId;\n    };\n\n    /**\n     *\n     * @returns {number} targetId\n     */\n    proto.redo = function() {\n\n        var actions = this.actions;\n        var actionsCount = actions.length;\n\n        var targetId = -1;\n        for(var i = 0; i < actionsCount; ++i) {\n\n            var action =  actions[i];\n            action.redo();\n\n            if (action.targetId !== -1) {\n                targetId = action.targetId;\n            }\n        }\n\n        return targetId;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isOpen = function() {\n\n        return !this.closed;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isClosed = function() {\n\n        return this.closed;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isEmpty = function() {\n\n        return this.actions.length === 0;\n    };\n\n    /**\n     *\n     * @param {EditAction} action\n     */\n    proto.addAction = function(action) {\n\n        if (this.closed) {\n            return false;\n        }\n\n        this.actions.push(action);\n        this.compact();\n\n        return true;\n    };\n\n    /**\n     * @private\n     */\n    proto.compact = function() {\n\n        var actions = this.actions;\n        var actionsCount = actions.length;\n\n        for(var i = 0; i < actionsCount; ++i) {\n\n            // If an action does nothing, remove it.\n            var actionA = actions[i];\n            if (actionA.isIdentity()) {\n                actions.splice(i, 1);\n                --actionsCount;\n                --i;\n                continue;\n            }\n\n            // If an action can be merged, merge it.\n            for (var j = i + 1; j < actionsCount; ++j) {\n\n                var actionB = actions[j];\n                if (actionA.type === actionB.type &&\n                    actionA.merge(actionB)) {\n                    actions.splice(j, 1);\n                    --actionsCount;\n                    --i;\n                    break;\n                }\n            }\n        }\n    };\n\n    proto.getTargetId = function() {\n      var actions = this.actions;\n      var actionsCount = actions.length;\n      var targetId = -1;\n      for(var i = 0; i < actionsCount; ++i) {\n        var action =  actions[i];\n        if (action.targetId !== -1) {\n          targetId = action.targetId;\n        }\n      }\n      return targetId;\n    }","'use strict';\n\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditActionGroup } from './EditActionGroup'\n\n    /**\n     *\n     * @param historySize\n     * @constructor\n     */\n    export function EditActionManager(historySize) {\n\n        this.historySize = historySize;\n\n        this.undoStack = [];\n        this.redoStack = [];\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = EditActionManager.prototype;\n\n    /**\n     *\n     * @param action\n     */\n    proto.execute = function(action) {\n\n        var redoStack = this.redoStack;\n        var undoStack = this.undoStack;\n\n        redoStack.splice(0, redoStack.length);\n\n        action.redo();\n\n        var group = this.getEditActionGroup();\n        if (group.isOpen()) {\n            group.addAction(action);\n        } else {\n            group.open();\n            group.addAction(action);\n            group.close();\n        }\n\n        if (undoStack.length > this.historySize) {\n            undoStack.splice(0,1);\n        }\n\n        var targetId = action.selectOnExecution ? action.targetId : -1;\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'execute', targetId: targetId}});\n    };\n\n    proto.beginActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n        var group = null;\n\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\n\n            group = this.getEditActionGroup();\n            group.open();\n        } else {\n            console.warn('Markups - Undo/Redo - Action edit group already open.');\n        }\n    };\n\n    proto.closeActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n\n        if (undoStackCount === 0) {\n\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\n            return;\n        }\n\n        var group = undoStack[undoStackCount-1];\n        if(!group.close()) {\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\n        }\n\n        if (group.isEmpty()) {\n            undoStack.pop();\n        }\n    };\n\n    proto.cancelActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n\n        if (undoStackCount === 0) {\n\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\n            return;\n        }\n\n        var group = undoStack[undoStackCount-1];\n        if(!group.close()) {\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\n            return;\n        }\n\n        group.undo();\n        undoStack.pop();\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'cancel', targetId: -1}});\n    };\n\n    proto.undo = function() {\n\n        var undoStack = this.undoStack;\n        var redoStack = this.redoStack;\n\n        if (undoStack.length === 0) {\n            return;\n        }\n\n        var group = undoStack.pop();\n        var targetId = group.undo();\n\n        redoStack.push(group);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'undo', targetId: targetId}});\n    };\n\n    proto.redo = function() {\n\n        var undoStack = this.undoStack;\n        var redoStack = this.redoStack;\n\n        if (redoStack.length === 0) {\n            return;\n        }\n\n        var group = redoStack.pop();\n        var targetId = group.redo();\n\n        undoStack.push(group);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'redo', targetId: targetId}});\n    };\n\n    proto.clear = function() {\n\n        this.undoStack.splice(0, this.undoStack.length);\n        this.redoStack.splice(0, this.redoStack.length);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'clear', targetId: -1}});\n    };\n\n    proto.isUndoStackEmpty = function() {\n\n        return this.undoStack.length === 0;\n    };\n\n    proto.isRedoStackEmpty = function() {\n\n        return this.redoStack.length === 0;\n    };\n\n    proto.getLastElementInUndoStack = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n        return undoStack[undoStackCount-1];\n    }\n\n    /**\n     *\n     * @return action\n     * @private\n     */\n    proto.getEditActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = this.undoStack.length;\n\n        var group = null;\n\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\n            group = new EditActionGroup();\n            undoStack.push(group);\n        } else {\n            group = undoStack[undoStackCount-1];\n        }\n\n        return group;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param markup\n     * @param position\n     * @constructor\n     */\n    export function CloneMarkup(editor, id, markup, position) {\n\n        EditAction.call(this, editor, 'CLONE-MARKUP', id);\n\n        this.clone = markup.clone();\n        this.clone.id = id;\n        this.position = {x: position.x, y: position.y};\n    }\n\n    CloneMarkup.prototype = Object.create(EditAction.prototype);\n    CloneMarkup.prototype.constructor = CloneMarkup;\n\n    var proto = CloneMarkup.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var clone = this.clone;\n        var position = this.position;\n\n        if (editor.getMarkup(this.targetId)) {\n            return;\n        }\n\n        var markup = clone.clone();\n        markup.setPosition(position.x, position.y);\n\n        editor.addMarkup(markup);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { CloneMarkup } from '../edit-actions/CloneMarkup'\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function Clipboard(editor) {\n\n        this.editor = editor;\n        this.content = null;\n        this.pastePosition = {x:0, y: 0};\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = Clipboard.prototype;\n\n    proto.copy = function() {\n\n        var selectedMarkup = this.editor.getSelection();\n        if(!selectedMarkup) {\n            return;\n        }\n\n        this.content = selectedMarkup.clone();\n        this.pastePosition.x = selectedMarkup.position.x;\n        this.pastePosition.y = selectedMarkup.position.y;\n    };\n\n    proto.cut = function() {\n\n        var selectedMarkup = this.editor.getSelection();\n        if(!selectedMarkup) {\n            return;\n        }\n\n        this.copy();\n        this.editor.deleteMarkup(selectedMarkup);\n    };\n\n    proto.paste = function() {\n\n        var content = this.content;\n        if(!content) {\n            return;\n        }\n\n        var editor = this.editor;\n        var position = this.pastePosition;\n        var delta = editor.sizeFromClientToMarkups(20, 20);\n\n        position.x += delta.x;\n        position.y -= delta.y;\n\n        var cloneMarkup = new CloneMarkup(editor, editor.getId(), content, position);\n        cloneMarkup.execute();\n    };\n","'use strict';\n\nimport { isTouchDevice } from '../MarkupsCoreUtils'\n\n    var av = Autodesk.Viewing;\n    var avp = av.Private;\n\n    var _mouseEnabled = false;\n    var _mousePrevValue = false;\n    var _lock = false;\n\n    export function InputHandler() {\n\n        this.editor = null;\n        this.mousePosition = {x:0, y:0};\n        this.makeSameXY = false; // TODO: FIND a better way to name and communicate these.\n        this.snapRotations = false;\n        this.keepAspectRatio = false;\n        this.constrainAxis = false;\n        this.duringEditMode = false;\n\n        this.onWheelBinded = this.onWheel.bind(this);\n        this.onTouchDragBinded = this.onTouchDrag.bind(this);\n        this.onTouchPanBinded = this.onTouchPan.bind(this);\n        this.onTouchPinchBinded = this.onTouchPinch.bind(this);\n        this.onSingleTapBinded = this.onSingleTap.bind(this);\n        this.onDoubleTapBinded = this.onDoubleTap.bind(this);\n        this.onMouseMoveBinded = this.onMouseMove.bind(this);\n        this.onMouseUpBinded = this.onMouseUp.bind(this);\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\n        this.onMouseDoubleClickBinded = this.onMouseDoubleClick.bind(this);\n        this.onHammerInputBinded = this.onHammerInput.bind(this);\n        this.isMouseDown = false;\n    }\n\n    var proto = InputHandler.prototype;\n\n    proto.attachTo = function(editor) {\n\n        this.editor && this.detachFrom(this.editor);\n        this.editor = editor;\n\n        if (isTouchDevice()) {\n\n            this.hammer = new av.Hammer.Manager(editor.svg, {\n                recognizers: [\n                    av.GestureRecognizers.drag,\n                    av.GestureRecognizers.doubletap,\n                    av.GestureRecognizers.doubletap2,\n                    av.GestureRecognizers.singletap,\n                    av.GestureRecognizers.singletap2,\n                    av.GestureRecognizers.press,\n                    av.GestureRecognizers.pan,\n                    av.GestureRecognizers.pinch\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\n            });\n\n            this.hammer.get('doubletap2').recognizeWith('doubletap');\n            this.hammer.get('singletap2').recognizeWith('singletap');\n            this.hammer.get('singletap').requireFailure('doubletap');\n        }\n    };\n\n    proto.onHammerInput = function(event) {\n\n        this.setMouseDisabledWhenTouching(event);\n    };\n\n    proto.setMouseDisabledWhenTouching = function(event) {\n\n        if (event.isFirst && !_lock) {\n            this.enableMouseButtons(false);\n            _lock = true;\n        } else if (event.isFinal) {\n            var _this = this;\n            setTimeout(function() {\n                _this.enableMouseButtons(_mousePrevValue);\n                _lock = false;\n            }, 10);\n        }\n    };\n\n    proto.enableMouseButtons = function(state) {\n\n        if (state && !_mouseEnabled)\n        {\n            this.editor.svg.addEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.addEventListener('dblclick', this.onMouseDoubleClickBinded);\n            this.editor.svg.addEventListener('wheel', this.onWheelBinded);\n            this.editor.svg.addEventListener('DOMMouseScroll', this.onWheelBinded); // Firefox\n            document.addEventListener('mousemove', this.onMouseMoveBinded);\n            document.addEventListener('mouseup', this.onMouseUpBinded);\n        }\n        else if (!state && _mouseEnabled)\n        {\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\n            this.editor.svg.removeEventListener('wheel', this.onWheelBinded);\n            this.editor.svg.removeEventListener('DOMMouseScroll', this.onWheelBinded);\n            document.removeEventListener('mousemove', this.onMouseMoveBinded);\n            document.removeEventListener('mouseup', this.onMouseUpBinded);\n\n        }\n\n        _mousePrevValue = _mouseEnabled;\n        _mouseEnabled = state;\n    };\n\n    proto.detachFrom = function(editor) {\n\n        this.hammer && this.hammer.destroy();\n\n        document.removeEventListener('mousemove', this.onMouseMoveBinded);\n        document.removeEventListener('mouseup', this.onMouseUpBinded);\n\n        if (this.editor) {\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\n        }\n\n        this.editor = editor;\n    };\n\n    proto.enterEditMode = function() {\n        if (this.duringEditMode) {\n            return;\n        }\n\n        if (this.hammer) {\n            this.hammer.on('dragstart dragmove dragend', this.onTouchDragBinded);\n            this.hammer.on('panstart panmove panend', this.onTouchPanBinded);\n            this.hammer.on('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\n            this.hammer.on('singletap', this.onSingleTapBinded);\n            this.hammer.on('singletap2', this.onSingleTapBinded);\n            this.hammer.on('doubletap', this.onDoubleTapBinded);\n            this.hammer.on('doubletap2', this.onDoubleTapBinded);\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\n\n\t\t\tthis.hammer.get('drag').requireFailure('pinch');\n            this.hammer.get('drag').requireFailure('pan');\n        }\n\n        if (!av.isMobileDevice()) {\n            this.enableMouseButtons(true);\n        }\n\n        this.duringEditMode = true;\n    };\n\n    proto.leaveEditMode = function() {\n        if (!this.duringEditMode) {\n            return;\n        }\n\n        if (this.hammer) {\n            this.hammer.off('dragstart dragmove dragend', this.onTouchDragBinded);\n\t\t\tthis.hammer.off('panstart panmove panend', this.onTouchPanBinded);\n            this.hammer.off('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\n            this.hammer.off('singletap', this.onSingleTapBinded);\n            this.hammer.off('singletap2', this.onSingleTapBinded);\n            this.hammer.off('doubletap', this.onDoubleTapBinded);\n            this.hammer.off('doubletap2', this.onDoubleTapBinded);\n            this.hammer.off('hammer.input', this.onHammerInputBinded);\n        }\n\n        if (!av.isMobileDevice()) {\n            this.enableMouseButtons(false);\n        }\n\n        this.duringEditMode = false;\n    };\n\n    proto.enterViewMode = function() {\n\n    };\n\n    proto.leaveViewMode = function() {\n\n    };\n\n    proto.getMousePosition = function() {\n\n        return {x: this.mousePosition.x, y: this.mousePosition.y};\n    };\n\n    proto.onWheel = function(event) {\n\n        if (!av.isMobileDevice()) {\n            this.editor.viewer.toolController.mousewheel(event);\n        }\n\n        event.preventDefault();\n    };\n\n    proto.onMouseMove = function(event) {\n\n        processMouseEvent(this, event);\n\n        if (!av.isMobileDevice()) {\n            this.editor.viewer.toolController.mousemove(event);\n        }\n\n        this.editor.onMouseMove(event);\n        event.preventDefault();\n    };\n\n\n    proto.onMouseDownRightClick = function(event) {\n\n        // Don't do blur in full screen (IE issue)\n        if (!(av.isIE11 && av.inFullscreen())) {\n            document.activeElement && document.activeElement.blur && document.activeElement.blur();\n        }\n\n        var controller = this.editor.viewer.toolController;\n        controller.__clientToCanvasCoords(event);\n\n        this.editor.markupTool.handleButtonDown(event, 2);\n    };\n\n    proto.onMouseUpRightClick = function(event) {\n\n        var controller = this.editor.viewer.toolController;\n        controller.__clientToCanvasCoords(event);\n\n        this.editor.markupTool.handleButtonUp(event, 2);\n    };\n\n    proto.onMouseDown = function(event) {\n\n        processMouseEvent(this, event);\n\n        // Panning when right clicking\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.onMouseDownRightClick(event);\n            return;\n        }\n        \n        this.isMouseDown = true;\n        this.editor.onMouseDown(event);\n        event.preventDefault();\n    };\n\n    proto.onMouseUp = function(event) {\n\n        processMouseEvent(this, event);\n\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.onMouseUpRightClick(event);\n            return;\n        }\n\n        this.isMouseDown = false;\n        this.editor.onMouseUp(event);\n        event.preventDefault();\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        processMouseEvent(this, event);\n        this.editor.onMouseDoubleClick(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchDrag = function(event) {\n\n        convertEventHammerToMouse(event);\n        switch (event.type) {\n          case 'dragstart':\n                this.onMouseDown(event);\n                break;\n            case 'dragmove':\n                this.onMouseMove(event);\n                break;\n           case 'dragend':\n                this.onMouseUp(event);\n                break;\n        }\n        event.preventDefault();\n    };\n\n    proto.onTouchPan = function(event) {\n\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchPinch = function(event) {\n\n        processMouseEvent(this, event);\n\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        \n        this.mousePosition.x = this.mousePosition.y = null;\n        this.editor.callSnapperMouseMove();\n\n        event.preventDefault();\n    };\n\n    proto.onSingleTap = function(event) {\n\n        convertEventHammerToMouse(event);\n\n        this.onMouseDown(event);\n        this.onMouseUp(event);\n        event.preventDefault();\n    };\n\n    proto.onDoubleTap = function(event) {\n\n        convertEventHammerToMouse(event);\n        this.onMouseDoubleClick(event);\n        event.preventDefault();\n    };\n\n    function processMouseEvent(input, event) {\n\n        var rect = input.editor.svg.getBoundingClientRect();\n\n        input.makeSameXY = event.shiftKey;\n        input.snapRotations = event.shiftKey;\n        input.keepAspectRatio = event.shiftKey;\n        input.constrainAxis = event.shiftKey;\n\n        input.mousePosition.x = event.clientX - rect.left;\n        input.mousePosition.y = event.clientY - rect.top;\n    }\n\n    function convertEventHammerToMouse(event) {\n\n        // Convert Hammer touch-event X,Y into mouse-event X,Y.\n        event.shiftKey = false;\n        event.clientX = event.pointers[0].clientX;\n        event.clientY = event.pointers[0].clientY;\n    }\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    export function SetPosition(editor, markup, position) {\n\n        EditAction.call(this, editor, 'SET-POSITION', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n    }\n\n    SetPosition.prototype = Object.create(EditAction.prototype);\n    SetPosition.prototype.constructor = SetPosition;\n\n    var proto = SetPosition.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setPosition(this.newPosition.x, this.newPosition.y);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setPosition(this.oldPosition.x, this.oldPosition.y);\n    };\n\n    /**\n     *\n     * @param action\n     * @returns {boolean}\n     */\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        var newPosition = this.newPosition;\n        var oldPosition = this.oldPosition;\n\n        return newPosition.x === oldPosition.x && newPosition.y === oldPosition.y;\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param angle\n     * @constructor\n     */\n    export function SetRotation(editor, markup, angle) {\n\n        EditAction.call(this, editor, 'SET-ROTATION', markup.id);\n\n        var curAngle = markup.getRotation();\n\n        this.newRotation = {angle: angle};\n        this.oldRotation = {angle: curAngle};\n    }\n\n    SetRotation.prototype = Object.create(EditAction.prototype);\n    SetRotation.prototype.constructor = SetRotation;\n\n    var proto = SetRotation.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setRotation(this.newRotation.angle);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setRotation(this.oldRotation.angle);\n    };\n\n    /**\n     *\n     * @param action\n     * @returns {boolean}\n     */\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newRotation = action.newRotation;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return this.newRotation.angle === this.oldRotation.angle;\n    };\n\n","'use strict';\n\nimport { EDIT_FRAME_DEFAULT_MARGIN, \n         addTraitEventDispatcher, isTouchDevice, degreesToRadians } from './MarkupsCoreUtils'\nimport * as MarkupEvents from './MarkupEvents'\nimport { CloneMarkup } from './edit-actions/CloneMarkup'\nimport { SetPosition } from './edit-actions/SetPosition'\nimport { SetSize } from './edit-actions/SetSize'\nimport { SetRotation } from './edit-actions/SetRotation'\n\n     var av = Autodesk.Viewing;\n     var avp = Autodesk.Viewing.Private;\n\n    /**\n     * A component to handle the selection of markups.\n     *\n     *\n     *      Sample\n     *\n     *      var containingDiv = document.getElementById('containingDiv3d-app-wrapper');\n     *      var selectionComponent = new EditFrame(containingDiv);\n     *      selectionComponent.setSelection(100, 100, 300, 150, 0);\n     *\n     * @param {HTMLElement} containingDiv The container where the selection layer will live.\n     * @param {Object} editor\n     * @constructor\n     */\n    export function EditFrame(containingDiv, editor) {\n\n        this.containingDiv = containingDiv;\n        this.editor = editor;\n        this.selectionLayer = createSelectionLayer();\n\n        this.frameMargin = EDIT_FRAME_DEFAULT_MARGIN;\n\n        this.selection = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            rotation: 0,\n            element: null,\n            active: false,\n            dragging: false,\n            resizing: false,\n            //a dictionary of all the drag points\n            //the key for each drag point will be its cardinal/ordinal direction\n            handle: {}\n        };\n\n        createSelectorBox.bind(this)();\n\n        if (isTouchDevice()) {\n            this.hammer = new av.Hammer.Manager(this.selectionLayer, {\n                recognizers: [\n                    av.GestureRecognizers.drag,\n                    av.GestureRecognizers.doubletap,\n                    av.GestureRecognizers.doubletap2,\n                    av.GestureRecognizers.pan,\n                    av.GestureRecognizers.pinch\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\n            });\n\n            this.onHammerDragBinded = this.onHammerDrag.bind(this);\n            this.onHammerDoubleTapBinded = this.onHammerDoubleTap.bind(this);\n            this.onTouchPanBinded = this.onTouchPan.bind(this);\n            this.onTouchPinchBinded = this.onTouchPinch.bind(this);\n\n            this.hammer.on(\"dragstart dragmove dragend\", this.onHammerDragBinded);\n            this.hammer.on(\"doubletap\", this.onHammerDoubleTapBinded);\n            this.hammer.on(\"doubletap2\", this.onHammerDoubleTapBinded);\n            this.hammer.on(\"panstart panmove panend\", this.onTouchPanBinded);\n            this.hammer.on(\"pinchstart pinchmove pinchend\", this.onTouchPinchBinded);\n\n            this.hammer.get('drag').requireFailure('pinch');\n            this.hammer.get('drag').requireFailure('pan');\n        }\n\n        handleSelectionBoxDragging.bind(this)();\n        handleSelectionBoxResizing.bind(this)();\n        handleSelectionDoubleClick.bind(this)();\n        handleSelectionBoxRotating.bind(this)();\n\n        //add the selection into the container given to us\n        this.containingDiv.appendChild(this.selectionLayer);\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = EditFrame.prototype;\n\n    proto.unload = function() {\n\n        this.containingDiv.removeChild(this.selectionLayer);\n        this.selectionLayer = null;\n    };\n    /**\n     * Draws a selection box with the given attributes\n     *\n     * @param {number} x - The x coordinate to place the selection box\n     * @param {number} y - The y coordinate to place the selection box\n     * @param {number} width - The width of the selection box\n     * @param {number} height - The height of the selection box\n     * @param {number} rotation - The amount of degrees to rotate the selection box\n     */\n    proto.setSelection = function (x, y, width, height, rotation) {\n\n        var margin = this.frameMargin;\n        var doubleMargin = margin * 2;\n\n        updateSelectorBoxDimensions.bind(this)(width + doubleMargin, height + doubleMargin);\n        updateSelectorBoxPosition.bind(this)(x - margin, y - margin, rotation);\n        updateSelectionBoxState.bind(this)(true); //activate the selection box\n        this.selectionLayer.style.visibility = 'visible';\n    };\n\n    /**\n     * Displays the selection box based on the position, dimension, and rotation of a given markup\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - the markup that should appear as selected\n     */\n    proto.setMarkup = function (markup) {\n\n        this.hammer && this.hammer.set({enable: markup !== null});\n        this.markup = markup;\n\n        updateSelectionBoxState.bind(this)(false);\n\n        if (markup) {\n            var boundingBox = markup.getBoundingRect();\n            var rotation = markup.getRotation();\n            this.frameMargin = boundingBox.margin !== undefined ? boundingBox.margin : EDIT_FRAME_DEFAULT_MARGIN;\n\n            this.setSelection(boundingBox.x, boundingBox.y, boundingBox.width, boundingBox.height, rotation);\n\n            this.enableResizeHandles();\n            this.enableRotationHandle();\n\n            if (markup.preventReposition) {\n                this.selectionLayer.firstChild.style.cursor = '';\n            }\n            else {\n                this.selectionLayer.firstChild.style.cursor = 'move';\n            }\n        }\n    };\n\n    proto.startDrag = function (event) {\n\n        if (this.markup && this.markup.preventReposition) return;\n\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\n        this._onRepositionMouseDown(event, this.editor.getMousePosition());\n    };\n\n     proto.isActive = function() {\n        return this.selection.active;\n     };\n\n    proto.isDragging = function () {\n\n        return this.selection.dragging;\n    };\n\n    proto.isResizing = function () {\n\n        return this.selection.resizing;\n    };\n\n    proto.isRotating = function () {\n\n        return this.selection.rotating;\n    };\n\n    proto.onMouseMove = function (event) {\n\n        //dummy fn\n    };\n\n    proto.onMouseUp = function (event) {\n        //dummy fn\n    };\n\n    proto.onWheel = function (event) {\n        this.editor.viewer.toolController.mousewheel(event);\n    };\n\n    proto.onTouchPan = function(event) {\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchPinch = function(event) {\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n     proto.onHammerDrag = function(event) {\n\n         function updateEditorInput(input, parent, event) {\n\n             //TODO: Change this when refactoring input in edit frame.\n             var rect = parent.getBoundingClientRect();\n             input.mousePosition.x = event.pageX - rect.left;\n             input.mousePosition.y = event.pageY - rect.top;\n         }\n\n        //console.log('EditFrame drag ' + event.type);\n         convertEventHammerToMouse(event);\n         switch (event.type) {\n             case 'dragstart':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.editor.callSnapperMouseDown();\n                 // Check whether to translate, rotate or resize\n                 if (isRotatePoint(event.target)) {\n                     // Rotate\n                     this._onRotationMouseDown(event);\n                 } else if (isDragPoint(event.target)) {\n                     // Resize\n                     this._onResizeMouseDown(event);\n                 } else {\n                     this.startDrag(event);\n                 }\n                 event.preventDefault();\n                 break;\n             case 'dragmove':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.editor.callSnapperMouseMove();\n                 this.onMouseMove(event);\n                 event.preventDefault();\n                 break;\n             case 'dragend':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.onMouseUp(event);\n                 event.preventDefault();\n                 break;\n         }\n     };\n\n    proto.onHammerDoubleTap = function(event) {\n\n        function updateEditorInput(input, parent, event) {\n\n            //TODO: Change this when refactoring input in edit frame.\n            var rect = parent.getBoundingClientRect();\n            input.mousePosition.x = event.pageX - rect.left;\n            input.mousePosition.y = event.pageY - rect.top;\n        }\n\n        convertEventHammerToMouse(event);\n        updateEditorInput(this.editor.input, this.editor.svg, event);\n\n        this.selection.dragging = false;\n        this.editor.editMode && this.editor.editMode.onMouseDoubleClick(this.markup);\n    };\n\n    proto.enableResizeHandles = function () {\n\n        var markup = this.markup;\n        var handle;\n\n        if (markup.isHeightConstrained() || markup.isWidthConstrained()) {\n            //hide all the handles\n            for (var direction in this.selection.handle) {\n                handle = this.selection.handle[direction];\n                if(handle) handle.style.display = 'none';\n            }\n\n            //show only the resize points that are allowed\n            if (!markup.isHeightConstrained()) {\n                this.selection.handle['n'].style.display = 'block';\n                this.selection.handle['s'].style.display = 'block';\n            }\n            if (!markup.isWidthConstrained()) {\n                this.selection.handle['w'].style.display = 'block';\n                this.selection.handle['e'].style.display = 'block';\n            }\n        } else {\n            //no constraints, show all resize handles\n            for (var direction in this.selection.handle) {\n                handle = this.selection.handle[direction];\n                if(handle) handle.style.display = 'block';\n            }\n        }\n    };\n\n    proto.enableRotationHandle = function () {\n\n        var markup = this.markup;\n        var display = markup.isRotationConstrained() ? 'none' : 'block';\n        this.selection.rotationHandle.style.display = display;\n        this.selection.rotationBridge.style.display = display;\n    };\n\n     function convertEventHammerToMouse(event) {\n         // Convert Hammer touch-event X,Y into mouse-event X,Y.\n         event.pageX = event.pointers[0].clientX;\n         event.pageY = event.pointers[0].clientY;\n     }\n\n    /**\n     * Creates an element spanning the full height and width of its parent.\n     * It serves as our surface to draw the selection box.\n     *\n     * @return {HTMLElement}\n     */\n    function createSelectionLayer() {\n\n        var selectionLayer = document.createElement('div');\n        selectionLayer.style.position = 'absolute';\n        selectionLayer.style.top = 0;\n        selectionLayer.style.bottom = 0;\n        selectionLayer.style.left = 0;\n        selectionLayer.style.right = 0;\n        //don't let the selection box be visible outside the selection layer\n        selectionLayer.style.overflow = 'hidden';\n        selectionLayer.style.visibility = 'hidden';\n        togglePointerEvents(selectionLayer, false);\n        return selectionLayer;\n    }\n\n    /**\n     * Creates a single drag point with the corresponding styles\n     *\n     * @param {number} diameter - The size of the drag point\n     * @param {string} position - The cardinal(n, s, w, e) or ordinal(nw, nw, sw, se) direction of the point\n     * @return {HTMLElement}\n     */\n    function createDragPoint(position) {\n\n        var point = document.createElement('div');\n\n        setResizeCursor(point, position);\n        point.className = 'selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-' + position;\n        point.classList.add('adsk-viewing-viewer');\n        point.setAttribute('data-sdp-handle', position);\n\n        return point;\n    }\n\n    function createRotatePoint () {\n        var point = document.createElement('div');\n        point.classList.add('adsk-viewing-viewer');\n        point.classList.add('selector-rotate-point');\n        point.classList.add('autodesk-markups-extension-core-make-me-bigger');\n        setResizeCursor(point, 'w');\n\n        return point;\n    }\n\n    function createRotationBridge() {\n        var rotationBridge = document.createElement('div');\n        rotationBridge.classList.add('adsk-viewing-viewer');\n        rotationBridge.classList.add('selector-rotate-point');\n        rotationBridge.classList.add('autodesk-markups-extension-core-make-me-bigger');\n        rotationBridge.classList.add('rotation-bridge');\n        setResizeCursor(rotationBridge, 'w');\n\n        return rotationBridge;\n    }\n\n    function setResizeCursor (element, direction) {\n\n        var cursor;\n        switch(direction) {\n            case 'n':\n            case 's':\n                cursor = 'ns-resize';\n                break;\n            case 'w':\n            case 'e':\n                cursor = 'ew-resize';\n                break;\n            case 'ne':\n            case 'sw':\n                cursor = 'nesw-resize';\n                break;\n            case 'nw':\n            case 'se':\n                cursor = 'nwse-resize';\n                break;\n        }\n        element.style.cursor = cursor;\n    }\n\n    /**\n     * Creates the 8 drag points of the selection box.\n     *\n     * @this EditFrame\n     */\n    function createDragPoints(selector) {\n\n        ['n', 's', 'w', 'e', 'nw', 'ne', 'sw', 'se'].forEach(function (direction) {\n            //store the drag point and put it in the DOM\n            this.selection.handle[direction] = createDragPoint(direction);\n            selector.appendChild(this.selection.handle[direction]);\n        }.bind(this));\n    }\n\n    /**\n     * Determines if an element is a drag point\n     *\n     * @return {boolean}\n     */\n    function isDragPoint(element) {\n\n        return matchesSelectorAux(element, '.selector-drag-point');\n    }\n\n    /**\n     * Determines if an element is a rotate point\n     *\n     * @return {boolean}\n     */\n    function isRotatePoint(element) {\n\n        return matchesSelectorAux(element, '.selector-rotate-point');\n    }\n\n    /**\n     * Creates the element that will be used as the selection box. It also\n     * takes care of adding the drag handles\n     *\n     * @return {HTMLElement} - the selection box\n     * @this EditFrame\n     */\n    function createSelectorBox() {\n\n        var selectorBox = document.createElement('div');\n        togglePointerEvents(selectorBox, true);\n        selectorBox.classList.add('selector-box');\n\n        this.selection.rotationBridge = createRotationBridge();\n        selectorBox.appendChild(this.selection.rotationBridge);\n\n        this.selection.rotationHandle = createRotatePoint();\n        selectorBox.appendChild(this.selection.rotationHandle);\n\n        createDragPoints.bind(this)(selectorBox);\n\n        //store the selector box\n        this.selection.element = selectorBox;\n\n        if (!av.isMobileDevice()) {\n            this.onWheelBinded = this.onWheel.bind(this);\n            this.selection.element.addEventListener('wheel', this.onWheelBinded);\n            this.selection.element.addEventListener('DOMMouseScroll', this.onWheelBinded); // firefox\n        }\n\n        //add the selection box to the selection layer\n        this.selectionLayer.appendChild(this.selection.element);\n\n        //we are just creating the box, start it out hidden\n        updateSelectionBoxState.bind(this)(false);\n\n        return selectorBox;\n    }\n\n    /**\n     * Utility to create the CSS translate3d value from a given 2d point\n     *\n     * @param {number} x - coordinate\n     * @param {number} y - coordinate\n     * @return {string}\n     */\n    function toTranslate3d(x, y) {\n\n        return 'translate3d(' + x + 'px,' + y + 'px,0)';\n    }\n\n\n    /**\n     * Updates the display state of the selection box\n     *\n     * @param {boolean} active - The new state of the the selection box\n     * @this EditFrame\n     */\n    function updateSelectionBoxState(active) {\n\n        this.selection.active = active;\n        this.selection.element.style.display = active ? 'block' : 'none';\n    }\n\n    /**\n     * Updates the position and rotation of the selection box.\n     *\n     * @param {number} x - The x coordinate to place the selection box\n     * @param {number} y - The y coordinate to place the selection box\n     * @param {number} rotation - The amount of degrees to rotate the selection box\n     * @this EditFrame\n     */\n    function updateSelectorBoxPosition(x, y, rotation) {\n\n        this.selection.x = x;\n        this.selection.y = y;\n        this.selection.rotation = rotation;\n        var size = this.markup.getBoundingRect();\n        //TODO: consider DomElementStyle\n\n        size.width += this.frameMargin * 2;\n        size.height += this.frameMargin * 2;\n\n        var transform = toTranslate3d(x, y) + ' rotate(' + rotation + 'rad)';\n        var transformOrigin = (size.width / 2) + 'px ' + (size.height / 2) + 'px';\n\n        this.selection.element.style.msTransform =\n            this.selection.element.style.webkitTransform =\n            this.selection.element.style.transform = transform;\n        this.selection.element.style.msTransformOrigin =\n            this.selection.element.style.webkitTransformOrigin =\n            this.selection.element.style.transformOrigin = transformOrigin;\n    }\n\n    /**\n     * Updates the dimensions of the selection box (width and height).\n     *\n     * @param {number} width - The new width of the selection box\n     * @param {number} height - The new height of the selection box\n     * @this EditFrame\n     */\n    function updateSelectorBoxDimensions(width, height) {\n\n        this.selection.width = width;\n        this.selection.height = height;\n        this.selection.element.style.width = width + 'px';\n        this.selection.element.style.height = height + 'px';\n    }\n\n    /**\n     * Attaches all the necessary listeners to handle a drag action.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionBoxDragging () {\n\n        this.selection.element.addEventListener('mousedown', this._onRepositionMouseDown.bind(this));\n    }\n\n    /**\n     * Handles panning when right clicking down\n     * @param event\n     * @returns {boolean} returns true if the event was handled\n     * @private\n     */\n    proto._handleRightClickDown = function(event) {\n\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.editor.input.onMouseDownRightClick(event);\n            return true;\n        }\n\n        return false;\n    };\n\n    var ignoreFirstMouseMove = false;\n    proto._onRepositionMouseDown = function (event, cursor) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        // Return for markups that are not allowed to be repositioned.\n        if (this.markup && this.markup.preventReposition) return;\n\n        // ignore the first mouse move for the Microsoft Surface\n        ignoreFirstMouseMove = !av.isMobileDevice() && av.isTouchDevice();\n        //a synthetic start means that the event was triggered manually and not as a\n        //result of a mousedown on the edit frame\n        var syntheticStart = !(event instanceof MouseEvent);\n\n        //during a real mousedown, ignore events originating from a resizing handle\n        if (!syntheticStart && (isDragPoint(event.target) || isRotatePoint(event.target))) return;\n\n        //get the cursor position\n        cursor = syntheticStart ?  cursor : this.editor.getMousePosition();\n\n        //store the initial cursor and axis constrains\n        this.initialCursor = cursor;\n        this.initialPosition = this.markup.getClientPosition();\n        this.areAxisConstrained = false;\n        this.axisConstrains = new THREE.Vector2(1,1);\n\n        //update the function that will handle the mousemove and mouseup events\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\n\n        if (this.selection.dragging)\n            return;\n\n        this.selection.dragging = true;\n        this.editor.beginActionGroup();\n\n        //if alt down I drop a clone.\n        if (event && event.altKey) {\n            var editor = this.editor;\n            var cloneMarkup = new CloneMarkup(editor, editor.getId(), this.markup, this.markup.position);\n            cloneMarkup.execute();\n        }\n\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Moving around\n    };\n\n    proto._onRepositionMouseMove = function(event) {\n\n        // This check is needed for selecting markups on devices that have touch screen + mouse (eg: Microsoft Surface)\n        if (ignoreFirstMouseMove) {\n            ignoreFirstMouseMove = false;\n            return;\n        }\n        //ignore mousemove events if the dragging state hasn't been activated\n        if (!this.selection.dragging || !this.markup || this.markup.preventReposition) return;\n\n        //get the position of the cursor relative to selection layer\n        var cursor = this.editor.getMousePosition();\n\n        //constrain axis if shift key is down.\n        var constrainAxis = this.editor.input.constrainAxis;\n        if (this.areAxisConstrained !== constrainAxis) {\n            this.areAxisConstrained = constrainAxis;\n            this.axisConstrains = constrainAxis ? new THREE.Vector2(0, 0) : new THREE.Vector2(1,1);\n\n            this.initialPosition.x += cursor.x - this.initialCursor.x;\n            this.initialPosition.y += cursor.y - this.initialCursor.y;\n\n            this.initialCursor.x = cursor.x;\n            this.initialCursor.y = cursor.y;\n        }\n\n        //determine how many pixel we have to shift the\n        //selection box to keep the cursor on the drag point\n        var movement = {\n            x: cursor.x - this.initialCursor.x,\n            y: cursor.y - this.initialCursor.y\n        };\n\n        var deadZone = 15;\n        if (this.axisConstrains.x === 0 && this.axisConstrains.y === 0) {\n\n            if (Math.abs(movement.x) > deadZone) {\n                this.axisConstrains.x = 1;\n                movement.x += movement.x < 0 ?  deadZone : -deadZone;\n            } else\n            if (Math.abs(movement.y) > deadZone) {\n                this.axisConstrains.y = 1;\n                movement.y += movement.y < 0 ?  deadZone : -deadZone;\n            }\n        }\n\n        var x = this.initialPosition.x + movement.x * this.axisConstrains.x;\n        var y = this.initialPosition.y + movement.y * this.axisConstrains.y;\n\n        updateSelectorBoxPosition.bind(this)(x, y, this.selection.rotation);\n\n        //tell the markup to start transforming\n        //the markup expects an (x, y) coordinate that\n        //uses an origin at the center, adjust our x, y because\n        //our origin starts at the top left\n        var position = this.editor.positionFromClientToMarkups(x, y);\n        var setPosition = new SetPosition(this.editor, this.markup, position);\n        setPosition.execute();\n    };\n\n    proto._onRepositionMouseUp = function () {\n\n        if (this.markup && this.markup.preventReposition) return;\n\n        this.last = null;\n\n        //this should never be called after the mouse up because we are no longer repositioning\n        this.onMouseMove = function () {/*do nothing*/};\n        this.onMouseUp = function () {/*do nothing*/};\n\n        if(!this.selection.dragging) {\n            return;\n        }\n\n        this.editor.closeActionGroup();\n        this.selection.dragging = false;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Moving around\n    };\n\n    proto._onResizeMouseDown = function (event) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        var target = event.target;\n\n        //is the target where the mousedown occurred a drag point\n        if (!isDragPoint(target)) {\n            return;\n        }\n\n        //keep a reference to the point where the drag started\n        this.selection.handle.resizing = target;\n        //figure out which direction this point should resize\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\n        //set the cursor position for the entire layer\n        this.containingDiv.style.cursor = direction + '-resize';\n\n        var cursor = this.editor.getMousePosition();\n\n        var position = this.markup.getClientPosition();\n        var size = this.markup.getBoundingRect();\n\n        //store the center\n        this.initial = {\n            x: position.x,\n            y: position.y,\n            width: size.width,\n            height: size.height,\n            mouseX: cursor.x,\n            mouseY: cursor.y\n        };\n\n        this.onMouseMove = this._onResizeMouseMove.bind(this);\n        this.onMouseUp = this._onResizeMouseUp.bind(this);\n\n        if (this.selection.resizing) {\n            return;\n        }\n\n        this.selection.resizing = true;\n        this.editor.beginActionGroup();\n\n        setHandleSelected(event.target, true);\n\n        //notify the markup that dragging has started\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Resizing\n    };\n\n    proto._onResizeMouseMove = function (event) {\n\n        if (!this.selection.resizing) return;\n\n        var cursor = this.editor.getMousePosition();\n        var initial = this.initial;\n\n        var movement = {\n            x: cursor.x - initial.mouseX,\n            y: cursor.y - initial.mouseY\n        };\n\n        var vector = new THREE.Vector3(movement.x, movement.y, 0);\n        var undoRotation = new THREE.Matrix4().makeRotationZ(-this.selection.rotation);\n        movement = vector.applyMatrix4(undoRotation);\n\n        var x = initial.x,\n            y = initial.y,\n            width = initial.width,\n            height = initial.height;\n\n        var localSpaceDelta = new THREE.Vector3();\n\n        //get the direction of the arrow being dragged\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\n\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\n        // If shift is pressed, figure aspect ratio is maintained.\n        if (this.editor.input.keepAspectRatio && ['nw', 'ne', 'sw', 'se'].indexOf(direction) !== -1) {\n\n            var delta = new THREE.Vector3(movement.x, movement.y, 0);\n            switch (direction){\n                case 'nw': movement.set(-initial.width,-initial.height, 0); break;\n                case 'ne': movement.set( initial.width,-initial.height, 0); break;\n                case 'sw': movement.set( initial.width,-initial.height, 0); break;\n                case 'se': movement.set( initial.width, initial.height, 0); break;\n            }\n            movement.normalize();\n            movement = delta.projectOnVector(movement);\n        }\n\n        var translations = {\n            n: function () {\n                height -= movement.y;\n                localSpaceDelta.y = movement.y;\n            },\n            s: function () {\n                height += movement.y;\n                localSpaceDelta.y = movement.y;\n            },\n            w: function () {\n                width -= movement.x;\n                localSpaceDelta.x = movement.x;\n            },\n            e: function () {\n                width += movement.x;\n                localSpaceDelta.x = movement.x;\n            },\n            nw: function () {\n                this.n();\n                this.w();\n            },\n            ne: function () {\n                this.n();\n                this.e();\n            },\n            sw: function () {\n                this.s();\n                this.w();\n            },\n            se: function () {\n                this.s();\n                this.e();\n            }\n        };\n\n        translations[direction]();\n\n        // Check if new size is smaller than min width or height\n        if (width <= this.markup.getMinWidth() || height <= this.markup.getMinHeight()) return;\n\n        var redoRotation = new THREE.Matrix4().makeRotationZ(this.selection.rotation);\n        var actualDelta = localSpaceDelta.applyMatrix4(redoRotation);\n\n        var newPos = this.editor.positionFromClientToMarkups(\n            x + (actualDelta.x * 0.5),\n            y + (actualDelta.y * 0.5));\n\n        var newSize = this.editor.sizeFromClientToMarkups(width, height);\n\n        var setSize = new SetSize(this.editor, this.markup, newPos, newSize.x, newSize.y);\n        setSize.execute();\n    };\n\n    function setHandleSelected (handle, isSelected) {\n        if (isSelected) {\n            handle.classList.add('selected');\n        } else {\n            handle.classList.remove('selected');\n        }\n    }\n\n    proto._onResizeMouseUp = function (event) {\n        this.selection.resizing = false;\n        this.selection.handle.resizing = null;\n        this.containingDiv.style.cursor = '';\n\n        for (var direction in this.selection.handle) {\n            if (this.selection.handle[direction]) {\n                setHandleSelected(this.selection.handle[direction], false);\n            }\n        }\n\n\n        this.editor.closeActionGroup();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Resizing\n\n        //this should never be called after the mouse up because we are no longer resizing\n        this.onMouseMove = function () {/*do nothing*/\n        };\n        this.onMouseUp = function () {/*do nothing*/\n        };\n    };\n\n\n    /**\n     * Attaches all the necessary listeners to handle a resizing action.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionBoxResizing() {\n        this.selectionLayer.addEventListener('mousedown', this._onResizeMouseDown.bind(this));\n    }\n\n    function handleSelectionBoxRotating () {\n\n        this.selection.element.addEventListener('mousedown', this._onRotationMouseDown.bind(this));\n    }\n\n    var initialRotation;\n    var initialHandlePosition;\n\n    proto._onRotationMouseDown = function (event) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        //ignore anything not coming from the rotation point\n        if (!isRotatePoint(event.target)) return;\n\n        this.editor.beginActionGroup();\n        this.selection.rotating = true;\n\n        //store the initial cursor\n        initialHandlePosition = this.editor.getMousePosition();\n\n        initialRotation = this.selection.rotation || 0;\n\n        //update the function that will handle the mousemove and mouseup events\n        this.onMouseMove = this._onRotationMouseMove.bind(this);\n        this.onMouseUp = this._onRotationMouseUp.bind(this);\n\n        setHandleSelected(event.target, true);\n\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Rotating\n    };\n\n     proto._onRotationMouseMove = function (event) {\n\n        //ignore mousemove events if the dragging state hasn't been activated\n        if (!this.selection.rotating) return;\n\n        var cursor = this.editor.getMousePosition();\n        var position = this.markup.getClientPosition();\n\n        var r = getAngleBetweenPoints(position, cursor);\n        var r2 = getAngleBetweenPoints(position, initialHandlePosition);\n        var rotation = r - r2 + initialRotation;\n\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\n        if (this.editor.input.snapRotations) {\n            var snap = degreesToRadians(22.5);\n            rotation = Math.ceil(rotation / snap) * snap;\n        }\n\n         //pass rotation as degrees\n         updateSelectorBoxPosition.bind(this)(this.selection.x, this.selection.y, rotation);\n\n        //convert to radians\n        var setRotation = new SetRotation(this.editor, this.markup, rotation);\n        setRotation.execute();\n    };\n\n    proto._onRotationMouseUp = function (event) {\n\n        this.selection.rotating = false;\n        initialRotation = null;\n        initialHandlePosition = null;\n        setHandleSelected(this.selection.rotationHandle, false);\n        this.editor.closeActionGroup();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Rotating\n    };\n\n    /**\n     * Attaches double click listener and pass events to markup, markups such as text use it to enter text edit\n     * mode.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionDoubleClick() {\n\n        var doubleClick = function (event) {\n            if (event.defaultPrevented) {\n                return;\n            }\n            this.selection.dragging = false;\n            var editMode = this.editor.editMode;\n            editMode && editMode.onMouseDoubleClick(this.markup);\n        }.bind(this);\n\n        var selectorBoxWrapper = this.selectionLayer;\n        selectorBoxWrapper.addEventListener('dblclick', doubleClick);\n    }\n\n    function togglePointerEvents(element, state) {\n\n        element.style.pointerEvents = state ? 'auto' : 'none';\n    }\n\n    function getAngleBetweenPoints (p1, p2) {\n\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    }\n\n     function matchesSelectorAux(domElem, selector) {\n         if (domElem.matches) return domElem.matches(selector); //Un-prefixed\n         if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\n         if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\n         if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\n         return false;\n     }\n","'use strict';\n\n    var avp = Autodesk.Viewing.Private;\n\n    export function MarkupTool() {\n\n        Autodesk.Viewing.ToolInterface.call(this);\n        this.names = [\"markups.core\"];\n        this.panTool = null;\n        this.allowNav = false;\n        this.is2d = false;\n\n        this.coreExt = null;\n        this.hotkeysEnabled = true;\n\n        var _ctrlDown = false;\n        var _shiftDown = false;\n\n        // Non-ToolInterface methods //\n\n        this.allowNavigation = function(allow) {\n            this.allowNav = allow;\n        };\n        this.setCoreExtension = function(coreExt) {\n            this.coreExt = coreExt;\n        };\n        this.setHotkeysEnabled = function(enabled) {\n            this.hotkeysEnabled = enabled;\n        };\n\n\n        // ToolInterface methods //\n\n        this.activate = function(name, viewerApi) {\n            this.panTool = viewerApi.toolController.getTool(\"pan\");\n            if (this.panTool) {\n                this.panTool.activate(\"pan\"); // TODO: What if we want \"zoom\" here?\n            }\n\n            this.is2d = viewerApi.model.is2d();\n            this.viewer = viewerApi;\n        };\n\n        this.deactivate = function(name) {\n            if (this.panTool) {\n                this.panTool.deactivate(\"pan\");\n            }\n        };\n\n        this.handleKeyDown = function(event, keyCode) {\n\n            if (!this.coreExt.editMode) {\n                return false;\n            }\n\n            if (!this.hotkeysEnabled) {\n                return true; // Consume event\n            }\n\n            // Don't propagate key handling down to tool //\n\n            switch (keyCode) {\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = true; break;\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = true; break;\n\n                case Autodesk.Viewing.KeyCode.x: _ctrlDown && !this.allowNav && this.coreExt.cut(); break;\n                case Autodesk.Viewing.KeyCode.c: _ctrlDown && !this.allowNav && this.coreExt.copy(); break;\n                case Autodesk.Viewing.KeyCode.v: _ctrlDown && !this.allowNav && this.coreExt.paste(); break;\n                case Autodesk.Viewing.KeyCode.d:\n                    if (_ctrlDown && !this.allowNav) {\n                        // Duplicate\n                        this.coreExt.copy();\n                        this.coreExt.paste();\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.z:\n                    if (_ctrlDown && !_shiftDown && !this.allowNav) {\n                        this.coreExt.undo();\n                    }\n                    else if (_ctrlDown && _shiftDown && !this.allowNav) {\n                        this.coreExt.redo(); // Also support Ctrl+Y\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.y: _ctrlDown && !this.allowNav && this.coreExt.redo(); break; // Also support ctrl+shift+z\n                case Autodesk.Viewing.KeyCode.ESCAPE: this.coreExt.onUserCancel(); break;\n\n                case Autodesk.Viewing.KeyCode.BACKSPACE: // Fall through\n                case Autodesk.Viewing.KeyCode.DELETE:\n                    var selectedMarkup = this.coreExt.getSelection();\n                    if (selectedMarkup) {\n                        this.coreExt.deleteMarkup(selectedMarkup);\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.F12:\n                    return false; // To allow opening developer console.\n                    break;\n                default: break;\n            }\n\n            return true; // Consume event\n        };\n        this.handleKeyUp = function(event, keyCode) {\n\n            if (!this.coreExt.editMode) {\n                return false;\n            }\n\n            if (!this.hotkeysEnabled) {\n                return true; // Consume event\n            }\n\n            // Don't propagate key handling down to tool\n\n            switch (keyCode) {\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = false; break;\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = false; break;\n                default: break;\n            }\n\n            return true; // Consume event ONLY\n        };\n\n        this.update = function() {\n            if (this.allowNav && this.panTool && this.panTool.update) {\n                return this.panTool.update();\n            }\n            return false;\n        };\n\n        this.handleSingleClick = function( event, button ) {\n            if (this.allowNav) {\n                // If pan tool won't handle single click, then pass over the event.\n                if (this.panTool && this.panTool.handleSingleClick)\n                    return this.panTool.handleSingleClick(event, button);\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleDoubleClick = function( event, button ) {\n            if (this.allowNav) {\n                // If pan tool won't handle double click, then pass over the event\n                if (this.panTool && this.panTool.handleDoubleClick) {\n                    return this.panTool.handleDoubleClick(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleSingleTap = function( event ) {\n            if (this.allowNav) {\n                // If pan tool won't handle single tap, then pass over the event\n                if (this.panTool && this.panTool.handleSingleTap) {\n                    return this.panTool.handleSingleTap(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleDoubleTap = function( event ) {\n            if (this.allowNav) {\n                // If pan tool won't handle double tap, then pass over the event\n                if (this.panTool && this.panTool.handleDoubleTap) {\n                    return this.panTool.handleDoubleTap(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleWheelInput = function(delta) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle wheel input, then pass over the event\n                if (this.panTool && this.panTool.handleWheelInput) {\n                    this.coreExt.callSnapperMouseMove();\n                    return this.panTool.handleWheelInput(delta);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleButtonDown = function(event, button) {\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\n                // If pan tool won't handle button down, then pass over the event\n                if (this.panTool && this.panTool.handleButtonDown) {\n                    return this.panTool.handleButtonDown(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleButtonUp = function(event, button) {\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\n                // If pan tool won't handle button up, then pass over the event\n                if (this.panTool && this.panTool.handleButtonUp) {\n                    return this.panTool.handleButtonUp(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleMouseMove = function(event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle button move, then pass over the event\n                if (this.panTool && this.panTool.handleMouseMove) {\n                    return this.panTool.handleMouseMove(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleGesture = function(event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle gesture, then pass over the event\n                if (this.panTool && this.panTool.handleGesture) {\n                    return this.panTool.handleGesture(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleBlur = function(event) {\n            if (this.allowNav) {\n                // If pan tool won't handle blur, then pass over the event\n                if (this.panTool && this.panTool.handleBlur) {\n                    return this.panTool.handleBlur(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n    }\n","\n// Maps EditMode id (string) into a contructor/class\nvar _editModes = {};\n\nclass EditModeManager {\n    constructor(){\n        // nothing //\n    }\n\n    register(id, clazz) {\n        if (id in _editModes)\n            throw new Error(`EditMode with id (${id}) already registered.`);\n        \n            _editModes[id] = clazz;\n    }\n\n    unregister(id) {\n        if (id in _editModes)\n            delete _editModes[id];\n    }\n\n    getClass(id) {\n        return _editModes[id] || null;\n    }\n\n    getRegistered() {\n        var ret = {}\n        for (var id in _editModes) {\n            if (_editModes.hasOwnProperty(id)) {\n                ret[id] = _editModes[id];\n            }\n        }\n        return ret; // shallow copy.\n    }\n}\n\n\nexport var theEditModeManager =  new EditModeManager();","\nimport { theEditModeManager } from '../EditModeManager'\nimport * as MarkupTypes from '../MarkupTypes'\n\nimport { EditModeArrow } from './EditModeArrow'\nimport { EditModeText } from './EditModeText'\nimport { EditModeRectangle } from './EditModeRectangle'\nimport { EditModeCircle } from './EditModeCircle'\nimport { EditModeCloud } from './EditModeCloud'\nimport { EditModeFreehand } from './EditModeFreehand'\nimport { EditModeHighlight } from './EditModeHighlight'\nimport { EditModePolyline } from './EditModePolyline'\nimport { EditModePolycloud } from './EditModePolycloud'\nimport { EditModeCallout } from './EditModeCallout'\nimport { EditModeDimension } from './EditModeDimension'\n\n\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_ARROW, EditModeArrow);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_TEXT, EditModeText);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_RECTANGLE, EditModeRectangle);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CIRCLE, EditModeCircle);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CLOUD, EditModeCloud);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_FREEHAND, EditModeFreehand);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_HIGHLIGHT, EditModeHighlight);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYLINE, EditModePolyline);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYCLOUD, EditModePolycloud);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CALLOUT, EditModeCallout);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_DIMENSION, EditModeDimension);\n\n","'use strict';\n\nimport { EditActionManager } from './edit-actions/EditActionManager'\nimport * as MarkupEvents from './MarkupEvents'\nimport * as MarkupTypes from './MarkupTypes'\nimport { addTraitEventDispatcher, createSvgElement, setSvgParentAttributes,\n    MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,\n    hideLmvUi, restoreLmvUi, dismissLmvHudMessage, \n    removeAllMetadata, transferChildNodes, addSvgMetadata,\n    svgNodeToString, checkPolygon, stringToSvgNode, createMarkupFromSVG,\n    worldToClient, clientToWorld } from './MarkupsCoreUtils'\nimport { cloneStyle, copyStyle, createStyle } from './StyleUtils'\nimport { DomElementStyle } from './DomElementStyle'\nimport { Clipboard } from './edit-clipboard/Clipboard'\nimport { InputHandler } from './edit-input/InputHandler'\nimport { EditFrame } from './EditFrame'\nimport { MarkupTool } from './MarkupTool'\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\n\nimport * as Blah from './edit-modes/BuiltinEditModes' // IMPORTANT!!\nimport CSS from './Markups.css' // IMPORTANT!!\n\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    var PERSPECTIVE_MODE_SCALE = 1000;\n\n    /**\n     * Extension that allows end users to draw 2D markups on top of 2D and 3D models.\n     *\n     * @tutorial feature_markup\n     * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance used to operate on.\n     * @param {object} options - Same Dictionary object passed into {@link Autodesk.Viewing.Viewer3D|Viewer3D}'s constructor.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}.\n     * @param {boolean} [options.markupDisableHotkeys] - Disables hotkeys for copy, cut, paste, duplicate, undo, redo and deselect.\n     * @param {Autodesk.Viewing.ToolInterface} [options.markupToolClass] - Class override for input handling.\n     * Use it to override/extend default hotkeys and/or mouse/gesture input.\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @constructor\n     */\n    export function MarkupsCore(viewer, options) {\n\n        Autodesk.Viewing.Extension.call(this, viewer, options);\n\n        this.options = this.options || {};\n        this.markups = [];\n        this.styles = {};\n\n        this.activeLayer = '';\n        this.duringViewMode = false;\n        this.duringEditMode = false;\n\n        this.svgLayersMap = {};\n\n        // Add action manager.\n        this.actionManager = new EditActionManager( 50 ); // history of 50 actions.\n        this.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onEditActionHistoryChanged.bind(this));\n\n        this.nextId = 0; // Used to identify markups by id during an edit session.\n\n        // Clipboard.\n        this.clipboard = new Clipboard(this);\n\n        // Default Input handler.\n        this.input = new InputHandler();\n\n        // Extension will dispatch events.\n        addTraitEventDispatcher(this);\n\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, function() {\n            this.getStrokeWidth();\n            this.getFontWidth();\n        }.bind(this), { once: true });\n\n        // Handled events.\n        this.onCameraChangeBinded = this.onCameraChange.bind(this);\n        this.onViewerResizeBinded = function(event) {\n            // This is ugly, but we need to do this twice\n            var self = this;\n            // First usage is to avoid a blinking scenario\n            self.onViewerResize(event);\n            requestAnimationFrame(function(){\n                // Second one is to actually make it work on some resize scenarios.\n                // Check the unlikely scenario that we are no longer in view mode.\n                if (self.duringViewMode) {\n                    self.onViewerResize(event);\n                }\n            });\n        }.bind(this);\n\n        this.onMarkupSelectedBinded = this.onMarkupSelected.bind(this);\n        this.onMarkupEnterEditionBinded = this.onMarkupEnterEdition.bind(this);\n        this.onMarkupCancelEditionBinded = this.onMarkupCancelEdition.bind(this);\n        this.onMarkupDeleteEditionBinded = this.onMarkupDeleteEdition.bind(this);\n        this.onToolChangeBinded = this.onToolChange.bind(this);\n        this.onUnitsCalibrationStartsBinded = this.onUnitsCalibrationStarts.bind(this);\n\n        viewer.addEventListener(MeasureCommon.Events.UNITS_CALIBRATION_STARTS_EVENT, this.onUnitsCalibrationStartsBinded);\n    }\n\n    MarkupsCore.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\n    MarkupsCore.prototype.constructor = MarkupsCore;\n\n    var proto = MarkupsCore.prototype;\n\n    proto.load = function () {\n\n        // Add layer where annotations will actually live\n        var svg = this.svg = createSvgElement('svg');\n        setSvgParentAttributes(svg);\n\n        // NOTE: Required since LMV renders Y coordinates upwards,\n        // while browser's Y coordinates goes downwards.\n        var svgStyle = new DomElementStyle();\n        svgStyle.setAttribute('position', 'absolute');\n        svgStyle.setAttribute('left', '0');\n        svgStyle.setAttribute('top', '0');\n        svgStyle.setAttribute('transform', 'scale(1,-1)', { allBrowsers: true});\n        svgStyle.setAttribute('transformOrigin', '0, 0', { allBrowsers: true});\n        svg.setAttribute('style', svgStyle.getStyleString());\n\n        this.bounds = {x:0, y:0, width:0, height:0};\n\n        this.input.attachTo(this);\n\n        //Instantiate edit frame.\n        this.editFrame = new EditFrame(this.viewer.container, this);\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_START, function(){this.disableMarkupInteractions(true);}.bind(this));\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\n\n        // Register tool\n        var toolClass = this.options.markupToolClass || MarkupTool;\n        this.changeMarkupTool(toolClass, !this.options.markupDisableHotkeys);\n\n        this.snapper = new MeasureCommon.Snapper(this.viewer, {markupMode:true});\n        this.viewer.toolController.registerTool(this.snapper);\n\n        return true;\n    };\n\n    /**\n     * Change the markup tool's class in order to implement a different behaviour to the UI.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupTool} toolClass - Implementation or extension of MarkupTool's class.\n     * @param {boolean} enableHotKeys - Whether to enable markup's hot-keys or not.\n     */\n    proto.changeMarkupTool = function(toolClass, enableHotKeys) {\n        if (this.markupTool) {\n            this.viewer.toolController.deregisterTool(this.markupTool);\n            this.markupTool = null;\n        }\n\n        this.markupTool = new toolClass();\n        this.markupTool.setCoreExtension(this);\n        this.markupTool.setHotkeysEnabled(enableHotKeys);\n        this.viewer.toolController.registerTool(this.markupTool);\n    };\n\n    proto.unload = function() {\n\n        this.hide();\n\n        this.input.detachFrom(this);\n\n        this.editFrame.unload();\n\n        if (this.markupTool) {\n            this.viewer.toolController.deregisterTool(this.markupTool);\n            this.markupTool = null;\n        }\n\n        if (this.snapper) {\n            this.viewer.toolController.deregisterTool(this.snapper);\n            this.snapper = null;\n        }\n\n        var svg = this.svg;\n        if (svg && this.onMouseDownBinded) {\n            svg.removeEventListener(\"mousedown\", this.onMouseDownBinded);\n            this.onMouseDownBinded = null;\n        }\n        if (svg.parentNode) {\n            svg.parentNode.removeChild(svg);\n        }\n        this.editModeSvgLayerNode = null;\n        this.svg = null;\n\n        return true;\n    };\n\n    MarkupsCore.prototype.getStrokeWidth = function() {\n        \n        if (!this.initialStrokeWidth || (this.viewer.model && !this.viewer.model.is2d())) {\n            this.initialStrokeWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS).y;\n        }\n\n        return this.initialStrokeWidth;\n    };\n\n    MarkupsCore.prototype.getFontWidth = function() {\n        \n        if (!this.initialFontWidth || (this.viewer.model && !this.viewer.model.is2d())) {\n            this.initialFontWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS).y;\n        }\n\n        return this.initialFontWidth;\n    };\n\n    /**\n     * Toggle in and out of Edit mode. In Edit mode the user is able to draw markups on the canvas.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}\n     */\n    MarkupsCore.prototype.toggleEditMode = function() {\n\n        if (this.duringEditMode) {\n            this.leaveEditMode();\n        } else {\n            this.enterEditMode();\n        }\n    };\n\n    /**\n     * Enables mouse interactions and mobile device gestures over the Viewer canvas to create or draw markups.\n     *\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\n     * @param {string} layerId - [optional] Identifier for the layer of markups to be edited. Example \"Layer1\".\n     * @returns {boolean} Returns true if editMode is active\n     */\n    MarkupsCore.prototype.enterEditMode = function(layerId) {\n\n        function disableLayerMarkups(layer, disable){\n            if (layer){\n                var layerMarkups = layer.markups;\n                for (var k = 0; k < layerMarkups.length; k++){\n                    var m = layerMarkups[k];\n                    m.disableInteractions(disable);\n                }\n            }\n        }\n        if (layerId) {\n            if (!this.svgLayersMap[layerId]) {\n                // if layerId is supplied but it does not exist in the svgLayerMap then create the new layer\n                console.warn(\"No such layer exists.\");\n                return false;\n            }\n        }\n\n        // If not currently shown, then show\n        if (!this.duringViewMode) {\n            if (!this.show()){\n                return false; // Failed to enter view mode.\n            }\n        }\n\n        // Initialize the edit mode layer if it does not exist\n        if(!this.editModeSvgLayerNode) {\n            var parSvg = createSvgElement('g');\n            this.editModeSvgLayerNode = {\n                markups: [],\n                svg: parSvg\n            };\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', 'default');\n        }\n\n\n        if ((this.editModeSvgLayerNode.svg.parentNode != this.svg) || !layerId) {\n            this.svg.appendChild(this.editModeSvgLayerNode.svg);\n        }\n        this.svg.setAttribute('cursor', 'crosshair');\n\n\n        if (layerId) {\n            var layer = this.svgLayersMap[layerId];\n            // If the layer exists in the layer map, use the information stored for that specific layer.\n            if (layer) {\n                // Remove the edit layer when entering edit mode of a specific edit mode.\n                var editModeLayerParentNode = this.editModeSvgLayerNode.svg.parentNode;\n                editModeLayerParentNode && editModeLayerParentNode.removeChild(this.editModeSvgLayerNode.svg);\n\n                // disable the markups in the editModeLayer\n                disableLayerMarkups(this.editModeSvgLayerNode, true);\n\n                // Enable interactions for markups in the current edit layer and disable interactions for markups in\n                // the other layers.\n                for (var key in this.svgLayersMap){\n                    var markups = this.svgLayersMap[key].markups;\n                    for (var i = 0; i < markups.length; i++) {\n                        var markup = markups[i];\n                        if (key !== layerId.toString()){\n                            // disable all not in the current layer.\n                            markup.disableInteractions(true);\n                        } else {\n                            // enable all markups in current layer.\n                            markup.disableInteractions(false);\n                        }\n                    }\n                }\n\n                // assign the current layer to the global active layer\n                this.activeLayer = layerId;\n                this.editingLayer = layerId;\n                var svgParent = layer.svg;\n\n                // remove previous svg layer child from svg\n                svgParent.parentNode && this.svg.removeChild(svgParent);\n\n                // reassign the markups in that layer to the global markups list\n                this.markups = layer.markups.slice();\n\n                // re-append svg layer child to svg to make it the top most layer\n                this.svg.appendChild(svgParent);\n            }\n        } else {\n            // disable interactions for the previous markups\n            // Example: enterEditMode(layer) -> enterEditMode()\n            if (this.editingLayer) {\n                for (var k = 0; k < this.markups.length; k++) {\n                    var m = this.markups[k];\n                    m.disableInteractions(true);\n                }\n                disableLayerMarkups(this.editModeSvgLayerNode, false);\n            }\n            this.editingLayer = '';\n            if (!this.editModeSvgLayerNode) {\n                this.markups = [];\n            }else{\n                this.markups = this.editModeSvgLayerNode.markups.slice();\n            }\n            this.activeLayer = '';\n        }\n\n        this.input.enterEditMode();\n        this.activateTool(true);\n        this.styles = {}; // Clear EditMode styles.\n        this.defaultStyle = null;\n        this.duringEditMode = true;\n        this.changeEditMode(new EditModeArrow(this));\n        this.actionManager.clear();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_ENTER });\n        this.allowNavigation(false);\n        return true;\n    };\n\n    /**\n     * Exits Edit mode.\n     *\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\n     *\n     * @returns {boolean} Returns true if Edit mode has been deactivated\n     */\n    MarkupsCore.prototype.leaveEditMode = function() {\n\n        var NOT_IN_EDIT_MODE = true;\n        var WE_ARE_STILL_IN_EDIT_MODE = false;\n\n        if (!this.duringEditMode || !this.duringViewMode) {\n            return NOT_IN_EDIT_MODE;\n        }\n\n        var viewer = this.viewer;\n        if (!viewer) {\n            return WE_ARE_STILL_IN_EDIT_MODE; // something is very wrong...\n        }\n\n        this.editMode.destroy();\n        this.editMode = null;\n        this.duringEditMode = false;\n\n        if (this.snapper) {\n            this.snapper.indicator.clearOverlays();\n            this.snapper.clearSnapped();\n        }\n\n        // Remove the edit layer\n        if (this.editModeSvgLayerNode && this.editModeSvgLayerNode.svg.parentNode){\n            this.svg.removeChild(this.editModeSvgLayerNode.svg);\n        }\n        this.svg.setAttribute('cursor', 'default');\n\n        this.input.leaveEditMode();\n        this.editFrame.setMarkup(null);\n        this.activateTool(true);\n\n        this.allowNavigation(true);\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_LEAVE });\n        return NOT_IN_EDIT_MODE;\n    };\n\n    /**\n     * Toggle between visible markups, i.e., show() and hidden markups, i.e., hide().\n     */\n    MarkupsCore.prototype.toggle = function() {\n\n        if (this.duringViewMode) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    };\n\n    /**\n     * Enables loading of previously saved markups.\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\n     * @returns {boolean} Whether it successfully entered view mode or not.\n     */\n    MarkupsCore.prototype.show = function() {\n\n        var viewer = this.viewer;\n        if (!viewer || !viewer.model || !this.svg) {\n            return false;\n        }\n\n        // Return if already showing or in edit-mode.\n        // Notice that edit mode requires that we are currently show()-ing.\n        if (this.duringViewMode || this.duringEditMode) {\n            return true;\n        }\n\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\n        viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\n\n        // Add parent svg of all markups.\n        viewer.container.appendChild(this.svg);\n        viewer.reorderElements(this.svg);\n\n        this.input.enterViewMode();\n        hideLmvUi(viewer);\n\n        // TODO: Nasty hack, currently there is no API to disable mouse highlighting in 3d models.\n        // TODO: We nuke rollover function in viewer, for now, public api will be added soon.\n        this.onViewerRolloverObject = viewer.impl.rolloverObject;\n        viewer.impl.rolloverObject = function(){};\n\n        this.activateTool(true);\n        var camera = viewer.impl.camera;\n        this.onViewerResize({ width: camera.clientWidth, height: camera.clientHeight });\n\n        // See function loadMarkups() for when the actual SVG gets added onstage //\n        this.svgLayersMap = {};\n        this.duringViewMode = true;\n        this.allowNavigation(true);\n        return true;\n    };\n\n    /**\n     * Removes any markup currently overlaid on the viewer. It exits Edit mode if it is active.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\n     * @returns {boolean} Whether it successfully left view mode or not.\n     */\n    MarkupsCore.prototype.hide = function() {\n\n        var RESULT_HIDE_OK = true;\n        var RESULT_HIDE_FAIL = false;\n\n        var viewer = this.viewer;\n        if (!viewer || !this.duringViewMode) {\n            return RESULT_HIDE_OK;\n        }\n\n        if (this.duringEditMode) {\n            if (!this.leaveEditMode()) {\n                return RESULT_HIDE_FAIL;\n            }\n        }\n\n        viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\n        viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\n\n        var svg = this.svg;\n        svg.parentNode && svg.parentNode.removeChild(svg);\n\n        // Remove all Markups and metadata (if any)\n        this.unloadMarkupsAllLayers();\n        removeAllMetadata(svg);\n\n        this.input.leaveViewMode();\n        restoreLmvUi(viewer);\n        this.viewer.impl.rolloverObject = this.onViewerRolloverObject;\n\n        this.activateTool(false);\n        this.duringViewMode = false;\n        return RESULT_HIDE_OK;\n    };\n\n    /**\n     * Removes newly created markups in the current editing layer.\n     * Markups that were created in a specific layer will not be removed.\n     *\n     * Markups should have been added while in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     */\n    MarkupsCore.prototype.clear = function() {\n        // Can only clear specific layers when in the edit mode of that layer.\n        if (!this.duringEditMode) {\n            console.warn(\"Clear only removes markups when in Edit Mode.\");\n            return;\n        }\n        var editModeLayer = this.editingLayer ? this.svgLayersMap[this.editingLayer] : this.editModeSvgLayerNode;\n        if (editModeLayer) {\n            var markups = editModeLayer.markups;\n            var svg = editModeLayer.svg;\n            if (svg && svg.childNodes.length > 0) {\n                while (svg.childNodes.length) {\n                    svg.removeChild(svg.childNodes[0]);\n                }\n            }\n            while (markups.length > 0) {\n                var markup = markups[0];\n                this.removeMarkup(markup);\n                markup.destroy();\n            }\n        }\n    };\n\n    /**\n     * Returns an SVG string with the markups created so far.\n     * The SVG string can be reloaded using\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\n     *\n     * Markups should have been added while in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     * @returns {string} Returns an SVG element with all of the created markups in a string format.\n     */\n    MarkupsCore.prototype.generateData = function() {\n\n        var defaultLayer = this.editModeSvgLayerNode.svg;\n\n        if (this.editMode) {\n            this.editMode.onSave();\n        }\n\n        // Sanity check, remove any lingering metadata nodes\n        removeAllMetadata(this.svg);\n\n        if (this.activeLayer){\n            defaultLayer = this.svgLayersMap[this.activeLayer].svg;\n        }\n\n        var tmpNode = createSvgElement(\"svg\");\n        transferChildNodes(this.svg, tmpNode); // Transfer includes this.editModeSvgLayerNode\n        transferChildNodes(defaultLayer, this.svg);\n\n        // version 1: first implementation.\n        // version 2: added global offset to markup positions.\n        // version 3: change node structure to include hitareas, hit areas are not exported.\n        // version 4: scale perspective markups space by PERSPECTIVE_MODE_SCALE because bug in firefox. LMV-1150\n        var metadataObject = {\n            \"data-model-version\": \"4\"\n        };\n        var metadataNode = addSvgMetadata(this.svg, metadataObject);\n        var metadataNodes = [ metadataNode ];\n\n        // Notify each markup to inject metadata\n        this.markups.forEach(function(markup){\n            var addedNode = markup.setMetadata();\n            if (addedNode) {\n                metadataNodes.push(addedNode);\n            }\n        });\n\n        // Generate the data!\n        var data = svgNodeToString(this.svg);\n\n        // Remove metadataObject before returning\n        metadataNodes.forEach(function(metadataNode){\n            metadataNode.parentNode.removeChild(metadataNode);\n        });\n\n        transferChildNodes(this.svg, defaultLayer);\n        transferChildNodes(tmpNode, this.svg);\n        tmpNode = null; // get rid of it.\n\n        return  data;\n    };\n\n    /**\n     * @private\n     */\n    MarkupsCore.prototype.generatePoints3d = function() {\n\n        var result = {markups: [], main: null};\n        var markups = this.markups;\n        var markupsCount = markups.length;\n\n        if (markupsCount === 0) {\n            return result;\n        }\n\n        // Gather a 3d point for markup.\n        var idTarget = this.viewer.impl.renderer().readbackTargetId();\n        for(var i = 0; i < markupsCount; ++i) {\n\n            var markup = markups[i];\n            var point = markup.generatePoint3d(idTarget) || null;\n            result.markups.push(\n                {\n                    id: markup.id,\n                    type: markup.type,\n                    point: point || null\n                });\n        }\n\n\n        // If there is 3d point associated with an arrow, we use that as main point.\n        if (markupsCount === 1) {\n\n            var main = result.markups[0].point;\n            result.main = main && main.clone();\n            return result;\n        }\n\n        for(var i = 0; i < markupsCount; ++i) {\n\n            var collision = result.markups[i];\n            if (collision.type === MarkupTypes.MARKUP_TYPE_ARROW && collision.point !== null) {\n\n                result.main = collision.point.clone();\n                return result;\n            }\n        }\n\n        // If there is no arrows, we average bounding boxes and get a 3d point inside it.\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < markupsCount; ++i) {\n\n            var boundingBox = markups[i].generateBoundingBox();\n\n            bbX0 = Math.min(bbX0, boundingBox.min.x);\n            bbY0 = Math.min(bbY0, boundingBox.min.y);\n            bbX1 = Math.max(bbX1, boundingBox.max.x);\n            bbY1 = Math.max(bbY1, boundingBox.max.y);\n        }\n\n        var polygon = {};\n\n        polygon.vertexCount = 4;\n        polygon.xVertices = new Float32Array([bbX0, bbX1, bbX1, bbX0]);\n        polygon.yVertices = new Float32Array([bbY0, bbY0, bbY1, bbY1]);\n\n        var point2d = checkPolygon(polygon, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n        result.main = point3d && point3d.point;\n\n        return result;\n    };\n\n    /**\n     * Renders the markups onto a 2D canvas context to generate an image.\n     * @param {CanvasRenderingContext2D} context - Markups are drawn using the context provided\n     */\n    MarkupsCore.prototype.renderToCanvas = function(context, callback, renderAllMarkups) {\n\n        var width = this.bounds.width;\n        var height = this.bounds.height;\n        var viewBox = this.getSvgViewBox(width, height);\n        var numberOfScreenshotsTaken = 0;\n        var markups = [];\n        var layer;\n\n        var onMarkupScreenshotTaken = function () {\n            if (callback && (++numberOfScreenshotsTaken === markups.length)) {\n                callback();\n            }\n        }.bind(this);\n\n        if (renderAllMarkups) {\n            var svgKeys = Object.keys(this.svg.childNodes);\n            var layersKeys = Object.keys(this.svgLayersMap);\n\n            // Append only markups that their parent layer is contained inside the svg main container.\n            for (var i = 0; i < svgKeys.length; i++) {                \n                for (var j = 0; j < layersKeys.length; j++) {\n                    layer = this.svgLayersMap[layersKeys[j]];\n                    if (this.svg.childNodes[svgKeys[i]] === layer.svg) {\n                        markups = markups.concat(layer.markups);\n                    }\n                }\n            }\n        } else {\n            layer = this.svgLayersMap[this.activeLayer] || this.editModeSvgLayerNode;\n            markups = layer.markups;\n        }\n\n        if (markups.length === 0) {\n            callback();\n        } else {\n            markups.forEach(function(markup) {\n                markup.renderToCanvas(context, viewBox, width, height, onMarkupScreenshotTaken);\n            });\n        }\n    };\n\n    /**\n     * Changes the active drawing tool. For example, from the Arrow drawing tool to the Rectangle drawing tool.\n     * Only applicable while in {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * Supported values are:\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeArrow(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeRectangle(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCloud(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeText(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeFreehand(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolyline(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolycloud(MarkupsCoreInstance)`\n     *\n     * This function fires event `Autodesk.Viewing.Extensions.Markups.Core.EVENT_EDITMODE_CHANGED`.\n     * @param {Object} editMode - Object instance for the drawing tool\n     */\n    MarkupsCore.prototype.changeEditMode = function(editMode) {\n\n        var oldEditMode = this.editMode;\n        oldEditMode && oldEditMode.destroy();\n\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN, function() {this.disableMarkupInteractions(true);}.bind(this));\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\n        editMode.addEventListener(MarkupEvents.EVENT_MARKUP_DESELECT, function(event){this.dispatchEvent(event);}.bind(this));\n\n        this.editMode = editMode;\n        this.styles[editMode.type] = cloneStyle(editMode.getStyle());\n\n        this.dispatchEvent({type:MarkupEvents.EVENT_EDITMODE_CHANGED, target: editMode});\n    };\n\n    /**\n     * Check whether a user can perform camera navigation operations on the current loaded model.\n     * While the extension is active, the user can still draw markups.\n     * Panning and zooming are only supported for orthographic cameras.\n     *\n     * @return {boolean} Whether {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#allowNavigation|allowNavigation()} can succeed.\n     */\n    MarkupsCore.prototype.isNavigationAllowed = function() {\n\n        return !this.viewer.impl.camera.isPerspective;\n    };\n\n    /**\n     * Enables click, tap, and swipe behavior to allow camera zoom and panning operations. It is only available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * @param {boolean} allow - Whether camera navigation interactions are active or not.\n     */\n    MarkupsCore.prototype.allowNavigation = function(allow) {\n\n        //we will still need to update the markup styles even if in perspective mode\n        var editMode = this.editMode;\n        this.navigating = allow;\n\n        if (allow){\n            this.svg.setAttribute(\"pointer-events\", \"none\");\n            editMode && this.selectMarkup(null);\n        } else {\n            this.svg.setAttribute(\"pointer-events\", \"painted\");\n        }\n\n        // Update pointer events for all markups.\n        var markups = this.markups;\n        var markupsCount = markups.length;\n\n        for(var i = 0; i < markupsCount; ++i) {\n            markups[i].updateStyle();\n        }\n        editMode && editMode.notifyAllowNavigation(allow);\n\n        // Navigation is not allowed while in perspective mode.\n        if (allow && (this.duringEditMode || this.duringViewMode) && !this.isNavigationAllowed()) {\n            return false;\n        }\n\n        // Clear snapper.\n        if (allow && this.snapper) {\n            this.snapper.indicator.clearOverlays();\n            this.snapper.clearSnapped();\n        }\n\n        this.markupTool.allowNavigation(allow);\n\n    };\n\n    /**\n     * Sets mouse interactions and mobile device gestures with markups. Only applicable in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     * @param {boolean} disable - true to disable interactions with markups; false to enable interactions with markups; default false.\n     */\n    MarkupsCore.prototype.disableMarkupInteractions = function(disable) {\n\n        if (this.editModeSvgLayerNode) {\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', disable ? 'inherit' : 'default');\n        }\n        this.markups.forEach(function(markup) {markup.disableInteractions(disable);});\n    };\n\n    /**\n     *\n     * @param isActive\n     * @private\n     */\n    MarkupsCore.prototype.activateTool = function(isActive) {\n        if (isActive) {\n            if (!this.cachedNavigationTool) {\n                this.cachedNavigationTool = this.viewer.getActiveNavigationTool();\n                this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\n            }\n            this.viewer.setActiveNavigationTool(this.markupTool.getName());\n        } else {\n\n            if (this.cachedNavigationTool) {\n                this.viewer.setActiveNavigationTool(this.cachedNavigationTool);\n                this.cachedNavigationTool = null;\n            } else {\n                var defaultToolName = this.viewer.getDefaultNavigationToolName();\n                this.viewer.setActiveNavigationTool(defaultToolName);\n            }\n\n            this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\n        }\n    };\n\n    /**\n     *\n     * @param event\n     * @private\n     */\n    MarkupsCore.prototype.onToolChange = function(event) {\n\n        if (event.toolName !== this.markupTool.getName())\n            return;\n\n        if (event.active) {\n            var navAllowed = this.isNavigationAllowed();\n            this.viewer.setNavigationLockSettings({\n                pan      : navAllowed,\n                zoom     : navAllowed,\n                orbit    : false,\n                roll     : false,\n                fov      : false,\n                walk     : false,\n                gotoview : false\n            });\n        }\n        this.viewer.setNavigationLock(event.active);\n    };\n\n    MarkupsCore.prototype.onUnitsCalibrationStarts = function(event) {\n        if (this.duringEditMode) {\n            this.hide();\n        }\n    };\n\n    //// Input /////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    proto.changeInputHandler = function(inputHandler) {\n\n        this.input.detachFrom(this);\n        inputHandler.attachTo(this);\n        this.input = inputHandler;\n\n        if (this.duringEditMode) {\n            inputHandler.enterEditMode();\n        }\n\n        if (this.duringViewMode) {\n            inputHandler.enterViewMode();\n        }\n    };\n\n    //// Copy and Paste System /////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     * Standard copy operation. Applies to any selected markup.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\n     */\n    MarkupsCore.prototype.copy = function() {\n\n        this.clipboard.copy();\n    };\n\n    /**\n     * Standard cut operation. Applies to any selected markup, which gets removed from the screen at call time.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\n     */\n    MarkupsCore.prototype.cut = function() {\n\n        this.clipboard.cut();\n    };\n\n    /**\n     * Standard paste operation. This function will paste any previously copied or cut markup.\n     * Can be called repeatedly after a single copy or cut operation.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()}.\n     */\n    MarkupsCore.prototype.paste = function() {\n\n        this.clipboard.paste();\n    };\n\n    //// Undo and Redo System //////////////////////////////////////////////////////////////////////////////////////////\n    /**\n     * Will undo the previous operation.<br>\n     * The Undo/Redo stacks will track any change done to the existing markups.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isUndoStackEmpty|isUndoStackEmpty()}.\n     */\n    MarkupsCore.prototype.undo = function() {\n\n        this.actionManager.undo();\n    };\n\n    /**\n     * Will redo any previously undo operation.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isRedoStackEmpty|isRedoStackEmpty()}.\n     */\n    MarkupsCore.prototype.redo = function() {\n\n        this.actionManager.redo();\n    };\n\n    /**\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()}\n     * produces no changes.\n     * @return {boolean} true if there are no changes to undo; false if there are changes to undo.\n     */\n    MarkupsCore.prototype.isUndoStackEmpty = function() {\n\n        return this.actionManager.isUndoStackEmpty();\n    };\n\n    /**\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()}\n     * produces no changes.\n     * @return {boolean} true if there are no changes to redo; false if there are changes to redo.\n     */\n    MarkupsCore.prototype.isRedoStackEmpty = function() {\n\n        return this.actionManager.isRedoStackEmpty();\n    };\n\n    proto.beginActionGroup = function() {\n\n        this.actionManager.beginActionGroup();\n    };\n\n    proto.closeActionGroup = function() {\n\n        this.actionManager.closeActionGroup();\n    };\n\n    proto.cancelActionGroup = function() {\n\n        this.actionManager.cancelActionGroup();\n    };\n\n    /**\n     * Helper function for generating unique markup ids.\n     * @returns {number}\n     */\n    proto.getId = function() {\n\n        return ++this.nextId;\n    };\n\n    /**\n     * @param event\n     * @private\n     */\n    proto.onEditActionHistoryChanged = function(event) {\n\n        var data = event.data;\n        if((data.action !== 'undo' && data.targetId !== -1)) {\n\n            // Markup can be null when deleting, that's ok, we unselect in that case.\n            var markup = this.getMarkup(data.targetId);\n            this.selectMarkup(markup);\n        }\n        if(data.action === 'undo' && !this.isUndoStackEmpty()) {\n\n          var markup = this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());\n          this.selectMarkup(markup);\n        }\n\n        this.dispatchEvent(event);\n    };\n\n    /**\n     * Returns a markup with the specified ID. Returns null when not found.\n     * The ID can be retrieved from the return value of getSelection(). <br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getSelection|getSelection()}.\n     * @param {string} id Markup identifier.\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} Returns markup object.\n     */\n    MarkupsCore.prototype.getMarkup = function(id) {\n\n        var markups = this.markups;\n        var markupsCount = markups.length;\n\n        for(var i = 0; i < markupsCount; ++i) {\n            if (markups[i].id == id) {\n                return markups[i];\n            }\n        }\n\n        return null;\n    };\n\n\n    /**\n     * Selects or deselects a markup. A selected markup gets an overlayed UI that allows you to perform transformations\n     * such as resizing, rotations, and translations. To deselect a markup, send a null value. <br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getMarkup|getMarkup()}.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} markup The markup instance to select. Set the value to null to deselect a markup.\n     */\n    MarkupsCore.prototype.selectMarkup = function(markup) {\n\n        if (markup) {\n\n            if (this.editMode.type === markup.type) {\n                this.editMode.setSelection(markup);\n            } else {\n\n                var editMode = markup.getEditMode();\n                editMode.setSelection(null);\n\n                this.changeEditMode(editMode);\n                this.setStyle(markup.getStyle());\n                this.editMode.setSelection(markup);\n            }\n        } else {\n            // fix for text markup in view mode\n            if (this.editMode){\n                this.editMode.setSelection(null);\n            }\n        }\n    };\n\n    /**\n     * Returns the currently selected markup. A selected markup has a custom UI overlayed that allows you to perform\n     * resizing, rotations and translations.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#selectMarkup|selectMarkup()}.\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} Returns selected markup object; null if no markup is selected.\n     */\n    MarkupsCore.prototype.getSelection = function() {\n\n        return this.editMode.getSelection();\n    };\n\n    /**\n     * Deletes a markup from the canvas. Only applies while in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - Markup object.\n     * @param {boolean} [dontAddToHistory] Whether delete action can be {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undone}.\n     */\n    MarkupsCore.prototype.deleteMarkup = function(markup, dontAddToHistory) {\n\n        if (!this.editMode || (this.editMode && this.editMode.selectedMarkup.id !== markup.id)) {\n            this.editMode = markup.getEditMode();\n        }\n        this.editMode.deleteMarkup(markup, dontAddToHistory);\n    };\n\n    proto.addMarkup = function(markup) {\n\n        var markups;\n        var layer = this.activeLayer;\n        var layerObject = this.svgLayersMap[layer] || '';\n\n        if (layerObject) {\n            var svgParent = layerObject.svg;\n            // append markup svg to layer svg\n            markup.setParent(svgParent);\n            // Add markup to layer markups if it does not exist\n            layerObject.markups.push(markup);\n            markups = layerObject.markups.slice();\n        } else {\n            // if layer is undefined create a edit mode svg layer\n            markup.setParent(this.editModeSvgLayerNode.svg);\n            this.editModeSvgLayerNode.markups.push(markup);\n            markups = this.editModeSvgLayerNode.markups.slice();\n        }\n        \n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\n        // Only set the global markups array when in edit mode\n        if (this.duringEditMode) {\n            this.markups = markups;\n        }\n    };\n\n    /**\n     *\n     * @param markup\n     * @private\n     */\n    proto.removeMarkup = function(markup) {\n\n        if (!markup){\n            return false;\n        }\n        var self = this;\n\n        /**\n         * Get the layer markups in which the markup exists.\n         * This function will remove the markup if it exists in the corresponding layer markups array.\n         * @param markup\n         * @returns {number} returns -1 if the markup does not exist in a layer markups array\n         */\n        function removeMarkupIfExists(markup){\n            var markupIndex;\n            var layerMarkups = -1;\n            // check if the markup exists in the edit layer\n            if (self.editModeSvgLayerNode){\n                var editLayerMarkups = self.editModeSvgLayerNode.markups;\n                markupIndex = editLayerMarkups.indexOf(markup);\n                if (markupIndex !== -1) {\n                    // remove the markup from the corresponding markup array\n                    editLayerMarkups.splice(markupIndex, 1);\n                    layerMarkups = editLayerMarkups.slice();\n                    // update the global markups array if the markup is in the active layer\n                    if (self.activeLayer === ''){\n                        self.markups = layerMarkups;\n                    }\n                    return layerMarkups;\n                }\n            }\n            // check if the markup exists in a layer\n            if (self.svgLayersMap) {\n                for (var layer in self.svgLayersMap) {\n                    var markups = self.svgLayersMap[layer].markups;\n                    markupIndex = markups.indexOf(markup);\n                    if (markupIndex !== -1) {\n                        // remove the markup from the corresponding markup array\n                        markups.splice(markupIndex, 1);\n                        layerMarkups = markups.slice();\n                        // update the global markups array if the markup is in the active layer\n                        if (self.activeLayer === layer){\n                            self.markups = layerMarkups;\n                        }\n                        return layerMarkups;\n                    }\n                }\n            }\n            return layerMarkups;\n        }\n\n        var layerMarkups = removeMarkupIfExists(markup);\n        if (layerMarkups === -1)\n            return false;\n\n        markup.setParent(null);\n\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\n\n        var editMode = this.editMode;\n        if (editMode) {\n            var selectedMarkup = editMode.getSelection();\n            if (selectedMarkup === markup) {\n                this.selectMarkup(null);\n            }\n        }\n    };\n\n    //// Markups style /////////////////////////////////////////////////////////////////////////////////////////////////\n\n    MarkupsCore.prototype.setStyle = function(style) {\n\n        var styles = this.styles;\n        var editMode = this.editMode;\n\n        copyStyle(style, styles[editMode.type]);\n        // copyStyle(styles[editMode.type], style);\n        editMode.setStyle(styles[editMode.type]);\n    };\n\n    MarkupsCore.prototype.getStyle = function() {\n\n        return cloneStyle(this.styles[this.editMode.type]);\n    };\n\n    MarkupsCore.prototype.getDefaultStyle = function() {\n\n        var defaultStyleAttributes = [\n            'stroke-width',\n            'font-size',\n            'font-family',\n            'font-style',\n            'font-weight',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity'];\n        this.defaultStyle = this.defaultStyle || createStyle(defaultStyleAttributes, this);\n\n        return this.defaultStyle;\n    };\n\n    //// Markups depth order ///////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param markup\n     */\n    proto.bringToFront = function(markup) {\n\n        this.sendMarkupTo(markup, this.markups.length-1);\n    };\n\n    /**\n     *\n     * @param markup\n     */\n    proto.sendToBack = function(markup) {\n\n        this.sendMarkupTo(markup, 0);\n    };\n\n    /**\n     *\n     * @param markup\n     */\n    proto.bringForward = function(markup) {\n\n        var markupIndex = this.markups.indexOf(markup);\n        this.sendMarkupTo(markup, markupIndex+1);\n    };\n\n    /**\n     *\n     * @param markup\n     */\n    proto.bringBackward = function(markup) {\n\n        var markupIndex = this.markups.indexOf(markup);\n        this.sendMarkupTo(markup, markupIndex-1);\n    };\n\n    /**\n     *\n     * @param markup\n     * @param index\n     * @private\n     */\n    proto.sendMarkupTo = function(markup, index) {\n\n        var markups = this.markups;\n        var markupIndex = markups.indexOf(markup);\n\n        if (markupIndex === -1 || index < 0 || index >= markups.length) {\n            return;\n        }\n\n        markups.splice(markupIndex, 1);\n        index = markupIndex > index ? index -1 : index;\n        markups.splice(index, 0, markup);\n\n        // TODO: Add markup in right position not always at the end.\n        markup.setParent(null);\n        if (this.activeLayer){\n            var parent = this.svgLayersMap[this.activeLayer].svg;\n            markup.setParent(parent);\n        }else {\n            markup.setParent(this.editModeSvgLayerNode.svg);\n        }\n    };\n\n\n    /**\n     * Loads data (SVG string) for all markups in a specified layer (layerId) to the Viewer's canvas.<br>\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\n     *\n     * @param {string} markupString - SVG string with markups. See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#generateData|generateData()}.\n     * @param {string} layerId - Identifier for the layer where the markup should be loaded to. Example \"Layer1\".\n     * @return {boolean} Whether the markup string was able to be loaded successfully\n     */\n    MarkupsCore.prototype.loadMarkups = function (markupString, layerId) {\n\n        function getDataModelVersion(node) {\n            var metadata = node.childNodes[0] ? node.childNodes[0].childNodes[0] : null;\n            var versionAttr = metadata && (typeof metadata.getAttribute === 'function') && metadata.getAttribute('data-model-version');\n\n            return (typeof versionAttr === 'string') ? parseFloat(versionAttr) : null;\n        }\n\n        if (this.duringEditMode) {\n            console.warn(\"Markups will not be loaded during the edit mode\");\n            return false;\n        }\n\n        if (!this.duringViewMode) {\n            return false;\n        }\n\n        if (!layerId) {\n            console.warn(\"loadMarkups failed; missing 2nd argument 'layerId'\");\n            return false;\n        }\n\n        // Can it be parsed into SVG?\n        var parent = stringToSvgNode(markupString);\n        if (!parent) {\n            return false;\n        }\n\n        // var version = getDataModelVersion(parent);\n\n        // If the supplied layerId exists in the svg layers map and there are children in the svg then return false.\n        if (layerId in this.svgLayersMap && this.svg.childNodes.length > 0) {\n            console.warn(\"This layer is already loaded, will not load again.\");\n            return false;\n        }\n        this.activeLayer = layerId;\n        var svgLayerNode = this.svgLayersMap[layerId];\n\n        // if the layer exists, delete it\n        if (svgLayerNode)\n            delete this.svgLayersMap[layerId];\n\n        // create an empty parent svg layer node for layerId\n        // Child markups will get added to th parent svg layer node in the addMarkup function\n        var newSvg = this.createLayerNode();\n\n        svgLayerNode = {\n            markups: [],\n            svgString: markupString,\n            svg: newSvg\n        };\n        this.svgLayersMap[layerId] = svgLayerNode;\n\n        var children = parent.childNodes;\n        for (var i = 0; i < children.length; i++) {\n            var child = children[i];\n            var markup = createMarkupFromSVG(child, this);\n            // Disable markups if already in edit mode and the active layer is different\n            if (markup && this.duringEditMode && this.editingLayer !== this.activeLayer) {\n                markup.disableInteractions(true);\n            }\n\n            if (!markup && child.localName !== \"metadata\") {\n                // Append child removes it from parent and copies it over to the new svg layer node,\n                // so we need to reduce index by 1 to continue proper iteration\n                svgLayerNode.svg.appendChild(child);\n                i--;\n                if (typeof child.setAttribute === 'function') {\n                    child.setAttribute(\"pointer-events\", \"none\");\n                }\n            }\n        }\n\n        var svgParentNode = this.svgLayersMap[this.activeLayer].svg;\n\n        this.svg.appendChild(svgParentNode);\n        // If already in an edit mode layer then reassign active layer to edit layer\n        if(this.duringEditMode && this.editingLayer !== this.activeLayer) {\n            this.activeLayer = this.editingLayer;\n            if (this.editingLayer)\n                this.markups = this.svgLayersMap[this.activeLayer].markups.slice();\n        }\n        return true;\n    };\n\n    /**\n     * TODO: Probably this function needs to be moved to MarkupCoreUtils.js\n     * Creates a new layer node\n     * */\n\n    proto.createLayerNode = function() {\n\n        var newSvgLayerNode = createSvgElement('g');\n        newSvgLayerNode.setAttribute('cursor', 'default');\n        return newSvgLayerNode;\n    };\n\n    /**\n     * Revert any changes made to the specific layer.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\n     *\n     * @param {string} layerId - ID of the layer to revert any changes that were made to it.\n     * @returns {boolean} true if the layer was unloaded, false if the layer was not unloaded.\n     */\n    MarkupsCore.prototype.revertLayer = function(layerId){\n        if (!layerId) {\n            console.warn(\"revertLayer failed because no layerId was supplied.\");\n            return false;\n        }\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode){\n            console.warn(\"The supplied layer does not exist.\");\n            return false;\n        }\n        var inEditMode = this.duringEditMode;\n        // Leave editMode to revert a layer\n        if (inEditMode)\n            this.leaveEditMode();\n\n        // keep track of previous global markups.\n        var currentMarkups = this.markups.slice();\n        // Set the global markups to the markups in the current layer. These ones get removed in the unloadMarkups\n        this.markups = svgLayerNode.markups;\n        var layerSvg = svgLayerNode.svgString;\n        this.unloadMarkups(layerId);\n        this.loadMarkups(layerSvg, layerId);\n        // Assign markups\n        if (this.editingLayer){\n            if(this.editingLayer !== layerId) {\n                this.markups = currentMarkups;\n                var layerObject = this.svgLayersMap[this.editingLayer];\n                if (layerObject) {\n                    layerObject.markups = currentMarkups;\n                }\n            }\n        }else{\n            if(this.editModeSvgLayerNode){\n                this.editModeSvgLayerNode.markups = currentMarkups;\n            }\n        }\n\n        if(this.editingLayer || this.editingLayer.length === 0){\n            var svg = this.editingLayer.length === 0 ? this.editModeSvgLayerNode.svg : this.svgLayersMap[this.editingLayer].svg;\n            if (svg.parentNode == this.svg) {\n                this.svg.removeChild(svg);\n                this.svg.appendChild(svg);\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Removes markups from the DOM (Document Object Model). This is helpful for freeing up memory.<br>\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkupsAllLayers|unloadMarkupsAllLayers()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\n     *\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\n     * @return {boolean} Whether the operation succeeded or not.\n     */\n    MarkupsCore.prototype.unloadMarkups = function(layerId) {\n\n        if (!layerId) {\n            console.warn(\"unloadMarkups failed; No layerId provided.\");\n            return false;\n        }\n\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode) {\n            // TODO: Do we need to log anything here?\n            console.warn('No such layer exists to unload.');\n            return false;\n        }\n\n        var layerMarkups = svgLayerNode.markups.slice();\n        var numMarkups = layerMarkups.length;\n        for (var i = 0; i < numMarkups; i++) {\n            var markup = layerMarkups[i];\n            this.removeMarkup(markup);\n            markup.destroy();\n        }\n\n        // Remove the markups in the layer from the svg canvas\n        if (svgLayerNode.svg.parentNode === this.svg)\n            this.svg.removeChild(svgLayerNode.svg);\n\n        // Delete the layer from the layer map.\n        delete this.svgLayersMap[layerId];\n        // Reset the active layer if the supplied layer id is the same as the active layer\n        if (this.activeLayer.toString() === layerId.toString()) {\n            this.activeLayer = '';\n        }\n        // Leave edit mode and reset the editing layer if the supplied layer is the same as the current editing layer\n        if (this.editingLayer && this.editingLayer.toString() === layerId.toString()){\n            this.editingLayer = '';\n            this.duringEditMode && this.leaveEditMode();\n        }\n\n        return true;\n    };\n\n    /**\n     * Removes all markups loaded so far. Great for freeing up memory.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\n     */\n    MarkupsCore.prototype.unloadMarkupsAllLayers = function() {\n        this.activeLayer = '';\n        var self = this;\n\n        //this is specific to the editModeSvgLayerNode, enterEditMode().\n        var unloadSvgLayerNode = function(){\n            if (self.editModeSvgLayerNode){\n                var layerMarkups = self.editModeSvgLayerNode.markups.slice();\n                var numMarkups = layerMarkups.length;\n                for (var i = 0; i < numMarkups; i++) {\n                    var markup = layerMarkups[i];\n                    self.removeMarkup(markup);\n                    markup.destroy();\n                }\n            }\n        };\n\n        // Unload the markups in the editModeSvgLayerNode\n        unloadSvgLayerNode();\n        var layerId;\n        for (layerId in this.svgLayersMap){\n            this.unloadMarkups(layerId);\n        }\n    };\n\n    /**\n     * Hides all markups in a specified layer. Note that hidden markups will not be unloaded.\n     * Use the {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()} method to make\n     * them visible again; no additional parsing is required.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\n     *\n     * @param {string} layerId - ID of the layer containing all markups that should be hidden (in the DOM).\n     * @return {boolean} Whether the operation succeeded or not.\n     */\n    MarkupsCore.prototype.hideMarkups = function(layerId) {\n\n        if (!layerId) {\n            console.warn(\"hideMarkups failed; No layerId provided.\");\n            return false;\n        }\n\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode) {\n            // TODO: Do we need to log anything here?\n            return false;\n        }\n        var layerSvg = svgLayerNode.svg;\n\n        // Return false if the layer svg is not present in the main svg\n        if (layerSvg.parentNode != this.svg) {\n            console.warn(\"Layer is already hidden.\");\n            return false;\n        }\n        // remove the layer svg from the main svg\n        this.svg.removeChild(layerSvg);\n        return true;\n    };\n\n    /**\n     * Unhides a layer of hidden markups\n     * ({@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}).\n     *\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\n     * @return {boolean} Whether the operation succeeded or not.\n     */\n    MarkupsCore.prototype.showMarkups = function(layerId) {\n\n        if (!layerId) {\n            console.warn(\"showMarkups failed; No layerId provided.\");\n            return false;\n        }\n\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode) {\n            // TODO: Do we need to log anything here?\n            return false;\n        }\n        // Append the layer svg to the main svg\n        var layerSvg = svgLayerNode.svg;\n        this.svg.appendChild(layerSvg);\n    };\n\n    //// Client Space <-> Markup Space /////////////////////////////////////////////////////////////////////////////////\n\n    proto.positionFromClientToMarkups = function(x, y) {\n\n        return this.clientToMarkups(x, y);\n    };\n\n    proto.positionFromMarkupsToClient = function(x, y) {\n\n        return this.markupsToClient(x, y);\n    };\n\n    proto.vectorFromClientToMarkups = function(x, y) {\n\n        var a = this.clientToMarkups(0, 0);\n        var b = this.clientToMarkups(x, y);\n\n        return {x: b.x - a.x, y: b.y - a.y};\n    };\n\n    proto.vectorFromMarkupsToClient = function(x, y) {\n\n        var a = this.markupsToClient(0, 0);\n        var b = this.markupsToClient(x, y);\n\n        return {x: b.x - a.x, y: b.y - a.y};\n    };\n\n    proto.sizeFromClientToMarkups = function(w, h) {\n\n        var a = this.clientToMarkups(0, 0);\n        var b = this.clientToMarkups(w, h);\n\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\n    };\n\n    proto.sizeFromMarkupsToClient = function(w, h) {\n\n        var a = this.markupsToClient(0, 0);\n        var b = this.markupsToClient(w, h);\n\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\n    };\n\n    proto.markupsToClient = function(x, y) {\n\n        var camera = this.viewer.impl.camera;\n        var point = new THREE.Vector3(x, y, 0);\n\n        if (camera.isPerspective) {\n\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\n\n            point.x =( point.x / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.width  * 0.5);\n            point.y =(-point.y / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.height * 0.5);\n        } else {\n\n            point.applyMatrix4(camera.matrixWorld);\n            point.sub(camera.position);\n\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\n            // exported markups don't have the offset.\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\n            if (globalOffset) {\n                point.sub(globalOffset);\n            }\n\n            point = worldToClient(point, this.viewer, false);\n            point.z = 0;\n        }\n\n        return point;\n    };\n\n    proto.clientToMarkups = function(x, y) {\n\n        var camera = this.viewer.impl.camera;\n        var point = new THREE.Vector3(x, y, 0);\n\n        if (camera.isPerspective) {\n\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\n\n            // Multiply by PERSPECTIVE_MODE_SCALE because Firfox on Windows machines have problems to deal with very small paths.\n            point.x = (point.x - bb.width  * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\n            point.y =-(point.y - bb.height * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\n        } else {\n\n            point = clientToWorld(point.x, point.y, 0, this.viewer);\n\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\n            // exported markups don't have the offset.\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\n            if (globalOffset) {\n                point.add(globalOffset);\n            }\n\n            point.add(camera.position);\n            point.applyMatrix4(camera.matrixWorldInverse);\n            point.z = 0;\n        }\n\n        return point;\n    };\n\n    proto.getSvgViewBox = function(clientWidth, clientHeight) {\n\n        // Get pan offset.\n        var lt = this.clientToMarkups(0, 0);\n        var rb = this.clientToMarkups(clientWidth, clientHeight);\n\n        var l = Math.min(lt.x, rb.x);\n        var t = Math.min(lt.y, rb.y);\n        var r = Math.max(lt.x, rb.x);\n        var b = Math.max(lt.y, rb.y);\n\n        return [l , t, r-l, b-t].join(' ');\n    };\n\n    proto.getBounds = function () {\n\n        return this.bounds;\n    };\n\n    proto.getMousePosition = function() {\n\n        // When snapping, use the snap position instead of the mouse position\n        // as the start point of the markup drawing.\n        // For now only works for 2D.\n        if (this.editMode.useWithSnapping() && this.snapper && this.snapper.isSnapped()) {\n            return this.getSnapPosition();\n        }\n        return this.input.getMousePosition();\n    };\n\n    proto.getSnapPosition = function() {\n\n        var point = MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(), this.viewer);\n        var p = this.project(point);\n        return {x: p.x, y: p.y};\n    };\n\n    proto.project = function(position) {\n        var camera = this.viewer.navigation.getCamera();\n        var containerBounds = this.viewer.navigation.getScreenViewport();\n\n        var p = new THREE.Vector3().copy(position);\n        p.project(camera);\n\n        return new THREE.Vector3(Math.round((p.x + 1) / 2 * containerBounds.width),\n            Math.round((-p.y + 1) / 2 * containerBounds.height), p.z);\n    };\n\n    //// Handled Events ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    proto.onCameraChange = function(event) {\n\n        // Update annotations' parent transform.\n        var viewBox = this.getSvgViewBox(this.bounds.width, this.bounds.height);\n\n        // HACK, for some reason the 2nd frame returns an empty canvas.\n        // The reason why this happens is that the code above calls into the viewer\n        // and a division by zero occurs due to LMV canvas having zero width and height\n        // When we detect this case, avoid setting the viewBox value and rely on one\n        // previously set.\n        if (viewBox === \"NaN NaN NaN NaN\") {\n            return;\n        }\n\n        if (this.svg) {\n            this.svg.setAttribute('viewBox', viewBox);\n        }\n\n\n        var editMode = this.editMode;\n\n        if (editMode) {\n            // Edit frame has to be updated, re-setting the selected markup does the job.\n            if (this.editFrame.isActive()) {\n                var selectedMarkup = editMode.getSelection();\n                this.editFrame.setMarkup(selectedMarkup);\n            }\n\n            if (editMode.updateTextBoxStyle) {\n                editMode.updateTextBoxStyle();\n            }\n\n            if (this.snapper && editMode.useWithSnapping()) {\n                this.snapper.indicator.render();\n            }\n        }\n    };\n\n    proto.onViewerResize = function(event) {\n\n        this.bounds.x = 0;\n        this.bounds.y = 0;\n        this.bounds.width = event.width;\n        this.bounds.height = event.height;\n\n        if (this.svg) {\n            this.svg.setAttribute('width', this.bounds.width);\n            this.svg.setAttribute('height', this.bounds.height);\n        }\n\n        this.onCameraChange();\n    };\n\n    proto.callSnapperMouseDown = function() {\n\n        // Disable snapper in freehand mode\n        if (this.editMode && this.editMode.useWithSnapping()){\n            var mousePosition = this.input.getMousePosition();\n            if (this.snapper) {\n                this.snapper.onMouseDown(mousePosition);\n                this.snapper.indicator.render();\n            }\n        }else{\n            // Clear the snapper when selecting a markup that does not allow snapping.\n            if (this.snapper){\n                this.snapper.clearSnapped();\n                this.snapper.indicator.clearOverlays();\n            }\n        }\n    };\n\n    proto.callSnapperMouseMove = function() {\n\n        if (this.editMode && this.editMode.useWithSnapping()) {\n            var mousePosition = this.input.getMousePosition();\n            if (this.snapper) {\n                this.snapper.onMouseMove(mousePosition);\n                this.snapper.indicator.render();\n            }\n        }\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (this.navigating) {\n            return;\n        }\n\n        if (this.editFrame.isActive() && event.type === 'mousemove') {\n            this.editFrame.onMouseMove(event);\n        }\n\n        this.callSnapperMouseMove();\n\n        this.editMode && this.editMode.onMouseMove(event);\n    };\n\n    /**\n     * Handler to mouse down events, used to start creation markups.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        dismissLmvHudMessage();\n\n        this.callSnapperMouseDown();\n\n        var bounds = this.getBounds();\n        var mousePosition = this.getMousePosition();\n\n        if (mousePosition.x >= bounds.x && mousePosition.x <= bounds.x + bounds.width &&\n            mousePosition.y >= bounds.y && mousePosition.y <= bounds.y + bounds.height) {\n            this.editMode.onMouseDown(event);\n        }\n\n        // TODO: There is a better way to do this, implement when undo/redo group.\n        if(!this.editMode.creating && event.target === this.svg) {\n            this.selectMarkup(null);\n        }\n        this.ignoreNextMouseUp = false;\n    };\n\n    proto.onMouseUp = function(event) {\n\n        if (this.navigating) {\n            return;\n        }\n\n        if (this.editFrame.isActive()) {\n            this.editFrame.onMouseUp(event);\n            return;\n        }\n\n        if(!this.ignoreNextMouseUp) {\n            this.editMode.onMouseUp(event);\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if (this.navigating) {\n            return;\n        }\n\n        if (this.editFrame.isActive()) {\n            return;\n        }\n\n        this.editMode.onMouseDoubleClick(event);\n    };\n\n    proto.onUserCancel = function() {\n        if (!this.editMode) {\n            return;\n        }\n        else if (this.editMode.creating) {\n            this.editMode.creationCancel();\n        } else {\n            this.editMode.unselect();\n        }\n    };\n\n    /**\n     *\n     * @param event\n     */\n    proto.onMarkupSelected = function(event) {\n\n        this.selectMarkup(event.markup);\n        this.dispatchEvent(event);\n    };\n\n    proto.onMarkupEnterEdition = function(event) {\n\n    };\n\n    proto.onMarkupCancelEdition = function(event) {\n\n        this.onUserCancel();\n    };\n\n    proto.onMarkupDeleteEdition = function(event) {\n\n        this.removeMarkup(event.markup);\n        this.editMode.deleteMarkup();\n    };\n\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsCore', MarkupsCore);\n","import { getStyleDefaultValues } from '../core/StyleUtils'\nimport * as MarkupEvents from '../core/MarkupEvents' \nimport * as MarkupTypes from '../core/MarkupTypes'\nimport { theEditModeManager } from '../core/EditModeManager'\n\nimport CSS from './MarkupsGui.css' // IMPORTANT!!\n\n    var CORE_EXTENSION = 'Autodesk.Viewing.MarkupsCore';\n\n    export function MarkupsGui(viewer, options) {\n        Autodesk.Viewing.Extension.call(this, viewer, options);\n        this.domEvents = [];\n        this.name = 'markup';\n        this.onEditModeEnter = this.onEditModeEnter.bind(this);\n        this.onEditModeLeave = this.onEditModeLeave.bind(this);\n        this.onEditModeChange = this.onEditModeChange.bind(this);\n        this.onMarkupSelected = this.onMarkupSelected.bind(this);\n    }\n\n    MarkupsGui.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\n    MarkupsGui.prototype.constructor = MarkupsGui;\n    var proto = MarkupsGui.prototype;\n    var av = Autodesk.Viewing;\n    var avp = av.Private;\n\n    proto.load = function () {\n\n        this.viewer.loadExtension(CORE_EXTENSION).then( coreExt => {\n\n            this.core = coreExt;\n\n            // Hook into markup core events\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\n            this.core.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\n        });\n\n        return true;\n    };\n\n    proto.unload = function() {\n\n        this.deactivate(); // not necessary, but leaves the viewer in an unusable state without it\n        this.unhookAllEvents();\n\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\n        this.core.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\n\n        this.destroyToolUi();\n        this.destroyToolbarUI();\n        this.core = null;\n\n        return true;\n    };\n\n    proto.onToolbarCreated = function(toolbar) {\n        \n        var self = this;\n        var viewer = this.viewer;\n\n        this.markupToolButton = new Autodesk.Viewing.UI.Button(\"toolbar-markupTool\");\n        this.markupToolButton.setToolTip(\"Markup\");\n        this.markupToolButton.setIcon(\"adsk-icon-markup\");\n        this.markupToolButton.onClick = function () {\n            // Since the bar will get hidden when closed, there\n            // is no need to track button state (active or not)\n            self.activate();\n        };\n\n        var modelTools = toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);\n        if (modelTools) {\n            modelTools.addControl(this.markupToolButton, {index:0});\n        }\n    };\n\n    proto.destroyToolbarUI = function() {\n        if (this.markupToolButton) {\n            var toolbar = this.viewer.getToolbar();\n            if (toolbar) {\n                this.markupToolButton.removeFromParent();\n            }\n            this.markupToolButton = null;\n        }\n    };\n\n    proto.onEditModeEnter = function() {\n        avp.logger.log('ENTER edit mode');\n        this.showToolsUi();\n    };\n\n    proto.onEditModeLeave = function() {\n        avp.logger.log('LEAVE edit mode');\n        this.hideToolsUi();\n    };\n\n    proto.onEditModeChange = function(event) {\n        if (!this.domToolSelect || this.ignoreChangeEvent)\n            return;\n        var editMode = this.core.editMode;\n        var optionList = this.domToolSelect.options;\n        for (var i=0, len=optionList.length; i<len; i++) {\n            var option = optionList[i];\n            if (option.value === editMode.type) {\n                this.domToolSelect.selectedIndex = i; // doesn't fire event\n                break;\n            }\n        }\n    };\n\n    proto.onMarkupSelected = function(event) {\n\n        var markup = event.markup;\n        var editMode = this.core.editMode;\n        this.setStylesUi(editMode, markup);\n    };\n\n    proto.showToolsUi = function() {\n        this.createToolsUi();\n\n        // Hide some UI\n        var canNavigate = this.core.isNavigationAllowed();\n        this.setControlVisibility('.lmv-markup-gui-enterNavMode', canNavigate, 'inline-block');\n        this.exitNavigationMode();\n        this.domContent.style.display = 'block'; // remove collapsed state\n\n        // It's okay if we call these many times in a row, no biggie.\n        this.viewer.container.appendChild(this.domRoot);\n    };\n\n    proto.hideToolsUi = function() {\n        if (this.domRoot && this.domRoot.parentNode) {\n            this.domRoot.parentNode.removeChild(this.domRoot);\n        }\n    };\n\n    proto.createToolsUi = function() {\n\n        if (this.domRoot)\n            return;\n\n        var optionIndex = 0;\n        function createEditModeOption(locLabel, editModeType) {\n            return [\n                '<option value=\"', editModeType, '\">',\n                    locLabel,\n                '</option>'\n            ].join('');\n        }\n\n        var html = [\n            '<div class=\"lmv-markup-gui-toolbar-content\">',\n\n                '<button class=\"lmv-markup-gui-collapse-btn\">&lt;-&gt;</button>',\n                '<button class=\"lmv-markup-editmode-done\">Exit</button>',\n                '<div class=\"lmv-markup-gui-collapse-content\">',\n                    '<div class=\"lmv-markup-gui-editMode\">',\n                        '<button class=\"lmv-markup-gui-enterNavMode\">Navigate</button>',\n                        '<button class=\"lmv-markup-gui-undo\">&#8617;</button>',\n                        '<button class=\"lmv-markup-gui-redo\">&#8618;</button>',\n                        '<br>',\n                        '<button class=\"lmv-markup-gui-delete\">Delete</button>',\n                        '<button class=\"lmv-markup-gui-duplicate\">Duplicate</button>',\n                        '<br>',\n                        '<button class=\"lmv-markup-gui-cut\">Cut</button>',\n                        '<button class=\"lmv-markup-gui-copy\">Copy</button>',\n                        '<button class=\"lmv-markup-gui-paste\">Paste</button>',\n                        '<br>',\n                        '<span>Markup:</span>', // TODO: Localize\n                        '<select class=\"lmv-markup-tool-select\">',\n                            createEditModeOption('Arrow', MarkupTypes.MARKUP_TYPE_ARROW),\n                            createEditModeOption('Rectangle', MarkupTypes.MARKUP_TYPE_RECTANGLE),\n                            createEditModeOption('Circle', MarkupTypes.MARKUP_TYPE_CIRCLE),\n                            createEditModeOption('Text', MarkupTypes.MARKUP_TYPE_TEXT),\n                            createEditModeOption('Callout', MarkupTypes.MARKUP_TYPE_CALLOUT),\n                            createEditModeOption('Cloud', MarkupTypes.MARKUP_TYPE_CLOUD),\n                            createEditModeOption('PolyLine', MarkupTypes.MARKUP_TYPE_POLYLINE),\n                            createEditModeOption('Polycloud', MarkupTypes.MARKUP_TYPE_POLYCLOUD),\n                            createEditModeOption('Freehand', MarkupTypes.MARKUP_TYPE_FREEHAND),\n                            createEditModeOption('Highlight', MarkupTypes.MARKUP_TYPE_HIGHLIGHT),\n                            createEditModeOption('Dimension', MarkupTypes.MARKUP_TYPE_DIMENSION),\n                        '</select>',\n                        '<br>',\n                        '<div class=\"lmv-markup-gui-style-options\"></div>',\n                    '</div>',\n                    '<div class=\"lmv-markup-gui-navMode\" style=\"display:none;\">',\n                        '<button class=\"lmv-markup-gui-exitNavMode\">Back to Markup</button>',\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('');\n\n        this.domRoot = document.createElement('div');\n        this.domRoot.className = 'lmv-markup-gui-toolbar';\n        this.domRoot.innerHTML = html;\n\n        this.domContent = this.domRoot.querySelector('.lmv-markup-gui-collapse-content');\n        this.domToolSelect = this.domRoot.querySelector('.lmv-markup-tool-select');\n        this.domStylesRoot = this.domRoot.querySelector('.lmv-markup-gui-style-options');\n\n        // General\n        this.hookEvent('click', '.lmv-markup-gui-collapse-btn', this.onToggleCollapse.bind(this));\n        this.hookEvent('click', '.lmv-markup-editmode-done', this.onEditModeDone.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-enterNavMode', this.enterNavigationMode.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-exitNavMode', this.exitNavigationMode.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-undo', this.onUndoClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-redo', this.onRedoClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-delete', this.onDeleteClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-cut', this.onCutClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-copy', this.onCopyClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-paste', this.onPasteClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-duplicate', this.onDuplicateClick.bind(this));\n        // Tools\n        this.hookEvent('change', '.lmv-markup-tool-select', this.onSelectEditMode.bind(this));\n        this.hookEvent('change', '.lmv-markup-gui-style-select', this.onStyleChange.bind(this));\n\n        this.setStylesUi(this.core.editMode);\n    };\n\n    proto.destroyToolUi = function() {\n        if (this.domRoot) {\n            this.hideToolsUi();\n            this.domRoot = null;\n        }\n    };\n\n    proto.getEditMode = function(editModeType) {\n        var EditModeClass = theEditModeManager.getClass(editModeType);\n        if (!EditModeClass)\n            return null;\n\n        var editMode = new EditModeClass(this.core);\n        return editMode;\n    };\n\n    proto.onToggleCollapse = function() {\n        var curr = this.domContent.style.display;\n        if (curr === 'none')\n            this.domContent.style.display = 'block';\n        else\n            this.domContent.style.display = 'none';\n    };\n\n    proto.onEditModeDone = function() {\n        this.deactivate();\n    };\n\n    proto.enterNavigationMode = function() {\n        this.core.allowNavigation(true);\n        this.setControlVisibility('.lmv-markup-gui-editMode', false);\n        this.setControlVisibility('.lmv-markup-gui-navMode', true);\n    };\n    proto.exitNavigationMode = function() {\n        this.core.allowNavigation(false);\n        this.setControlVisibility('.lmv-markup-gui-editMode', true);\n        this.setControlVisibility('.lmv-markup-gui-navMode', false);\n    };\n\n    proto.onUndoClick = function() {\n        this.core.undo();\n    };\n    proto.onRedoClick = function() {\n        this.core.redo();\n    };\n    proto.onDeleteClick = function() {\n        var markup = this.core.getSelection();\n        if (markup) {\n            this.core.deleteMarkup(markup);\n        }\n    };\n    proto.onCutClick = function() {\n        this.core.cut();\n    };\n    proto.onCopyClick = function() {\n        this.core.copy();\n    };\n    proto.onPasteClick = function() {\n        this.core.paste();\n    };\n    proto.onDuplicateClick = function() {\n        // only when there's a selection\n        var markup = this.core.getSelection();\n        if (markup) {\n            this.core.copy();\n            this.core.paste();\n        }\n    };\n\n    proto.onSelectEditMode = function(event) {\n        var editModeType = event.target.value;\n        var editMode = this.getEditMode(editModeType);\n        if (!editMode) {\n            avp.logger.error('Markup editMode not found for type: ' + editModeType);\n            return;\n        }\n\n        if (editMode.cancelEditModeChange) {\n            avp.logger.warn('There was a problem selecting current editMode');\n            return;\n        }\n\n        this.ignoreChangeEvent = true;\n        this.core.changeEditMode(editMode);\n        this.ignoreChangeEvent = false;\n        this.setStylesUi(editMode);\n        this.domToolSelect.blur(); // remove focus from UI\n    };\n\n    proto.onStyleChange = function(event) {\n        var select = event.target;\n        var option = select.options[select.selectedIndex];\n        var styleKey = select.getAttribute('style-key');\n        var valueType = select.getAttribute('value-type');\n        select.blur(); // remove focus from UI\n\n        var markup = this.core.getSelection();\n        var style = markup ? markup.getStyle() : this.core.getStyle();\n        style[styleKey] = getTypedValue(option.value, valueType);\n        this.core.setStyle(style);\n\n        function getTypedValue(val, type) {\n            if (type === 'number')\n                return Number(val);\n            if (type === 'boolean')\n                return val === 'true';\n            return val;\n        }\n    };\n\n    proto.setStylesUi = function(editMode, markup) {\n        avp.logger.log('set ui for ' + editMode.type);\n\n        var style = markup ? markup.style : editMode.style;\n        var defaults = getStyleDefaultValues(style, this.core);\n\n        this.domStylesRoot.innerHTML = ''; // flush UI\n        for (var key in defaults) {\n            // Quite inefiient because we are re-creating DOM constantly\n            // Consider optimize if it becomes a problem\n            var domElem = this.getUiForStyleKey(key, defaults[key], style[key]);\n            this.domStylesRoot.appendChild(domElem);\n        }\n    };\n\n    proto.getUiForStyleKey = function(key, defaults, current) {\n\n        var selectionIndex = defaults.default;\n        var options = [];\n        var values = defaults.values;\n        for (var i=0, len=values.length; i<len; ++i) {\n            var optLine = [\n                '<option value=\"', values[i].value,'\">',\n                    values[i].name,\n                '</option>'\n            ].join('');\n            options.push(optLine);\n\n            if (this.valueEquals(values[i].value, current)) {\n                selectionIndex = i;\n            }\n        }\n\n        var valueType = typeof values[0].value;\n\n        // TODO: Build specialized controls for each style-attribute\n        var domElem = document.createElement('div');\n        var html = [\n            '<span>',key,'</span>',\n            '<select class=\"lmv-markup-gui-style-select\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\n                options.join(''),\n            '</select>'\n        ].join('');\n        domElem.innerHTML = html;\n\n        // select index\n        var domSelect = domElem.querySelector('select');\n        domSelect.selectedIndex = selectionIndex;\n\n        return domElem;\n    };\n    proto.valueEquals = function(value1, value2) {\n\n        return value1 === value2;\n    }\n\n    proto.setControlVisibility = function(selector, isVisible, visibleValue) {\n        var elem = this.domRoot.querySelector(selector);\n        if (!visibleValue)\n            visibleValue = 'block';\n        elem.style.display = isVisible ? visibleValue : 'none';\n    };\n\n    proto.hookEvent = function(eventStr, selector, callbackFn) {\n        var handler = function(event){\n            if (this.matchesSelector(event.target, selector)){\n                callbackFn(event);\n            }\n        }.bind(this);\n        this.domRoot.addEventListener(eventStr, handler);\n        this.domEvents.push({str: eventStr, handler: handler });\n    };\n\n    proto.unhookAllEvents = function() {\n        var domRoot = this.domRoot;\n        this.domEvents.forEach(function(event) {\n            domRoot.removeEventListener(event.str, event.handler);\n        });\n        this.domEvents = [];\n    };\n\n    proto.matchesSelector = function(domElem, selector) {\n        if (domElem.matches) return domElem.matches(selector); //Un-prefixed\n        if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\n        if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\n        if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\n        return false;\n    };\n\n    proto.getStyleOptions = function(editMode) {\n        var style = editMode.getStyle();\n        return getStyleDefaultValues(style, this.core);\n    };\n\n    proto.activate = function () {\n        if(!this.activeStatus) {\n            this.core.enterEditMode();\n            this.activeStatus = true;\n        }\n        return true;\n    };\n\n    proto.deactivate = function () {\n        if(this.activeStatus) {\n            this.core.hide();\n            this.activeStatus = false;\n        }\n        return true;\n    };\n\n\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsGui', MarkupsGui);\n","'use strict';\n\nimport { MarkupsCore } from './core/MarkupsCore'\nimport { MarkupsGui } from './gui/MarkupsGui'\n\nimport { Clipboard } from './core/edit-clipboard/Clipboard'\nimport { CloneMarkup } from './core/edit-actions/CloneMarkup'\nimport { CreateArrow } from './core/edit-actions/CreateArrow'\nimport { CreateCallout } from './core/edit-actions/CreateCallout'\nimport { CreateCircle } from './core/edit-actions/CreateCircle'\nimport { CreateCloud } from './core/edit-actions/CreateCloud'\nimport { CreateDimension } from './core/edit-actions/CreateDimension'\nimport { CreateFreehand } from './core/edit-actions/CreateFreehand'\nimport { CreateHighlight } from './core/edit-actions/CreateHighlight'\nimport { CreatePolycloud } from './core/edit-actions/CreatePolycloud'\nimport { CreatePolyline } from './core/edit-actions/CreatePolyline'\nimport { CreateRectangle } from './core/edit-actions/CreateRectangle'\nimport { CreateText } from './core/edit-actions/CreateText'\nimport { DeleteArrow } from './core/edit-actions/DeleteArrow'\nimport { DeleteCallout } from './core/edit-actions/DeleteCallout'\nimport { DeleteCircle } from './core/edit-actions/DeleteCircle'\nimport { DeleteCloud } from './core/edit-actions/DeleteCloud'\nimport { DeleteDimension } from './core/edit-actions/DeleteDimension'\nimport { DeleteFreehand } from './core/edit-actions/DeleteFreehand'\nimport { DeleteHighlight } from './core/edit-actions/DeleteHighlight'\nimport { DeletePolycloud } from './core/edit-actions/DeletePolycloud'\nimport { DeletePolyline } from './core/edit-actions/DeletePolyline'\nimport { DeleteRectangle } from './core/edit-actions/DeleteRectangle'\nimport { DeleteText } from './core/edit-actions/DeleteText'\n\nimport { EditAction } from './core/edit-actions/EditAction' \nimport { EditActionGroup } from './core/edit-actions/EditActionGroup' \nimport { EditActionManager } from './core/edit-actions/EditActionManager' \nimport { EditFrame } from './core/EditFrame' \n\nimport { EditMode } from './core/edit-modes/EditMode'\nimport { EditModeArrow } from './core/edit-modes/EditModeArrow'\nimport { EditModeCallout } from './core/edit-modes/EditModeCallout'\nimport { EditModeCircle } from './core/edit-modes/EditModeCircle'\nimport { EditModeCloud } from './core/edit-modes/EditModeCloud'\nimport { EditModeDimension } from './core/edit-modes/EditModeDimension'\nimport { EditModeFreehand } from './core/edit-modes/EditModeFreehand'\nimport { EditModeHighlight } from './core/edit-modes/EditModeHighlight'\nimport { EditModePen } from './core/edit-modes/EditModePen'\nimport { EditModePolycloud } from './core/edit-modes/EditModePolycloud'\nimport { EditModePolyline } from './core/edit-modes/EditModePolyline'\nimport { EditModeRectangle } from './core/edit-modes/EditModeRectangle'\nimport { EditModeText } from './core/edit-modes/EditModeText'\nimport { EditorTextInput } from './core/edit-modes/EditorTextInput'\n\n\nimport { Markup } from './core/Markup'\nimport { MarkupArrow } from './core/MarkupArrow'\nimport { MarkupCallout } from './core/MarkupCallout'\nimport { MarkupCircle } from './core/MarkupCircle'\nimport { MarkupCloud } from './core/MarkupCloud'\nimport { MarkupDimension } from './core/MarkupDimension'\nimport { MarkupFreehand } from './core/MarkupFreehand'\nimport { MarkupHighlight } from './core/MarkupHighlight'\nimport { MarkupPen } from './core/MarkupPen'\nimport { MarkupPolycloud } from './core/MarkupPolycloud'\nimport { MarkupPolyline } from './core/MarkupPolyLine'\nimport { MarkupRectangle } from './core/MarkupRectangle'\nimport { MarkupText } from './core/MarkupText'\nimport { MarkupTool } from './core/MarkupTool'\n\nimport { SetArrow } from './core/edit-actions/SetArrow'\nimport { SetCallout } from './core/edit-actions/SetCallout'\nimport { SetCircle } from './core/edit-actions/SetCircle'\nimport { SetCloud } from './core/edit-actions/SetCloud'\nimport { SetDimension } from './core/edit-actions/SetDimension'\nimport { SetFreehand } from './core/edit-actions/SetFreehand'\nimport { SetHighlight } from './core/edit-actions/SetHighlight'\nimport { SetPolycloud } from './core/edit-actions/SetPolycloud'\nimport { SetPolyline } from './core/edit-actions/SetPolyline'\nimport { SetPosition } from './core/edit-actions/SetPosition'\nimport { SetRectangle } from './core/edit-actions/SetRectangle'\nimport { SetRotation } from './core/edit-actions/SetRotation'\nimport { SetSize } from './core/edit-actions/SetSize'\nimport { SetStyle } from './core/edit-actions/SetStyle'\nimport { SetText } from './core/edit-actions/SetText'\n\n\nimport * as MarkupEvents from './core/MarkupEvents'\nimport * as MarkupTypes from './core/MarkupTypes'\n\nimport * as Utils from './core/MarkupsCoreUtils'\nimport * as StyleUtils from './core/StyleUtils'\n\nimport { theEditModeManager } from './core/EditModeManager'\n\n// All the things\nexport const Core = {\n    Clipboard,\n    CloneMarkup,\n    CreateArrow,\n    CreateCallout,\n    CreateCircle,\n    CreateCloud,\n    CreateDimension,\n    CreateFreehand,\n    CreateHighlight,\n    CreatePolycloud,\n    CreatePolyline,\n    CreateRectangle,\n    CreateText,\n    DeleteArrow,\n    DeleteCallout,\n    DeleteCircle,\n    DeleteCloud,\n    DeleteDimension,\n    DeleteFreehand,\n    DeleteHighlight,\n    DeletePolycloud,\n    DeletePolyline,\n    DeleteRectangle,\n    DeleteText,\n\n    EditAction,\n    EditActionGroup,\n    EditActionManager,\n    EditFrame,\n\n    EditMode,\n    EditModeArrow,\n    EditModeCallout,\n    EditModeCircle,\n    EditModeCloud,\n    EditModeDimension,\n    EditModeFreehand,\n    EditModeHighlight,\n    EditModePen,\n    EditModePolycloud,\n    EditModePolyline,\n    EditModeRectangle,\n    EditModeText,\n    EditorTextInput,\n\n    Markup,\n    MarkupArrow,\n    MarkupCallout,\n    MarkupCircle,\n    MarkupCloud,\n    MarkupDimension,\n    MarkupFreehand,\n    MarkupHighlight,\n    MarkupPen,\n    MarkupPolycloud,\n    MarkupPolyline,\n    MarkupRectangle,\n    MarkupText,\n    MarkupTool,\n    \n    MarkupsCore,\n\n    SetArrow,\n    SetCallout,\n    SetCircle,\n    SetCloud,\n    SetDimension,\n    SetFreehand,\n    SetHighlight,\n    SetPolycloud,\n    SetPolyline,\n    SetPosition,\n    SetRectangle,\n    SetRotation,\n    SetSize,\n    SetStyle,\n    SetText,\n\n\n    MarkupEvents,\n    MarkupTypes,\n    theEditModeManager,\n    Utils,\n};\n\n// Spread the markup types to minimize breaking changes (sigh)\nfor (var markupType in MarkupTypes) {\n    Core[markupType] = MarkupTypes[markupType];\n}\n\n// Spread the event ids to minimize breaking changes (sigh)\nfor (var eventType in MarkupEvents) {\n    Core[eventType] = MarkupEvents[eventType];\n}\n\n// Merge StyleUtils with utils (because those methods used to live in Utils)\nfor (var thing in StyleUtils) {\n    if (thing in Core.Utils)\n        throw new Error(`Property ${thing} from StyleUtils already present in MarkupsCoreUtils.`);\n\n    Core.Utils[thing] = StyleUtils[thing];\n}\n\n\nexport const Gui = {\n    MarkupsGui\n}\n\n\n// Also map back to legacy namespace\nAutodesk.Viewing.Extensions.Markups = {\n    Core\n};\n","/**\n * A class to parse color values\n * @author Stoyan Stefanov <sstoo@gmail.com>\n * @link   http://www.phpied.com/rgb-color-parser-in-javascript/\n * @license Use it if you like it\n */\n\n(function ( global ) {\n\n    function RGBColor(color_string)\n    {\n        this.ok = false;\n\n        // strip any leading #\n        if (color_string.charAt(0) == '#') { // remove # if any\n            color_string = color_string.substr(1,6);\n        }\n\n        color_string = color_string.replace(/ /g,'');\n        color_string = color_string.toLowerCase();\n\n        // before getting into regexps, try simple matches\n        // and overwrite the input\n        var simple_colors = {\n            aliceblue: 'f0f8ff',\n            antiquewhite: 'faebd7',\n            aqua: '00ffff',\n            aquamarine: '7fffd4',\n            azure: 'f0ffff',\n            beige: 'f5f5dc',\n            bisque: 'ffe4c4',\n            black: '000000',\n            blanchedalmond: 'ffebcd',\n            blue: '0000ff',\n            blueviolet: '8a2be2',\n            brown: 'a52a2a',\n            burlywood: 'deb887',\n            cadetblue: '5f9ea0',\n            chartreuse: '7fff00',\n            chocolate: 'd2691e',\n            coral: 'ff7f50',\n            cornflowerblue: '6495ed',\n            cornsilk: 'fff8dc',\n            crimson: 'dc143c',\n            cyan: '00ffff',\n            darkblue: '00008b',\n            darkcyan: '008b8b',\n            darkgoldenrod: 'b8860b',\n            darkgray: 'a9a9a9',\n            darkgreen: '006400',\n            darkkhaki: 'bdb76b',\n            darkmagenta: '8b008b',\n            darkolivegreen: '556b2f',\n            darkorange: 'ff8c00',\n            darkorchid: '9932cc',\n            darkred: '8b0000',\n            darksalmon: 'e9967a',\n            darkseagreen: '8fbc8f',\n            darkslateblue: '483d8b',\n            darkslategray: '2f4f4f',\n            darkturquoise: '00ced1',\n            darkviolet: '9400d3',\n            deeppink: 'ff1493',\n            deepskyblue: '00bfff',\n            dimgray: '696969',\n            dodgerblue: '1e90ff',\n            feldspar: 'd19275',\n            firebrick: 'b22222',\n            floralwhite: 'fffaf0',\n            forestgreen: '228b22',\n            fuchsia: 'ff00ff',\n            gainsboro: 'dcdcdc',\n            ghostwhite: 'f8f8ff',\n            gold: 'ffd700',\n            goldenrod: 'daa520',\n            gray: '808080',\n            green: '008000',\n            greenyellow: 'adff2f',\n            honeydew: 'f0fff0',\n            hotpink: 'ff69b4',\n            indianred : 'cd5c5c',\n            indigo : '4b0082',\n            ivory: 'fffff0',\n            khaki: 'f0e68c',\n            lavender: 'e6e6fa',\n            lavenderblush: 'fff0f5',\n            lawngreen: '7cfc00',\n            lemonchiffon: 'fffacd',\n            lightblue: 'add8e6',\n            lightcoral: 'f08080',\n            lightcyan: 'e0ffff',\n            lightgoldenrodyellow: 'fafad2',\n            lightgrey: 'd3d3d3',\n            lightgreen: '90ee90',\n            lightpink: 'ffb6c1',\n            lightsalmon: 'ffa07a',\n            lightseagreen: '20b2aa',\n            lightskyblue: '87cefa',\n            lightslateblue: '8470ff',\n            lightslategray: '778899',\n            lightsteelblue: 'b0c4de',\n            lightyellow: 'ffffe0',\n            lime: '00ff00',\n            limegreen: '32cd32',\n            linen: 'faf0e6',\n            magenta: 'ff00ff',\n            maroon: '800000',\n            mediumaquamarine: '66cdaa',\n            mediumblue: '0000cd',\n            mediumorchid: 'ba55d3',\n            mediumpurple: '9370d8',\n            mediumseagreen: '3cb371',\n            mediumslateblue: '7b68ee',\n            mediumspringgreen: '00fa9a',\n            mediumturquoise: '48d1cc',\n            mediumvioletred: 'c71585',\n            midnightblue: '191970',\n            mintcream: 'f5fffa',\n            mistyrose: 'ffe4e1',\n            moccasin: 'ffe4b5',\n            navajowhite: 'ffdead',\n            navy: '000080',\n            oldlace: 'fdf5e6',\n            olive: '808000',\n            olivedrab: '6b8e23',\n            orange: 'ffa500',\n            orangered: 'ff4500',\n            orchid: 'da70d6',\n            palegoldenrod: 'eee8aa',\n            palegreen: '98fb98',\n            paleturquoise: 'afeeee',\n            palevioletred: 'd87093',\n            papayawhip: 'ffefd5',\n            peachpuff: 'ffdab9',\n            peru: 'cd853f',\n            pink: 'ffc0cb',\n            plum: 'dda0dd',\n            powderblue: 'b0e0e6',\n            purple: '800080',\n            red: 'ff0000',\n            rosybrown: 'bc8f8f',\n            royalblue: '4169e1',\n            saddlebrown: '8b4513',\n            salmon: 'fa8072',\n            sandybrown: 'f4a460',\n            seagreen: '2e8b57',\n            seashell: 'fff5ee',\n            sienna: 'a0522d',\n            silver: 'c0c0c0',\n            skyblue: '87ceeb',\n            slateblue: '6a5acd',\n            slategray: '708090',\n            snow: 'fffafa',\n            springgreen: '00ff7f',\n            steelblue: '4682b4',\n            tan: 'd2b48c',\n            teal: '008080',\n            thistle: 'd8bfd8',\n            tomato: 'ff6347',\n            turquoise: '40e0d0',\n            violet: 'ee82ee',\n            violetred: 'd02090',\n            wheat: 'f5deb3',\n            white: 'ffffff',\n            whitesmoke: 'f5f5f5',\n            yellow: 'ffff00',\n            yellowgreen: '9acd32'\n        };\n        for (var key in simple_colors) {\n            if (color_string == key) {\n                color_string = simple_colors[key];\n            }\n        }\n        // emd of simple type-in colors\n\n        // array of color definition objects\n        var color_defs = [\n            {\n                re: /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,\n                example: ['rgb(123, 234, 45)', 'rgb(255,234,245)'],\n                process: function (bits){\n                    return [\n                        parseInt(bits[1]),\n                        parseInt(bits[2]),\n                        parseInt(bits[3])\n                    ];\n                }\n            },\n            {\n                re: /^(\\w{2})(\\w{2})(\\w{2})$/,\n                example: ['#00ff00', '336699'],\n                process: function (bits){\n                    return [\n                        parseInt(bits[1], 16),\n                        parseInt(bits[2], 16),\n                        parseInt(bits[3], 16)\n                    ];\n                }\n            },\n            {\n                re: /^(\\w{1})(\\w{1})(\\w{1})$/,\n                example: ['#fb0', 'f0f'],\n                process: function (bits){\n                    return [\n                        parseInt(bits[1] + bits[1], 16),\n                        parseInt(bits[2] + bits[2], 16),\n                        parseInt(bits[3] + bits[3], 16)\n                    ];\n                }\n            }\n        ];\n\n        // search through the definitions to find a match\n        for (var i = 0; i < color_defs.length; i++) {\n            var re = color_defs[i].re;\n            var processor = color_defs[i].process;\n            var bits = re.exec(color_string);\n            if (bits) {\n                channels = processor(bits);\n                this.r = channels[0];\n                this.g = channels[1];\n                this.b = channels[2];\n                this.ok = true;\n            }\n\n        }\n\n        // validate/cleanup values\n        this.r = (this.r < 0 || isNaN(this.r)) ? 0 : ((this.r > 255) ? 255 : this.r);\n        this.g = (this.g < 0 || isNaN(this.g)) ? 0 : ((this.g > 255) ? 255 : this.g);\n        this.b = (this.b < 0 || isNaN(this.b)) ? 0 : ((this.b > 255) ? 255 : this.b);\n\n        // some getters\n        this.toRGB = function () {\n            return 'rgb(' + this.r + ', ' + this.g + ', ' + this.b + ')';\n        }\n        this.toHex = function () {\n            var r = this.r.toString(16);\n            var g = this.g.toString(16);\n            var b = this.b.toString(16);\n            if (r.length == 1) r = '0' + r;\n            if (g.length == 1) g = '0' + g;\n            if (b.length == 1) b = '0' + b;\n            return '#' + r + g + b;\n        }\n\n        // help\n        this.getHelpXML = function () {\n\n            var examples = new Array();\n            // add regexps\n            for (var i = 0; i < color_defs.length; i++) {\n                var example = color_defs[i].example;\n                for (var j = 0; j < example.length; j++) {\n                    examples[examples.length] = example[j];\n                }\n            }\n            // add type-in colors\n            for (var sc in simple_colors) {\n                examples[examples.length] = sc;\n            }\n\n            var xml = document.createElement('ul');\n            xml.setAttribute('id', 'rgbcolor-examples');\n            for (var i = 0; i < examples.length; i++) {\n                try {\n                    var list_item = document.createElement('li');\n                    var list_color = new RGBColor(examples[i]);\n                    var example_div = document.createElement('div');\n                    example_div.style.cssText =\n                        'margin: 3px; '\n                        + 'border: 1px solid black; '\n                        + 'background:' + list_color.toHex() + '; '\n                        + 'color:' + list_color.toHex()\n                    ;\n                    example_div.appendChild(document.createTextNode('test'));\n                    var list_item_value = document.createTextNode(\n                        ' ' + examples[i] + ' -> ' + list_color.toRGB() + ' -> ' + list_color.toHex()\n                    );\n                    list_item.appendChild(example_div);\n                    list_item.appendChild(list_item_value);\n                    xml.appendChild(list_item);\n\n                } catch(e){}\n            }\n            return xml;\n\n        }\n\n    }\n\n    // export as AMD...\n    if ( typeof define !== 'undefined' && define.amd ) {\n        define( function () { return RGBColor; });\n    }\n\n    // ...or as browserify\n    else if ( typeof module !== 'undefined' && module.exports ) {\n        module.exports = RGBColor;\n    }\n\n    global.RGBColor = RGBColor;\n\n}( typeof window !== 'undefined' ? window : this ));"],"sourceRoot":""}
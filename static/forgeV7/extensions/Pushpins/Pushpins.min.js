/*!
 * LMV v7.1.1
 * 
 * Copyright 2019 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Pushpins=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=357)}({1:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var s=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(i),o=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[n].concat(o).concat([s]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},s=0;s<this.length;s++){var o=this[s][0];"number"==typeof o&&(i[o]=!0)}for(s=0;s<e.length;s++){var r=e[s];"number"==typeof r[0]&&i[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),t.push(r))}},t}},2:function(e,t,n){var i={},s=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),o=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),r=null,a=0,u=[],l=n(3);function h(e,t){for(var n=0;n<e.length;n++){var s=e[n],o=i[s.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](s.parts[r]);for(;r<s.parts.length;r++)o.parts.push(v(s.parts[r],t))}else{var a=[];for(r=0;r<s.parts.length;r++)a.push(v(s.parts[r],t));i[s.id]={id:s.id,refs:1,parts:a}}}}function c(e,t){for(var n=[],i={},s=0;s<e.length;s++){var o=e[s],r=t.base?o[0]+t.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[r]?i[r].parts.push(a):n.push(i[r]={id:r,parts:[a]})}return n}function d(e,t){var n=o(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=u[u.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=o(e.insertAt.before,n);n.insertBefore(t,s)}}function p(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function A(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return f(t,e.attrs),d(e,t),t}function f(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function v(e,t){var n,i,s,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var u=a++;n=r||(r=A(t)),i=m.bind(null,n,u,!1),s=m.bind(null,n,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",f(t,e.attrs),d(e,t),t}(t),i=function(e,t,n){var i=n.css,s=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&s;(t.convertToAbsoluteUrls||o)&&(i=l(i));s&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}.bind(null,n,t),s=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=A(t),i=function(e,t){var n=t.css,i=t.media;i&&e.setAttribute("media",i);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),s=function(){p(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else s()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=c(e,t);return h(n,t),function(e){for(var s=[],o=0;o<n.length;o++){var r=n[o];(a=i[r.id]).refs--,s.push(a)}e&&h(c(e,t),t);for(o=0;o<s.length;o++){var a;if(0===(a=s[o]).refs){for(var u=0;u<a.parts.length;u++)a.parts[u]();delete i[a.id]}}}};var y=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}();function m(e,t,n,i){var s=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=y(t,s);else{var o=document.createTextNode(s),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}},248:function(e,t,n){var i=n(249);"string"==typeof i&&(i=[[e.i,i,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(2)(i,s);i.locals&&(e.exports=i.locals)},249:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'/*<editor-fold desc="ISSUES">*/\n@font-face {\n    font-family: \'issueicon\';\n    src: url(data:application/font-woff;charset=utf-8;base64,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);\n    font-weight: normal;\n    font-style: normal;\n}\n\n[class^="issueicon-"], [class*=" issueicon-"] {\n    font-family: \'issueicon\';\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    line-height: 1;\n    padding-top: 2px;\n    speak: none;\n    text-transform: none;\n\n\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\n@font-face {\n    font-family: \'rfiicon\';\n    src: url(data:application/font-woff;charset=utf-8;base64,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);\n    font-weight: normal;\n    font-style: normal;\n}\n\n[class^="rfiicon-"], [class*=" rfiicon-"] {\n    font-family: \'rfiicon\';\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    line-height: 1;\n    padding-top: 2px;\n    speak: none;\n    text-transform: none;\n\n\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\n@font-face {\n    font-family: \'fieldissueicon\';\n    src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUAAA0AAAAAByQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAE5AAAABwAAAAcfzoDmUdERUYAAATIAAAAGwAAAB4AJwALT1MvMgAAAZwAAABKAAAAYC+xTDxjbWFwAAAB+AAAAEQAAAFKwBQjvWdhc3AAAATAAAAACAAAAAj//wADZ2x5ZgAAAkgAAAFeAAABhPocpV5oZWFkAAABMAAAADAAAAA2DEAuiWhoZWEAAAFgAAAAHAAAACQEIwIFaG10eAAAAegAAAAQAAAAEgYAAABsb2NhAAACPAAAAAwAAAAMAFgAwm1heHAAAAF8AAAAHgAAACAATgBKbmFtZQAAA6gAAADjAAAB47FU88Bwb3N0AAAEjAAAADIAAABR2shGr3icY2BkYGAA4uk3ErPi+W2+MnAzMYDAVZ+8TjB9te4fkGJnYmAE0RwMYGkALxEKOXicY2BkYGD8wsDAoMfEAAJAkpEBFbAAACM+AS54nGNgZGBgYGVwZ2BnAAEmIGZkAIk5gPkMAApQAJkAAHicY2BmYmCcwMDKwMHow5jGwMDgDqW/MkgytDAwMDGwcjLAgQCCyRCQ5prC4PCA8QET44P/Dxj0GL/8/wIUZkRSosDACAAr1Q1fAAB4nGNigAAmKGZgAAAAVgAHeJzdisEJwDAQw+RLyRR59NlBuv8M2STxpaWQFSowRiCg8Kwhktum5QeXv/pFQI8xMujKP+PtjSqfyGXWG+L3TGW0BrEAAAAAAAAAAABYAMJ4nG2PvU7CUBiGv4+fcyhwSiH0HAg/ASptKLQ1LaVoDTHGOOjohAnizwW46AU4GBNnZx2dZfQKSJzYvQYHE1fi0dnhXZ68w/NAGgBoAvAWmmDDCLZhAhC5SSua0MAXhtlHF40O0ctchC6Gw5GkhBrC53qgG2EggdCDkMp9j+db7RSheV20Nmy/9nRRV6unuaDdiwOz0rLqdkml/kJhfCGYwh3HOUuYoVvMKKxS4kU1c8eb3bhnjdOdVLdas7okL3/LpcIG0+mV48Cvq1wev3ANJWhDD3zpuwcHAGgW0JSilAtKBPcjHKX/ZKmEDaRDUxgdK+IxRjIj4sI06D8N+K5q56PK8UO7GR8WCqRI8Flbv04GZdYgzX4jcY2e45WrOMfkbtTKcZFllTfBssLzPPzUtEt2sh8PjrQCIfiifvR3aN1ukDqtPmpu7h4JToxN5rHsapVl7mx247o/vPQ77AAAeJyVj8FKw0AURc+0aUAUiht3ltnLhGQgCAXd2U/IFzQtgZJAmv6KOz/IT/ET3HmnPhe6EDrwmDN37rvzBrjhFUdajiXeeEbOs/GcB96MM3k+jBdcu1vjnKV7ktNlV1JW567EM+WXxnMaXowzed6NF9zxaZyzcvec6JnoVAdatgR2DGctUMGpn7rp0G7DbuinIOHX7Y+4MTHtI3sFeSKFxvGsVf8/8u2J1DqliuqreFSs4jfDuG99LEq/9n+GkRLrUIdYVjJf+pFGrpGjOpLLy5PmpWnHYzf0virKizO/AEzyTYUAeJxjYGJABowM6IAVLMrEyMTIzJ+WmZqToptZXFyaqpuZnCeCzM9PSwOK5ecBAP6rDY8AAAAAAAH//wACeJxjYGRgYOABYjEgZmJgBEIWMAbxGAADygAzAAAAAAEAAAAA1BgWEQAAAADVTG6JAAAAANXVfv4=);\n    font-weight: normal;\n    font-style: normal;\n}\n\n[class^="fieldissueicon-"], [class*=" fieldissueicon-"] {\n    font-family: \'fieldissueicon\';\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    line-height: 1;\n    padding-top: 2px;\n    speak: none;\n    text-transform: none;\n\n\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\n.issueicon-issue_hide:before {\n    content: "\\E915";\n}\n.issueicon-issue_normal:before {\n    content: "\\E916";\n}\n\n.rfiicon-rfi_hide:before {\n    content: "\\E003";\n}\n.rfiicon-rfi_normal:before {\n    content: "\\E002";\n}\n\n.fieldissueicon-issue_hide:before {\n    content: "\\E002";\n}\n.fieldissueicon-issue_normal:before {\n    content: "\\E001";\n}\n\n.leaflet-text-label {\n    display: inherit;\n    font-family: \'HelveticaNeue-bold\';\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    line-height: 0;\n    pointer-events: none;\n    /*margin-top: 40px;\n    margin-left:-20px;*/\n    text-align: center;\n    font-size: 16px;\n    border-radius: .5em;\n    max-width:auto;\n    min-width: 60px; /*real width = width + border*2*/\n    height: 32px;    /*real height = height + border*2*/\n    position:absolute;\n    background-color:rgba(0,0,0,0.7);\n    color: #FFF;\n    border: 2px solid white;\n}\n\n.leaflet-marker-icon.leaflet-pin-icon {\n    width: 40px;\n}\n\n.leaflet-text-label span {\n    display: inline-block;\n    vertical-align: middle;\n    line-height:32px;\n    white-space: pre;\n}\n\n.leaflet-pushpin-hidden {\n    visibility: hidden;\n}\n\n/* disable push pin visible button\'s border*/\n#toolbar-pushpinVis, #toolbar-pushpinRfisVis, #toolbar-pushpinFieldIssuesVis {\n    border: none;\n}\n/*</editor-fold>*/\n\n/*<editor-fold desc="PUSHPIN BILLBOARD (3D)">*/\n.pushpin-billboard-marker {\n    position: absolute;\n    font-size: 10px;\n    font-weight: bold;\n    width: 22px;\n    height: 22px;\n\n    left: 0;\n    top: 0;\n\n    line-height: 16px;\n    text-align: center;\n    cursor: pointer;\n    pointer-events: none;\n\n    color: rgba(23, 87, 168, 1.0);\n    border: 4px solid rgba(255, 255, 255, 0.95);\n    background: #4675A8 no-repeat center;\n    background-size: 16px;\n    border-radius: 15px;\n\n    opacity: 1;\n    transition: opacity 0.4s;\n    -webkit-transition: opacity 0.4s;\n}\n\n.rfi-billboard-marker {\n    position: absolute;\n    font-size: 10px;\n    font-weight: bold;\n    width: 22px;\n    height: 22px;\n    line-height: 16px;\n    text-align: center;\n    cursor: pointer;\n    pointer-events: none;\n\n    left: 0;\n    top: 0;\n\n    color: rgba(23, 87, 168, 1.0);\n    border: 4px solid rgba(255, 255, 255, 0.95);\n    background: #4675A8 no-repeat center;\n    background-size: 16px;\n    border-radius: 3px;\n\n    opacity: 1;\n    transition: opacity 0.4s;\n    -webkit-transition: opacity 0.4s;\n}\n\n.pushpin-billboard-marker.selected {\n    border: 5px solid rgba(255, 255, 255, 0.95);\n    border-radius: 20px;\n    background-size: 20px;\n    z-index: 1;\n    top: -3px;\n    width: 28px;\n    height: 28px;\n    left: -3px;\n}\n\n\n.rfi-billboard-marker.selected {\n    border: 5px solid rgba(255, 255, 255, 0.95);\n    border-radius: 4px;\n    background-size: 20px;\n    z-index: 1;\n    top: -3px;\n    width: 28px;\n    height: 28px;\n    left: -3px;\n}\n\n.pushpin-billboard-marker.grey-out {\n    background-color: rgb(145, 145, 145) !important;\n    opacity: 0.5 !important;\n    cursor: not-allowed;\n}\n\n.rfi-billboard-marker.grey-out {\n    background-color: rgb(145, 145, 145) !important;\n    opacity: 0.5 !important;\n    cursor: not-allowed;\n}\n\n.pushpin-container {\n    will-change: transform;\n    transform: translateZ(0);\n    left: 0;\n    top: 0;\n    position: absolute;\n}\n/*</editor-fold>*/',""])},3:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var s,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(s=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},357:function(e,t,n){"use strict";n.r(t);var i={PUSH_PIN_CREATION_START_EVENT:"pushpin.creation.start",PUSH_PIN_CREATION_END_EVENT:"pushpin.creation.end",PUSH_PIN_PREPARING_THUMBNAIL:"pushpin.preparing.thumbnail",PUSH_PIN_CREATED_EVENT:"pushpin.created",PUSH_PIN_SELECTED_EVENT:"pushpin.selected",PUSH_PIN_REMOVED_EVENT:"pushpin.removed",PUSH_PIN_REMOVE_ALL_EVENT:"pushpin.remove.all",PUSH_PIN_MODIFY_EVENT:"pushpin.modified",PUSH_PIN_UPDATE_EVENT:"pushpin.update",PUSH_PIN_VISIBILITY_EVENT:"pushpin.visibility.changed",PUSH_PIN_ITEMS_LOADED:"pushpin.tool.items.loaded",PUSH_PIN_CLICKED_EVENT:"pushpin.clicked",PUSH_PIN_SELECT_NONE:"pushpin.select.none"},s=function(e,t){e&&t&&("eye"in e&&(e.eye[0]=(Number(e.eye[0])+t.x).toString(),e.eye[1]=(Number(e.eye[1])+t.y).toString(),e.eye[2]=(Number(e.eye[2])+t.z).toString()),"target"in e&&(e.target[0]=(Number(e.target[0])+t.x).toString(),e.target[1]=(Number(e.target[1])+t.y).toString(),e.target[2]=(Number(e.target[2])+t.z).toString()),"pivotPoint"in e&&(e.pivotPoint[0]=(Number(e.pivotPoint[0])+t.x).toString(),e.pivotPoint[1]=(Number(e.pivotPoint[1])+t.y).toString(),e.pivotPoint[2]=(Number(e.pivotPoint[2])+t.z).toString()))},o=function(e,t){if(e&&t)for(var n=new THREE.Vector3,i=0;i<e.length;i++){var s=e[i];a(s,n),s[3]=Number(s[3])-n.dot(t)}},r=function(e,t){if(t.data&&t.data.viewerState){var n=e.model,i=function(e,t){if(t){var n=JSON.parse(JSON.stringify(e.data.viewerState)),i={x:-t.x,y:-t.y,z:-t.z};return s(n.viewport,i),e.attributesVersion>=2&&o(n.cutplanes,i),n}return e.data.viewerState}(t,n?n.getData().globalOffset:null);e.restoreState(i,null,!1);var r=e.navigation;if(r){r.updateCamera();var a=r.getCamera();a.updateMatrixWorld(),a.matrixWorldInverse.getInverse(a.matrixWorld)}}},a=function(e,t){t.x=Number(e[0]),t.y=Number(e[1]),t.z=Number(e[2])},u=function(){var e=new THREE.Vector3;return function(t,n){a(t,e),e.applyMatrix4(n),e.toArray(t)}}(),l=function(){var e=new THREE.Vector3,t=new THREE.Matrix3;return function(n,i){a(n,e),t.getNormalMatrix(i),e.applyMatrix3(t),e.normalize(),e.toArray(n)}}(),h=function(e,t){if(u(e.viewport.eye,t),u(e.viewport.target,t),u(e.viewport.pivotPoint,t),l(e.viewport.up,t),l(e.viewport.worldUpVector,t),e.cutplanes)for(var n=new THREE.Plane,i=new THREE.Vector3,s=0;s<e.cutplanes.length;s++){var o=e.cutplanes[s];a(o,i);var r=Number(o[3]);n.set(i,r),n.applyMatrix4(t),n.normal.toArray(o),o[3]=n.constant}},c={"issues-draft":"#819099","issues-draft-selected":"#819099","issues-draft-movable":"#819099","issues-open":"#ffba0c","issues-open-selected":"#ffba0c","issues-open-movable":"#ffba0c","issues-answered":"#087cd9","issues-answered-selected":"#087cd9","issues-answered-movable":"#087cd9","issues-closed":"#bcc9d1","issues-closed-selected":"#bcc9d1","issues-closed-movable":"#bcc9d1","rfis-draft":"#819099","rfis-draft-selected":"#819099","rfis-draft-movable":"#819099","rfis-submitted":"#7a77d9","rfis-submitted-selected":"#7a77d9","rfis-submitted-movable":"#7a77d9","rfis-open":"#ffba0c","rfis-open-selected":"#ffba0c","rfis-open-movable":"#ffba0c","rfis-answered":"#087cd9","rfis-answered-selected":"#087cd9","rfis-answered-movable":"#087cd9","rfis-rejected":"#ff495c","rfis-rejected-selected":"#ff495c","rfis-rejected-movable":"#ff495c","rfis-closed":"#bcc9d1","rfis-closed-selected":"#bcc9d1","rfis-closed-movable":"#bcc9d1","rfis-void":"#bcc9d1","rfis-void-selected":"#bcc9d1","rfis-void-movable":"#bcc9d1","quality_issues-draft":"#819099","quality_issues-draft-selected":"#819099","quality_issues-draft-movable":"#819099","quality_issues-not_approved":"#ff495c","quality_issues-not_approved-selected":"#ff495c","quality_issues-not_approved-movable":"#ff495c","quality_issues-open":"#ffba0c","quality_issues-open-selected":"#ffba0c","quality_issues-open-movable":"#ffba0c","quality_issues-ready_to_inspect":"#7a77d9","quality_issues-ready_to_inspect-selected":"#7a77d9","quality_issues-ready_to_inspect-movable":"#7a77d9","quality_issues-void":"#bcc9d1","quality_issues-void-selected":"#bcc9d1","quality_issues-void-movable":"#bcc9d1","quality_issues-work_completed":"#087cd9","quality_issues-work_completed-selected":"#087cd9","quality_issues-work_completed-movable":"#087cd9","quality_issues-in_dispute":"#ff495c","quality_issues-in_dispute-selected":"#ff495c","quality_issues-in_dispute-movable":"#ff495c","quality_issues-closed":"#bcc9d1","quality_issues-closed-selected":"#bcc9d1","quality_issues-closed-movable":"#bcc9d1","quality_issues-answered":"#087cd9","quality_issues-answered-selected":"#087cd9","quality_issues-answered-movable":"#087cd9"},d="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABMCAYAAAAlS0pSAAAA4UlEQVR42u3bSw7DIAwFwNz/zhXddNVuoPWHlHkHCGKUgG0p1yVyTMYrJGDFQwFbhAIGKw8KGKw8KGCLUMBg5UEdDQYrGeo4sBEUWLC0O7BgwYIFCxYsWLBgwYL1r1jRm8nGasPP3Ew2VhlY1Waqnl96ntwdKxytagjXifXzOtUTy26sr9YbMoeGaAIMywIaDm+Yc2sbKKVDcr2lKP1c6KHd0Ugb0WwxojH8M1aGBUtgwYIFCxYsgQUL1iYofkeB1Q/mcwQFqw3MzQgrHkwlOglGCJZ2B9YdwIhMgpGAJfKWJ1qioD8mrIWXAAAAAElFTkSuQmCC)",p="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIxJREFUeNpi/P//PwMlgJGR0QBIfQCa84ASc5gYKAcTgDiBUkOo4RCqgFGHjDpk1CGjDhl1yKhDRoxDGIFYgcJqPAVK3yHXAGBbxoEF1KgBYgcKHPIHiEHmHKCgcaXASIUWWgPIIyBfjSbWUYeMOmTUIaMOGXXIqEOGVMOICs0AUMNKAGjOBUrMAQgwAFWiHzqojsmJAAAAAElFTkSuQmCC)16 16, auto",A=30,f=38,v=2;function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=AutodeskNamespace("Autodesk.BIM360.Extension.PushPin"),g=function(e){var t=function(e){for(e=(e=e.replace(/-/g,"+")).replace(/_/g,"/");e.length%4;)e+="=";return atob(e)}(e),n=t.indexOf("file:")+"file:".length,i=t.indexOf("?");return t.substring(n,i)},b=function(e,t){for(var n=g(t),i=e.getVisibleModels(),s=0;s<i.length;s++){var o=i[s],r=o.myData.urn;if(g(r)===n)return o}console.error("Issue seedUrn does not match with any visible model urn.")},E=1,P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.itemData={id:(E++).toString(),attributesVersion:v,label:"New",status:"issues-open",position:{x:0,y:0,z:0},type:"issues",objectId:null,externalId:null,viewerState:null,objectData:null},this.selected=!1,this.isVisible=!0,this.draggable=!1,this.selectable=!0}return function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(e,[{key:"defaultAppearance",value:function(){return{normalSize:40,selectedSize:60,draggableStatus:"-movable",selectedStatus:"-selected"}}},{key:"set",value:function(e){return this.itemData=Object.assign({},this.itemData,e),this.correctDataFormat(),this}},{key:"setLocal",value:function(e,t){this.set(e);var n=this.findModel(t);if(n){this.itemData.position=(new THREE.Vector3).copy(this.itemData.position);var i=n.myData.placementWithOffset;i&&this.itemData.position.applyMatrix4(i);var s=n.myData.placementTransform;this.itemData.viewerState=JSON.parse(JSON.stringify(this.itemData.viewerState)),s&&h(this.itemData.viewerState,s)}else console.error("PushPin coordinate conversion failed: PushPin must belong to a visible model.")}},{key:"getLocal",value:function(e){var t=this.findModel(e);if(t){var n=Object.assign({},this.itemData);n.position=(new THREE.Vector3).copy(this.itemData.position),n.viewerState=JSON.parse(JSON.stringify(this.itemData.viewerState));var i=t.myData.placementWithOffset,s=t.myData.placementTransform;if(i){var o=(new THREE.Matrix4).getInverse(i);n.position.applyMatrix4(o)}if(s){var r=(new THREE.Matrix4).getInverse(s);h(n.viewerState,r)}return n}console.error("PushPin coordinate conversion failed: PushPin must belong to a visible model.")}},{key:"setObjectId",value:function(e){this.itemData.objectId=e}},{key:"setObjectData",value:function(e){var t=e.model;if(t){var n=t.getData();if(n){var i=t.getDocumentNode();if(i){var s=i.data;s&&(this.itemData.objectData={guid:s.guid,urn:n.urn,viewableId:s.viewableID,viewName:s.name})}}}}},{key:"setExternalId",value:function(e){this.itemData.externalId=e}},{key:"setPosition",value:function(e){this.itemData.position=Object.assign({},e)}},{key:"hasPosition",value:function(){return null!==this.itemData.position.x&&null!==this.itemData.position.y&&null!==this.itemData.position.z}},{key:"findModel",value:function(e){var t=this.itemData.viewerState.seedUrn||this.itemData.viewerState.seedURN;return b(e,t)}},{key:"setViewerState",value:function(e){this.itemData.viewerState=Object.assign({},e)}},{key:"setOriginalDocumentResolution",value:function(e){this.setViewerState({originalDocumentResolution:e})}},{key:"correctDataFormat",value:function(){var e=this;["draft","draft-selected","draft-movable","open","open-selected","open-movable","answered","answered-selected","answered-movable","closed","closed-selected","closed-movable"].forEach(function(t){e.itemData.status===t&&(e.itemData.status="".concat(e.itemData.type||"issues","-").concat(e.itemData.status))})}},{key:"data",get:function(){return this.itemData}},{key:"visible",get:function(){return this.isVisible},set:function(e){this.hasPosition()?this.isVisible=e:this.isVisible=!1}}]),e}();function w(e,t){var n=Math.ceil(Math.log2(e)),i=Math.ceil(Math.log2(t));return Math.max(n,i)}function I(e,t,n){var i=e.impl.clientToViewport(t,n),s=e.impl.camera.projectionMatrix,o=new THREE.Matrix4;return o.getInverse(s),i.applyMatrix4(o),i.applyMatrix4(e.impl.camera.matrixWorld),i}function k(e,t,n){return e.model.getData().isLeaflet?function(e,t,n){var i,s;if(e.model.getData().isPdf)i=Autodesk.Viewing.PDFUtils.getLeafletLoadOptions(e),s=Autodesk.Viewing.PDFUtils.getLeafletBoundingBox(e);else{var o=e.model.getData();i=o.loadOptions.loadOptions,s=o.bbox}var r=i,a=r.texWidth,u=r.texHeight,l=I(e,t,n),h=new THREE.Vector3(s.min.x,s.max.y,0);l.sub(h);var c=l.x*a/s.size().x,d=l.y*u/s.size().y,p=new THREE.Vector3(c,d,0),A=w(a,u),f=Math.pow(2,A),v=p.x/f,y=p.y/f;return new THREE.Vector3(y,v,0)}(e,t,n):I(e,t,n)}function B(e,t){if(e.model.getData().isLeaflet||e.model.getData().isPdf){var n=t.viewerState&&t.viewerState.originalDocumentResolution,i=function(e,t,n){if(!e.model.getData().isLeaflet&&!e.model.getData().isPdf)return e.worldToClient(t);var i,s,o=t.y,r=t.x;if(e.model.getData().isPdf)i=Autodesk.Viewing.PDFUtils.getLeafletLoadOptions(e),s=Autodesk.Viewing.PDFUtils.getLeafletBoundingBox(e);else{var a=e.model.getData();i=a.loadOptions.loadOptions,s=a.bbox}var u=i,l=u.texWidth,h=u.texHeight,c=w(l,h),d=Math.pow(2,c);o*=d,r*=d;var p=n&&n[0]||l,A=l/p,f=o/(l/A)*s.size().x,v=r/(h/A)*s.size().y,y=new THREE.Vector3(s.min.x+f,s.max.y+v,0);e.model.getData().isPdf&&Autodesk.Viewing.PDFUtils.leafletToPdfWorld(e,y);return e.impl.worldToClient(y)}(e,t.position,n);return I(e,i.x,i.y)}return t.position}function T(e,t){var n=Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(e,(new THREE.Vector3).copy(t.position));t.position={x:n.y-1,y:n.x,z:0}}function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function S(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e,t,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(n):s.value}})(e,t,n||e)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}m.PushPinItem=P;var V=AutodeskNamespace("Autodesk.BIM360.Extension.PushPin"),_=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=S(this,C(t).call(this))).viewer=e,n.options=i,n.pushPinList=[],n.selectedItem=null,n.PushPinTypes={ISSUES:"issues",RFIS:"rfis",QUALITY_ISSUES:"quality_issues"},n.pushPinsVisibilityByType=n.getInitialPushpinVisibilityByType(),n.pushpinsByType=n.getInitialPushpinsByType(),n.create=Promise.resolve(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,Autodesk.Viewing.EventDispatcher),function(e,t,n){t&&x(e.prototype,t),n&&x(e,n)}(t,[{key:"items",value:function(){return this.pushPinList}},{key:"getInitialPushpinsByType",value:function(){var e=this,t={};return Object.keys(this.PushPinTypes).forEach(function(n){t[e.PushPinTypes[n]]={}}),t}},{key:"getInitialPushpinVisibilityByType",value:function(){var e=this,t={};return Object.keys(this.PushPinTypes).forEach(function(n){t[e.PushPinTypes[n]]=!0}),t}},{key:"shouldGenerateThumbnail",value:function(e){return this.options.generateIssueThumbnail&&(e.data.type===this.PushPinTypes.ISSUES||e.data.type===this.PushPinTypes.QUALITY_ISSUES)||this.options.generateRFIThumbnail&&e.data.type===this.PushPinTypes.RFIS}},{key:"generateThumbnail",value:function(e){var t=this;return this.shouldGenerateThumbnail(e)?new Promise(function(n,s){var o,r,a,u,l,h=e.data.position,c=h.x,d=h.y,p=h.z;t.viewer.model.getData().isPdf&&T(t.viewer,e.data),t.fireEvent({type:i.PUSH_PIN_PREPARING_THUMBNAIL,value:e}),e.data.position={x:c,y:d,z:p},u=t.viewer.model.getData().isLeaflet?B(t.viewer,e.data):e.data.position;var A=t.viewer.impl.getCanvasBoundingClientRect();A.width/A.height>1?(r=Math.floor(Math.max(A.height,800)),a=r/A.height,o=Math.floor(A.width*a)):(o=Math.floor(Math.max(A.width,800)),a=o/A.width,r=Math.floor(A.height*a));var f;if(t.viewer.model.is2d()){var v=k(t.viewer,200,0),y=k(t.viewer,0,0),m=v.distanceTo(y);(f=(new THREE.Box3).expandByPoint(u)).expandByVector(new THREE.Vector3(m/2,m/2,0)),f.min.z=0,f.max.z=0}var g={bounds:f,getCropBounds:function(e,t){var n=l;n.x+400>o&&(n.x-=n.x+400-o),n.y+400>r&&(n.y-=n.y+400-r);var i=(new THREE.Box3).expandByPoint(n);return i.expandByVector(new THREE.Vector3(400,400,0)),i},overlayRenderer:function(e,t){var n=t.height,i=t.ctx,s=t.target,o=t.screenshotCamera,r=t.onRenderDone,h=i.targetToCanvas(s).canvas;l=e.worldToClient(u,o).multiplyScalar(a);var c=h.getContext("2d");c.fillStyle="#FF0000",c.beginPath(),c.arc(l.x,n-l.y,40,0,2*Math.PI),c.closePath(),c.fill(),r(h)}};Autodesk.Viewing.ScreenShot.getScreenShotWithBounds(t.viewer,o,r,function(e,t,i){if(!e)return s("Error while preparing pushpin thumbnail.");Autodesk.Viewing.ScreenShot.blobToImage(e,t,i,function(e){return n(e)})},g)}).catch(function(e){return console.error(e),null}):Promise.resolve(null)}},{key:"createItem",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(this.getItemById(e.id))return null;var r=new P;return s?r.setLocal(e,o):r.set(e),this.addItem(r),n&&this.create(r).then(function(){return t.generateThumbnail(r)}).then(function(e){var n=r.data.position,s=n.x,o=n.y,a=n.z;t.viewer.model.getData().isPdf&&T(t.viewer,r.data),t.fireEvent({type:i.PUSH_PIN_CREATED_EVENT,value:r,thumbnail:e}),r.data.position={x:s,y:o,z:a}}),r}},{key:"addItems",value:function(e,t,n){var s=this;e.forEach(function(e){if(s.viewer.model.getData().isPdf){var i=B(s.viewer,e),o=i.x,r=i.y,a=i.z;e.position={x:o,y:r,z:a}}s.createItem(e,!1,t,n)}),this.fireEvent({type:i.PUSH_PIN_ITEMS_LOADED,value:null})}},{key:"removeAllItems",value:function(){this.selectedItem=null,this.pushPinList=[],this.pushpinsByType=this.getInitialPushpinsByType(),this.fireEvent({type:i.PUSH_PIN_REMOVE_ALL_EVENT})}},{key:"addItem",value:function(e){if(e.data&&e.data.id){if(this.getItemIndexById(e.data.id)>-1)return!1;var t=e.data.type;return t&&this.pushPinsVisibilityByType&&(e.visible=this.pushPinsVisibilityByType[t]),t=t||this.PushPinTypes.ISSUES,this.pushpinsByType[t]&&(this.pushpinsByType[t][e.data.id]=e.data),this.pushPinList.unshift(e),!0}return!1}},{key:"removeItemById",value:function(e){this.selectedItem&&this.selectedItem.data.id===e&&(this.selectedItem=null);var t=this.getItemIndexById(e);if(t>-1){var n=this.pushPinList.splice(t,1)[0],s=n.data.type;return s&&this.pushpinsByType[s]&&delete this.pushpinsByType[s][e],this.fireEvent({type:i.PUSH_PIN_REMOVED_EVENT,value:n}),n}return null}},{key:"removeItemsByType",value:function(e){var t=this,n=this.pushpinsByType[e]||{};Object.keys(n).forEach(function(e){t.removeItemById(e)})}},{key:"updateItemById",value:function(e,t){var n=this.getItemById(e);if(!n)return null;var s=this.getItemIndexById(n.data.id);if(!t||!t.id||t.type!==n.data.type)return null;if(this.viewer.model.getData().isPdf){var o=B(this.viewer,t),r=o.x,a=o.y,u=o.z;t.position={x:r,y:a,z:u}}n.set(t);var l=n.data.type;return l&&this.pushpinsByType[l]&&(delete this.pushpinsByType[l][e],this.pushpinsByType[l][n.data.id]=n.data),this.pushPinList[s]=n,this.fireEvent({type:i.PUSH_PIN_UPDATE_EVENT,value:n}),n}},{key:"getItemById",value:function(e){var t=this.getItemIndexById(e);return t>-1?this.pushPinList[t]:null}},{key:"getItemIndexById",value:function(e){var t=-1;return this.pushPinList.every(function(n,i){return n.data.id!==e||(t=i,!1)}),t}},{key:"getItemCountByType",value:function(e){var t=this.pushpinsByType[e]||{};return Object.keys(t).length}},{key:"getSelectedItem",value:function(){return this.selectedItem}},{key:"selectOne",value:function(e){if(!this.selectedItem||this.selectedItem.data.id!==e){var t=this.selectedItem;this.selectedItem=this.getItemById(e),t!==this.selectedItem&&(t&&(t.selected=!1),this.selectedItem&&(this.selectedItem.selected=!0),this.fireEvent({type:i.PUSH_PIN_SELECTED_EVENT,value:this.selectedItem}))}return this.selectedItem}},{key:"selectNone",value:function(){this.selectOne(null)}},{key:"getVisibleByType",value:function(e){return this.pushPinsVisibilityByType[e]}},{key:"setVisibleByType",value:function(e,t){var n=this;this.pushPinsVisibilityByType[e]=t;var s=this.pushpinsByType[e]||{};Object.keys(s).forEach(function(e){var i=n.getItemById(e);i&&(i.visible=t)}),this.fireEvent({type:i.PUSH_PIN_VISIBILITY_EVENT,value:{type:e,isVisible:t}})}},{key:"addEventListener",value:function(e,n){this.hasEventListener(e,n)||D(C(t.prototype),"addEventListener",this).call(this,e,n)}},{key:"setCreateFunction",value:function(e){this.create=e}},{key:"removeCreateFunction",value:function(e){e===this.create&&(this.create=Promise.resolve())}}]),t}();function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}V.PushPinManager=_;var R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=document.createElement("div"),this.container.className="leaflet-text-label",this.text="",this.dirty=!1}return function(e,t,n){t&&L(e.prototype,t),n&&L(e,n)}(e,[{key:"setParent",value:function(e){this.container.parentNode&&this.container.parentNode.removeChild(this.container),e&&e.appendChild(this.container)}},{key:"set",value:function(e){if(this.text!==e){this.container.innerHTML="<span>"+e+"</span>",this.text=e;var t=this.container.firstChild.clientWidth+20;t<60&&(t=60),this.container.style.width=t.toString()+"px";var n=10,i=0;if(0!==this.container.clientWidth)n+=this.container.parentNode.clientHeight,i=.5*(this.container.parentNode.clientWidth-this.container.clientWidth),n=n.toString()+"px",i=i.toString()+"px",this.container.style.top!==n&&(this.container.style.top=n),this.container.style.left!==i&&(this.container.style.left=i),this.dirty=!1}}}]),e}();function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function U(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(n):s.value}})(e,t,n||e)}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}AutodeskNamespace("Autodesk.BIM360.Extension.PushPin").HTMLPushPinLabel=R;var z=function(e){function t(e,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=U(this,G(t).call(this))).createLabel(e,n),i.visible=!0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,R),function(e,t,n){t&&H(e.prototype,t),n&&H(e,n)}(t,[{key:"createLabel",value:function(e,n){j(G(t.prototype),"setParent",this).call(this,e),this.update(n)}},{key:"update",value:function(e){j(G(t.prototype),"set",this).call(this,e),this.container.style.top=t.TOP_PADDING,this.container.style.left=this.container.style.width/3+"px"}},{key:"show",value:function(){this.visible=!0,this.container.style.display="block"}},{key:"hide",value:function(){this.visible=!1,this.container.style.display="none"}},{key:"isVisible",get:function(){return this.visible},set:function(e){this.visible=e}}]),t}();function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}z.TOP_PADDING="50px",AutodeskNamespace("Autodesk.BIM360.Extension.PushPin").PushPinBillboardLabel=z;var Q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.names=["pushpinBillboard2D"],this.viewer=t,this.active=!1,this.pushpins=[],this.selectedPushpin=null,this.dirty=!1,this.camera=this.viewer.navigation.getCamera(),this.curCameraZ=0,this.curCameraRotationZ=0}return function(e,t,n){t&&F(e.prototype,t),n&&F(e,n)}(e,[{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"isActive",value:function(){return this.active}},{key:"activate",value:function(e){var t=this;e===this.getName()&&(this.active=!0,this.onCameraChangeBinded=function(e){return t.onCameraChange(e)},this.handleResizeBinded=function(e){return t.handleResize(e)},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.handleResizeBinded),this.createMarkerContainer())}},{key:"deactivate",value:function(e){e===this.getName()&&(this.active=!1,this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.handleResizeBinded))}},{key:"onCameraChange",value:function(e){e.camera.position.z.toPrecision(5)!==this.curCameraZ.toPrecision(5)||e.camera.rotation.z.toPrecision(5)!==this.curCameraRotationZ.toPrecision(5)?(this.updatePushpinsProjection(),this.curCameraZ=e.camera.position.z,this.curCameraRotationZ=e.camera.rotation.z):this.updateContainerProjection()}},{key:"createMarkerContainer",value:function(){this.pushpinContainer||(this.pushpinContainer=this.viewer.appendOrderedElementToViewer("pushpin-container"),this.pushpinContainer.className="pushpin-container",this.pushpinContainer.position=new THREE.Vector3)}},{key:"project",value:function(e){var t=e.marker.intersectPoint,n=this.viewer.navigation.getScreenViewport(),i=(new THREE.Vector3).copy(t),s=new THREE.Matrix4;return s.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),i.applyProjection(s),new THREE.Vector3(Math.round((i.x+1)/2*n.width),Math.round((1-i.y)/2*n.height),i.z)}},{key:"unproject",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n=new THREE.Vector3;return n.x=e.x/t.width*2-1,n.y=-(e.y/t.height*2-1),n.z=e.z,n.unproject(this.camera),n}},{key:"initNewPushpin",value:function(e){if(this.viewer.model.getData().isLeaflet){this.convertLeafletPosition(e);var t=this.viewer.model.getData().loadOptions.loadOptions;e.setOriginalDocumentResolution([t.texWidth,t.texHeight])}else e.intersectPoint=e.data.position;this.pushpins.push(e),this.createMarker(e),e.draggable?this.enableDragging(e):this.disableDragging(e),e.visible?this.showMarker(e.marker):this.hideMarker(e.marker)}},{key:"createPushpin",value:function(e){return this.initNewPushpin(e),this.selectPushpin(e),Promise.resolve()}},{key:"convertLeafletPosition",value:function(e){var t=B(this.viewer,e.data);e.intersectPoint={x:t.x,y:t.y,z:t.z}}},{key:"loadPushpin",value:function(e){return this.initNewPushpin(e),Promise.resolve()}},{key:"createMarker",value:function(e){var t=document.createElement("div"),n="rfis"===e.data.type?"rfi-billboard-marker":"pushpin-billboard-marker";if(t.classList.add(n),t.style.backgroundColor=c[e.data.status],t.style.boxShadow="0px 1px 6px rgba(0, 0, 0, 0.6)",this.pushpinContainer.appendChild(t),t.id=e.data.id,t.intersectPoint=e.intersectPoint,e.marker=t,this.setMarkerPosition(e),1===this.pushpins.length)this.setPushpinContainerPosition(e);else{var i=e.marker.position.x-this.pushpinContainer.position.x,s=e.marker.position.y-this.pushpinContainer.position.y;e.marker.style.transform="translate(".concat(i,"px, ").concat(s,"px)")}}},{key:"removePushpin",value:function(e){var t=this;this.pushpins=this.pushpins.filter(function(n){return t.selectedPushpin&&t.selectedPushpin.data.id===e.data.id&&(t.selectedPushpin=null),n.data.id!==e.data.id}),this.destroyMarker(e)}},{key:"removeAll",value:function(){var e=this;this.pushpins.forEach(function(t){e.removePushpin(t)})}},{key:"destroyMarker",value:function(e){this.destroyLabel(e),this.pushpinContainer.removeChild(e.marker),e.marker=void 0}},{key:"destroyLabel",value:function(e){e.label&&(e.marker.removeChild(e.label.container),e.label=void 0)}},{key:"setPushpinContainerPosition",value:function(e){var t=e.marker.position.x-A/2,n=e.marker.position.y-A/2;this.pushpinContainer.initPos=e.intersectPoint,this.pushpinContainer.position.x=e.marker.position.x,this.pushpinContainer.position.y=e.marker.position.y,this.pushpinContainer.style.transform="translate(".concat(t,"px, ").concat(n,"px)")}},{key:"setMarkerPosition",value:function(e){e.marker.position=this.project(e)}},{key:"updateStyle",value:function(e,t,n){c[e]=n,this.dirty=!0}},{key:"updateContainerProjection",value:function(){var e=this;if(this.pushpins.length>0){var t={marker:{intersectPoint:this.pushpinContainer.initPos}},n=this.pushpinContainer.position=this.project(t),i=A,s=n.x-i/2,o=n.y-i/2;this.pushpinContainer.style.transform="translate(".concat(s,"px, ").concat(o,"px)")}this.pushpins.forEach(function(t){e.updatePushpin(t)}),this.dirty=!1}},{key:"updatePushpinsProjection",value:function(){var e=this;this.redraw=!0,this.pushpins.forEach(function(t){e.setMarkerPosition(t)}),this.pushpins.forEach(function(t){e.redraw&&(e.setPushpinContainerPosition(t),e.redraw=!1);var n=t.marker.position.x-e.pushpinContainer.position.x,i=t.marker.position.y-e.pushpinContainer.position.y;t.marker.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e.updatePushpin(t)}),this.dirty=!1}},{key:"updatePushpin",value:function(e){this.dirty&&(e.label&&e.label.update(e.data.label),e.draggable?this.enableDragging(e):this.disableDragging(e),e.marker.style.backgroundColor=c[e.data.status],e.visible?this.showMarker(e.marker):this.hideMarker(e.marker))}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"selectPushpin",value:function(e){this.deselect(),this.viewer.clearSelection(),e.label=new z(e.marker,e.data.label),e.marker.classList.add("selected"),this.selectedPushpin=e,e.draggable?this.enableDragging(e):this.disableDragging(e)}},{key:"deselect",value:function(){this.selectedPushpin&&(this.destroyLabel(this.selectedPushpin),this.selectedPushpin.marker.style.pointerEvents="none",this.selectedPushpin.marker.classList.remove("selected"),this.selectedPushpin=null)}},{key:"enableDragging",value:function(e){this.selectedPushpin&&this.selectedPushpin.data.id===e.data.id&&(e.marker.style.pointerEvents="auto"),e.marker.style.backgroundImage=d}},{key:"disableDragging",value:function(e){var t=e||this.selectedPushpin;t.marker.style.pointerEvents="none",t.marker.style.backgroundImage="none",t.draggable=!1}},{key:"showMarker",value:function(e){e.style.display=""}},{key:"hideMarker",value:function(e){e.style.display="none"}},{key:"showMarkers",value:function(){var e=this;this.pushpins.forEach(function(t){t.visible?e.showMarker(t.marker):e.hideMarker(t.marker)})}},{key:"hideMarkers",value:function(){var e=this;this.pushpins.forEach(function(t){e.hideMarker(t.marker)}),this.selectedPushpin&&this.destroyLabel(this.selectedPushpin)}},{key:"handleButtonDown",value:function(e,t){return!1}},{key:"handleButtonUp",value:function(e,t){return!1}},{key:"handleResize",value:function(){var e=this;setTimeout(function(){e.updatePushpinsProjection()},1)}}]),e}();function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}AutodeskNamespace("Autodesk.BIM360.Extension.PushPin").PushPinBillboardTool2D=Q;var X=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pushpin=null,this.pushpinRenderer=t,this.mousePosition={x:0,y:0},this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onHammerInputBinded=this.onHammerInput.bind(this),this.mouseEnabled=!1,this.mousePrevValue=!1,this.lock=!1}return function(e,t,n){t&&W(e.prototype,t),n&&W(e,n)}(e,[{key:"processMouseEvent",value:function(e){this.mousePosition.x=e.clientX,this.mousePosition.y=e.clientY}},{key:"attachTo",value:function(e){this.pushpin&&this.detach(),this.pushpin=e,Autodesk.Viewing.isTouchDevice()&&(this.hammer=new Autodesk.Viewing.Hammer.Manager(e,{recognizers:[Autodesk.Viewing.GestureRecognizers.drag],inputClass:Autodesk.Viewing.isIE11?Hammer.PointerEventInput:Hammer.TouchInput}),this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("hammer.input",this.onHammerInputBinded)),Autodesk.Viewing.isMobileDevice()||this.enableMouseButtons(!0)}},{key:"onHammerInput",value:function(e){this.setMouseDisabledWhenTouching(e)}},{key:"setMouseDisabledWhenTouching",value:function(e){var t=this;e.isFirst&&!this.lock?(this.enableMouseButtons(!1),this.lock=!0):e.isFinal&&setTimeout(function(){t.enableMouseButtons(t.mousePrevValue),t.lock=!1},10)}},{key:"enableMouseButtons",value:function(e){e&&!this.mouseEnabled?(this.pushpin.addEventListener("mousedown",this.onMouseDownBinded),this.pushpinRenderer.viewer.container.addEventListener("mousemove",this.onMouseMoveBinded),this.pushpinRenderer.viewer.container.addEventListener("mouseup",this.onMouseUpBinded)):!e&&this.mouseEnabled&&(this.pushpin.removeEventListener("mousedown",this.onMouseDownBinded),this.pushpinRenderer.viewer.container.removeEventListener("mousemove",this.onMouseMoveBinded),this.pushpinRenderer.viewer.container.removeEventListener("mouseup",this.onMouseUpBinded)),this.mousePrevValue=this.mouseEnabled,this.mouseEnabled=e}},{key:"detach",value:function(){this.hammer&&this.hammer.destroy(),this.pushpinRenderer.viewer.container.removeEventListener("mousemove",this.onMouseMoveBinded),this.pushpinRenderer.viewer.container.removeEventListener("mouseup",this.onMouseUpBinded),this.pushpin&&(this.pushpin.removeEventListener("mousedown",this.onMouseDownBinded),this.pushpin=null),this.mouseEnabled=!1}},{key:"onMouseMove",value:function(e){this.processMouseEvent(e),this.pushpinRenderer.handleMouseMove(e),e.preventDefault()}},{key:"onMouseDown",value:function(e){this.processMouseEvent(e),this.pushpinRenderer.handleMouseDown(e),e.preventDefault()}},{key:"onMouseUp",value:function(e){this.processMouseEvent(e),this.pushpinRenderer.handleMouseUp(e),e.preventDefault()}},{key:"onTouchDrag",value:function(t){switch(e.convertEventHammerToMouse(t),t.type){case"dragstart":this.onMouseDown(t);break;case"dragmove":this.onMouseMove(t);break;case"dragend":this.onMouseUp(t)}t.preventDefault()}}],[{key:"convertEventHammerToMouse",value:function(e){e.shiftKey=!1,e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY}}]),e}();function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}AutodeskNamespace("Autodesk.BIM360.Extension.PushPin").PushPinInputHandler=X;var Z=function(){function e(t,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.pushPinManager=n,this.pushpinDirty=!1,this.selectedItem=null,this.onSelectedChangedBind=function(e){return i.onSelectedChanged(e)},this.onRemoveBind=function(e){return i.onRemove(e)},this.onRemoveAllBind=function(e){return i.onRemoveAll(e)},this.onModifyBind=function(e){return i.onModify(e)},this.onUpdateBind=function(e){return i.onUpdate(e)},this.createBind=function(e){return i.create(e)},this.onVisibilityChangedBind=function(e){return i.onVisibilityChanged(e)}}return function(e,t,n){t&&J(e.prototype,t),n&&J(e,n)}(e,[{key:"register",value:function(){this.pushpinBillboardTool=new Q(this.viewer),this.viewer.toolController.registerTool(this.pushpinBillboardTool)}},{key:"deregister",value:function(){this.pushpinBillboardTool&&(this.viewer.toolController.deregisterTool(this.pushpinBillboardTool),this.pushpinBillboardTool=null)}},{key:"activate",value:function(){return this.pushpinBillboardTool.isActive()||this.viewer.toolController.activateTool("pushpinBillboard2D"),this.inputHandler=new X(this),this.pushPinManager.addEventListener(i.PUSH_PIN_SELECTED_EVENT,this.onSelectedChangedBind),this.pushPinManager.addEventListener(i.PUSH_PIN_REMOVED_EVENT,this.onRemoveBind),this.pushPinManager.addEventListener(i.PUSH_PIN_REMOVE_ALL_EVENT,this.onRemoveAllBind),this.pushPinManager.addEventListener(i.PUSH_PIN_MODIFY_EVENT,this.onModifyBind),this.pushPinManager.addEventListener(i.PUSH_PIN_UPDATE_EVENT,this.onUpdateBind),this.pushPinManager.addEventListener(i.PUSH_PIN_VISIBILITY_EVENT,this.onVisibilityChangedBind),this.pushPinManager.setCreateFunction(this.createBind),!0}},{key:"deactivate",value:function(){this.pushpinBillboardTool.isActive()&&this.viewer.toolController.deactivateTool("pushpinBillboard2D"),this.inputHandler.detach(),this.pushPinManager.removeEventListener(i.PUSH_PIN_SELECTED_EVENT,this.onSelectedChangedBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_REMOVED_EVENT,this.onRemoveBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_REMOVE_ALL_EVENT,this.onRemoveAllBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_MODIFY_EVENT,this.onModifyBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_UPDATE_EVENT,this.onUpdateBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_VISIBILITY_EVENT,this.onVisibilityChangedBind),this.pushPinManager.removeCreateFunction(this.createBind)}},{key:"setPushpinDirty",value:function(){this.pushpinDirty=!0}},{key:"onSelectedChanged",value:function(e){e.value?(this.selectedItem=e.value,this.selectedItem.marker||this.create(this.selectedItem),this.pushpinBillboardTool.selectPushpin(this.selectedItem),this.focusCameraOnSelectedItem(this.selectedItem),this.selectedItem.draggable&&this.enableItemDragging(this.selectedItem),this.viewer.dispatchEvent({type:i.PUSH_PIN_SELECTED_EVENT})):(this.deselectItem(),this.pushpinBillboardTool.deselect()),this.setPushpinDirty()}},{key:"deselectItem",value:function(){this.selectedItem=null,this.inputHandler.detach()}},{key:"onRemove",value:function(e){this.selectedItem&&e.value.data.id===this.selectedItem.data.id&&this.deselectItem(),e.value&&e.value.marker&&this.pushpinBillboardTool.removePushpin(e.value)}},{key:"onRemoveAll",value:function(){this.deselectItem(),this.pushpinBillboardTool.removeAll()}},{key:"onModify",value:function(){this.pushpinDirty=!0}},{key:"onVisibilityChanged",value:function(){this.pushpinBillboardTool.showMarkers()}},{key:"onUpdate",value:function(){var e=this;setTimeout(function(){e.setPushpinDirty(),e.pushpinBillboardTool&&e.pushpinBillboardTool.setDirty();var t=e.pushPinManager?e.pushPinManager.getSelectedItem():null;t&&(t.draggable&&t.marker?e.enableItemDragging(t):e.disableItemDragging(t))},1)}},{key:"enableItemDragging",value:function(e){this.pushpinBillboardTool.enableDragging(e),this.inputHandler.attachTo(e.marker)}},{key:"disableItemDragging",value:function(e){this.pushpinBillboardTool.disableDragging(e),this.inputHandler.detach()}},{key:"create",value:function(e){return this.createRenderItem(e,Autodesk.Viewing.isIOSDevice())}},{key:"createRenderItem",value:function(e,t){var n,i=e.data.id.length>20;return this.pushpinBillboardTool.deselect(),i&&!t?n=this.pushpinBillboardTool.loadPushpin(e):(n=this.pushpinBillboardTool.createPushpin(e),this.pushPinManager.selectOne(e.data.id)),n}},{key:"updatePattern",value:function(e,t,n){this.pushpinBillboardTool.updateStyle(e,t,n),this.setPushpinDirty()}},{key:"focusCameraOnSelectedItem",value:function(e){if(e.marker){var t=this.viewer.utilities.getBoundingBox(!0),n=.2*(t.max.x-t.min.x),i=.2*(t.max.y-t.min.y),s=new THREE.Vector3(e.marker.intersectPoint.x-n,e.marker.intersectPoint.y-i,0),o=new THREE.Vector3(e.marker.intersectPoint.x+n,e.marker.intersectPoint.y+i,0),r=new THREE.Box3(s,o);this.viewer.navigation.fitBounds(!1,r,!0)}}},{key:"render",value:function(){var e=this;this.pushPinManager&&this.viewer.model&&(this.pushPinManager.items().reverse().forEach(function(t){t.marker||e.createRenderItem(t,!1)}),this.pushpinDirty&&(this.pushpinBillboardTool.updateContainerProjection(),this.pushpinDirty=!1))}},{key:"findIntersections",value:function(e){var t=e.clientX,n=e.clientY,i=null;return this.pushPinManager.items().some(function(e){if(e.selectable&&e.marker){var s=e.marker.getBoundingClientRect();if(t>s.left&&t<s.left+s.width&&n>s.top&&n<s.top+s.height)return i=e,!0}return!1}),i}},{key:"handleMouseMove",value:function(e){if(this.selectedItem.marker&&this.selectedItem.marker.startDragging){this.newX||(this.selectedItem.marker.style.transform="translate(0px, 0px)");var t=function(e){return e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+document.body.scrollLeft-document.body.clientLeft,y:e.clientY+document.body.scrollTop-document.body.clientTop}}(e);this.newX=t.x-this.mouseOffset.x,this.newY=t.y-this.mouseOffset.y;var n=this.viewer.navigation.getScreenViewport(),i=this.selectedItem.marker.clientWidth,s=this.selectedItem.marker.clientHeight;this.newX<5&&(this.newX=0),this.newY<5&&(this.newY=0),n.width-5<this.newX+i&&(this.newX=n.width-i),n.height-5<this.newY+s&&(this.newY=n.height-s);var o=this.pushpinBillboardTool.pushpinContainer.position.x,r=this.pushpinBillboardTool.pushpinContainer.position.y;this.selectedItem.marker.style.left="".concat(this.newX-o,"px"),this.selectedItem.marker.style.top="".concat(this.newY-r,"px"),this.selectedItem.marker.dragging=!0}}},{key:"handleMouseUp",value:function(e){var t=this;if(this.selectedItem.marker)if(this.selectedItem.marker.dragging){var n=this.pushpinBillboardTool.pushpinContainer.position.x,s=this.pushpinBillboardTool.pushpinContainer.position.y;this.selectedItem.marker.style.transform="translate(".concat(this.newX-n,"px, ").concat(this.newY-s,"px)");var o=k(this.viewer,this.newX,this.newY);this.selectedItem.data.position={x:o.x,y:o.y,z:o.z},this.pushPinManager.generateThumbnail(this.selectedItem).then(function(e){var n=t.selectedItem.data.position,s=n.x,o=n.y,r=n.z;t.viewer.model.getData().isPdf&&T(t.viewer,t.selectedItem.data),t.pushPinManager.fireEvent({type:i.PUSH_PIN_MODIFY_EVENT,value:t.selectedItem,thumbnail:e}),t.selectedItem.data.position={x:s,y:o,z:r}}),this.pushpinBillboardTool.removeAll(),this.render(),this.pushpinBillboardTool.selectPushpin(this.pushPinManager.selectedItem),this.selectedItem.draggable&&this.enableItemDragging(this.selectedItem)}else this.selectedItem.marker.startDragging=!1}},{key:"handleMouseDown",value:function(e){if(this.selectedItem.marker){if("textarea"===e.target.tagName.toLowerCase())return;this.mouseOffset=function(e){for(var t=0,n=0;e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t+=e.offsetLeft,y:n+=e.offsetTop}}(this.viewer.container),this.newX=null,this.newY=null,this.selectedItem.marker.startDragging=!0}}}]),e}();function K(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var q=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.names=["pushpinBillboard3D"],this.viewer=t,this.active=!1,this.pushpins=[],this.selectedPushpin=null,this.dirty=!1,this.camera=this.viewer.navigation.getCamera();this.maxMsPerRayCastCycle=20,this.updateTimestamp=0,i.disableOcclusionTest?this.raycastThrottle=function(){}:this.raycastThrottle=this.throttle(function(){n.continueRayCasts()},200)}return function(e,t,n){t&&K(e.prototype,t),n&&K(e,n)}(e,[{key:"continueRayCasts",value:function(){for(var e=performance.now(),t=0;t<this.pushpins.length;t++){var n=this.pushpins[t];if(n.visible&&(n.updateTimestamp!==this.updateTimestamp&&(n.updateTimestamp=this.updateTimestamp,this.castRay(n),performance.now()>e+this.maxMsPerRayCastCycle)))break}t<this.pushpins.length&&this.raycastThrottle()}},{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"isActive",value:function(){return this.active}},{key:"activate",value:function(e){var t=this;e===this.getName()&&(this.active=!0,this.onCameraChangeBinded=function(e){return t.onCameraChange(e)},this.handleResizeBinded=function(e){return t.handleResize(e)},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.handleResizeBinded))}},{key:"throttle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=null,s=null,o=function(){i=null,e.apply(n,s)};return function(){i||(s=arguments,i=setTimeout(o,t))}}},{key:"deactivate",value:function(e){e===this.getName()&&(this.active=!1,this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.handleResizeBinded))}},{key:"onCameraChange",value:function(){this.updatePushpins()}},{key:"project",value:function(e){var t=e.marker.intersectPoint,n=this.viewer.navigation.getScreenViewport(),i=(new THREE.Vector3).copy(t),s=new THREE.Matrix4,o=new THREE.Frustum;return s.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),e.visible&&(o.setFromMatrix(s),o.containsPoint(i)?this.showMarker(e.marker):this.hideMarker(e.marker)),i.applyProjection(s),new THREE.Vector3(Math.round((i.x+1)/2*n.width),Math.round((1-i.y)/2*n.height),i.z)}},{key:"unproject",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n=new THREE.Vector3;return n.x=e.x/t.width*2-1,n.y=-(e.y/t.height*2-1),n.z=e.z,n.unproject(this.camera),n}},{key:"initNewPushpin",value:function(e){e.intersectPoint=e.data.position,this.pushpins.push(e),this.createMarker(e),e.draggable?this.enableDragging(e):this.disableDragging(e),e.visible?this.showMarker(e.marker):this.hideMarker(e.marker)}},{key:"fetchExternalId",value:function(e,t,n){var i=this;return new Promise(function(s,o){e.getProperties2(t,function(t){var o=t.externalId;if(o.startsWith("[")&&o.endsWith("]"))try{var r=JSON.parse(o);Array.isArray(r)&&(o=r[r.length-1])}catch(e){console.error("Error "+e+" parsing externalId ",o)}if("ifc"===e.getData().loadOptions.fileExt){var a=t.properties.find(function(e){return"IfcGUID"===e.displayName||"GLOBALID"===e.displayName&&"IFC"===e.displayCategory});if(a)o=a.displayValue;else{var u=t.properties.find(function(e){return"parent"===e.displayName&&e.displayValue>-1});if(u)return void s(i.fetchExternalId(e,u.displayValue,n))}}n(o),s()},function(e,t,n){Autodesk.Viewing.Private.logger.warn(t),s()},{needsExternalId:!0})})}},{key:"createPushpin",value:function(e){this.initNewPushpin(e);var t=this.viewer.model?this.viewer.model.getData().globalOffset:null;e.setViewerState(function(e,t){var n=JSON.parse(JSON.stringify(e));return t&&(s(n.viewport,t),o(n.cutplanes,t),n.globalOffset=t),n}(this.viewer.getState(),t)),this.selectPushpin(e);var n=this.viewer.impl.clientToViewport(e.marker.position.x,e.marker.position.y),i=this.viewer.impl.castRayViewport(n,!1);if(i){e.setObjectId(i.dbId),e.setObjectData(i);var r=e.findModel(this.viewer);return r?this.fetchExternalId(r,i.dbId,function(t){return e.setExternalId(t)}):(console.error("Failed to assign externalId: The model for this PushPin is not loaded."),Promise.resolve())}return Promise.resolve()}},{key:"loadPushpin",value:function(e){return this.initNewPushpin(e),Promise.resolve()}},{key:"createMarker",value:function(e){var t=document.createElement("div");if(e.marker=t,t.id=e.data.id,t.intersectPoint=e.intersectPoint,e.hasPosition()){var n="rfis"===e.data.type?"rfi-billboard-marker":"pushpin-billboard-marker";t.classList.add(n),t.style.backgroundColor=c[e.data.status],this.viewer.container.appendChild(t),this.setMarkerPosition(e);var i=e.marker.position.x-A/2,s=e.marker.position.y-A/2;e.marker.style.transform="translate(".concat(i,"px, ").concat(s,"px)")}else this.hideMarker(t),e.visible=!1}},{key:"removePushpin",value:function(e){var t=this;this.pushpins=this.pushpins.filter(function(n){return t.selectedPushpin&&t.selectedPushpin.data.id===e.data.id&&(t.selectedPushpin=null),n.data.id!==e.data.id}),this.destroyMarker(e)}},{key:"removeAll",value:function(){var e=this;this.pushpins.forEach(function(t){e.removePushpin(t)})}},{key:"destroyMarker",value:function(e){this.destroyLabel(e),this.viewer.container.removeChild(e.marker),e.marker=void 0}},{key:"destroyLabel",value:function(e){e.label&&(e.marker.removeChild(e.label.container),e.label=void 0)}},{key:"setMarkerPosition",value:function(e){e.marker.position=this.project(e)}},{key:"updateStyle",value:function(e,t,n){c[e]=n,this.dirty=!0}},{key:"castRay",value:function(e){var t=parseInt(e.data.objectId,10);if(!isNaN(t)&&-1!==t){var n=this.viewer.impl.clientToViewport(e.marker.position.x,e.marker.position.y),i=this.viewer.impl.castRayViewport(n,!1);if(i&&i.dbId){if(e.data.externalId)return this.fetchExternalId(i.model,i.dbId,function(t){e&&e.marker&&e.data&&(e.marker.style.opacity=t===e.data.externalId?"1.0":"0.15")});e.data.objectId&&-1!==parseInt(e.data.objectId,10)&&(e.marker.style.opacity=i.dbId===parseInt(e.data.objectId,10)?"1.0":"0.15")}else e.marker.style.opacity="0.15"}}},{key:"updatePushpins",value:function(){var e=this;this.updateTimestamp++,this.raycastThrottle(),this.pushpins.forEach(function(t){e.setMarkerPosition(t)}),this.pushpins.forEach(function(t){var n=t.selected?f:A,i=t.marker.position.x-n/2,s=t.marker.position.y-n/2;t.marker.style.transform="translate(".concat(i,"px, ").concat(s,"px)"),e.dirty&&(t.label&&t.label.update(t.data.label),t.draggable?e.enableDragging(t):e.disableDragging(t),t.marker.style.backgroundColor=c[t.data.status],t.visible?e.showMarker(t.marker):e.hideMarker(t.marker))}),this.dirty=!1}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"selectPushpin",value:function(e){this.deselect(),this.viewer.clearSelection(),e.label=new z(e.marker,e.data.label),e.marker.classList.add("selected"),this.selectedPushpin=e}},{key:"deselect",value:function(){this.selectedPushpin&&(this.destroyLabel(this.selectedPushpin),this.selectedPushpin.marker.style.pointerEvents="none",this.selectedPushpin.marker.classList.remove("selected"),this.selectedPushpin=null)}},{key:"enableDragging",value:function(e){this.selectedPushpin&&this.selectedPushpin.data.id===e.data.id&&(e.marker.style.pointerEvents="auto"),e.marker.style.backgroundImage=d}},{key:"disableDragging",value:function(e){var t=e||this.selectedPushpin;t.marker.style.pointerEvents="none",t.marker.style.backgroundImage="none",t.draggable=!1}},{key:"hideLabel",value:function(){this.selectedPushpin&&this.selectedPushpin.label.hide()}},{key:"showMarker",value:function(e){e.style.display=""}},{key:"hideMarker",value:function(e){e.style.display="none"}},{key:"showMarkers",value:function(){var e=this;this.pushpins.forEach(function(t){t.visible?e.project(t):e.hideMarker(t.marker)})}},{key:"hideMarkers",value:function(){var e=this;this.pushpins.forEach(function(t){e.hideMarker(t.marker)}),this.selectedPushpin&&this.destroyLabel(this.selectedPushpin)}},{key:"handleButtonDown",value:function(e,t){return!1}},{key:"handleButtonUp",value:function(e,t){return!1}},{key:"handleResize",value:function(){this.updatePushpins()}}]),e}();function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}AutodeskNamespace("Autodesk.BIM360.Extension.PushPin").PushPinBillboardTool3D=q;var ee=function(){function e(t,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.pushPinManager=n,this.pushpinDirty=!1,this.selectedItem=null,this.onExplodeBind=function(e){return i.onExplode(e)},this.onSectionBind=function(e){return i.onSection(e)},this.onSelectedChangedBind=function(e){return i.onSelectedChanged(e)},this.onRemoveBind=function(e){return i.onRemove(e)},this.onRemoveAllBind=function(e){return i.onRemoveAll(e)},this.onModifyBind=function(e){return i.onModify(e)},this.onUpdateBind=function(e){return i.onUpdate(e)},this.createBind=function(e){return i.create(e)},this.onVisibilityChangedBind=function(e){return i.onVisibilityChanged(e)}}return function(e,t,n){t&&$(e.prototype,t),n&&$(e,n)}(e,[{key:"register",value:function(){this.pushpinBillboardTool=new q(this.viewer,this.pushPinManager.options),this.viewer.toolController.registerTool(this.pushpinBillboardTool)}},{key:"deregister",value:function(){this.pushpinBillboardTool&&(this.viewer.toolController.deregisterTool(this.pushpinBillboardTool),this.pushpinBillboardTool=null)}},{key:"activate",value:function(){return this.pushpinBillboardTool.isActive()||this.viewer.toolController.activateTool("pushpinBillboard3D"),this.inputHandler=new X(this),this.viewer.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBind),this.viewer.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this.onSectionBind),this.pushPinManager.addEventListener(i.PUSH_PIN_SELECTED_EVENT,this.onSelectedChangedBind),this.pushPinManager.addEventListener(i.PUSH_PIN_REMOVED_EVENT,this.onRemoveBind),this.pushPinManager.addEventListener(i.PUSH_PIN_REMOVE_ALL_EVENT,this.onRemoveAllBind),this.pushPinManager.addEventListener(i.PUSH_PIN_MODIFY_EVENT,this.onModifyBind),this.pushPinManager.addEventListener(i.PUSH_PIN_UPDATE_EVENT,this.onUpdateBind),this.pushPinManager.addEventListener(i.PUSH_PIN_VISIBILITY_EVENT,this.onVisibilityChangedBind),this.pushPinManager.setCreateFunction(this.createBind),!0}},{key:"deactivate",value:function(){this.pushpinBillboardTool.isActive()&&this.viewer.toolController.deactivateTool("pushpinBillboard3D"),this.inputHandler.detach(),this.viewer.removeEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBind),this.viewer.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this.onSectionBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_SELECTED_EVENT,this.onSelectedChangedBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_REMOVED_EVENT,this.onRemoveBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_REMOVE_ALL_EVENT,this.onRemoveAllBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_MODIFY_EVENT,this.onModifyBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_UPDATE_EVENT,this.onUpdateBind),this.pushPinManager.removeEventListener(i.PUSH_PIN_VISIBILITY_EVENT,this.onVisibilityChangedBind),this.pushPinManager.removeCreateFunction(this.createBind)}},{key:"setPushpinDirty",value:function(){this.pushpinDirty=!0}},{key:"onSelectedChanged",value:function(e){if(e.value)this.selectedItem=e.value,this.selectedItem.marker||this.create(this.selectedItem),this.pushpinBillboardTool.selectPushpin(this.selectedItem),r(this.viewer,this.selectedItem),this.selectedItem.draggable&&this.enableItemDragging(this.selectedItem),this.viewer.dispatchEvent({type:i.PUSH_PIN_SELECTED_EVENT});else{this.deselectItem(),this.pushpinBillboardTool.deselect();var t=this.viewer.getExtension("Autodesk.Section");t&&1===t.getSectionPlanes().length?t.setSectionFromPlane(null):this.viewer.impl.setCutPlaneSet("__set_view",void 0)}this.setPushpinDirty()}},{key:"deselectItem",value:function(){this.selectedItem=null,this.inputHandler.detach()}},{key:"onRemove",value:function(e){this.selectedItem&&e.value.data.id===this.selectedItem.data.id&&this.deselectItem(),e.value&&e.value.marker&&this.pushpinBillboardTool.removePushpin(e.value)}},{key:"onRemoveAll",value:function(){this.deselectItem(),this.pushpinBillboardTool.removeAll()}},{key:"onModify",value:function(){this.pushpinDirty=!0}},{key:"onVisibilityChanged",value:function(){this.pushpinBillboardTool.showMarkers()}},{key:"onUpdate",value:function(){var e=this;setTimeout(function(){e.setPushpinDirty(),e.pushpinBillboardTool&&e.pushpinBillboardTool.setDirty();var t=e.pushPinManager?e.pushPinManager.getSelectedItem():null;t&&(t.draggable&&t.marker?e.enableItemDragging(t):e.disableItemDragging(t))},1)}},{key:"enableItemDragging",value:function(e){this.pushpinBillboardTool.enableDragging(e),this.inputHandler.attachTo(e.marker)}},{key:"disableItemDragging",value:function(e){this.pushpinBillboardTool.disableDragging(e),this.inputHandler.detach()}},{key:"onExplode",value:function(e){1*e.scale==0?this.pushpinBillboardTool.showMarkers():this.pushpinBillboardTool.hideMarkers()}},{key:"onSection",value:function(){}},{key:"create",value:function(e){return this.createRenderItem(e,Autodesk.Viewing.isIOSDevice())}},{key:"createRenderItem",value:function(e,t){var n,i=e.data.id.length>20;return this.pushpinBillboardTool.deselect(),i&&!t?n=this.pushpinBillboardTool.loadPushpin(e):(n=this.pushpinBillboardTool.createPushpin(e),this.pushPinManager.selectOne(e.data.id)),n}},{key:"updatePattern",value:function(e,t,n){this.pushpinBillboardTool.updateStyle(e,t,n),this.setPushpinDirty()}},{key:"render",value:function(){var e=this;this.pushPinManager&&this.viewer.model&&(this.pushPinManager.items().reverse().forEach(function(t){t.marker||e.createRenderItem(t,!1)}),this.pushpinDirty&&(this.pushpinBillboardTool.updatePushpins(),this.pushpinDirty=!1))}},{key:"findIntersections",value:function(e){var t=e.clientX,n=e.clientY,i=null;return this.pushPinManager.items().some(function(e){if(e.selectable&&e.marker){var s=e.marker.getBoundingClientRect();if(t>s.left&&t<s.left+s.width&&n>s.top&&n<s.top+s.height)return i=e,!0}return!1}),i}},{key:"handleMouseMove",value:function(e){if(this.selectedItem.marker.startDragging){this.newX||(this.selectedItem.marker.style.transform="translate(0px, 0px)");var t=function(e){return e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+document.body.scrollLeft-document.body.clientLeft,y:e.clientY+document.body.scrollTop-document.body.clientTop}}(e);this.newX=t.x-this.mouseOffset.x,this.newY=t.y-this.mouseOffset.y;var n=this.viewer.navigation.getScreenViewport(),i=this.selectedItem.marker.clientWidth,s=this.selectedItem.marker.clientHeight;this.newX<5&&(this.newX=0),this.newY<5&&(this.newY=0),n.width-5<this.newX+i&&(this.newX=n.width-i),n.height-5<this.newY+s&&(this.newY=n.height-s),this.selectedItem.marker.style.left="".concat(this.newX,"px"),this.selectedItem.marker.style.top="".concat(this.newY,"px");var o=this.viewer.impl.clientToViewport(this.newX+this.offsetWidth/2,this.newY+this.offsetWidth/2);this.viewer.impl.castRayViewport(o,!1)?this.selectedItem.marker.classList.remove("grey-out"):this.selectedItem.marker.classList.add("grey-out"),this.selectedItem.marker.dragging=!0}}},{key:"handleMouseUp",value:function(e){var t=this;if(this.selectedItem.marker.dragging){this.selectedItem.marker.style.left="0px",this.selectedItem.marker.style.top="0px",this.selectedItem.marker.style.transform="translate(".concat(this.newX,"px, ").concat(this.newY,"px)"),this.newX+=this.offsetWidth/2,this.newY+=this.offsetWidth/2;var n=this.viewer.impl.clientToWorld(this.newX,this.newY);n&&(this.selectedItem.data.position={x:n.point.x,y:n.point.y,z:n.point.z}),this.pushpinBillboardTool.removePushpin(this.selectedItem);var s=this.createRenderItem(this.selectedItem,!0);n&&s.then(function(){return t.pushPinManager.generateThumbnail(t.selectedItem)}).then(function(e){t.pushPinManager.fireEvent({type:i.PUSH_PIN_MODIFY_EVENT,value:t.selectedItem,thumbnail:e})}),this.selectedItem.marker.startDragging=!1,this.selectedItem.marker.dragging=!1,this.onUpdate()}else this.selectedItem.marker.startDragging=!1}},{key:"handleMouseDown",value:function(e){"textarea"!==e.target.tagName.toLowerCase()&&(this.offsetWidth=this.selectedItem.selected?f:A,this.mouseOffset=function(e,t){var n=function(e){for(var t=0,n=0;e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t+=e.offsetLeft,y:n+=e.offsetTop}}(e);return n.x+=t/2,n.y+=t/2,{x:n.x,y:n.y}}(this.viewer.container,this.offsetWidth),this.selectedItem.marker.style.opacity="1.0",this.newX=null,this.newY=null,this.selectedItem.marker.startDragging=!0)}}]),e}();function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ne=function(){function e(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.names=["pushpin"],this.priority=65,this.pushpinCursor=p,this.isActive=!1,this.pushPinInitData=null,this.viewer=t,this.pushPinManager=n,this.createMode=!1,this.testId="1111122222333334444455555",this.autoCreate=!1,this.is2D=this.viewer.model&&this.viewer.model.is2d(),!this.is2D){var i=this.viewer.model.getBoundingBox(),s=this.viewer.impl.worldUpName();this.isPseudo2D=i.max[s]-i.min[s]==0,this.pushPinManager.options.disableOcclusionTest=!0}}return function(e,t,n){t&&te(e.prototype,t),n&&te(e,n)}(e,[{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"getPriority",value:function(){return this.priority}},{key:"setAutoCreate",value:function(e){this.autoCreate=e}},{key:"getCursor",value:function(){return this.createMode?this.pushpinCursor:this.isHover?"pointer":null}},{key:"register",value:function(){this.renderTool||(this.is2D?this.renderTool=new Z(this.viewer,this.pushPinManager):this.renderTool=new ee(this.viewer,this.pushPinManager),this.renderTool.register())}},{key:"deregister",value:function(){this.renderTool&&(this.renderTool.deregister(),this.renderTool=null)}},{key:"activate",value:function(e,t){e===this.getName()&&(this.renderTool.activate(),this.isActive=!0)}},{key:"deactivate",value:function(e){e===this.getName()&&(this.show(!1),this.isActive=!1)}},{key:"update",value:function(){return this.isActive&&this.duringShowing&&this.renderTool&&this.renderTool.render(),!1}},{key:"show",value:function(e){this.duringShowing=e}},{key:"enablePushPinSelect",value:function(e){this.pushPinManager.items().forEach(function(t){t.selectable=e})}},{key:"startCreateItem",value:function(e){if(this.isActive){var t=this.viewer.toolController;t&&t.getActiveToolName()!==this.getName()&&(t.deactivateTool(this.getName()),t.activateTool(this.getName())),this.duringShowing||this.show(!0),this.pushPinInitData=e,this.createMode=!0,this.enablePushPinSelect(!1)}this.viewer.dispatchEvent({type:i.PUSH_PIN_SELECTED_EVENT})}},{key:"endCreateItem",value:function(){this.pushPinInitData=null,this.createMode&&(this.createMode=!1,this.enablePushPinSelect(!0))}},{key:"createThreePushPin",value:function(e){var t,n=null,i=e.canvasX,s=e.canvasY;return(t=this.isPseudo2D?{point:this.viewer.impl.intersectGround(i,s)}:this.viewer.impl.clientToWorld(i,s))&&this.pushPinInitData&&(this.pushPinInitData.position={x:t.point.x,y:t.point.y,z:t.point.z},n=this.pushPinManager.createItem(this.pushPinInitData),this.pushPinInitData=null),n}},{key:"createTwoPushPin",value:function(e){var t=null,n=e.canvasX,i=e.canvasY,s=k(this.viewer,n,i);return s&&this.pushPinInitData&&(this.pushPinInitData.position={x:s.x,y:s.y,z:s.z},t=this.pushPinManager.createItem(this.pushPinInitData),this.pushPinInitData=null),t}},{key:"createPushPin",value:function(e){return this.autoCreate&&!this.pushPinInitData&&(this.pushPinInitData={id:this.testId+"1",status:"issues-open",type:"issues"}),!!this.pushPinInitData&&(this.viewer.model.is2d()?this.createTwoPushPin(e):this.createThreePushPin(e))}},{key:"handleSingleTap",value:function(t){return e.convertEventHammerToMouse(t),this.handleSingleClick(t,0)}},{key:"triggerPushpinClick",value:function(e){this.pushPinManager.selectOne(e.data.id),this.pushPinManager.fireEvent({type:i.PUSH_PIN_CLICKED_EVENT,value:this.pushPinManager.getSelectedItem()})}},{key:"checkPushpinClick",value:function(e){return this.renderTool.findIntersections(e)}},{key:"handleSingleClick",value:function(e,t){var n=this.checkPushpinClick(e),s=!1;if(this.createMode||(n?(this.triggerPushpinClick(n),s=!0):this.pushPinManager.selectedItem&&(this.pushPinManager.selectNone(),this.pushPinManager.fireEvent({type:i.PUSH_PIN_SELECT_NONE,value:null}))),this.isActive&&0===t){if(!n)return this.createPushPin(e);s||this.triggerPushpinClick(n)}return n&&document.addEventListener("click",function e(t){t.stopPropagation(),document.removeEventListener("click",e,!0)},!0),!!n}},{key:"handleMouseMove",value:function(e){var t=this.checkPushpinClick(e);return this.isHover=!!t,!1}}],[{key:"convertEventHammerToMouse",value:function(e){e.shiftKey=!1,e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY}}]),e}();function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}AutodeskNamespace("Autodesk.BIM360.Extension.PushPin").PushPinTool=ne;var se=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.extension=n,this.pushpinVisBtn=null,this.initiallyHidePushpins=i,this.setButtonConstants()}return function(e,t,n){t&&ie(e.prototype,t),n&&ie(e,n)}(e,[{key:"setButtonConstants",value:function(){this.buttonConstants={btnClass:"",btnLabel:"",noPushpinLabel:"",hidePushpinLabel:"",showPushpinLabel:"",pushpinNormalIcon:"",pushpinHideIcon:""},this.type=""}},{key:"createButton",value:function(){var t=new Autodesk.Viewing.UI.Button(this.buttonConstants.btnClass);return t.setToolTip(Autodesk.Viewing.i18n.translate(this.buttonConstants.btnLabel)),t.setIcon(this.buttonConstants.pushpinNormalIcon),t.onClick=function(){var n=t.getState();n!==e.DISABLED&&t.setState(n===e.INACTIVE?e.ACTIVE:e.INACTIVE)},t}},{key:"onPushpinVisBtnStateChange",value:function(t){if(t.state!==e.DISABLED){var n=t.state===e.ACTIVE&&!this.initiallyHidePushpins;this.initiallyHidePushpins&&(this.pushpinVisBtn.setState(e.INACTIVE),this.initiallyHidePushpins=!1),n?(this.extension.tool.show(!0),this.extension.showByType(this.type),this.pushpinVisBtn.setToolTip(Autodesk.Viewing.i18n.translate(this.buttonConstants.hidePushpinLabel)),this.pushpinVisBtn.setIcon(this.buttonConstants.pushpinNormalIcon)):(this.extension.hideByType(this.type),this.pushpinVisBtn.setToolTip(Autodesk.Viewing.i18n.translate(this.buttonConstants.showPushpinLabel)),this.pushpinVisBtn.setIcon(this.buttonConstants.pushpinHideIcon))}else this.pushpinVisBtn.setToolTip(Autodesk.Viewing.i18n.translate(this.buttonConstants.noPushpinLabel))}},{key:"addButton",value:function(){var e=this;if(!this.pushpinVisBtn&&this.viewer.getToolbar){var t=this.viewer.getToolbar();if(t){var n=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(!n){var s=t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),o={};o.index=s?t.indexOf(s)+1:0,n=new Autodesk.Viewing.UI.ControlGroup(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),t.addControl(n,o)}this.pushpinVisBtn=this.createButton(),this.pushpinVisBtn.addEventListener(Autodesk.Viewing.UI.Button.Event.STATE_CHANGED,function(t){e.onPushpinVisBtnStateChange(t)}),this.updateButtonStatus(),n.addControl(this.pushpinVisBtn),this.extension.pushPinManager.addEventListener(i.PUSH_PIN_REMOVED_EVENT,function(){e.updateButtonStatus()}),this.extension.pushPinManager.addEventListener(i.PUSH_PIN_REMOVE_ALL_EVENT,function(){e.updateButtonStatus()}),this.extension.pushPinManager.addEventListener(i.PUSH_PIN_CREATED_EVENT,function(){e.updateButtonStatus()}),this.extension.pushPinManager.addEventListener(i.PUSH_PIN_ITEMS_LOADED,function(){e.updateButtonStatus()}),this.extension.pushPinManager.addEventListener(i.PUSH_PIN_PREPARING_THUMBNAIL,function(){e.updateButtonStatus()}),this.extension.pushPinManager.addEventListener(i.PUSH_PIN_ITEMS_LOADED,function(){e.updateButtonStatus()})}}}},{key:"updateButtonStatus",value:function(){if(this.pushpinVisBtn)if(this.extension.tool.createMode)this.pushpinVisBtn.getState()!==e.DISABLED&&this.pushpinVisBtn.setState(e.DISABLED);else{var t=this.extension.pushPinManager.getItemCountByType(this.type),n=this.pushpinVisBtn.getState()===e.DISABLED;t>0&&n?this.pushpinVisBtn.setState(e.ACTIVE):0!==t||n||this.pushpinVisBtn.setState(e.DISABLED)}}},{key:"destroyButton",value:function(){this.pushpinVisBtn&&(this.extension.pushPinManager.removeEventListener(i.PUSH_PIN_REMOVED_EVENT,this.updateButtonStatus),this.extension.pushPinManager.removeEventListener(i.PUSH_PIN_REMOVE_ALL_EVENT,this.updateButtonStatus),this.extension.pushPinManager.removeEventListener(i.PUSH_PIN_CREATED_EVENT,this.updateButtonStatus),this.viewer.getToolbar()&&this.pushpinVisBtn.removeFromParent(),this.pushpinVisBtn.removeEventListener(Autodesk.Viewing.UI.Button.Event.STATE_CHANGED,this.onPushpinVisBtnStateChange),this.pushpinVisBtn=null)}},{key:"pushPinButton",get:function(){return this.pushpinVisBtn}}]),e}();function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ae(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}se.ACTIVE=Autodesk.Viewing.UI.Button.State.ACTIVE,se.DISABLED=Autodesk.Viewing.UI.Button.State.DISABLED,se.INACTIVE=Autodesk.Viewing.UI.Button.State.INACTIVE;var he=function(e){function t(e,n,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=ae(this,ue(t).call(this,e,n,i))).viewer=e,s.extension=n,s.pushpinVisBtn=null,s.setButtonConstants(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(t,se),function(e,t,n){t&&re(e.prototype,t),n&&re(e,n)}(t,[{key:"setButtonConstants",value:function(){this.buttonConstants={btnClass:"toolbar-pushpinVis",btnLabel:"Show all pushpins",noPushpinLabel:"No issue in current doc",hidePushpinLabel:"Hide all issues",showPushpinLabel:"Show all issues",pushpinNormalIcon:"issueicon-issue_normal",pushpinHideIcon:"issueicon-issue_hide"},this.type=this.extension.pushPinManager.PushPinTypes.ISSUES}}]),t}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function pe(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ae(e){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ve=function(e){function t(e,n,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=pe(this,Ae(t).call(this,e,n,i))).viewer=e,s.extension=n,s.pushpinVisBtn=null,s.setButtonConstants(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,se),function(e,t,n){t&&de(e.prototype,t),n&&de(e,n)}(t,[{key:"setButtonConstants",value:function(){this.buttonConstants={btnClass:"toolbar-pushpinRfisVis",btnLabel:"Show all rfis",noPushpinLabel:"No RFI in current doc",hidePushpinLabel:"Hide all RFIs",showPushpinLabel:"Show all RFIs",pushpinNormalIcon:"rfiicon-rfi_normal",pushpinHideIcon:"rfiicon-rfi_hide"},this.type=this.extension.pushPinManager.PushPinTypes.RFIS}}]),t}();function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ge(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe=function(e){function t(e,n,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=ge(this,be(t).call(this,e,n,i))).viewer=e,s.extension=n,s.pushpinVisBtn=null,s.setButtonConstants(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,se),function(e,t,n){t&&me(e.prototype,t),n&&me(e,n)}(t,[{key:"setButtonConstants",value:function(){this.buttonConstants={btnClass:"toolbar-pushpinFieldIssuesVis",btnLabel:"Show all field pushpins",noPushpinLabel:"No field issue in current doc",hidePushpinLabel:"Hide all field issues",showPushpinLabel:"Show all field issues",pushpinNormalIcon:"fieldissueicon-issue_normal",pushpinHideIcon:"fieldissueicon-issue_hide"},this.type=this.extension.pushPinManager.PushPinTypes.QUALITY_ISSUES}}]),t}();function we(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ie=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pushpinExtension=t,this.addListeners()}return function(e,t,n){t&&we(e.prototype,t),n&&we(e,n)}(e,[{key:"addListeners",value:function(){this.pushpinExtension&&(this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_CREATED_EVENT,function(t){e.postMessage("onPushPinCreated",t)}),this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_PREPARING_THUMBNAIL,function(t){e.postMessage("onPushPinPreparingThumbnail",t)}),this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_CLICKED_EVENT,function(t){e.postMessage("onPushPinActived",t)}),this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_MODIFY_EVENT,function(t){e.postMessage("onPushPinMoved",t)}),this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_SELECT_NONE,function(t){e.postMessage("onPushPinSelectNone",t)}),this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_UPDATE_EVENT,function(t){e.postMessage("onPushPinUpdated",t)}),this.pushpinExtension.addEventListener(Autodesk.BIM360.Extension.PushPin.PUSH_PIN_ITEMS_LOADED,function(t){e.postMessage("onPushPinItemsLoaded",t)}),e.postMessage("onPushPinToolLoaded",{}))}}],[{key:"postMessage",value:function(e,t){var n=t.value,i=t.thumbnail||"",s={};n&&(s={id:n.data.id,label:n.data.label,status:n.data.status,position:{x:n.data.position.x,y:n.data.position.y,z:n.data.position.z},type:n.data.type,objectId:n.data.objectId,externalId:n.data.externalId,viewerState:n.data.viewerState,attributesVersion:n.data.attributesVersion}),void 0!==window.webkit?window.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:{metadata:s,thumbnail:i}}):window.JSINTERFACE&&(n?window.JSINTERFACE[e](s.id,s.type,s.label,s.status,s.position.x,s.position.y,s.position.z,s.objectId,JSON.stringify(s.viewerState),s.externalId,s.attributesVersion,i):window.JSINTERFACE[e]())}}]),e}(),ke=function(e,t){if(function(e){var t=e&&e.myData.metadata["world bounding box"],n=new THREE.Box3;return n.min.fromArray(t.minXYZ),n.max.fromArray(t.maxXYZ),n}(e).distanceToPoint(t.position)*e.getUnitScale()<100)return!1;var n=e.getBoundingBox(),i=(new THREE.Vector3).copy(t.position).sub(t.viewerState.globalOffset);return n.containsPoint(i)},Be=function(e,t){var n=b(t,e.viewerState.seedUrn);n&&ke(n,e)&&function(e,t){var n=e.myData.placementTransform,i=n&&(new THREE.Matrix4).getInverse(n);n&&(t.position=(new THREE.Vector3).copy(t.position).applyMatrix4(i),t.viewerState=JSON.parse(JSON.stringify(t.viewerState)),h(t.viewerState,i))}(n,e)};n(248);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function xe(e,t){return!t||"object"!==Te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"default",function(){return Ne});var Ce=AutodeskNamespace("Autodesk.BIM360.Extension.PushPin"),Ne=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=xe(this,Se(t).call(this,e,i))).viewer=e,n.options=i,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(t,Autodesk.Viewing.Extension),function(e,t,n){t&&Me(e.prototype,t),n&&Me(e,n)}(t,[{key:"load",value:function(){return this.pushPinManager=new _(this.viewer,this.options),this.tool=new ne(this.viewer,this.pushPinManager,this.options),this.pushpinsByType=this.pushPinManager.getInitialPushpinsByType(),Autodesk.Viewing.isMobileDevice()&&(this.observer=new Ie(this)),!!this.viewer.toolController&&(this.viewer.toolController.registerTool(this.tool),this.viewer.toolController.activateTool(this.tool.getName()),this.createUI(),!0)}},{key:"unload",value:function(){return this.destroyUI(),this.pushPinManager&&(this.pushPinManager.selectNone(),this.pushPinManager.removeAllItems(),this.pushPinManager=null),this.tool&&(this.viewer.toolController.deregisterTool(this.tool),this.tool=null),!0}},{key:"startCreateItem",value:function(e){this.tool.startCreateItem(e),this.updateButtonsStatus()}},{key:"endCreateItem",value:function(){this.tool.endCreateItem(),this.updateButtonsStatus()}},{key:"showAll",value:function(){for(var e in this.pushPinManager.PushPinTypes)this.showByType(this.pushPinManager.PushPinTypes[e])}},{key:"hideAll",value:function(){for(var e in this.pushPinManager.PushPinTypes)this.hideByType(this.pushPinManager.PushPinTypes[e])}},{key:"enableItemSelect",value:function(e){this.tool.enablePushPinSelect(e)}},{key:"updatePattern",value:function(e,t,n){this.tool.renderTool.updatePattern(e,t,n)}},{key:"loadItems",value:function(e){this.tool.show(!0),this.pushPinManager.addItems(e)}},{key:"loadItemFromLocal",value:function(e){this.pushPinManager.addItems([e],!0,this.viewer)}},{key:"updateItemById",value:function(e,t){return this.pushPinManager.updateItemById(e,t)}},{key:"getItemById",value:function(e){var t=this.pushPinManager.getItemById(e);return t?t.data:null}},{key:"setDraggableById",value:function(e,t,n){var s=this.pushPinManager.getItemById(e);s&&(n&&s.setPosition(this.origItemPosition),s.draggable=t,this.pushPinManager.fireEvent({type:i.PUSH_PIN_UPDATE_EVENT,value:s}),this.origItemPosition=Object.assign({},s.data.position))}},{key:"setVisibleById",value:function(e,t){var n=this.pushPinManager.getItemById(e);n&&(n.visible=t,this.pushPinManager.fireEvent({type:i.PUSH_PIN_UPDATE_EVENT,value:n}))}},{key:"selectOne",value:function(e){this.pushPinManager.selectOne(e)}},{key:"selectNone",value:function(){this.pushPinManager.selectNone()}},{key:"removeItemById",value:function(e){this.pushPinManager.getItemById(e)&&this.pushPinManager.removeItemById(e)}},{key:"removeItemsByType",value:function(e){this.pushPinManager.removeItemsByType(e)}},{key:"removeAllItems",value:function(){this.pushPinManager.removeAllItems()}},{key:"addEventListener",value:function(e,t){this.pushPinManager.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.pushPinManager.removeEventListener(e,t)}},{key:"hasEventListener",value:function(e,t){this.pushPinManager.hasEventListener(e,t)}},{key:"createUI",value:function(){if(this.uiButtons=[],this.options.hideIssuesButton||this.uiButtons.push(new he(this.viewer,this,this.options.initiallyHideIssuesPushpins)),this.options.hideFieldIssuesButton||this.uiButtons.push(new Pe(this.viewer,this,this.options.initiallyHideFieldIssuesPushpins)),this.options.hideRfisButton||this.uiButtons.push(new ve(this.viewer,this,this.options.initiallyHideRfisPushpins)),this.viewer.model)this.uiButtons.forEach(function(e){e.addButton()});else{var e=this;this.viewer.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,function t(){e.viewer.model&&e.uiButtons.forEach(function(e){e.addButton()}),e.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,t)})}}},{key:"destroyUI",value:function(){this.uiButtons.forEach(function(e){e.destroyButton()})}},{key:"updateButtonsStatus",value:function(){this.uiButtons.forEach(function(e){e.updateButtonStatus()})}},{key:"hideByType",value:function(e){this.pushPinManager&&this.pushPinManager.setVisibleByType(e,!1)}},{key:"showByType",value:function(e){this.pushPinManager&&this.pushPinManager.setVisibleByType(e,!0)}},{key:"legacyToLocalPushPinData",value:function(e){!function(e,t){var n=e.viewerState.globalOffset;n||(n=t.model&&t.model.myData.globalOffset),n&&(e.position.x+=n.x,e.position.y+=n.y,e.position.z+=n.z)}(e,this.viewer),this.options.useLegacyFallback&&Be(e,this.viewer)}},{key:"getLegacyPushPinData",value:function(e){return function(e,t){if(!t.model||!t.model.is3d())return e.data;var n=e.getLocal(t),i=e.findModel(t);return i?(function(e,t){e.viewerState.globalOffset=function(e){var t=e&&e.myData.metadata["world bounding box"],n=t.minXYZ,i=t.maxXYZ;return{x:.5*(n[0]+i[0]),y:.5*(n[1]+i[1]),z:.5*(n[2]+i[2])}}(t),e.position.x-=e.viewerState.globalOffset.x,e.position.y-=e.viewerState.globalOffset.y,e.position.z-=e.viewerState.globalOffset.z}(n,i),n):(console.error("Saving issue attributes failed: Issue must be assigned to a visible model."),e.data)}(e,this.viewer)}}]),t}();Ce.PUSH_PIN_EXT_NAME="Autodesk.BIM360.Extension.PushPin",Object.assign(Ce,i),Autodesk.Viewing.theExtensionManager.registerExtension(Ce.PUSH_PIN_EXT_NAME,Ne)}});
//# sourceMappingURL=Pushpins.min.js.map